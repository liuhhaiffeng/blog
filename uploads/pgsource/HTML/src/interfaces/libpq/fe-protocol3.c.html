<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\interfaces\libpq\fe-protocol3.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\interfaces\libpq\fe-protocol3.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:11 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * fe-protocol3.c 
 *    functions that are specific to frontend/backend protocol version 3 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/interfaces/libpq/fe-protocol3.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;fcntl.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"libpq-fe.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq-int.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Keyword'>#include </span><span class='String'>"win32.h"</span> 
<span class='Directive'>#else</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/in.h&GT;</span> 
<span class='Directive'>#ifdef</span> HAVE_NETINET_TCP_H 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/tcp.h&GT;</span> 
<span class='Directive'>#endif</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;arpa/inet.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * This macro lists the backend message types that could be "long" (more 
 * than a couple of kilobytes). 
 */ 
</span><a name="LN40"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>VALID_LONG_MESSAGE_TYPE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>id</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="fe-protocol3.c.html#LN40"><span class='Ref_to_Parameter'>id</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'T'</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN40"><span class='Ref_to_Parameter'>id</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'D'</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN40"><span class='Ref_to_Parameter'>id</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'d'</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN40"><span class='Ref_to_Parameter'>id</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'V'</span> <span class='Operator'>|| \ 
</span>     <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN40"><span class='Ref_to_Parameter'>id</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'E'</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN40"><span class='Ref_to_Parameter'>id</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'N'</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN40"><span class='Ref_to_Parameter'>id</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'A'</span><span class='Parentheses'>)</span> 
 
 
<a name="LN45"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>handleSyncLoss</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>id</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>msgLength</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN46"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>getRowDescriptions</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>msgLength</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>getParamDescriptions</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>msgLength</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN48"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>getAnotherTuple</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>msgLength</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN49"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>getParameterStatus</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN50"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>getNotify</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN51"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>getCopyStart</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN81"><span class='Ref_to_Typedef'>ExecStatusType</span></a> <span class='Declare_Parameter'>copytype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN52"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>getReadyForQuery</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN53"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>reportErrorPosition</span><span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN54"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>loc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>encoding</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN55"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>build_startup_packet</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>packet</span><span class='Delimiter'>, 
</span><a name="LN56"></a>                     <span class='Keyword'>const </span><a href="libpq-int.h.html#LN248"><span class='Ref_to_Struct'>PQEnvironmentOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * parseInput: if appropriate, parse input data from backend 
 * until input is exhausted or a stopping state is reached. 
 * Note that this function will NOT attempt to read more data from the backend. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN65"></a><span class='Declare_Function'>pqParseInput3</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN67"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>id</span><span class='Delimiter'>; 
</span><a name="LN68"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>msgLength</span><span class='Delimiter'>; 
</span><a name="LN69"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>avail</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Loop to parse successive complete messages available in the buffer. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Try to read a message.  First get the type code and length. Return 
         * if not enough data. 
         */ 
</span>        <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Try to validate message type/length here.  A length less than 4 is 
         * definitely broken.  Large lengths should only be believed for a few 
         * message types. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol3.c.html#LN45"><span class='Ref_to_Proto'>handleSyncLoss</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&GT; </span><span class='Number'>30000</span> <span class='Operator'>&& !</span><a href="fe-protocol3.c.html#LN40"><span class='Ref_to_Macro'>VALID_LONG_MESSAGE_TYPE</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol3.c.html#LN45"><span class='Ref_to_Proto'>handleSyncLoss</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Can't process if message body isn't all here yet. 
         */ 
</span>        <a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>-= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN69"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a> <span class='Operator'>- </span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN69"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Before returning, enlarge the input buffer if needed to hold 
             * the whole message.  This is better than leaving it to 
             * pqReadData because we can avoid multiple cycles of realloc() 
             * when the message is large; also, we can implement a reasonable 
             * recovery strategy if we are unable to make the buffer big 
             * enough. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN408"><span class='Ref_to_Func'>pqCheckInBufferSpace</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span>size_t<span class='Parentheses'>) </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>, 
</span>                                     <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * XXX add some better recovery code... plan is to skip over 
                 * the message using its length, then report an error. For the 
                 * moment, just treat this like loss of sync (which indeed it 
                 * might be!) 
                 */ 
</span>                <a href="fe-protocol3.c.html#LN45"><span class='Ref_to_Proto'>handleSyncLoss</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if avail&LT;msgLength &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * NOTIFY and NOTICE messages can happen in any state; always process 
         * them right away. 
         * 
         * Most other messages should only be processed while in BUSY state. 
         * (In particular, in READY state we hold off further parsing until 
         * the application collects the current PGresult.) 
         * 
         * However, if the state is IDLE then we got trouble; we need to deal 
         * with the unexpected message somehow. 
         * 
         * ParameterStatus ('S') messages are a special case: in IDLE state we 
         * must process 'em (this case could happen if a new value was adopted 
         * from config file due to SIGHUP), but otherwise we hold off until 
         * BUSY state. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='String'>'A'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN39"><span class='Ref_to_Proto'>getNotify</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='String'>'N'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN603"><span class='Ref_to_Proto'>pqGetErrorNotice3</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN216"><span class='Ref_to_EnumConst'>PGASYNC_BUSY</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* If not IDLE state, just wait ... */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN215"><span class='Ref_to_EnumConst'>PGASYNC_IDLE</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Unexpected message in IDLE state; need to recover somehow. 
             * ERROR messages are handled using the notice processor; 
             * ParameterStatus is handled normally; anything else is just 
             * dropped on the floor after displaying a suitable warning 
             * notice.  (An ERROR is very possibly the backend telling us why 
             * it is about to close the connection, so we don't want to just 
             * discard it...) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='String'>'E'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN603"><span class='Ref_to_Proto'>pqGetErrorNotice3</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false </span><span class='Comment_Multi_Line'>/* treat as notice */ </span><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='String'>'S'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN49"><span class='Ref_to_Proto'>getParameterStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="fe-exec.c.html#LN799"><span class='Ref_to_Func'>pqInternalNotice</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Delimiter'>, 
</span>                        <span class='String'>"message type 0x%02x arrived from server while idle"</span><span class='Delimiter'>, 
</span>                                 <a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Discard the unexpected message */ 
</span>                <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+= </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if conn-&GT;asyncStatus!=PG... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * In BUSY state, we can process everything. 
             */ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='String'>'C'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* command complete */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                                                           <a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                            <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN177"><span class='Ref_to_Member'>cmdStatus</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                                <a href="libpq-int.h.html#LN85"><span class='Ref_to_Const'>CMDSTATUS_LEN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'E'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* error return */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN603"><span class='Ref_to_Proto'>pqGetErrorNotice3</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'Z'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* backend is ready for new query */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN52"><span class='Ref_to_Proto'>getReadyForQuery</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN215"><span class='Ref_to_EnumConst'>PGASYNC_IDLE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'I'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* empty query */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                                                           <a href="libpq-fe.h.html#LN83"><span class='Ref_to_EnumConst'>PGRES_EMPTY_QUERY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                            <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'1'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Parse Complete */ 
</span>                    <span class='Comment_Multi_Line'>/* If we're doing PQprepare, we're done; else ignore */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN380"><span class='Ref_to_Member'>queryclass</span></a> <span class='Operator'>== </span><a href="libpq-int.h.html#LN228"><span class='Ref_to_EnumConst'>PGQUERY_PREPARE</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                                                           <a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                            <span class='Delimiter'>{ 
</span>                                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                             <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                                <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                        <span class='Delimiter'>} 
</span>                        <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'2'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Bind Complete */ 
</span>                <span class='Control'>case</span> <span class='String'>'3'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Close Complete */ 
</span>                    <span class='Comment_Multi_Line'>/* Nothing to do for these message types */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* parameter status */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN49"><span class='Ref_to_Proto'>getParameterStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'K'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* secret key data from the backend */ 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * This is expected only during backend startup, but it's 
                     * just as easy to handle it as part of the main loop. 
                     * Save the data and continue processing. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN419"><span class='Ref_to_Member'>be_pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN420"><span class='Ref_to_Member'>be_key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'T'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Row Description */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                        <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN176"><span class='Ref_to_Member'>resultStatus</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * We've already choked for some reason.  Just discard 
                         * the data till we get to the end of the query. 
                         */ 
</span>                        <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+= </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>                             <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN380"><span class='Ref_to_Member'>queryclass</span></a> <span class='Operator'>== </span><a href="libpq-int.h.html#LN229"><span class='Ref_to_EnumConst'>PGQUERY_DESCRIBE</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* First 'T' in a query sequence */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN35"><span class='Ref_to_Proto'>getRowDescriptions</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>return</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* getRowDescriptions() moves inStart itself */ 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * A new 'T' message is treated as the start of 
                         * another PGresult.  (It is not clear that this is 
                         * really possible with the current backend.) We stop 
                         * parsing until the application accepts the current 
                         * result. 
                         */ 
</span>                        <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* No Data */ 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * NoData indicates that we will not be seeing a 
                     * RowDescription message because the statement or portal 
                     * inquired about doesn't return rows. 
                     * 
                     * If we're doing a Describe, we have to pass something 
                     * back to the client, so set up a COMMAND_OK result, 
                     * instead of TUPLES_OK.  Otherwise we can just ignore 
                     * this message. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN380"><span class='Ref_to_Member'>queryclass</span></a> <span class='Operator'>== </span><a href="libpq-int.h.html#LN229"><span class='Ref_to_EnumConst'>PGQUERY_DESCRIBE</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, 
</span>                                                           <a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                            <span class='Delimiter'>{ 
</span>                                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                             <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                                <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                        <span class='Delimiter'>} 
</span>                        <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Parameter Description */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN47"><span class='Ref_to_Proto'>getParamDescriptions</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* getParamDescriptions() moves inStart itself */ 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Data Row */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                        <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN176"><span class='Ref_to_Member'>resultStatus</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Read another tuple of a normal query response */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN36"><span class='Ref_to_Proto'>getAnotherTuple</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>return</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* getAnotherTuple() moves inStart itself */ 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                             <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN176"><span class='Ref_to_Member'>resultStatus</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * We've already choked for some reason.  Just discard 
                         * tuples till we get to the end of the query. 
                         */ 
</span>                        <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+= </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Set up to report error at end of query */ 
</span>                        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"server sent data (\"D\" message) without prior row description (\"T\" message)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* Discard the unexpected message */ 
</span>                        <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+= </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'G'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Start Copy In */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN51"><span class='Ref_to_Proto'>getCopyStart</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN91"><span class='Ref_to_EnumConst'>PGRES_COPY_IN</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN218"><span class='Ref_to_EnumConst'>PGASYNC_COPY_IN</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'H'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Start Copy Out */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN51"><span class='Ref_to_Proto'>getCopyStart</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN90"><span class='Ref_to_EnumConst'>PGRES_COPY_OUT</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN219"><span class='Ref_to_EnumConst'>PGASYNC_COPY_OUT</span></a><span class='Delimiter'>; 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN388"><span class='Ref_to_Member'>copy_already_done</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'W'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Start Copy Both */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN51"><span class='Ref_to_Proto'>getCopyStart</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN96"><span class='Ref_to_EnumConst'>PGRES_COPY_BOTH</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN220"><span class='Ref_to_EnumConst'>PGASYNC_COPY_BOTH</span></a><span class='Delimiter'>; 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN388"><span class='Ref_to_Member'>copy_already_done</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Copy Data */ 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If we see Copy Data, just silently drop it.  This would 
                     * only occur if application exits COPY OUT mode too 
                     * early. 
                     */ 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+= </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Copy Done */ 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If we see Copy Done, just silently drop it.  This is 
                     * the normal case during PQendcopy.  We will keep 
                     * swallowing data, expecting to see command-complete for 
                     * the COPY command. 
                     */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>                                                    <span class='String'>"unexpected response from server; first received character was \"%c\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* build an error result holding the error message */ 
</span>                    <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* not sure if we will see more, so go to ready state */ 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* Discard the unexpected message */ 
</span>                    <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+= </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch id &raquo; </span>                   <span class='Comment_Single_Line'>/* switch on protocol character */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Comment_Multi_Line'>/* Successfully consumed this message */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>== </span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+ </span><span class='Number'>5</span> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Normal case: parsing agrees with specified length */ 
</span>            <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Trouble --- report it */ 
</span>            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"message contents do not agree with length in message type \"%c\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="fe-protocol3.c.html#LN67"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* build an error result holding the error message */ 
</span>            <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* trust the specified message length as what to skip */ 
</span>            <a href="fe-protocol3.c.html#LN65"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+= </span><span class='Number'>5</span> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN68"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end pqParseInput3 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * handleSyncLoss: clean up after loss of message-boundary sync 
 * 
 * There isn't really a lot we can do here except abandon the connection. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN449"></a><span class='Declare_Function'>handleSyncLoss</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>id</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>msgLength</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN449"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>( 
</span>    <span class='String'>"lost synchronization with server: got message type \"%c\", length %d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="fe-protocol3.c.html#LN449"><span class='Ref_to_Parameter'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN449"><span class='Ref_to_Parameter'>msgLength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* build an error result holding the error message */ 
</span>    <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN449"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN449"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* drop out of GetResult wait loop */ 
</span>    <span class='Comment_Multi_Line'>/* flush input data since we're giving up on processing it */ 
</span>    <a href="fe-connect.c.html#LN403"><span class='Ref_to_Func'>pqDropConnection</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN449"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN449"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN377"><span class='Ref_to_Member'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN49"><span class='Ref_to_EnumConst'>CONNECTION_BAD</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* No more connection to backend */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * parseInput subroutine to read a 'T' (row descriptions) message. 
 * We'll build a new PGresult structure (unless called for a Describe 
 * command for a prepared statement) containing the attribute data. 
 * Returns: 0 if processed message successfully, EOF to suspend parsing 
 * (the latter case is not actually used currently). 
 * In the former case, conn-&GT;inStart has been advanced past the message. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN472"></a><span class='Declare_Function'>getRowDescriptions</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>msgLength</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN474"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN475"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nfields</span><span class='Delimiter'>; 
</span><a name="LN476"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>errmsg</span><span class='Delimiter'>; 
</span><a name="LN477"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * When doing Describe for a prepared statement, there'll already be a 
     * PGresult created by getParamDescriptions, and we should fill data into 
     * that.  Otherwise, create a new, empty PGresult. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN380"><span class='Ref_to_Member'>queryclass</span></a> <span class='Operator'>== </span><a href="libpq-int.h.html#LN229"><span class='Ref_to_EnumConst'>PGQUERY_DESCRIBE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>            <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN476"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* means "out of memory", see below */ 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN605"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* parseInput already read the 'T' label and message length. */ 
</span>    <span class='Comment_Multi_Line'>/* the next two bytes are the number of fields */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN169"><span class='Ref_to_Member'>numAttributes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We should not run out of data here, so complain */ 
</span>        <a href="fe-protocol3.c.html#LN476"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"insufficient data in \"T\" message"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN605"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-protocol3.c.html#LN475"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN169"><span class='Ref_to_Member'>numAttributes</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* allocate space for the attribute descriptors */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN475"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN234"><span class='Ref_to_Typedef'>PGresAttDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="fe-exec.c.html#LN504"><span class='Ref_to_Func'>pqResultAlloc</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN475"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN234"><span class='Ref_to_Typedef'>PGresAttDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>TRUE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol3.c.html#LN476"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* means "out of memory", see below */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN605"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN475"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN234"><span class='Ref_to_Typedef'>PGresAttDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* result-&GT;binary is true only if ALL columns are binary */ 
</span>    <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN178"><span class='Ref_to_Member'>binary</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN475"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* get type info */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN475"><span class='Ref_To_Local'>nfields</span></a><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN528"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>tableid</span><span class='Delimiter'>; 
</span><a name="LN529"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>columnid</span><span class='Delimiter'>; 
</span><a name="LN530"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>typid</span><span class='Delimiter'>; 
</span><a name="LN531"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN532"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>atttypmod</span><span class='Delimiter'>; 
</span><a name="LN533"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>format</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN528"><span class='Ref_To_Local'>tableid</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN529"><span class='Ref_To_Local'>columnid</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN530"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN531"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN532"><span class='Ref_To_Local'>atttypmod</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN533"><span class='Ref_To_Local'>format</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* We should not run out of data here, so complain */ 
</span>            <a href="fe-protocol3.c.html#LN476"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"insufficient data in \"T\" message"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN605"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Since pqGetInt treats 2-byte integers as unsigned, we need to 
         * coerce these results to signed form. 
         */ 
</span>        <a href="fe-protocol3.c.html#LN529"><span class='Ref_To_Local'>columnid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) ((</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><a href="fe-protocol3.c.html#LN529"><span class='Ref_To_Local'>columnid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN531"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) ((</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><a href="fe-protocol3.c.html#LN531"><span class='Ref_To_Local'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN533"><span class='Ref_To_Local'>format</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) ((</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><a href="fe-protocol3.c.html#LN533"><span class='Ref_To_Local'>format</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN236"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN570"><span class='Ref_to_Proto'>pqResultStrdup</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                                  <a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN236"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol3.c.html#LN476"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* means "out of memory", see below */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN605"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN237"><span class='Ref_to_Member'>tableid</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN528"><span class='Ref_To_Local'>tableid</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN238"><span class='Ref_to_Member'>columnid</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN529"><span class='Ref_To_Local'>columnid</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN239"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN533"><span class='Ref_To_Local'>format</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN240"><span class='Ref_to_Member'>typid</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN530"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN241"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN531"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN242"><span class='Ref_to_Member'>atttypmod</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN532"><span class='Ref_To_Local'>atttypmod</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN533"><span class='Ref_To_Local'>format</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN178"><span class='Ref_to_Member'>binary</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nfields;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Sanity check that we absorbed all the data */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>!= </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+ </span><span class='Number'>5</span> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>msgLength</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN476"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"extraneous data in \"T\" message"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN605"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Success! */ 
</span>    <a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Advance inStart to show that the "T" message has been processed. */ 
</span>    <a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're doing a Describe, we're done, and ready to pass the result 
     * back to the client. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN380"><span class='Ref_to_Member'>queryclass</span></a> <span class='Operator'>== </span><a href="libpq-int.h.html#LN229"><span class='Ref_to_EnumConst'>PGQUERY_DESCRIBE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN217"><span class='Ref_to_EnumConst'>PGASYNC_READY</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We could perform additional setup for the new result set here, but for 
     * now there's nothing else to do. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* And we're done. */ 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<a name="LN605"></a><span class='Label'>advance_and_error</span><span class='Operator'>: 
</span>    <span class='Comment_Multi_Line'>/* Discard unsaved result, if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>        <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN474"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Discard the failed message by pretending we read it */ 
</span>    <a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+= </span><span class='Number'>5</span> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>msgLength</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Replace partially constructed result with an error result. First 
     * discard the old result to try to win back some memory. 
     */ 
</span>    <a href="libpq-int.h.html#LN571"><span class='Ref_to_Proto'>pqClearAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If preceding code didn't provide an error message, assume "out of 
     * memory" was meant.  The advantage of having this special case is that 
     * freeing the old result first greatly improves the odds that gettext() 
     * will succeed in providing a translation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN476"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>) 
</span>        <a href="fe-protocol3.c.html#LN476"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory for query result"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN476"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN472"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return zero to allow input parsing to continue.  Subsequent "D" 
     * messages will be ignored until we get to end of data, since an error 
     * result is already set up. 
     */ 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getRowDescriptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * parseInput subroutine to read a 't' (ParameterDescription) message. 
 * We'll build a new PGresult structure containing the parameter data. 
 * Returns: 0 if completed message, EOF if not enough data yet. 
 * In the former case, conn-&GT;inStart has been advanced past the message. 
 * 
 * Note that if we run out of data, we have to release the partially 
 * constructed PGresult, and rebuild it again next time.  Fortunately, 
 * that shouldn't happen often, since 't' messages usually fit in a packet. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN650"></a><span class='Declare_Function'>getParamDescriptions</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>msgLength</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN652"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN653"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>errmsg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* means "out of memory", see below */ 
</span><a name="LN654"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nparams</span><span class='Delimiter'>; 
</span><a name="LN655"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN706"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* parseInput already read the 't' label and message length. */ 
</span>    <span class='Comment_Multi_Line'>/* the next two bytes are the number of parameters */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN174"><span class='Ref_to_Member'>numParameters</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN702"><span class='Ref_to_Label'>not_enough_data</span></a><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN654"><span class='Ref_To_Local'>nparams</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN174"><span class='Ref_to_Member'>numParameters</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* allocate space for the parameter descriptors */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN654"><span class='Ref_To_Local'>nparams</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN175"><span class='Ref_to_Member'>paramDescs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN109"><span class='Ref_to_Typedef'>PGresParamDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="fe-exec.c.html#LN504"><span class='Ref_to_Func'>pqResultAlloc</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN654"><span class='Ref_To_Local'>nparams</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN109"><span class='Ref_to_Typedef'>PGresParamDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>TRUE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN175"><span class='Ref_to_Member'>paramDescs</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN706"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN175"><span class='Ref_to_Member'>paramDescs</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN654"><span class='Ref_To_Local'>nparams</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN109"><span class='Ref_to_Typedef'>PGresParamDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* get parameter info */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN654"><span class='Ref_To_Local'>nparams</span></a><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN680"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>typid</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN680"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN702"><span class='Ref_to_Label'>not_enough_data</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN175"><span class='Ref_to_Member'>paramDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN111"><span class='Ref_to_Member'>typid</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN680"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Sanity check that we absorbed all the data */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>!= </span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+ </span><span class='Number'>5</span> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>msgLength</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN653"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"extraneous data in \"t\" message"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN706"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Success! */ 
</span>    <a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Advance inStart to show that the "t" message has been processed. */ 
</span>    <a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<a name="LN702"></a><span class='Label'>not_enough_data</span><span class='Operator'>: 
</span>    <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span> 
<a name="LN706"></a><span class='Label'>advance_and_error</span><span class='Operator'>: 
</span>    <span class='Comment_Multi_Line'>/* Discard unsaved result, if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>        <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN652"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Discard the failed message by pretending we read it */ 
</span>    <a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+= </span><span class='Number'>5</span> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>msgLength</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Replace partially constructed result with an error result. First 
     * discard the old result to try to win back some memory. 
     */ 
</span>    <a href="libpq-int.h.html#LN571"><span class='Ref_to_Proto'>pqClearAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If preceding code didn't provide an error message, assume "out of 
     * memory" was meant.  The advantage of having this special case is that 
     * freeing the old result first greatly improves the odds that gettext() 
     * will succeed in providing a translation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN653"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>) 
</span>        <a href="fe-protocol3.c.html#LN653"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN653"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN650"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return zero to allow input parsing to continue.  Essentially, we've 
     * replaced the COMMAND_OK result with an error result, but since this 
     * doesn't affect the protocol state, it's fine. 
     */ 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getParamDescriptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * parseInput subroutine to read a 'D' (row data) message. 
 * We fill rowbuf with column pointers and then call the row processor. 
 * Returns: 0 if processed message successfully, EOF to suspend parsing 
 * (the latter case is not actually used currently). 
 * In the former case, conn-&GT;inStart has been advanced past the message. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN747"></a><span class='Declare_Function'>getAnotherTuple</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>msgLength</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN749"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>; 
</span><a name="LN750"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nfields</span> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN749"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN169"><span class='Ref_to_Member'>numAttributes</span></a><span class='Delimiter'>; 
</span><a name="LN751"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>errmsg</span><span class='Delimiter'>; 
</span><a name="LN752"></a>    <a href="libpq-int.h.html#LN286"><span class='Ref_to_Typedef'>PGdataValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rowbuf</span><span class='Delimiter'>; 
</span><a name="LN753"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tupnfields</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* # fields from tuple */ 
</span><a name="LN754"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>vlen</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* length of the current field value */ 
</span><a name="LN755"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the field count and make sure it's what we expect */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN753"><span class='Ref_To_Local'>tupnfields</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We should not run out of data here, so complain */ 
</span>        <a href="fe-protocol3.c.html#LN751"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"insufficient data in \"D\" message"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN834"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN753"><span class='Ref_To_Local'>tupnfields</span></a> <span class='Operator'>!= </span><a href="fe-protocol3.c.html#LN750"><span class='Ref_To_Local'>nfields</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN751"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected field count in \"D\" message"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN834"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Resize row buffer if needed */ 
</span>    <a href="fe-protocol3.c.html#LN752"><span class='Ref_To_Local'>rowbuf</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN446"><span class='Ref_to_Member'>rowBuf</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN750"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>&GT; </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN447"><span class='Ref_to_Member'>rowBufLen</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN752"><span class='Ref_To_Local'>rowbuf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN286"><span class='Ref_to_Typedef'>PGdataValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN59"><span class='Ref_to_Macro'>realloc</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN752"><span class='Ref_To_Local'>rowbuf</span></a><span class='Delimiter'>, 
</span>                                         <a href="fe-protocol3.c.html#LN750"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-int.h.html#LN286"><span class='Ref_to_Typedef'>PGdataValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN752"><span class='Ref_To_Local'>rowbuf</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol3.c.html#LN751"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* means "out of memory", see below */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN834"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN446"><span class='Ref_to_Member'>rowBuf</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN752"><span class='Ref_To_Local'>rowbuf</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN447"><span class='Ref_to_Member'>rowBufLen</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN750"><span class='Ref_To_Local'>nfields</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Scan the fields */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN755"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN755"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN750"><span class='Ref_To_Local'>nfields</span></a><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN755"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* get the value length */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN754"><span class='Ref_To_Local'>vlen</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* We should not run out of data here, so complain */ 
</span>            <a href="fe-protocol3.c.html#LN751"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"insufficient data in \"D\" message"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN834"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="fe-protocol3.c.html#LN752"><span class='Ref_To_Local'>rowbuf</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN755"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-int.h.html#LN288"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN754"><span class='Ref_To_Local'>vlen</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * rowbuf[i].value always points to the next address in the data 
         * buffer even if the value is NULL.  This allows row processors to 
         * estimate data sizes more easily. 
         */ 
</span>        <a href="fe-protocol3.c.html#LN752"><span class='Ref_To_Local'>rowbuf</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN755"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Skip over the data value */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN754"><span class='Ref_To_Local'>vlen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN224"><span class='Ref_to_Func'>pqSkipnchar</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN754"><span class='Ref_To_Local'>vlen</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* We should not run out of data here, so complain */ 
</span>                <a href="fe-protocol3.c.html#LN751"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"insufficient data in \"D\" message"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN834"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nfields;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Sanity check that we absorbed all the data */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>!= </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+ </span><span class='Number'>5</span> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>msgLength</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN751"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"extraneous data in \"D\" message"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN834"><span class='Ref_to_Label'>advance_and_error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Advance inStart to show that the "D" message has been processed. */ 
</span>    <a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process the collected row */ 
</span>    <a href="fe-protocol3.c.html#LN751"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN579"><span class='Ref_to_Proto'>pqRowProcessor</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN751"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* normal, successful exit */ 
</span> 
    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN838"><span class='Ref_to_Label'>set_error_result</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* pqRowProcessor failed, report it */ 
</span> 
<a name="LN834"></a><span class='Label'>advance_and_error</span><span class='Operator'>: 
</span>    <span class='Comment_Multi_Line'>/* Discard the failed message by pretending we read it */ 
</span>    <a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+= </span><span class='Number'>5</span> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>msgLength</span></a><span class='Delimiter'>; 
</span> 
<a name="LN838"></a><span class='Label'>set_error_result</span><span class='Operator'>: 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Replace partially constructed result with an error result. First 
     * discard the old result to try to win back some memory. 
     */ 
</span>    <a href="libpq-int.h.html#LN571"><span class='Ref_to_Proto'>pqClearAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If preceding code didn't provide an error message, assume "out of 
     * memory" was meant.  The advantage of having this special case is that 
     * freeing the old result first greatly improves the odds that gettext() 
     * will succeed in providing a translation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN751"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>) 
</span>        <a href="fe-protocol3.c.html#LN751"><span class='Ref_To_Local'>errmsg</span></a> <span class='Operator'>= </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory for query result"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n"</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN751"><span class='Ref_To_Local'>errmsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN747"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return zero to allow input parsing to continue.  Subsequent "D" 
     * messages will be ignored until we get to end of data, since an error 
     * result is already set up. 
     */ 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getAnotherTuple &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Attempt to read an Error or Notice response message. 
 * This is possible in several places, so we break it out as a subroutine. 
 * Entry: 'E' or 'N' message type and length have already been consumed. 
 * Exit: returns 0 if successfully consumed message. 
 *       returns EOF if not enough data. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN875"></a><span class='Declare_Function'>pqGetErrorNotice3</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isError</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN877"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN878"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_position</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN879"></a>    <a href="pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>workBuf</span><span class='Delimiter'>; 
</span><a name="LN880"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>id</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since the fields might be pretty long, we create a temporary 
     * PQExpBuffer rather than using conn-&GT;workBuffer.  workBuffer is intended 
     * for stuff that is expected to be short.  We shouldn't use 
     * conn-&GT;errorMessage either, since this might be only a notice. 
     */ 
</span>    <a href="pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make a PGresult to hold the accumulated fields.  We temporarily lie 
     * about the result status, so that PQmakeEmptyPGresult doesn't uselessly 
     * copy conn-&GT;errorMessage. 
     * 
     * NB: This allocation can fail, if you run out of memory. The rest of the 
     * function handles that gracefully, and we still try to set the error 
     * message as the connection's error message. 
     */ 
</span>    <a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN83"><span class='Ref_to_EnumConst'>PGRES_EMPTY_QUERY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>        <a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN176"><span class='Ref_to_Member'>resultStatus</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>isError</span></a> <span class='Operator'>? </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a> <span class='Operator'>: </span><a href="libpq-fe.h.html#LN94"><span class='Ref_to_EnumConst'>PGRES_NONFATAL_ERROR</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read the fields and save into res. 
     * 
     * While at it, save the SQLSTATE in conn-&GT;last_sqlstate, and note whether 
     * we saw a PG_DIAG_STATEMENT_POSITION field. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN880"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN970"><span class='Ref_to_Label'>fail</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN880"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* terminator found */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN970"><span class='Ref_to_Label'>fail</span></a><span class='Delimiter'>; 
</span>        <a href="libpq-int.h.html#LN575"><span class='Ref_to_Proto'>pqSaveMessageField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN880"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN880"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN56"><span class='Ref_to_Const'>PG_DIAG_SQLSTATE</span></a><span class='Parentheses'>) 
</span>            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN382"><span class='Ref_to_Member'>last_sqlstate</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                    <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN382"><span class='Ref_to_Member'>last_sqlstate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN880"><span class='Ref_To_Local'>id</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN60"><span class='Ref_to_Const'>PG_DIAG_STATEMENT_POSITION</span></a><span class='Parentheses'>) 
</span>            <a href="fe-protocol3.c.html#LN878"><span class='Ref_To_Local'>have_position</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Save the active query text, if any, into res as well; but only if we 
     * might need it for an error cursor display, which is only true if there 
     * is a PG_DIAG_STATEMENT_POSITION field. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN878"><span class='Ref_To_Local'>have_position</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN381"><span class='Ref_to_Member'>last_query</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>        <a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN197"><span class='Ref_to_Member'>errQuery</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN570"><span class='Ref_to_Proto'>pqResultStrdup</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN381"><span class='Ref_to_Member'>last_query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now build the "overall" error message for PQresultErrorMessage. 
     */ 
</span>    <a href="pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="libpq-int.h.html#LN604"><span class='Ref_to_Proto'>pqBuildErrorMessage3</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN424"><span class='Ref_to_Member'>verbosity</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN425"><span class='Ref_to_Member'>show_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Either save error as current async result, or just emit the notice. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>isError</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN195"><span class='Ref_to_Member'>errMsg</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN570"><span class='Ref_to_Proto'>pqResultStrdup</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="libpq-int.h.html#LN571"><span class='Ref_to_Proto'>pqClearAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN66"><span class='Ref_to_Macro'>PQExpBufferDataBroken</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Parentheses'>))</span> 
            <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN875"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* if we couldn't allocate the result set, just discard the NOTICE */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* We can cheat a little here and not copy the message. */ 
</span>            <a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN195"><span class='Ref_to_Member'>errMsg</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN185"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN151"><span class='Ref_to_Member'>noticeRec</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN185"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN151"><span class='Ref_to_Member'>noticeRec</span></a><span class='Parentheses'>) (</span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN185"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Operator'>.</span><a href="libpq-int.h.html#LN152"><span class='Ref_to_Member'>noticeRecArg</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<a name="LN970"></a><span class='Label'>fail</span><span class='Operator'>: 
</span>    <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN877"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN879"><span class='Ref_To_Local'>workBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> EOF<span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pqGetErrorNotice3 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Construct an error message from the fields in the given PGresult, 
 * appending it to the contents of "msg". 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN981"></a><span class='Declare_Function'>pqBuildErrorMessage3</span><span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Delimiter'>, 
</span><a name="LN982"></a>                     <a href="libpq-fe.h.html#LN109"><span class='Ref_to_Typedef'>PGVerbosity</span></a> <span class='Declare_Parameter'>verbosity</span><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN116"><span class='Ref_to_Typedef'>PGContextVisibility</span></a> <span class='Declare_Parameter'>show_context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN984"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN985"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>querytext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN986"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>querypos</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we couldn't allocate a PGresult, just say "out of memory" */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we don't have any broken-down fields, just return the base message. 
     * This mainly applies if we're given a libpq-generated error result. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN196"><span class='Ref_to_Member'>errFields</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN195"><span class='Ref_to_Member'>errMsg</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN195"><span class='Ref_to_Member'>errMsg</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN195"><span class='Ref_to_Member'>errMsg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"no error message available\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Else build error message from relevant fields */ 
</span>    <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN54"><span class='Ref_to_Const'>PG_DIAG_SEVERITY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='String'>"%s:  "</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN982"><span class='Ref_to_Parameter'>verbosity</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN113"><span class='Ref_to_EnumConst'>PQERRORS_VERBOSE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN56"><span class='Ref_to_Const'>PG_DIAG_SQLSTATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='String'>"%s: "</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN57"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_PRIMARY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>        <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN60"><span class='Ref_to_Const'>PG_DIAG_STATEMENT_POSITION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN982"><span class='Ref_to_Parameter'>verbosity</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN111"><span class='Ref_to_EnumConst'>PQERRORS_TERSE</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN197"><span class='Ref_to_Member'>errQuery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* emit position as a syntax cursor display */ 
</span>            <a href="fe-protocol3.c.html#LN985"><span class='Ref_To_Local'>querytext</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN197"><span class='Ref_to_Member'>errQuery</span></a><span class='Delimiter'>; 
</span>            <a href="fe-protocol3.c.html#LN986"><span class='Ref_To_Local'>querypos</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* emit position as text addition to primary message */ 
</span>            <span class='Comment_Multi_Line'>/* translator: %s represents a digit string */ 
</span>            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>" at character %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN61"><span class='Ref_to_Const'>PG_DIAG_INTERNAL_POSITION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol3.c.html#LN985"><span class='Ref_To_Local'>querytext</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN62"><span class='Ref_to_Const'>PG_DIAG_INTERNAL_QUERY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN982"><span class='Ref_to_Parameter'>verbosity</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN111"><span class='Ref_to_EnumConst'>PQERRORS_TERSE</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN985"><span class='Ref_To_Local'>querytext</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* emit position as a syntax cursor display */ 
</span>                <a href="fe-protocol3.c.html#LN986"><span class='Ref_To_Local'>querypos</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* emit position as text addition to primary message */ 
</span>                <span class='Comment_Multi_Line'>/* translator: %s represents a digit string */ 
</span>                <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>" at character %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <a href="pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN982"><span class='Ref_to_Parameter'>verbosity</span></a> <span class='Operator'>!= </span><a href="libpq-fe.h.html#LN111"><span class='Ref_to_EnumConst'>PQERRORS_TERSE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN985"><span class='Ref_To_Local'>querytext</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN986"><span class='Ref_To_Local'>querypos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="fe-protocol3.c.html#LN53"><span class='Ref_to_Proto'>reportErrorPosition</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN985"><span class='Ref_To_Local'>querytext</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN986"><span class='Ref_To_Local'>querypos</span></a><span class='Delimiter'>, 
</span>                                <a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN188"><span class='Ref_to_Member'>client_encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN58"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_DETAIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"DETAIL:  %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN59"><span class='Ref_to_Const'>PG_DIAG_MESSAGE_HINT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"HINT:  %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN62"><span class='Ref_to_Const'>PG_DIAG_INTERNAL_QUERY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"QUERY:  %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN982"><span class='Ref_to_Parameter'>show_context</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN120"><span class='Ref_to_EnumConst'>PQSHOW_CONTEXT_ALWAYS</span></a> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN982"><span class='Ref_to_Parameter'>show_context</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN119"><span class='Ref_to_EnumConst'>PQSHOW_CONTEXT_ERRORS</span></a> <span class='Operator'>&& 
</span>             <a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN176"><span class='Ref_to_Member'>resultStatus</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN63"><span class='Ref_to_Const'>PG_DIAG_CONTEXT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>                <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"CONTEXT:  %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if verbosity!=PQERRORS_T... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN982"><span class='Ref_to_Parameter'>verbosity</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN113"><span class='Ref_to_EnumConst'>PQERRORS_VERBOSE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN64"><span class='Ref_to_Const'>PG_DIAG_SCHEMA_NAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"SCHEMA NAME:  %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN65"><span class='Ref_to_Const'>PG_DIAG_TABLE_NAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"TABLE NAME:  %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN66"><span class='Ref_to_Const'>PG_DIAG_COLUMN_NAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"COLUMN NAME:  %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN67"><span class='Ref_to_Const'>PG_DIAG_DATATYPE_NAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"DATATYPE NAME:  %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN68"><span class='Ref_to_Const'>PG_DIAG_CONSTRAINT_NAME</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, 
</span>                              <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"CONSTRAINT NAME:  %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if verbosity==PQERRORS_V... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN982"><span class='Ref_to_Parameter'>verbosity</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN113"><span class='Ref_to_EnumConst'>PQERRORS_VERBOSE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1108"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>valf</span><span class='Delimiter'>; 
</span><a name="LN1109"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>vall</span><span class='Delimiter'>; 
</span> 
        <a href="fe-protocol3.c.html#LN1108"><span class='Ref_To_Local'>valf</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN69"><span class='Ref_to_Const'>PG_DIAG_SOURCE_FILE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1109"><span class='Ref_To_Local'>vall</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN70"><span class='Ref_to_Const'>PG_DIAG_SOURCE_LINE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN472"><span class='Ref_to_Proto'>PQresultErrorField</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN71"><span class='Ref_to_Const'>PG_DIAG_SOURCE_FUNCTION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>|| </span><a href="fe-protocol3.c.html#LN1108"><span class='Ref_To_Local'>valf</span></a> <span class='Operator'>|| </span><a href="fe-protocol3.c.html#LN1109"><span class='Ref_To_Local'>vall</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"LOCATION:  "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>                <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"%s, "</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN984"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1108"><span class='Ref_To_Local'>valf</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN1109"><span class='Ref_To_Local'>vall</span></a><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* unlikely we'd have just one */ 
</span>                <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"%s:%s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-protocol3.c.html#LN1108"><span class='Ref_To_Local'>valf</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1109"><span class='Ref_To_Local'>vall</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN981"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end pqBuildErrorMessage3 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add an error-location display to the error message under construction. 
 * 
 * The cursor location is measured in logical characters; the query string 
 * is presumed to be in the specified encoding. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1134"></a><span class='Declare_Function'>reportErrorPosition</span><span class='Parentheses'>(</span><a href="pqexpbuffer.h.html#LN50"><span class='Ref_to_Typedef'>PQExpBuffer</span></a> <span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>loc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>encoding</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1136"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DISPLAY_SIZE</span>    <span class='Number'>60</span>      <span class='Comment_Single_Line'>/* screen width limit, in screen cols */ 
</span><a name="LN1137"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MIN_RIGHT_CUT</span>   <span class='Number'>10</span>      <span class='Comment_Single_Line'>/* try to keep this far away from EOL */ 
</span> 
<a name="LN1139"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>wquery</span><span class='Delimiter'>; 
</span><a name="LN1140"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>slen</span><span class='Delimiter'>, 
</span><a name="LN1141"></a>                <span class='Declare_Local'>cno</span><span class='Delimiter'>, 
</span><a name="LN1142"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1143"></a>               <span class='Operator'>*</span><span class='Declare_Local'>qidx</span><span class='Delimiter'>, 
</span><a name="LN1144"></a>               <span class='Operator'>*</span><span class='Declare_Local'>scridx</span><span class='Delimiter'>, 
</span><a name="LN1145"></a>                <span class='Declare_Local'>qoffset</span><span class='Delimiter'>, 
</span><a name="LN1146"></a>                <span class='Declare_Local'>scroffset</span><span class='Delimiter'>, 
</span><a name="LN1147"></a>                <span class='Declare_Local'>ibeg</span><span class='Delimiter'>, 
</span><a name="LN1148"></a>                <span class='Declare_Local'>iend</span><span class='Delimiter'>, 
</span><a name="LN1149"></a>                <span class='Declare_Local'>loc_line</span><span class='Delimiter'>; 
</span><a name="LN1150"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>mb_encoding</span><span class='Delimiter'>, 
</span><a name="LN1151"></a>                <span class='Declare_Local'>beg_trunc</span><span class='Delimiter'>, 
</span><a name="LN1152"></a>                <span class='Declare_Local'>end_trunc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert loc from 1-based to 0-based; no-op if out of range */ 
</span>    <a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>loc</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>loc</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Need a writable copy of the query */ 
</span>    <a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* fail silently if out of memory */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Each character might occupy multiple physical bytes in the string, and 
     * in some Far Eastern character sets it might take more than one screen 
     * column as well.  We compute the starting byte offset and starting 
     * screen column of each logical character, and store these in qidx[] and 
     * scridx[] respectively. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* we need a safe allocation size... */ 
</span>    <a href="fe-protocol3.c.html#LN1140"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="fe-protocol3.c.html#LN1143"><span class='Ref_To_Local'>qidx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1140"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1143"><span class='Ref_To_Local'>qidx</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1140"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1143"><span class='Ref_To_Local'>qidx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* We can optimize a bit if it's a single-byte encoding */ 
</span>    <a href="fe-protocol3.c.html#LN1150"><span class='Ref_To_Local'>mb_encoding</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/mb/pg_wchar.h.html#LN534"><span class='Ref_to_Proto'>pg_encoding_max_length</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>encoding</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Within the scanning loop, cno is the current character's logical 
     * number, qoffset is its offset in wquery, and scroffset is its starting 
     * logical screen column (all indexed from 0).  "loc" is the logical 
     * character number of the error location.  We scan to determine loc_line 
     * (the 1-based line number containing loc) and ibeg/iend (first character 
     * number and last+1 character number of the line containing loc). Note 
     * that qidx[] and scridx[] are filled only as far as iend. 
     */ 
</span>    <a href="fe-protocol3.c.html#LN1145"><span class='Ref_To_Local'>qoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN1146"><span class='Ref_To_Local'>scroffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN1149"><span class='Ref_To_Local'>loc_line</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN1147"><span class='Ref_To_Local'>ibeg</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>                  <span class='Comment_Single_Line'>/* -1 means not set yet */ 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1141"><span class='Ref_To_Local'>cno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1145"><span class='Ref_To_Local'>qoffset</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN1141"><span class='Ref_To_Local'>cno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1209"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>ch</span> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1145"><span class='Ref_To_Local'>qoffset</span></a><span class='Delimiter'>]; 
</span> 
        <a href="fe-protocol3.c.html#LN1143"><span class='Ref_To_Local'>qidx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1141"><span class='Ref_To_Local'>cno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1145"><span class='Ref_To_Local'>qoffset</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1141"><span class='Ref_To_Local'>cno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1146"><span class='Ref_To_Local'>scroffset</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Replace tabs with spaces in the writable copy.  (Later we might 
         * want to think about coping with their variable screen width, but 
         * not today.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1209"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\t'</span><span class='Parentheses'>) 
</span>            <a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1145"><span class='Ref_To_Local'>qoffset</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>' '</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If end-of-line, count lines and mark positions. Each \r or \n 
         * counts as a line except when \r \n appear together. 
         */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1209"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\r'</span> <span class='Operator'>|| </span><a href="fe-protocol3.c.html#LN1209"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1141"><span class='Ref_To_Local'>cno</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>loc</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1209"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='String'>'\r'</span> <span class='Operator'>|| 
</span>                    <a href="fe-protocol3.c.html#LN1141"><span class='Ref_To_Local'>cno</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                    <a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1143"><span class='Ref_To_Local'>qidx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1141"><span class='Ref_To_Local'>cno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]] </span><span class='Operator'>!= </span><span class='String'>'\r'</span><span class='Parentheses'>) 
</span>                    <a href="fe-protocol3.c.html#LN1149"><span class='Ref_To_Local'>loc_line</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* extract beginning = last line start before loc. */ 
</span>                <a href="fe-protocol3.c.html#LN1147"><span class='Ref_To_Local'>ibeg</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1141"><span class='Ref_To_Local'>cno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* set extract end. */ 
</span>                <a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1141"><span class='Ref_To_Local'>cno</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* done scanning. */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Advance */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1150"><span class='Ref_To_Local'>mb_encoding</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1249"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>w</span><span class='Delimiter'>; 
</span> 
            <a href="fe-protocol3.c.html#LN1249"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN524"><span class='Ref_to_Proto'>pg_encoding_dsplen</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>encoding</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1145"><span class='Ref_To_Local'>qoffset</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* treat any non-tab control chars as width 1 */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1249"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="fe-protocol3.c.html#LN1249"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="fe-protocol3.c.html#LN1146"><span class='Ref_To_Local'>scroffset</span></a> <span class='Operator'>+= </span><a href="fe-protocol3.c.html#LN1249"><span class='Ref_To_Local'>w</span></a><span class='Delimiter'>; 
</span>            <a href="fe-protocol3.c.html#LN1145"><span class='Ref_To_Local'>qoffset</span></a> <span class='Operator'>+= </span><a href="../../include/mb/pg_wchar.h.html#LN523"><span class='Ref_to_Proto'>pg_encoding_mblen</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>encoding</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1145"><span class='Ref_To_Local'>qoffset</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* We assume wide chars only exist in multibyte encodings */ 
</span>            <a href="fe-protocol3.c.html#LN1146"><span class='Ref_To_Local'>scroffset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="fe-protocol3.c.html#LN1145"><span class='Ref_To_Local'>qoffset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for cno=0;wquery[qoffset]... &raquo; </span> 
    <span class='Comment_Multi_Line'>/* Fix up if we didn't find an end-of-line after loc */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1141"><span class='Ref_To_Local'>cno</span></a><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* query length in chars, +1 */ 
</span>        <a href="fe-protocol3.c.html#LN1143"><span class='Ref_To_Local'>qidx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1145"><span class='Ref_To_Local'>qoffset</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1146"><span class='Ref_To_Local'>scroffset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Print only if loc is within computed query length */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>loc</span></a> <span class='Operator'>&LT;= </span><a href="fe-protocol3.c.html#LN1141"><span class='Ref_To_Local'>cno</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If the line extracted is too long, we truncate it. */ 
</span>        <a href="fe-protocol3.c.html#LN1151"><span class='Ref_To_Local'>beg_trunc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1152"><span class='Ref_To_Local'>end_trunc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1147"><span class='Ref_To_Local'>ibeg</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="fe-protocol3.c.html#LN1136"><span class='Ref_to_Const'>DISPLAY_SIZE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We first truncate right if it is enough.  This code might be 
             * off a space or so on enforcing MIN_RIGHT_CUT if there's a wide 
             * character right there, but that should be okay. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1147"><span class='Ref_To_Local'>ibeg</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN1136"><span class='Ref_to_Const'>DISPLAY_SIZE</span></a> <span class='Operator'>&GT;= </span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>loc</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN1137"><span class='Ref_to_Const'>MIN_RIGHT_CUT</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1147"><span class='Ref_To_Local'>ibeg</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="fe-protocol3.c.html#LN1136"><span class='Ref_to_Const'>DISPLAY_SIZE</span></a><span class='Parentheses'>) 
</span>                    <a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <a href="fe-protocol3.c.html#LN1152"><span class='Ref_To_Local'>end_trunc</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Truncate right if not too close to loc. */ 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>loc</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN1137"><span class='Ref_to_Const'>MIN_RIGHT_CUT</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                    <a href="fe-protocol3.c.html#LN1152"><span class='Ref_To_Local'>end_trunc</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* Truncate left if still too long. */ 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1147"><span class='Ref_To_Local'>ibeg</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="fe-protocol3.c.html#LN1136"><span class='Ref_to_Const'>DISPLAY_SIZE</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="fe-protocol3.c.html#LN1147"><span class='Ref_To_Local'>ibeg</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <a href="fe-protocol3.c.html#LN1151"><span class='Ref_To_Local'>beg_trunc</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if scridx[iend]-scridx[i... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* truncate working copy at desired endpoint */ 
</span>        <a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1143"><span class='Ref_To_Local'>qidx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1148"><span class='Ref_To_Local'>iend</span></a><span class='Delimiter'>]] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Begin building the finished message. */ 
</span>        <a href="fe-protocol3.c.html#LN1142"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>        <a href="pqexpbuffer.c.html#LN260"><span class='Ref_to_Func'>appendPQExpBuffer</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"LINE %d: "</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1149"><span class='Ref_To_Local'>loc_line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1151"><span class='Ref_To_Local'>beg_trunc</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='String'>"..."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * While we have the prefix in the msg buffer, compute its screen 
         * width. 
         */ 
</span>        <a href="fe-protocol3.c.html#LN1146"><span class='Ref_To_Local'>scroffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN1142"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN1142"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+= </span><a href="../../include/mb/pg_wchar.h.html#LN523"><span class='Ref_to_Proto'>pg_encoding_mblen</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>encoding</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1142"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1326"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>w</span> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN524"><span class='Ref_to_Proto'>pg_encoding_dsplen</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>encoding</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Operator'>-&GT;</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1142"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1326"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="fe-protocol3.c.html#LN1326"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="fe-protocol3.c.html#LN1146"><span class='Ref_To_Local'>scroffset</span></a> <span class='Operator'>+= </span><a href="fe-protocol3.c.html#LN1326"><span class='Ref_To_Local'>w</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Finish up the LINE message line. */ 
</span>        <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1143"><span class='Ref_To_Local'>qidx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1147"><span class='Ref_To_Local'>ibeg</span></a><span class='Delimiter'>]]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1152"><span class='Ref_To_Local'>end_trunc</span></a><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.h.html#LN164"><span class='Ref_to_Proto'>appendPQExpBufferStr</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='String'>"..."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Now emit the cursor marker line. */ 
</span>        <a href="fe-protocol3.c.html#LN1146"><span class='Ref_To_Local'>scroffset</span></a> <span class='Operator'>+= </span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>loc</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1147"><span class='Ref_To_Local'>ibeg</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1142"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN1142"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN1146"><span class='Ref_To_Local'>scroffset</span></a><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN1142"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='String'>' '</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='String'>'^'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pqexpbuffer.h.html#LN171"><span class='Ref_to_Proto'>appendPQExpBufferChar</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1134"><span class='Ref_to_Parameter'>msg</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if loc&LT;=cno &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Clean up. */ 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1144"><span class='Ref_To_Local'>scridx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1143"><span class='Ref_To_Local'>qidx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1139"><span class='Ref_To_Local'>wquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end reportErrorPosition &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Attempt to read a ParameterStatus message. 
 * This is possible in several places, so we break it out as a subroutine. 
 * Entry: 'S' message type and length have already been consumed. 
 * Exit: returns 0 if successfully consumed message. 
 *       returns EOF if not enough data. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1362"></a><span class='Declare_Function'>getParameterStatus</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1364"></a>    <a href="pqexpbuffer.h.html#LN43"><span class='Ref_to_Struct'>PQExpBufferData</span></a> <span class='Declare_Local'>valueBuf</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the parameter name */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1362"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1362"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Get the parameter value (could be large) */ 
</span>    <a href="pqexpbuffer.c.html#LN87"><span class='Ref_to_Func'>initPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1364"><span class='Ref_To_Local'>valueBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1364"><span class='Ref_To_Local'>valueBuf</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1362"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1364"><span class='Ref_To_Local'>valueBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* And save it */ 
</span>    <a href="libpq-int.h.html#LN577"><span class='Ref_to_Proto'>pqSaveParameterStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1362"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1362"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1364"><span class='Ref_To_Local'>valueBuf</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN121"><span class='Ref_to_Proto'>termPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1364"><span class='Ref_To_Local'>valueBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getParameterStatus &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Attempt to read a Notify response message. 
 * This is possible in several places, so we break it out as a subroutine. 
 * Entry: 'A' message type and length have already been consumed. 
 * Exit: returns 0 if successfully consumed Notify message. 
 *       returns EOF if not enough data. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1391"></a><span class='Declare_Function'>getNotify</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1393"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>be_pid</span><span class='Delimiter'>; 
</span><a name="LN1394"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>svname</span><span class='Delimiter'>; 
</span><a name="LN1395"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nmlen</span><span class='Delimiter'>; 
</span><a name="LN1396"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>extralen</span><span class='Delimiter'>; 
</span><a name="LN1397"></a>    <a href="libpq-fe.h.html#LN160"><span class='Ref_to_Typedef'>PGnotify</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newNotify</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1393"><span class='Ref_To_Local'>be_pid</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* must save name while getting extra string */ 
</span>    <a href="fe-protocol3.c.html#LN1394"><span class='Ref_To_Local'>svname</span></a> <span class='Operator'>= </span>strdup<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN1394"><span class='Ref_To_Local'>svname</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN163"><span class='Ref_to_Func'>pqGets</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1394"><span class='Ref_To_Local'>svname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Store the strings right after the PQnotify structure so it can all be 
     * freed at once.  We don't use NAMEDATALEN because we don't want to tie 
     * this interface to a specific server name length. 
     */ 
</span>    <a href="fe-protocol3.c.html#LN1395"><span class='Ref_To_Local'>nmlen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1394"><span class='Ref_To_Local'>svname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN1396"><span class='Ref_To_Local'>extralen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN160"><span class='Ref_to_Typedef'>PGnotify</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN160"><span class='Ref_to_Typedef'>PGnotify</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN1395"><span class='Ref_To_Local'>nmlen</span></a> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN1396"><span class='Ref_To_Local'>extralen</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN162"><span class='Ref_to_Member'>relname</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN160"><span class='Ref_to_Typedef'>PGnotify</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN162"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1394"><span class='Ref_To_Local'>svname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN164"><span class='Ref_to_Member'>extra</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN162"><span class='Ref_to_Member'>relname</span></a> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN1395"><span class='Ref_To_Local'>nmlen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN164"><span class='Ref_to_Member'>extra</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN494"><span class='Ref_to_Member'>workBuffer</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN163"><span class='Ref_to_Member'>be_pid</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1393"><span class='Ref_To_Local'>be_pid</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN166"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN391"><span class='Ref_to_Member'>notifyTail</span></a><span class='Parentheses'>) 
</span>            <a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN391"><span class='Ref_to_Member'>notifyTail</span></a><span class='Operator'>-&GT;</span><a href="libpq-fe.h.html#LN166"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN390"><span class='Ref_to_Member'>notifyHead</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1391"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN391"><span class='Ref_to_Member'>notifyTail</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1397"><span class='Ref_To_Local'>newNotify</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1394"><span class='Ref_To_Local'>svname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getNotify &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * getCopyStart - process CopyInResponse, CopyOutResponse or 
 * CopyBothResponse message 
 * 
 * parseInput already read the message type and length. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1447"></a><span class='Declare_Function'>getCopyStart</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="libpq-fe.h.html#LN81"><span class='Ref_to_Typedef'>ExecStatusType</span></a> <span class='Declare_Parameter'>copytype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1449"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1450"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nfields</span><span class='Delimiter'>; 
</span><a name="LN1451"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1447"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1447"><span class='Ref_to_Parameter'>copytype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN1494"><span class='Ref_to_Label'>failure</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1447"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN387"><span class='Ref_to_Member'>copy_is_binary</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1447"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN1494"><span class='Ref_to_Label'>failure</span></a><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN178"><span class='Ref_to_Member'>binary</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1447"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN387"><span class='Ref_to_Member'>copy_is_binary</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* the next two bytes are the number of fields  */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN169"><span class='Ref_to_Member'>numAttributes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1447"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN1494"><span class='Ref_to_Label'>failure</span></a><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN1450"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN169"><span class='Ref_to_Member'>numAttributes</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* allocate space for the attribute descriptors */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1450"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN234"><span class='Ref_to_Typedef'>PGresAttDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="fe-exec.c.html#LN504"><span class='Ref_to_Func'>pqResultAlloc</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1450"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN234"><span class='Ref_to_Typedef'>PGresAttDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>TRUE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN1494"><span class='Ref_to_Label'>failure</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1450"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN234"><span class='Ref_to_Typedef'>PGresAttDesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1451"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN1451"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN1450"><span class='Ref_To_Local'>nfields</span></a><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN1451"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1477"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>format</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1477"><span class='Ref_To_Local'>format</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1447"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="fe-protocol3.c.html#LN1494"><span class='Ref_to_Label'>failure</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Since pqGetInt treats 2-byte integers as unsigned, we need to 
         * coerce these results to signed form. 
         */ 
</span>        <a href="fe-protocol3.c.html#LN1477"><span class='Ref_To_Local'>format</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) ((</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><a href="fe-protocol3.c.html#LN1477"><span class='Ref_To_Local'>format</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN170"><span class='Ref_to_Member'>attDescs</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1451"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN239"><span class='Ref_to_Member'>format</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1477"><span class='Ref_To_Local'>format</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Success! */ 
</span>    <a href="fe-protocol3.c.html#LN1447"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<a name="LN1494"></a><span class='Label'>failure</span><span class='Operator'>: 
</span>    <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1449"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> EOF<span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getCopyStart &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * getReadyForQuery - process ReadyForQuery message 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1503"></a><span class='Declare_Function'>getReadyForQuery</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1505"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>xact_status</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1505"><span class='Ref_To_Local'>xact_status</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1503"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1505"><span class='Ref_To_Local'>xact_status</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='String'>'I'</span><span class='Operator'>: 
</span>            <a href="fe-protocol3.c.html#LN1503"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN102"><span class='Ref_to_EnumConst'>PQTRANS_IDLE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'T'</span><span class='Operator'>: 
</span>            <a href="fe-protocol3.c.html#LN1503"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN104"><span class='Ref_to_EnumConst'>PQTRANS_INTRANS</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'E'</span><span class='Operator'>: 
</span>            <a href="fe-protocol3.c.html#LN1503"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN105"><span class='Ref_to_EnumConst'>PQTRANS_INERROR</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="fe-protocol3.c.html#LN1503"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN379"><span class='Ref_to_Member'>xactStatus</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN106"><span class='Ref_to_EnumConst'>PQTRANS_UNKNOWN</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getReadyForQuery &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * getCopyDataMessage - fetch next CopyData message, process async messages 
 * 
 * Returns length word of CopyData message (&GT; 0), or 0 if no complete 
 * message available, -1 if end of copy, -2 if error. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1535"></a><span class='Declare_Function'>getCopyDataMessage</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1537"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>id</span><span class='Delimiter'>; 
</span><a name="LN1538"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>msgLength</span><span class='Delimiter'>; 
</span><a name="LN1539"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>avail</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Do we have the next input message?  To make life simpler for async 
         * callers, we keep returning 0 until the next message is fully 
         * available, even if it is not Copy Data. 
         */ 
</span>        <a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1537"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1538"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1538"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol3.c.html#LN45"><span class='Ref_to_Proto'>handleSyncLoss</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1537"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1538"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="fe-protocol3.c.html#LN1539"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a> <span class='Operator'>- </span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1539"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN1538"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>- </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Before returning, enlarge the input buffer if needed to hold 
             * the whole message.  See notes in parseInput. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN408"><span class='Ref_to_Func'>pqCheckInBufferSpace</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span>size_t<span class='Parentheses'>) </span><a href="fe-protocol3.c.html#LN1538"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>- </span><span class='Number'>4</span><span class='Delimiter'>, 
</span>                                     <a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * XXX add some better recovery code... plan is to skip over 
                 * the message using its length, then report an error. For the 
                 * moment, just treat this like loss of sync (which indeed it 
                 * might be!) 
                 */ 
</span>                <a href="fe-protocol3.c.html#LN45"><span class='Ref_to_Proto'>handleSyncLoss</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1537"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1538"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if avail&LT;msgLength-4 &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * If it's a legitimate async message type, process it.  (NOTIFY 
         * messages are not currently possible here, but we handle them for 
         * completeness.)  Otherwise, if it's anything except Copy Data, 
         * report end-of-copy. 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1537"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'A'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* NOTIFY */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN39"><span class='Ref_to_Proto'>getNotify</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'N'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* NOTICE */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN603"><span class='Ref_to_Proto'>pqGetErrorNotice3</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* ParameterStatus */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN49"><span class='Ref_to_Proto'>getParameterStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* Copy Data, pass it back to caller */ 
</span>                <span class='Control'>return</span> <a href="fe-protocol3.c.html#LN1538"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If this is a CopyDone message, exit COPY_OUT mode and let 
                 * caller read status with PQgetResult().  If we're in 
                 * COPY_BOTH mode, return to COPY_IN mode. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>== </span><a href="libpq-int.h.html#LN220"><span class='Ref_to_EnumConst'>PGASYNC_COPY_BOTH</span></a><span class='Parentheses'>) 
</span>                    <a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN218"><span class='Ref_to_EnumConst'>PGASYNC_COPY_IN</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN216"><span class='Ref_to_EnumConst'>PGASYNC_BUSY</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>:</span>            <span class='Comment_Single_Line'>/* treat as end of copy */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Any other message terminates either COPY_IN or COPY_BOTH 
                 * mode. 
                 */ 
</span>                <a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN216"><span class='Ref_to_EnumConst'>PGASYNC_BUSY</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch id &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Drop the processed message and loop around for another */ 
</span>        <a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1535"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end getCopyDataMessage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PQgetCopyData - read a row of data from the backend during COPY OUT 
 * or COPY BOTH 
 * 
 * If successful, sets *buffer to point to a malloc'd row of data, and 
 * returns row length (always &GT; 0) as result. 
 * Returns 0 if no row available yet (only possible if async is true), 
 * -1 if end of copy (consult PQgetResult), or -2 if error (consult 
 * PQerrorMessage). 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1640"></a><span class='Declare_Function'>pqGetCopyData3</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>async</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1642"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>msgLength</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Collect the next input message.  To make life simpler for async 
         * callers, we keep returning 0 until the next message is fully 
         * available, even if it is not Copy Data. 
         */ 
</span>        <a href="fe-protocol3.c.html#LN1642"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1534"><span class='Ref_to_Func'>getCopyDataMessage</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1642"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="fe-protocol3.c.html#LN1642"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* end-of-copy or error */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1642"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Don't block if async read requested */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>async</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Need to load more data */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN638"><span class='Ref_to_Proto'>pqWait</span></a><span class='Parentheses'>(</span><span class='Boolean'>TRUE</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <a href="fe-misc.c.html#LN629"><span class='Ref_to_Func'>pqReadData</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Drop zero-length messages (shouldn't happen anyway).  Otherwise 
         * pass the data back to the caller. 
         */ 
</span>        <a href="fe-protocol3.c.html#LN1642"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>-= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1642"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>buffer</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1642"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>buffer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            memcpy<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>], </span><a href="fe-protocol3.c.html#LN1642"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1642"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Add terminating null */ 
</span> 
            <span class='Comment_Multi_Line'>/* Mark message consumed */ 
</span>            <a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN1642"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>return</span> <a href="fe-protocol3.c.html#LN1642"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Empty, so drop it and loop around for another */ 
</span>        <a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1640"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end pqGetCopyData3 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PQgetline - gets a newline-terminated string from the backend. 
 * 
 * See fe-exec.c for documentation. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1700"></a><span class='Declare_Function'>pqGetline3</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>maxlen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1702"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN399"><span class='Ref_to_Member'>sock</span></a> <span class='Operator'>== </span><a href="../../include/port.h.html#LN23"><span class='Ref_to_Const'>PGINVALID_SOCKET</span></a> <span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN219"><span class='Ref_to_EnumConst'>PGASYNC_COPY_OUT</span></a> <span class='Operator'>&& 
</span>         <a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN220"><span class='Ref_to_EnumConst'>PGASYNC_COPY_BOTH</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN387"><span class='Ref_to_Member'>copy_is_binary</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                      <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"PQgetline: not doing text COPY OUT\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="fe-protocol3.c.html#LN1702"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN438"><span class='Ref_to_Proto'>PQgetlineAsync</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>maxlen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* need to load more data */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN638"><span class='Ref_to_Proto'>pqWait</span></a><span class='Parentheses'>(</span><span class='Boolean'>TRUE</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN629"><span class='Ref_to_Func'>pqReadData</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> EOF<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1702"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* End of copy detected; gin up old-style terminator */ 
</span>        <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span><span class='String'>"\\."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Add null terminator, and strip trailing \n if present */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1702"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1702"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="fe-protocol3.c.html#LN1700"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1702"><span class='Ref_To_Local'>status</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end pqGetline3 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PQgetlineAsync - gets a COPY data row without blocking. 
 * 
 * See fe-exec.c for documentation. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1752"></a><span class='Declare_Function'>pqGetlineAsync3</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>bufsize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1754"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>msgLength</span><span class='Delimiter'>; 
</span><a name="LN1755"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>avail</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN219"><span class='Ref_to_EnumConst'>PGASYNC_COPY_OUT</span></a> 
        <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN220"><span class='Ref_to_EnumConst'>PGASYNC_COPY_BOTH</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* we are not doing a copy... */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Recognize the next input message.  To make life simpler for async 
     * callers, we keep returning 0 until the next message is fully available 
     * even if it is not Copy Data.  This should keep PQendcopy from blocking. 
     * (Note: unlike pqGetCopyData3, we do not change asyncStatus here.) 
     */ 
</span>    <a href="fe-protocol3.c.html#LN1754"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1534"><span class='Ref_to_Func'>getCopyDataMessage</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1754"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* end-of-copy or error */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1754"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* no data yet */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Move data from libpq's buffer to the caller's.  In the case where a 
     * prior call found the caller's buffer too small, we use 
     * conn-&GT;copy_already_done to remember how much of the row was already 
     * returned to the caller. 
     */ 
</span>    <a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+= </span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN388"><span class='Ref_to_Member'>copy_already_done</span></a><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN1755"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1754"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>- </span><span class='Number'>4</span> <span class='Operator'>- </span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN388"><span class='Ref_to_Member'>copy_already_done</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1755"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>&LT;= </span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>bufsize</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Able to consume the whole message */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>], </span><a href="fe-protocol3.c.html#LN1755"><span class='Ref_To_Local'>avail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Mark message consumed */ 
</span>        <a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN1755"><span class='Ref_To_Local'>avail</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Reset state for next time */ 
</span>        <a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN388"><span class='Ref_to_Member'>copy_already_done</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="fe-protocol3.c.html#LN1755"><span class='Ref_To_Local'>avail</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We must return a partial message */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN429"><span class='Ref_to_Member'>inBuffer</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>], </span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>bufsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* The message is NOT consumed from libpq's buffer */ 
</span>        <a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN388"><span class='Ref_to_Member'>copy_already_done</span></a> <span class='Operator'>+= </span><a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>bufsize</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="fe-protocol3.c.html#LN1752"><span class='Ref_to_Parameter'>bufsize</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end pqGetlineAsync3 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * PQendcopy 
 * 
 * See fe-exec.c for documentation. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1807"></a><span class='Declare_Function'>pqEndcopy3</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1809"></a>    <a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN218"><span class='Ref_to_EnumConst'>PGASYNC_COPY_IN</span></a> <span class='Operator'>&& 
</span>        <a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN219"><span class='Ref_to_EnumConst'>PGASYNC_COPY_OUT</span></a> <span class='Operator'>&& 
</span>        <a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN220"><span class='Ref_to_EnumConst'>PGASYNC_COPY_BOTH</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                          <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"no COPY in progress\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Send the CopyDone message if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>== </span><a href="libpq-int.h.html#LN218"><span class='Ref_to_EnumConst'>PGASYNC_COPY_IN</span></a> <span class='Operator'>|| 
</span>        <a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>== </span><a href="libpq-int.h.html#LN220"><span class='Ref_to_EnumConst'>PGASYNC_COPY_BOTH</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN519"><span class='Ref_to_Func'>pqPutMsgStart</span></a><span class='Parentheses'>(</span><span class='String'>'c'</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="fe-misc.c.html#LN587"><span class='Ref_to_Func'>pqPutMsgEnd</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we sent the COPY command in extended-query mode, we must issue a 
         * Sync as well. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN380"><span class='Ref_to_Member'>queryclass</span></a> <span class='Operator'>!= </span><a href="libpq-int.h.html#LN226"><span class='Ref_to_EnumConst'>PGQUERY_SIMPLE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN519"><span class='Ref_to_Func'>pqPutMsgStart</span></a><span class='Parentheses'>(</span><span class='String'>'S'</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <a href="fe-misc.c.html#LN587"><span class='Ref_to_Func'>pqPutMsgEnd</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * make sure no data is waiting to be sent, abort if we are non-blocking 
     * and the flush fails 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN637"><span class='Ref_to_Proto'>pqFlush</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="libpq-int.h.html#LN676"><span class='Ref_to_Macro'>pqIsnonblocking</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return to active duty */ 
</span>    <a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN378"><span class='Ref_to_Member'>asyncStatus</span></a> <span class='Operator'>= </span><a href="libpq-int.h.html#LN216"><span class='Ref_to_EnumConst'>PGASYNC_BUSY</span></a><span class='Delimiter'>; 
</span>    <a href="pqexpbuffer.h.html#LN129"><span class='Ref_to_Proto'>resetPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Non blocking connections may have to abort at this point.  If everyone 
     * played the game there should be no problem, but in error scenarios the 
     * expected messages may not have arrived yet.  (We are assuming that the 
     * backend's packetizing will ensure that CommandComplete arrives along 
     * with the CopyDone; are there corner cases where that doesn't happen?) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN676"><span class='Ref_to_Macro'>pqIsnonblocking</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="libpq-fe.h.html#LN424"><span class='Ref_to_Proto'>PQisBusy</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Wait for the completion response */ 
</span>    <a href="fe-protocol3.c.html#LN1809"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN421"><span class='Ref_to_Proto'>PQgetResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Expecting a successful result */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1809"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN1809"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN176"><span class='Ref_to_Member'>resultStatus</span></a> <span class='Operator'>== </span><a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1809"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Trouble. For backwards-compatibility reasons, we issue the error 
     * message as if it were a notice (would be nice to get rid of this 
     * silliness, but too many apps probably don't handle errors from 
     * PQendcopy reasonably).  Note that the app can still obtain the error 
     * status from the PGconn object. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We have to strip the trailing newline ... pain in neck... */ 
</span><a name="LN1881"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>svLast</span> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1881"><span class='Ref_To_Local'>svLast</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>            <a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="fe-exec.c.html#LN799"><span class='Ref_to_Func'>pqInternalNotice</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN369"><span class='Ref_to_Member'>noticeHooks</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN45"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1807"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Operator'>.</span><a href="pqexpbuffer.h.html#LN46"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1881"><span class='Ref_To_Local'>svLast</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1809"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pqEndcopy3 &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * PQfn - Send a function call to the POSTGRES backend. 
 * 
 * See fe-exec.c for documentation. 
 */ 
</span><a href="libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>* 
</span><a name="LN1901"></a><span class='Declare_Function'>pqFunctionCall3</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>fnid</span><span class='Delimiter'>, 
</span><a name="LN1902"></a>                <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>result_buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>actual_result_len</span><span class='Delimiter'>, 
</span><a name="LN1903"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>result_is_int</span><span class='Delimiter'>, 
</span><a name="LN1904"></a>                <span class='Keyword'>const </span><a href="libpq-fe.h.html#LN219"><span class='Ref_to_Typedef'>PQArgBlock</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nargs</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1906"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>needInput</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1907"></a>    <a href="libpq-fe.h.html#LN81"><span class='Ref_to_Typedef'>ExecStatusType</span></a> <span class='Declare_Local'>status</span> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a><span class='Delimiter'>; 
</span><a name="LN1908"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>id</span><span class='Delimiter'>; 
</span><a name="LN1909"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>msgLength</span><span class='Delimiter'>; 
</span><a name="LN1910"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>avail</span><span class='Delimiter'>; 
</span><a name="LN1911"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* PQfn already validated connection state */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN519"><span class='Ref_to_Func'>pqPutMsgStart</span></a><span class='Parentheses'>(</span><span class='String'>'F'</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>||</span>  <span class='Comment_Single_Line'>/* function call msg */ 
</span>        <a href="fe-misc.c.html#LN307"><span class='Ref_to_Func'>pqPutInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>fnid</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>||</span>  <span class='Comment_Single_Line'>/* function id */ 
</span>        <a href="fe-misc.c.html#LN307"><span class='Ref_to_Func'>pqPutInt</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>||</span>     <span class='Comment_Single_Line'>/* # of format codes */ 
</span>        <a href="fe-misc.c.html#LN307"><span class='Ref_to_Func'>pqPutInt</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>||</span>     <span class='Comment_Single_Line'>/* format code: BINARY */ 
</span>        <a href="fe-misc.c.html#LN307"><span class='Ref_to_Func'>pqPutInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1904"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* # of args */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="libpq-int.h.html#LN580"><span class='Ref_to_Proto'>pqHandleSendFailure</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1911"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN1911"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN1904"><span class='Ref_to_Parameter'>nargs</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="fe-protocol3.c.html#LN1911"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* len.int4 + contents     */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN307"><span class='Ref_to_Func'>pqPutInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1904"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1911"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN221"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="libpq-int.h.html#LN580"><span class='Ref_to_Proto'>pqHandleSendFailure</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1904"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1911"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN221"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* it's NULL */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1904"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1911"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN222"><span class='Ref_to_Member'>isint</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN307"><span class='Ref_to_Func'>pqPutInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1904"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1911"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN227"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>integer<span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1904"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1911"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN221"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="libpq-int.h.html#LN580"><span class='Ref_to_Proto'>pqHandleSendFailure</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN246"><span class='Ref_to_Func'>pqPutnchar</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="fe-protocol3.c.html#LN1904"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1911"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN227"><span class='Ref_to_Member'>u</span></a><span class='Operator'>.</span>ptr<span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1904"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN1911"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="libpq-fe.h.html#LN221"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="libpq-int.h.html#LN580"><span class='Ref_to_Proto'>pqHandleSendFailure</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nargs;++i &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN307"><span class='Ref_to_Func'>pqPutInt</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* result format code: BINARY */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="libpq-int.h.html#LN580"><span class='Ref_to_Proto'>pqHandleSendFailure</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN587"><span class='Ref_to_Func'>pqPutMsgEnd</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="libpq-int.h.html#LN637"><span class='Ref_to_Proto'>pqFlush</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="libpq-int.h.html#LN580"><span class='Ref_to_Proto'>pqHandleSendFailure</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1906"><span class='Ref_To_Local'>needInput</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Wait for some data to arrive (or for the channel to close) */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN638"><span class='Ref_to_Proto'>pqWait</span></a><span class='Parentheses'>(</span><span class='Boolean'>TRUE</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <a href="fe-misc.c.html#LN629"><span class='Ref_to_Func'>pqReadData</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Scan the message. If we run out of data, loop around to try again. 
         */ 
</span>        <a href="fe-protocol3.c.html#LN1906"><span class='Ref_To_Local'>needInput</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN94"><span class='Ref_to_Func'>pqGetc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1908"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Try to validate message type/length here.  A length less than 4 is 
         * definitely broken.  Large lengths should only be believed for a few 
         * message types. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol3.c.html#LN45"><span class='Ref_to_Proto'>handleSyncLoss</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1908"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>&GT; </span><span class='Number'>30000</span> <span class='Operator'>&& !</span><a href="fe-protocol3.c.html#LN40"><span class='Ref_to_Macro'>VALID_LONG_MESSAGE_TYPE</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1908"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="fe-protocol3.c.html#LN45"><span class='Ref_to_Proto'>handleSyncLoss</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1908"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Can't process if message body isn't all here yet. 
         */ 
</span>        <a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a> <span class='Operator'>-= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1910"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN433"><span class='Ref_to_Member'>inEnd</span></a> <span class='Operator'>- </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1910"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>&LT; </span><a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Before looping, enlarge the input buffer if needed to hold the 
             * whole message.  See notes in parseInput. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN408"><span class='Ref_to_Func'>pqCheckInBufferSpace</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN432"><span class='Ref_to_Member'>inCursor</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span>size_t<span class='Parentheses'>) </span><a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>, 
</span>                                     <a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * XXX add some better recovery code... plan is to skip over 
                 * the message using its length, then report an error. For the 
                 * moment, just treat this like loss of sync (which indeed it 
                 * might be!) 
                 */ 
</span>                <a href="fe-protocol3.c.html#LN45"><span class='Ref_to_Proto'>handleSyncLoss</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1908"><span class='Ref_To_Local'>id</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if avail&LT;msgLength &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * We should see V or E response to the command, but might get N 
         * and/or A notices first. We also need to swallow the final Z before 
         * returning. 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1908"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'V'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* function result */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1902"><span class='Ref_to_Parameter'>actual_result_len</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-protocol3.c.html#LN1902"><span class='Ref_to_Parameter'>actual_result_len</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1903"><span class='Ref_to_Parameter'>result_is_int</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN267"><span class='Ref_to_Func'>pqGetInt</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1902"><span class='Ref_to_Parameter'>result_buf</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="fe-protocol3.c.html#LN1902"><span class='Ref_to_Parameter'>actual_result_len</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-misc.c.html#LN195"><span class='Ref_to_Func'>pqGetnchar</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="fe-protocol3.c.html#LN1902"><span class='Ref_to_Parameter'>result_buf</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>*</span><a href="fe-protocol3.c.html#LN1902"><span class='Ref_to_Parameter'>actual_result_len</span></a><span class='Delimiter'>, 
</span>                                       <a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* correctly finished function result message */ 
</span>                <a href="fe-protocol3.c.html#LN1907"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'E'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* error return */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN603"><span class='Ref_to_Proto'>pqGetErrorNotice3</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <a href="fe-protocol3.c.html#LN1907"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="libpq-fe.h.html#LN95"><span class='Ref_to_EnumConst'>PGRES_FATAL_ERROR</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'A'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* notify message */ 
</span>                <span class='Comment_Multi_Line'>/* handle notify and go back to processing return values */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol2.c.html#LN39"><span class='Ref_to_Proto'>getNotify</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'N'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* notice */ 
</span>                <span class='Comment_Multi_Line'>/* handle notice and go back to processing return values */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="libpq-int.h.html#LN603"><span class='Ref_to_Proto'>pqGetErrorNotice3</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'Z'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* backend is ready for new query */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN52"><span class='Ref_to_Proto'>getReadyForQuery</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* consume the message and exit */ 
</span>                <a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+= </span><span class='Number'>5</span> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* if we saved a result object (probably an error), use it */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN450"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="libpq-int.h.html#LN573"><span class='Ref_to_Proto'>pqPrepareAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="fe-exec.c.html#LN138"><span class='Ref_to_Func'>PQmakeEmptyPGresult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN1907"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>:</span>           <span class='Comment_Single_Line'>/* parameter status */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN49"><span class='Ref_to_Proto'>getParameterStatus</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* The backend violates the protocol. */ 
</span>                <a href="pqexpbuffer.c.html#LN232"><span class='Ref_to_Func'>printfPQExpBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN491"><span class='Ref_to_Member'>errorMessage</span></a><span class='Delimiter'>, 
</span>                                  <a href="win32.c.html#LN36"><span class='Ref_to_Func'>libpq_gettext</span></a><span class='Parentheses'>(</span><span class='String'>"protocol error: id=0x%x\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="fe-protocol3.c.html#LN1908"><span class='Ref_To_Local'>id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* trust the specified message length as what to skip */ 
</span>                <a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+= </span><span class='Number'>5</span> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="libpq-int.h.html#LN573"><span class='Ref_to_Proto'>pqPrepareAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch id &raquo; </span> 
        <span class='Comment_Multi_Line'>/* Completed this message, keep going */ 
</span>        <span class='Comment_Multi_Line'>/* trust the specified message length as what to skip */ 
</span>        <a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN431"><span class='Ref_to_Member'>inStart</span></a> <span class='Operator'>+= </span><span class='Number'>5</span> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN1909"><span class='Ref_To_Local'>msgLength</span></a><span class='Delimiter'>; 
</span>        <a href="fe-protocol3.c.html#LN1906"><span class='Ref_To_Local'>needInput</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * We fall out of the loop only upon failing to read data. 
     * conn-&GT;errorMessage has been set by pqWait or pqReadData. We want to 
     * append it to any already-received error message. 
     */ 
</span>    <a href="libpq-int.h.html#LN572"><span class='Ref_to_Proto'>pqSaveErrorResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="libpq-int.h.html#LN573"><span class='Ref_to_Proto'>pqPrepareAsyncResult</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN1901"><span class='Ref_to_Parameter'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pqFunctionCall3 &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Construct startup packet 
 * 
 * Returns a malloc'd packet buffer, or NULL if out of memory 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN2117"></a><span class='Declare_Function'>pqBuildStartupPacket3</span><span class='Parentheses'>(</span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>packetlen</span><span class='Delimiter'>, 
</span><a name="LN2118"></a>                      <span class='Keyword'>const </span><a href="libpq-int.h.html#LN248"><span class='Ref_to_Struct'>PQEnvironmentOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2120"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>startpacket</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="fe-protocol3.c.html#LN2117"><span class='Ref_to_Parameter'>packetlen</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN55"><span class='Ref_to_Proto'>build_startup_packet</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2117"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN2118"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN2120"><span class='Ref_To_Local'>startpacket</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fe-protocol3.c.html#LN2117"><span class='Ref_to_Parameter'>packetlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fe-protocol3.c.html#LN2120"><span class='Ref_To_Local'>startpacket</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="fe-protocol3.c.html#LN2117"><span class='Ref_to_Parameter'>packetlen</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN55"><span class='Ref_to_Proto'>build_startup_packet</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2117"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN2120"><span class='Ref_To_Local'>startpacket</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN2118"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="fe-protocol3.c.html#LN2120"><span class='Ref_To_Local'>startpacket</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Build a startup packet given a filled-in PGconn structure. 
 * 
 * We need to figure out how much space is needed, then fill it in. 
 * To avoid duplicate logic, this routine is called twice: the first time 
 * (with packet == NULL) just counts the space needed, the second time 
 * (with packet == allocated space) fills it in.  Return value is the number 
 * of bytes used. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2140"></a><span class='Declare_Function'>build_startup_packet</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>packet</span><span class='Delimiter'>, 
</span><a name="LN2141"></a>                     <span class='Keyword'>const </span><a href="libpq-int.h.html#LN248"><span class='Ref_to_Struct'>PQEnvironmentOption</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2143"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>packet_len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2144"></a>    <span class='Keyword'>const </span><a href="libpq-int.h.html#LN248"><span class='Ref_to_Struct'>PQEnvironmentOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>next_eo</span><span class='Delimiter'>; 
</span><a name="LN2145"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Protocol version comes first. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>packet</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2150"></a>        <a href="../../include/libpq/pqcomm.h.html#LN112"><span class='Ref_to_Typedef'>ProtocolVersion</span></a> <span class='Declare_Local'>pv</span> <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN403"><span class='Ref_to_Member'>pversion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>packet</span></a> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN2143"><span class='Ref_To_Local'>packet_len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fe-protocol3.c.html#LN2150"><span class='Ref_To_Local'>pv</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN112"><span class='Ref_to_Typedef'>ProtocolVersion</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="fe-protocol3.c.html#LN2143"><span class='Ref_To_Local'>packet_len</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN112"><span class='Ref_to_Typedef'>ProtocolVersion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add user name, database name, options */ 
</span> 
<a name="LN2158"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ADD_STARTUP_OPTION</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>optname</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>optval</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>packet</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>packet</span></a> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN2143"><span class='Ref_To_Local'>packet_len</span></a><span class='Delimiter'>, </span>optname<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <a href="fe-protocol3.c.html#LN2143"><span class='Ref_To_Local'>packet_len</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span>optname<span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>packet</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>packet</span></a> <span class='Operator'>+ </span><a href="fe-protocol3.c.html#LN2143"><span class='Ref_To_Local'>packet_len</span></a><span class='Delimiter'>, </span>optval<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <a href="fe-protocol3.c.html#LN2143"><span class='Ref_To_Local'>packet_len</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span>optval<span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <a href="fe-protocol3.c.html#LN2158"><span class='Ref_to_Macro'>ADD_STARTUP_OPTION</span></a><span class='Parentheses'>(</span><span class='String'>"user"</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN341"><span class='Ref_to_Member'>pguser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <a href="fe-protocol3.c.html#LN2158"><span class='Ref_to_Macro'>ADD_STARTUP_OPTION</span></a><span class='Parentheses'>(</span><span class='String'>"database"</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN339"><span class='Ref_to_Member'>dbName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN340"><span class='Ref_to_Member'>replication</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN340"><span class='Ref_to_Member'>replication</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <a href="fe-protocol3.c.html#LN2158"><span class='Ref_to_Macro'>ADD_STARTUP_OPTION</span></a><span class='Parentheses'>(</span><span class='String'>"replication"</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN340"><span class='Ref_to_Member'>replication</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <a href="fe-protocol3.c.html#LN2158"><span class='Ref_to_Macro'>ADD_STARTUP_OPTION</span></a><span class='Parentheses'>(</span><span class='String'>"options"</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN336"><span class='Ref_to_Member'>pgoptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN416"><span class='Ref_to_Member'>send_appname</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Use appname if present, otherwise use fallback */ 
</span>        <a href="fe-protocol3.c.html#LN2145"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN337"><span class='Ref_to_Member'>appname</span></a> <span class='Operator'>? </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN337"><span class='Ref_to_Member'>appname</span></a> <span class='Operator'>: </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN338"><span class='Ref_to_Member'>fbappname</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2145"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN2145"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="fe-protocol3.c.html#LN2158"><span class='Ref_to_Macro'>ADD_STARTUP_OPTION</span></a><span class='Parentheses'>(</span><span class='String'>"application_name"</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN2145"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN335"><span class='Ref_to_Member'>client_encoding_initial</span></a> <span class='Operator'>&& </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN335"><span class='Ref_to_Member'>client_encoding_initial</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <a href="fe-protocol3.c.html#LN2158"><span class='Ref_to_Macro'>ADD_STARTUP_OPTION</span></a><span class='Parentheses'>(</span><span class='String'>"client_encoding"</span><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>conn</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN335"><span class='Ref_to_Member'>client_encoding_initial</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add any environment-driven GUC settings needed */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2144"><span class='Ref_To_Local'>next_eo</span></a> <span class='Operator'>= </span><a href="fe-protocol3.c.html#LN2141"><span class='Ref_to_Parameter'>options</span></a><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN2144"><span class='Ref_To_Local'>next_eo</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN250"><span class='Ref_to_Member'>envName</span></a><span class='Delimiter'>; </span><a href="fe-protocol3.c.html#LN2144"><span class='Ref_To_Local'>next_eo</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fe-protocol3.c.html#LN2145"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2144"><span class='Ref_To_Local'>next_eo</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN250"><span class='Ref_to_Member'>envName</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2145"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='String'>"default"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="fe-protocol3.c.html#LN2158"><span class='Ref_to_Macro'>ADD_STARTUP_OPTION</span></a><span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2144"><span class='Ref_To_Local'>next_eo</span></a><span class='Operator'>-&GT;</span><a href="libpq-int.h.html#LN251"><span class='Ref_to_Member'>pgName</span></a><span class='Delimiter'>, </span><a href="fe-protocol3.c.html#LN2145"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Add trailing terminator */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>packet</span></a><span class='Parentheses'>) 
</span>        <a href="fe-protocol3.c.html#LN2140"><span class='Ref_to_Parameter'>packet</span></a><span class='Delimiter'>[</span><a href="fe-protocol3.c.html#LN2143"><span class='Ref_To_Local'>packet_len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="fe-protocol3.c.html#LN2143"><span class='Ref_To_Local'>packet_len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="fe-protocol3.c.html#LN2143"><span class='Ref_To_Local'>packet_len</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_startup_packet &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>