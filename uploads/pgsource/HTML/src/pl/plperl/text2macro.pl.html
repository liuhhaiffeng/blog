<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\pl\plperl\text2macro.pl</title>
<LINK REL=StyleSheet HREF="../../../Perl_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\pl\plperl\text2macro.pl</b></p></td>
<td align='right'>
Wed Jun 14 08:26:12 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Single_Line'># src/pl/plperl/text2macro.pl 
</span> 
<span class='Perl_POD'>=head1 NAME 
 
text2macro.pl - convert text files into C string-literal macro definitions 
 
=head1 SYNOPSIS 
 
  text2macro [options] file ... &GT; output.h 
 
Options: 
 
  --prefix=S   - add prefix S to the names of the macros 
  --name=S     - use S as the macro name (assumes only one file) 
  --strip=S    - don't include lines that match perl regex S 
 
=head1 DESCRIPTION 
 
Reads one or more text files and outputs a corresponding series of C 
pre-processor macro definitions. Each macro defines a string literal that 
contains the contents of the corresponding text file. The basename of the text 
file as capitalized and used as the name of the macro, along with an optional prefix. 
 
=cut 
</span> 
<span class='Control'>use</span> strict<span class='Delimiter'>; 
</span><span class='Control'>use</span> warnings<span class='Delimiter'>; 
</span> 
<span class='Control'>use</span> Getopt<span class='Operator'>::</span>Long<span class='Delimiter'>; 
</span> 
GetOptions<span class='Parentheses'>(</span> 
    <span class='String'>'prefix=s'</span>  <span class='Operator'>=&GT; \</span><span class='Keyword'>my </span>$opt_prefix<span class='Delimiter'>, 
</span>    <span class='String'>'name=s'</span>    <span class='Operator'>=&GT; \</span><span class='Keyword'>my </span>$opt_name<span class='Delimiter'>, 
</span>    <span class='String'>'strip=s'</span>   <span class='Operator'>=&GT; \</span><span class='Keyword'>my </span>$opt_strip<span class='Delimiter'>, 
</span>    <span class='String'>'selftest!'</span> <span class='Operator'>=&GT; </span><span class='Control'>sub</span> <span class='Delimiter'>{ </span><span class='Control'>exit</span> <a href="text2macro.pl.html#LN77"><span class='Ref_to_Func'>selftest</span></a><span class='Parentheses'>() </span><span class='Delimiter'>},</span><span class='Parentheses'>)</span> or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span> 
<span class='Control'>die</span> <span class='String'>"No text files specified"</span> 
  <span class='Control'>unless</span> @ARGV<span class='Delimiter'>; 
</span> 
<span class='Keyword'>print </span><span class='Operator'>qq</span><span class='String'>{ 
</span><span class='Operator'>/* 
</span> <span class='Operator'>* </span>DO NOT EDIT <span class='Operator'>- </span>THIS FILE IS AUTOGENERATED <span class='Operator'>- </span>CHANGES WILL BE LOST 
 <span class='Operator'>* </span>Written by $0 from @ARGV 
 <span class='Operator'>*/ 
</span><span class='Delimiter'>}; 
</span> 
<span class='Control'>for</span> <span class='Keyword'>my </span>$src_file <span class='Parentheses'>(</span>@ARGV<span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>my </span>$macro <span class='Operator'>= </span>$src_file<span class='Parentheses'>) </span><span class='Operator'>=~ s</span><span class='String'>/ .*? (\w+) (?:\.\w+) $/$1/</span>x<span class='Delimiter'>; 
</span> 
    <span class='Keyword'>open my </span>$src_fh<span class='Delimiter'>, </span><span class='String'>'&LT;'</span><span class='Delimiter'>, </span>$src_file 
      or <span class='Control'>die</span> <span class='String'>"Can't open $src_file: $!"</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>printf </span><span class='Operator'>qq</span><span class='String'>{#define %s%s \\\n}</span><span class='Delimiter'>, 
</span>      $opt_prefix <span class='Operator'>|| </span><span class='String'>''</span><span class='Delimiter'>, 
</span>      <span class='Parentheses'>(</span>$opt_name<span class='Parentheses'>) </span><span class='Operator'>? </span>$opt_name <span class='Operator'>: </span><span class='Keyword'>uc </span>$macro<span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>&LT;</span>$src_fh<span class='Operator'>&GT;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>chomp</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>next</span> <span class='Control'>if</span> $opt_strip and <span class='Operator'>m</span><span class='String'>/$opt_strip/</span>o<span class='Delimiter'>; 
</span> 
        <span class='Comment_Single_Line'># escape the text to suite C string literal rules 
</span>        <span class='Operator'>s</span><span class='String'>/\\/\\\\/</span>g<span class='Delimiter'>; 
</span>        <span class='Operator'>s</span><span class='String'>/"/\\"/</span>g<span class='Delimiter'>; 
</span> 
        <span class='Keyword'>printf </span><span class='Operator'>qq</span><span class='String'>{"%s\\n" \\\n}</span><span class='Delimiter'>, </span>$_<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Keyword'>print </span><span class='Operator'>qq</span><span class='String'>{""\n\n}</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>print </span><span class='String'>"/* end */\n"</span><span class='Delimiter'>; 
</span> 
<span class='Control'>exit</span> 0<span class='Delimiter'>; 
</span> 
 
<a name="LN77"></a><span class='Control'>sub</span> <span class='Declare_Function'>selftest</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$tmp    <span class='Operator'>= </span><span class='String'>"text2macro_tmp"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$string <span class='Operator'>= q</span><span class='String'>{a '' '\\'' "" "\\"" "\\\\" "\\\\n" b}</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>open my </span>$fh<span class='Delimiter'>, </span><span class='String'>'&GT;'</span><span class='Delimiter'>, </span><span class='String'>"$tmp.pl"</span> or <span class='Control'>die</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span>$fh $string<span class='Delimiter'>; 
</span>    <span class='Keyword'>close </span>$fh<span class='Delimiter'>; 
</span> 
    <span class='Keyword'>system</span><span class='Parentheses'>(</span><span class='String'>"perl $0 --name=X $tmp.pl &GT; $tmp.c"</span><span class='Parentheses'>) </span><span class='Operator'>== </span>0 or <span class='Control'>die</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>open </span>$fh<span class='Delimiter'>, </span><span class='String'>'&GT;&GT;'</span><span class='Delimiter'>, </span><span class='String'>"$tmp.c"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span>$fh <span class='String'>"#include &LT;stdio.h&GT;\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span>$fh <span class='String'>"int main() { puts(X); return 0; }\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>close </span>$fh<span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span><span class='String'>"cat -n $tmp.c"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>system</span><span class='Parentheses'>(</span><span class='String'>"make $tmp"</span><span class='Parentheses'>) </span><span class='Operator'>== </span>0 or <span class='Control'>die</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>open </span>$fh<span class='Delimiter'>, </span><span class='String'>'&LT;'</span><span class='Delimiter'>, </span><span class='String'>"./$tmp |"</span> or <span class='Control'>die</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$result <span class='Operator'>= &LT;</span>$fh<span class='Operator'>&GT;</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>unlink </span><span class='Operator'>&LT;</span>$tmp<span class='Operator'>.*&GT;</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>warn </span><span class='String'>"Test string: $string\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>warn </span><span class='String'>"Result     : $result"</span><span class='Delimiter'>; 
</span>    <span class='Control'>die</span> <span class='String'>"Failed!"</span> <span class='Control'>if</span> $result <span class='Operator'>ne </span><span class='String'>"$string\n"</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>