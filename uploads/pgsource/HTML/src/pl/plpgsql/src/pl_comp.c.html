<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\pl\plpgsql\src\pl_comp.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\pl\plpgsql\src\pl_comp.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:12 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pl_comp.c        - Compiler part of the PL/pgSQL 
 *            procedural language 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/pl/plpgsql/src/pl_comp.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/guc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/regproc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"plpgsql.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Our own local and global variables 
 * ---------- 
 */ 
</span><a name="LN42"></a><a href="plpgsql.h.html#LN403"><span class='Ref_to_Struct'>PLpgSQL_stmt_block</span></a> <span class='Operator'>*</span><span class='Declare_Var'>plpgsql_parse_result</span><span class='Delimiter'>; 
</span> 
<a name="LN44"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>datums_alloc</span><span class='Delimiter'>; 
</span><a name="LN45"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>plpgsql_nDatums</span><span class='Delimiter'>; 
</span><a name="LN46"></a><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>**</span><span class='Declare_Var'>plpgsql_Datums</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>datums_last</span><span class='Delimiter'>; 
</span> 
<a name="LN49"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>plpgsql_error_funcname</span><span class='Delimiter'>; 
</span><a name="LN50"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>plpgsql_DumpExecTree</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN51"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>plpgsql_check_syntax</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN53"></a><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Var'>plpgsql_curr_compile</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* A context appropriate for short-term allocs during compilation */ 
</span><a name="LN56"></a><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>plpgsql_compile_tmp_cxt</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * Hash table for compiled functions 
 * ---------- 
 */ 
</span><a name="LN62"></a><span class='Keyword'>static </span><a href="../../../backend/utils/hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Var'>plpgsql_HashTable</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<a name="LN64"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>plpgsql_hashent</span> 
<span class='Delimiter'>{ 
</span><a name="LN66"></a>    <a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a> <span class='Declare_Member'>key</span><span class='Delimiter'>; 
</span><a name="LN67"></a>    <a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Member'>function</span><span class='Delimiter'>; 
</span><a name="LN68"></a>} <span class='Declare_Typedef'>plpgsql_HashEnt</span><span class='Delimiter'>; 
</span> 
<a name="LN70"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>FUNCS_PER_USER</span>      <span class='Number'>128</span> <span class='Comment_Single_Line'>/* initial table size */ 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * Lookup table for EXCEPTION condition names 
 * ---------- 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN78"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>label</span><span class='Delimiter'>; 
</span><a name="LN79"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>sqlerrstate</span><span class='Delimiter'>; 
</span><a name="LN80"></a>} <span class='Declare_Typedef'>ExceptionLabelMap</span><span class='Delimiter'>; 
</span> 
<a name="LN82"></a><span class='Keyword'>static const </span><a href="pl_comp.c.html#LN76"><span class='Ref_to_Typedef'>ExceptionLabelMap</span></a> <span class='Declare_Var'>exception_label_map</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span><span class='Keyword'>#include </span><span class='String'>"plerrcodes.h"</span>         <span class='Comment_Single_Line'>/* pgrminclude ignore */ 
</span>    <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
}; 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * static prototypes 
 * ---------- 
 */ 
</span><a name="LN92"></a><span class='Keyword'>static </span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>do_compile</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, 
</span><a name="LN93"></a>           <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>procTup</span><span class='Delimiter'>, 
</span><a name="LN94"></a>           <a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>function</span><span class='Delimiter'>, 
</span><a name="LN95"></a>           <a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hashkey</span><span class='Delimiter'>, 
</span><a name="LN96"></a>           <span class='Keyword'>bool </span><span class='Declare_Parameter'>forValidator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN97"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>plpgsql_compile_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN98"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>add_parameter_name</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN37"><span class='Ref_to_Enum'>PLpgSQL_nsitem_type</span></a> <span class='Declare_Parameter'>itemtype</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>itemno</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN99"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>add_dummy_return</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>function</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN100"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>plpgsql_pre_column_ref</span><span class='Parentheses'>(</span><a href="../../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cref</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN101"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>plpgsql_post_column_ref</span><span class='Parentheses'>(</span><a href="../../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cref</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN102"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>plpgsql_param_ref</span><span class='Parentheses'>(</span><a href="../../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN241"><span class='Ref_to_Struct'>ParamRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pref</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN103"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>resolve_column_ref</span><span class='Parentheses'>(</span><a href="../../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN104"></a>                   <a href="../../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cref</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>error_if_no_field</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN105"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>make_datum_param</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dno</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>static </span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>build_row_from_class</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classOid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static </span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>build_row_from_vars</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>vars</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>numvars</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN108"></a><span class='Keyword'>static </span><a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>build_datatype</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>typeTup</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN109"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>plpgsql_start_datums</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN110"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>plpgsql_finish_datums</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>function</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN111"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>compute_function_hashkey</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, 
</span><a name="LN112"></a>                         <a href="../../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a> <span class='Declare_Parameter'>procStruct</span><span class='Delimiter'>, 
</span><a name="LN113"></a>                         <a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hashkey</span><span class='Delimiter'>, 
</span><a name="LN114"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>forValidator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN115"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>plpgsql_resolve_polymorphic_argtypes</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>numargs</span><span class='Delimiter'>, 
</span><a name="LN116"></a>                                     <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>argtypes</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>argmodes</span><span class='Delimiter'>, 
</span><a name="LN117"></a>                                     <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>call_expr</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>forValidator</span><span class='Delimiter'>, 
</span><a name="LN118"></a>                                     <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>proname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN119"></a><span class='Keyword'>static </span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>plpgsql_HashTableLookup</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func_key</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN120"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>plpgsql_HashTableInsert</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>function</span><span class='Delimiter'>, 
</span><a name="LN121"></a>                        <a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func_key</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN122"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>plpgsql_HashTableDelete</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>function</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN123"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>delete_function</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_compile      Make an execution tree for a PL/pgSQL function. 
 * 
 * If forValidator is true, we're only compiling for validation purposes, 
 * and so some checks are skipped. 
 * 
 * Note: it's important for this to fall through quickly if the function 
 * has already been compiled. 
 * ---------- 
 */ 
</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>* 
</span><a name="LN136"></a><span class='Declare_Function'>plpgsql_compile</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>forValidator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN138"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcOid</span> <span class='Operator'>= </span><a href="pl_comp.c.html#LN136"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Delimiter'>; 
</span><a name="LN139"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>procTup</span><span class='Delimiter'>; 
</span><a name="LN140"></a>    <a href="../../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a> <span class='Declare_Local'>procStruct</span><span class='Delimiter'>; 
</span><a name="LN141"></a>    <a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Local'>function</span><span class='Delimiter'>; 
</span><a name="LN142"></a>    <a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a> <span class='Declare_Local'>hashkey</span><span class='Delimiter'>; 
</span><a name="LN143"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>function_valid</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN144"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hashkey_valid</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Lookup the pg_proc tuple by Oid; we'll need it in any case 
     */ 
</span>    <a href="pl_comp.c.html#LN139"><span class='Ref_To_Local'>procTup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN138"><span class='Ref_To_Local'>funcOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN139"><span class='Ref_To_Local'>procTup</span></a><span class='Parentheses'>))</span> 
        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for function %u"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN138"><span class='Ref_To_Local'>funcOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN140"><span class='Ref_To_Local'>procStruct</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN139"><span class='Ref_To_Local'>procTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * See if there's already a cache entry for the current FmgrInfo. If not, 
     * try to find one in the hash table. 
     */ 
</span>    <a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN136"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span> 
<a name="LN160"></a><span class='Label'>recheck</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Compute hashkey using function signature and actual arg types */ 
</span>        <a href="pl_comp.c.html#LN111"><span class='Ref_to_Proto'>compute_function_hashkey</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN136"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN140"><span class='Ref_To_Local'>procStruct</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_comp.c.html#LN142"><span class='Ref_To_Local'>hashkey</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN136"><span class='Ref_to_Parameter'>forValidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_comp.c.html#LN144"><span class='Ref_To_Local'>hashkey_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* And do the lookup */ 
</span>        <a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN119"><span class='Ref_to_Proto'>plpgsql_HashTableLookup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_comp.c.html#LN142"><span class='Ref_To_Local'>hashkey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We have a compiled function, but is it still valid? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN821"><span class='Ref_to_Member'>fn_xmin</span></a> <span class='Operator'>== </span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN139"><span class='Ref_To_Local'>procTup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../../../backend/storage/page/itemptr.c.html#LN27"><span class='Ref_to_Func'>ItemPointerEquals</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN822"><span class='Ref_to_Member'>fn_tid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_comp.c.html#LN139"><span class='Ref_To_Local'>procTup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span> 
            <a href="pl_comp.c.html#LN143"><span class='Ref_To_Local'>function_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Nope, so remove it from hashtable and try to drop associated 
             * storage (if not done already). 
             */ 
</span>            <a href="pl_comp.c.html#LN123"><span class='Ref_to_Proto'>delete_function</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If the function isn't in active use then we can overwrite the 
             * func struct with new data, allowing any other existing fn_extra 
             * pointers to make use of the new definition on their next use. 
             * If it is in use then just leave it alone and make a new one. 
             * (The active invocations will run to completion using the 
             * previous definition, and then the cache entry will just be 
             * leaked; doesn't seem worth adding code to clean it up, given 
             * what a corner case this is.) 
             * 
             * If we found the function struct via fn_extra then it's possible 
             * a replacement has already been made, so go back and recheck the 
             * hashtable. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN874"><span class='Ref_to_Member'>use_count</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_comp.c.html#LN144"><span class='Ref_To_Local'>hashkey_valid</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="pl_comp.c.html#LN160"><span class='Ref_to_Label'>recheck</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if function &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If the function wasn't found or was out-of-date, we have to compile it 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_comp.c.html#LN143"><span class='Ref_To_Local'>function_valid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Calculate hashkey if we didn't already; we'll need it to store the 
         * completed function. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_comp.c.html#LN144"><span class='Ref_To_Local'>hashkey_valid</span></a><span class='Parentheses'>) 
</span>            <a href="pl_comp.c.html#LN111"><span class='Ref_to_Proto'>compute_function_hashkey</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN136"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN140"><span class='Ref_To_Local'>procStruct</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_comp.c.html#LN142"><span class='Ref_To_Local'>hashkey</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_comp.c.html#LN136"><span class='Ref_to_Parameter'>forValidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Do the hard part. 
         */ 
</span>        <a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN92"><span class='Ref_to_Proto'>do_compile</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN136"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN139"><span class='Ref_To_Local'>procTup</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="pl_comp.c.html#LN142"><span class='Ref_To_Local'>hashkey</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN136"><span class='Ref_to_Parameter'>forValidator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN139"><span class='Ref_To_Local'>procTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Save pointer in FmgrInfo to avoid search on subsequent calls 
     */ 
</span>    <a href="pl_comp.c.html#LN136"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Finally return the compiled function 
     */ 
</span>    <span class='Control'>return</span> <a href="pl_comp.c.html#LN141"><span class='Ref_To_Local'>function</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_compile &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This is the slow part of plpgsql_compile(). 
 * 
 * The passed-in "function" pointer is either NULL or an already-allocated 
 * function struct to overwrite. 
 * 
 * While compiling a function, the CurrentMemoryContext is the 
 * per-function memory context of the function we are compiling. That 
 * means a palloc() will allocate storage with the same lifetime as 
 * the function itself. 
 * 
 * Because palloc()'d storage will not be immediately freed, temporary 
 * allocations should either be performed in a short-lived memory 
 * context or explicitly pfree'd. Since not all backend functions are 
 * careful about pfree'ing their allocations, it is also wise to 
 * switch into a short-term context before calling into the 
 * backend. An appropriate context for performing short-term 
 * allocations is the plpgsql_compile_tmp_cxt. 
 * 
 * NB: this code is not re-entrant.  We assume that nothing we do here could 
 * result in the invocation of another plpgsql function. 
 */ 
</span><span class='Keyword'>static </span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>* 
</span><a name="LN264"></a><span class='Declare_Function'>do_compile</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, 
</span><a name="LN265"></a>           <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>procTup</span><span class='Delimiter'>, 
</span><a name="LN266"></a>           <a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>function</span><span class='Delimiter'>, 
</span><a name="LN267"></a>           <a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hashkey</span><span class='Delimiter'>, 
</span><a name="LN268"></a>           <span class='Keyword'>bool </span><span class='Declare_Parameter'>forValidator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN270"></a>    <a href="../../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a> <span class='Declare_Local'>procStruct</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN265"><span class='Ref_to_Parameter'>procTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN271"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_dml_trigger</span> <span class='Operator'>= </span><a href="../../../include/commands/trigger.h.html#LN24"><span class='Ref_to_Macro'>CALLED_AS_TRIGGER</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN264"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN272"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_event_trigger</span> <span class='Operator'>= </span><a href="../../../include/commands/event_trigger.h.html#LN39"><span class='Ref_to_Macro'>CALLED_AS_EVENT_TRIGGER</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN264"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN273"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>prosrcdatum</span><span class='Delimiter'>; 
</span><a name="LN274"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN275"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>proc_source</span><span class='Delimiter'>; 
</span><a name="LN276"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>typeTup</span><span class='Delimiter'>; 
</span><a name="LN277"></a>    <a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typeStruct</span><span class='Delimiter'>; 
</span><a name="LN278"></a>    <a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN279"></a>    <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span><span class='Delimiter'>; 
</span><a name="LN280"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN281"></a>    ErrorContextCallback <span class='Declare_Local'>plerrcontext</span><span class='Delimiter'>; 
</span><a name="LN282"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>parse_rc</span><span class='Delimiter'>; 
</span><a name="LN283"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>rettypeid</span><span class='Delimiter'>; 
</span><a name="LN284"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numargs</span><span class='Delimiter'>; 
</span><a name="LN285"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_in_args</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN286"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_out_args</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN287"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>argtypes</span><span class='Delimiter'>; 
</span><a name="LN288"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>argnames</span><span class='Delimiter'>; 
</span><a name="LN289"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>argmodes</span><span class='Delimiter'>; 
</span><a name="LN290"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>in_arg_varnos</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN291"></a>    <a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>**</span><span class='Declare_Local'>out_arg_variables</span><span class='Delimiter'>; 
</span><a name="LN292"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>func_cxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup the scanner input and error info.  We assume that this function 
     * cannot be invoked recursively, so there's no need to save and restore 
     * the static variables used here. 
     */ 
</span>    <a href="pl_comp.c.html#LN273"><span class='Ref_To_Local'>prosrcdatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN265"><span class='Ref_to_Parameter'>procTup</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/catalog/pg_proc.h.html#LN114"><span class='Ref_to_Const'>Anum_pg_proc_prosrc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_comp.c.html#LN274"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN274"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"null prosrc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN275"><span class='Ref_To_Local'>proc_source</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN273"><span class='Ref_To_Local'>prosrcdatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_scanner.c.html#LN700"><span class='Ref_to_Func'>plpgsql_scanner_init</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN275"><span class='Ref_To_Local'>proc_source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN49"><span class='Ref_to_Global_Var'>plpgsql_error_funcname</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN270"><span class='Ref_To_Local'>procStruct</span></a><span class='Operator'>-&GT;</span>proname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup error traceback support for ereport() 
     */ 
</span>    <a href="pl_comp.c.html#LN281"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="pl_comp.c.html#LN97"><span class='Ref_to_Proto'>plpgsql_compile_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN281"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><a href="pl_comp.c.html#LN268"><span class='Ref_to_Parameter'>forValidator</span></a> <span class='Operator'>? </span><a href="pl_comp.c.html#LN275"><span class='Ref_To_Local'>proc_source</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN281"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="pl_comp.c.html#LN281"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do extra syntax checks when validating the function definition. We skip 
     * this when actually compiling functions for execution, for performance 
     * reasons. 
     */ 
</span>    <a href="pl_comp.c.html#LN51"><span class='Ref_to_Global_Var'>plpgsql_check_syntax</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN268"><span class='Ref_to_Parameter'>forValidator</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the new function struct, if not done already.  The function 
     * structs are never thrown away, so keep them in TopMemoryContext. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="../../../backend/utils/mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* re-using a previously existing struct, so clear it out */ 
</span>        memset<span class='Parentheses'>(</span><a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pl_comp.c.html#LN53"><span class='Ref_to_Global_Var'>plpgsql_curr_compile</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * All the permanent output of compilation (e.g. parse tree) is kept in a 
     * per-function memory context, so it can be reclaimed easily. 
     */ 
</span>    <a href="pl_comp.c.html#LN292"><span class='Ref_To_Local'>func_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../../../backend/utils/mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                                     <span class='String'>"PL/pgSQL function context"</span><span class='Delimiter'>, 
</span>                                     <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN56"><span class='Ref_to_Global_Var'>plpgsql_compile_tmp_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN292"><span class='Ref_To_Local'>func_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN819"><span class='Ref_to_Member'>fn_signature</span></a> <span class='Operator'>= </span><a href="../../../include/utils/regproc.h.html#LN18"><span class='Ref_to_Proto'>format_procedure</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN264"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN820"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN264"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN821"><span class='Ref_to_Member'>fn_xmin</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN265"><span class='Ref_to_Parameter'>procTup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN822"><span class='Ref_to_Member'>fn_tid</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN265"><span class='Ref_to_Parameter'>procTup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN264"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN81"><span class='Ref_to_Member'>fncollation</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN826"><span class='Ref_to_Member'>fn_cxt</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN292"><span class='Ref_To_Local'>func_cxt</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN837"><span class='Ref_to_Member'>out_param_varno</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* set up for no OUT param */ 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN856"><span class='Ref_to_Member'>resolve_option</span></a> <span class='Operator'>= </span><a href="pl_handler.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_variable_conflict</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN858"><span class='Ref_to_Member'>print_strict_params</span></a> <span class='Operator'>= </span><a href="pl_handler.c.html#LN47"><span class='Ref_to_Global_Var'>plpgsql_print_strict_params</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* only promote extra warnings and errors at CREATE FUNCTION time */ 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN861"><span class='Ref_to_Member'>extra_warnings</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN268"><span class='Ref_to_Parameter'>forValidator</span></a> <span class='Operator'>? </span><a href="pl_handler.c.html#LN53"><span class='Ref_to_Global_Var'>plpgsql_extra_warnings</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN862"><span class='Ref_to_Member'>extra_errors</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN268"><span class='Ref_to_Parameter'>forValidator</span></a> <span class='Operator'>? </span><a href="pl_handler.c.html#LN54"><span class='Ref_to_Global_Var'>plpgsql_extra_errors</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN271"><span class='Ref_To_Local'>is_dml_trigger</span></a><span class='Parentheses'>) 
</span>        <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN823"><span class='Ref_to_Member'>fn_is_trigger</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN809"><span class='Ref_to_EnumConst'>PLPGSQL_DML_TRIGGER</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN272"><span class='Ref_To_Local'>is_event_trigger</span></a><span class='Parentheses'>) 
</span>        <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN823"><span class='Ref_to_Member'>fn_is_trigger</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN810"><span class='Ref_to_EnumConst'>PLPGSQL_EVENT_TRIGGER</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN823"><span class='Ref_to_Member'>fn_is_trigger</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN811"><span class='Ref_to_EnumConst'>PLPGSQL_NOT_TRIGGER</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the compiler, particularly the namespace stack.  The 
     * outermost namespace contains function parameters and other special 
     * variables (such as FOUND), and is named after the function itself. 
     */ 
</span>    <a href="pl_funcs.c.html#LN43"><span class='Ref_to_Func'>plpgsql_ns_init</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="pl_funcs.c.html#LN54"><span class='Ref_to_Func'>plpgsql_ns_push</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN270"><span class='Ref_To_Local'>procStruct</span></a><span class='Operator'>-&GT;</span>proname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN50"><span class='Ref_to_EnumConst'>PLPGSQL_LABEL_BLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN50"><span class='Ref_to_Global_Var'>plpgsql_DumpExecTree</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN109"><span class='Ref_to_Proto'>plpgsql_start_datums</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN823"><span class='Ref_to_Member'>fn_is_trigger</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN811"><span class='Ref_to_EnumConst'>PLPGSQL_NOT_TRIGGER</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Fetch info about the procedure's parameters. Allocations aren't 
             * needed permanently, so make them in tmp cxt. 
             * 
             * We also need to resolve any polymorphic input or output 
             * argument types.  In validation mode we won't be able to, so we 
             * arbitrarily assume we are dealing with integers. 
             */ 
</span>            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN56"><span class='Ref_to_Global_Var'>plpgsql_compile_tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pl_comp.c.html#LN284"><span class='Ref_To_Local'>numargs</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN171"><span class='Ref_to_Proto'>get_func_arg_info</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN265"><span class='Ref_to_Parameter'>procTup</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="pl_comp.c.html#LN287"><span class='Ref_To_Local'>argtypes</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_comp.c.html#LN288"><span class='Ref_To_Local'>argnames</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_comp.c.html#LN289"><span class='Ref_To_Local'>argmodes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pl_comp.c.html#LN115"><span class='Ref_to_Proto'>plpgsql_resolve_polymorphic_argtypes</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN284"><span class='Ref_To_Local'>numargs</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN287"><span class='Ref_To_Local'>argtypes</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN289"><span class='Ref_To_Local'>argmodes</span></a><span class='Delimiter'>, 
</span>                                                 <a href="pl_comp.c.html#LN264"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN65"><span class='Ref_to_Member'>fn_expr</span></a><span class='Delimiter'>, 
</span>                                                 <a href="pl_comp.c.html#LN268"><span class='Ref_to_Parameter'>forValidator</span></a><span class='Delimiter'>, 
</span>                                                 <a href="pl_comp.c.html#LN49"><span class='Ref_to_Global_Var'>plpgsql_error_funcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pl_comp.c.html#LN290"><span class='Ref_To_Local'>in_arg_varnos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN284"><span class='Ref_To_Local'>numargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN291"><span class='Ref_To_Local'>out_arg_variables</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN284"><span class='Ref_To_Local'>numargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN292"><span class='Ref_To_Local'>func_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Create the variables for the procedure's parameters. 
             */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN284"><span class='Ref_To_Local'>numargs</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN410"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span><a name="LN411"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argtypeid</span> <span class='Operator'>= </span><a href="pl_comp.c.html#LN287"><span class='Ref_To_Local'>argtypes</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN412"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>argmode</span> <span class='Operator'>= </span><a href="pl_comp.c.html#LN289"><span class='Ref_To_Local'>argmodes</span></a> <span class='Operator'>? </span><a href="pl_comp.c.html#LN289"><span class='Ref_To_Local'>argmodes</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>: </span><a href="../../../include/catalog/pg_proc.h.html#LN5500"><span class='Ref_to_Const'>PROARGMODE_IN</span></a><span class='Delimiter'>; 
</span><a name="LN413"></a>                <a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>*</span><span class='Declare_Local'>argdtype</span><span class='Delimiter'>; 
</span><a name="LN414"></a>                <a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>argvariable</span><span class='Delimiter'>; 
</span><a name="LN415"></a>                <a href="plpgsql.h.html#LN37"><span class='Ref_to_Enum'>PLpgSQL_nsitem_type</span></a> <span class='Declare_Local'>argitemtype</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Create $n name for variable */ 
</span>                <a href="../../plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN410"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN410"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"$%d"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Create datatype info */ 
</span>                <a href="pl_comp.c.html#LN413"><span class='Ref_To_Local'>argdtype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN411"><span class='Ref_To_Local'>argtypeid</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                               <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Disallow pseudotype argument */ 
</span>                <span class='Comment_Multi_Line'>/* (note we already replaced polymorphic types) */ 
</span>                <span class='Comment_Multi_Line'>/* (build_variable would do this, but wrong message) */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN413"><span class='Ref_To_Local'>argdtype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN179"><span class='Ref_to_Member'>ttype</span></a> <span class='Operator'>!= </span><a href="plpgsql.h.html#LN73"><span class='Ref_to_EnumConst'>PLPGSQL_TTYPE_SCALAR</span></a> <span class='Operator'>&& 
</span>                    <a href="pl_comp.c.html#LN413"><span class='Ref_To_Local'>argdtype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN179"><span class='Ref_to_Member'>ttype</span></a> <span class='Operator'>!= </span><a href="plpgsql.h.html#LN74"><span class='Ref_to_EnumConst'>PLPGSQL_TTYPE_ROW</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"PL/pgSQL functions cannot accept type %s"</span><span class='Delimiter'>, 
</span>                                  <a href="../../../backend/utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN411"><span class='Ref_To_Local'>argtypeid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Build variable and add to datum list */ 
</span>                <a href="pl_comp.c.html#LN414"><span class='Ref_To_Local'>argvariable</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN410"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                                     <a href="pl_comp.c.html#LN413"><span class='Ref_To_Local'>argdtype</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN414"><span class='Ref_To_Local'>argvariable</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN209"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pl_comp.c.html#LN415"><span class='Ref_To_Local'>argitemtype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN40"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_VAR</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN414"><span class='Ref_To_Local'>argvariable</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN209"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pl_comp.c.html#LN415"><span class='Ref_To_Local'>argitemtype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN41"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_ROW</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* Remember arguments in appropriate arrays */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN412"><span class='Ref_To_Local'>argmode</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_proc.h.html#LN5500"><span class='Ref_to_Const'>PROARGMODE_IN</span></a> <span class='Operator'>|| 
</span>                    <a href="pl_comp.c.html#LN412"><span class='Ref_To_Local'>argmode</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_proc.h.html#LN5502"><span class='Ref_to_Const'>PROARGMODE_INOUT</span></a> <span class='Operator'>|| 
</span>                    <a href="pl_comp.c.html#LN412"><span class='Ref_To_Local'>argmode</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_proc.h.html#LN5503"><span class='Ref_to_Const'>PROARGMODE_VARIADIC</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_comp.c.html#LN290"><span class='Ref_To_Local'>in_arg_varnos</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN285"><span class='Ref_To_Local'>num_in_args</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_comp.c.html#LN414"><span class='Ref_To_Local'>argvariable</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN412"><span class='Ref_To_Local'>argmode</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_proc.h.html#LN5501"><span class='Ref_to_Const'>PROARGMODE_OUT</span></a> <span class='Operator'>|| 
</span>                    <a href="pl_comp.c.html#LN412"><span class='Ref_To_Local'>argmode</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_proc.h.html#LN5502"><span class='Ref_to_Const'>PROARGMODE_INOUT</span></a> <span class='Operator'>|| 
</span>                    <a href="pl_comp.c.html#LN412"><span class='Ref_To_Local'>argmode</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_proc.h.html#LN5504"><span class='Ref_to_Const'>PROARGMODE_TABLE</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_comp.c.html#LN291"><span class='Ref_To_Local'>out_arg_variables</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN286"><span class='Ref_To_Local'>num_out_args</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_comp.c.html#LN414"><span class='Ref_To_Local'>argvariable</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Add to namespace under the $n name */ 
</span>                <a href="pl_comp.c.html#LN98"><span class='Ref_to_Proto'>add_parameter_name</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN415"><span class='Ref_To_Local'>argitemtype</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN414"><span class='Ref_To_Local'>argvariable</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN410"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* If there's a name for the argument, make an alias */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN288"><span class='Ref_To_Local'>argnames</span></a> <span class='Operator'>&& </span><a href="pl_comp.c.html#LN288"><span class='Ref_To_Local'>argnames</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                    <a href="pl_comp.c.html#LN98"><span class='Ref_to_Proto'>add_parameter_name</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN415"><span class='Ref_To_Local'>argitemtype</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN414"><span class='Ref_To_Local'>argvariable</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>, 
</span>                                       <a href="pl_comp.c.html#LN288"><span class='Ref_To_Local'>argnames</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;numargs;i++ &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * If there's just one OUT parameter, out_param_varno points 
             * directly to it.  If there's more than one, build a row that 
             * holds all of them. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN286"><span class='Ref_To_Local'>num_out_args</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN837"><span class='Ref_to_Member'>out_param_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN291"><span class='Ref_To_Local'>out_arg_variables</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN286"><span class='Ref_To_Local'>num_out_args</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN477"></a>                <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><a href="pl_comp.c.html#LN107"><span class='Ref_to_Proto'>build_row_from_vars</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN291"><span class='Ref_To_Local'>out_arg_variables</span></a><span class='Delimiter'>, 
</span>                                                       <a href="pl_comp.c.html#LN286"><span class='Ref_To_Local'>num_out_args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="plpgsql.h.html#LN1079"><span class='Ref_to_Proto'>plpgsql_adddatum</span></a><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN477"><span class='Ref_To_Local'>row</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN837"><span class='Ref_to_Member'>out_param_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN477"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN279"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Check for a polymorphic returntype. If found, use the actual 
             * returntype type from the caller's FuncExpr node, if we have 
             * one.  (In validation mode we arbitrarily assume we are dealing 
             * with integers.) 
             * 
             * Note: errcode is FEATURE_NOT_SUPPORTED because it should always 
             * work; if it doesn't we're in some context that fails to make 
             * the info available. 
             */ 
</span>            <a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN270"><span class='Ref_To_Local'>procStruct</span></a><span class='Operator'>-&GT;</span>prorettype<span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN744"><span class='Ref_to_Macro'>IsPolymorphicType</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN268"><span class='Ref_to_Parameter'>forValidator</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN687"><span class='Ref_to_Const'>ANYARRAYOID</span></a><span class='Parentheses'>) 
</span>                        <a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN466"><span class='Ref_to_Const'>INT4ARRAYOID</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN713"><span class='Ref_to_Const'>ANYRANGEOID</span></a><span class='Parentheses'>) 
</span>                        <a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN76"><span class='Ref_to_Const'>INT4RANGEOID</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* ANYELEMENT or ANYNONARRAY */ 
</span>                        <a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* XXX what could we use for ANYENUM? */ 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN662"><span class='Ref_to_Proto'>get_fn_expr_rettype</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN264"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine actual return type "</span> 
                                    <span class='String'>"for polymorphic function \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="pl_comp.c.html#LN49"><span class='Ref_to_Global_Var'>plpgsql_error_funcname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsPolymorphicType(ret... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Normal function has a defined returntype 
             */ 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN828"><span class='Ref_to_Member'>fn_rettype</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN832"><span class='Ref_to_Member'>fn_retset</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN270"><span class='Ref_To_Local'>procStruct</span></a><span class='Operator'>-&GT;</span>proretset<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Lookup the function's return type 
             */ 
</span>            <a href="pl_comp.c.html#LN276"><span class='Ref_To_Local'>typeTup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN276"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>))</span> 
                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN277"><span class='Ref_To_Local'>typeStruct</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN276"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Disallow pseudotype result, except VOID or RECORD */ 
</span>            <span class='Comment_Multi_Line'>/* (note we already replaced polymorphic types) */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN277"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN723"><span class='Ref_to_Const'>TYPTYPE_PSEUDO</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a> <span class='Operator'>|| 
</span>                    <a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>                     <span class='Comment_Multi_Line'>/* okay */ </span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN691"><span class='Ref_to_Const'>TRIGGEROID</span></a> <span class='Operator'>|| </span><a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN693"><span class='Ref_to_Const'>EVTTRIGGEROID</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"trigger functions can only be called as triggers"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"PL/pgSQL functions cannot return type %s"</span><span class='Delimiter'>, 
</span>                                  <a href="../../../backend/utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN277"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typrelid <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>|| 
</span>                <a href="pl_comp.c.html#LN283"><span class='Ref_To_Local'>rettypeid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>                <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN831"><span class='Ref_to_Member'>fn_retistuple</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN830"><span class='Ref_to_Member'>fn_retbyval</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN277"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typbyval<span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN829"><span class='Ref_to_Member'>fn_rettyplen</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN277"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typlen<span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * install $0 reference, but only for polymorphic return 
                 * types, and not when the return is specified through an 
                 * output parameter. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN744"><span class='Ref_to_Macro'>IsPolymorphicType</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN270"><span class='Ref_To_Local'>procStruct</span></a><span class='Operator'>-&GT;</span>prorettype<span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                    <a href="pl_comp.c.html#LN286"><span class='Ref_To_Local'>num_out_args</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"$0"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                                  <a href="pl_comp.c.html#LN108"><span class='Ref_to_Proto'>build_datatype</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN276"><span class='Ref_To_Local'>typeTup</span></a><span class='Delimiter'>, 
</span>                                                                 <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                               <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                  <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN276"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN809"><span class='Ref_to_EnumConst'>PLPGSQL_DML_TRIGGER</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Trigger procedure's return type is unknown yet */ 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN828"><span class='Ref_to_Member'>fn_rettype</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN830"><span class='Ref_to_Member'>fn_retbyval</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN831"><span class='Ref_to_Member'>fn_retistuple</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN832"><span class='Ref_to_Member'>fn_retset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* shouldn't be any declared arguments */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN270"><span class='Ref_To_Local'>procStruct</span></a><span class='Operator'>-&GT;</span>pronargs <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"trigger functions cannot have declared arguments"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"The arguments of the trigger can be accessed through TG_NARGS and TG_ARGV instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the record for referencing NEW ROW */ 
</span>            <a href="pl_comp.c.html#LN279"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1074"><span class='Ref_to_Proto'>plpgsql_build_record</span></a><span class='Parentheses'>(</span><span class='String'>"new"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN839"><span class='Ref_to_Member'>new_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN279"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN302"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the record for referencing OLD ROW */ 
</span>            <a href="pl_comp.c.html#LN279"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1074"><span class='Ref_to_Proto'>plpgsql_build_record</span></a><span class='Parentheses'>(</span><span class='String'>"old"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN840"><span class='Ref_to_Member'>old_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN279"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN302"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the variable tg_name */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_name"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN20"><span class='Ref_to_Const'>NAMEOID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                                <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN841"><span class='Ref_to_Member'>tg_name_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the variable tg_when */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_when"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                               <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN842"><span class='Ref_to_Member'>tg_when_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the variable tg_level */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_level"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                               <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN843"><span class='Ref_to_Member'>tg_level_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the variable tg_op */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_op"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                               <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN844"><span class='Ref_to_Member'>tg_op_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the variable tg_relid */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_relid"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                                <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN845"><span class='Ref_to_Member'>tg_relid_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the variable tg_relname */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_relname"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN20"><span class='Ref_to_Const'>NAMEOID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                                <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN846"><span class='Ref_to_Member'>tg_relname_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* tg_table_name is now preferred to tg_relname */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_table_name"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN20"><span class='Ref_to_Const'>NAMEOID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                                <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN847"><span class='Ref_to_Member'>tg_table_name_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* add the variable tg_table_schema */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_table_schema"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN20"><span class='Ref_to_Const'>NAMEOID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                                <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN848"><span class='Ref_to_Member'>tg_table_schema_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the variable tg_nargs */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_nargs"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                                <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN849"><span class='Ref_to_Member'>tg_nargs_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the variable tg_argv */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_argv"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN469"><span class='Ref_to_Const'>TEXTARRAYOID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                               <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN850"><span class='Ref_to_Member'>tg_argv_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN810"><span class='Ref_to_EnumConst'>PLPGSQL_EVENT_TRIGGER</span></a><span class='Operator'>: 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN828"><span class='Ref_to_Member'>fn_rettype</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN830"><span class='Ref_to_Member'>fn_retbyval</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN831"><span class='Ref_to_Member'>fn_retistuple</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN832"><span class='Ref_to_Member'>fn_retset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* shouldn't be any declared arguments */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN270"><span class='Ref_To_Local'>procStruct</span></a><span class='Operator'>-&GT;</span>pronargs <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"event trigger functions cannot have declared arguments"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the variable tg_event */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_event"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                               <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN853"><span class='Ref_to_Member'>tg_event_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the variable tg_tag */ 
</span>            <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"tg_tag"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                         <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, 
</span>                                                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                               <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN854"><span class='Ref_to_Member'>tg_tag_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized function typecode: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN823"><span class='Ref_to_Member'>fn_is_trigger</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch function-&GT;fn_is_trigg... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Remember if function is STABLE/IMMUTABLE */ 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN833"><span class='Ref_to_Member'>fn_readonly</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN270"><span class='Ref_To_Local'>procStruct</span></a><span class='Operator'>-&GT;</span>provolatile <span class='Operator'>!= </span><a href="../../../include/catalog/pg_proc.h.html#LN5484"><span class='Ref_to_Const'>PROVOLATILE_VOLATILE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the magic FOUND variable. 
     */ 
</span>    <a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"found"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                 <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, 
</span>                                                        <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                        <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN838"><span class='Ref_to_Member'>found_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN278"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now parse the function's text 
     */ 
</span>    <a href="pl_comp.c.html#LN282"><span class='Ref_To_Local'>parse_rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1153"><span class='Ref_to_Proto'>plpgsql_yyparse</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN282"><span class='Ref_To_Local'>parse_rc</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"plpgsql parser returned %d"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN282"><span class='Ref_To_Local'>parse_rc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN42"><span class='Ref_to_Global_Var'>plpgsql_parse_result</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_scanner.c.html#LN727"><span class='Ref_to_Func'>plpgsql_scanner_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN275"><span class='Ref_To_Local'>proc_source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it has OUT parameters or returns VOID or returns a set, we allow 
     * control to fall off the end without an explicit RETURN statement. The 
     * easiest way to implement this is to add a RETURN statement to the end 
     * of the statement list during parsing. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN286"><span class='Ref_To_Local'>num_out_args</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN828"><span class='Ref_to_Member'>fn_rettype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a> <span class='Operator'>|| 
</span>        <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN832"><span class='Ref_to_Member'>fn_retset</span></a><span class='Parentheses'>) 
</span>        <a href="pl_comp.c.html#LN99"><span class='Ref_to_Proto'>add_dummy_return</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Complete the function's info 
     */ 
</span>    <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN835"><span class='Ref_to_Member'>fn_nargs</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN270"><span class='Ref_To_Local'>procStruct</span></a><span class='Operator'>-&GT;</span>pronargs<span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN835"><span class='Ref_to_Member'>fn_nargs</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN836"><span class='Ref_to_Member'>fn_argvarnos</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_comp.c.html#LN290"><span class='Ref_To_Local'>in_arg_varnos</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN280"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
    <a href="pl_comp.c.html#LN110"><span class='Ref_to_Proto'>plpgsql_finish_datums</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Debug dump for completed functions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN50"><span class='Ref_to_Global_Var'>plpgsql_DumpExecTree</span></a><span class='Parentheses'>) 
</span>        <a href="plpgsql.h.html#LN1129"><span class='Ref_to_Proto'>plpgsql_dumptree</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * add it to the hash table 
     */ 
</span>    <a href="pl_comp.c.html#LN120"><span class='Ref_to_Proto'>plpgsql_HashTableInsert</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN267"><span class='Ref_to_Parameter'>hashkey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pop the error context stack 
     */ 
</span>    <a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN281"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN49"><span class='Ref_to_Global_Var'>plpgsql_error_funcname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN51"><span class='Ref_to_Global_Var'>plpgsql_check_syntax</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN56"><span class='Ref_to_Global_Var'>plpgsql_compile_tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN56"><span class='Ref_to_Global_Var'>plpgsql_compile_tmp_cxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pl_comp.c.html#LN266"><span class='Ref_to_Parameter'>function</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end do_compile &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_compile_inline   Make an execution tree for an anonymous code block. 
 * 
 * Note: this is generally parallel to do_compile(); is it worth trying to 
 * merge the two? 
 * 
 * Note: we assume the block will be thrown away so there is no need to build 
 * persistent data structures. 
 * ---------- 
 */ 
</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>* 
</span><a name="LN793"></a><span class='Declare_Function'>plpgsql_compile_inline</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>proc_source</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN795"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>func_name</span> <span class='Operator'>= </span><span class='String'>"inline_code_block"</span><span class='Delimiter'>; 
</span><a name="LN796"></a>    <a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Local'>function</span><span class='Delimiter'>; 
</span><a name="LN797"></a>    ErrorContextCallback <span class='Declare_Local'>plerrcontext</span><span class='Delimiter'>; 
</span><a name="LN798"></a>    <a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN799"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>parse_rc</span><span class='Delimiter'>; 
</span><a name="LN800"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>func_cxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup the scanner input and error info.  We assume that this function 
     * cannot be invoked recursively, so there's no need to save and restore 
     * the static variables used here. 
     */ 
</span>    <a href="pl_scanner.c.html#LN700"><span class='Ref_to_Func'>plpgsql_scanner_init</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN793"><span class='Ref_to_Parameter'>proc_source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN49"><span class='Ref_to_Global_Var'>plpgsql_error_funcname</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN795"><span class='Ref_To_Local'>func_name</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup error traceback support for ereport() 
     */ 
</span>    <a href="pl_comp.c.html#LN797"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="pl_comp.c.html#LN97"><span class='Ref_to_Proto'>plpgsql_compile_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN797"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><a href="pl_comp.c.html#LN793"><span class='Ref_to_Parameter'>proc_source</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN797"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="pl_comp.c.html#LN797"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Do extra syntax checking if check_function_bodies is on */ 
</span>    <a href="pl_comp.c.html#LN51"><span class='Ref_to_Global_Var'>plpgsql_check_syntax</span></a> <span class='Operator'>= </span><a href="../../../backend/utils/misc/guc.c.html#LN446"><span class='Ref_to_Global_Var'>check_function_bodies</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Function struct does not live past current statement */ 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN53"><span class='Ref_to_Global_Var'>plpgsql_curr_compile</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * All the rest of the compile-time storage (e.g. parse tree) is kept in 
     * its own memory context, so it can be reclaimed easily. 
     */ 
</span>    <a href="pl_comp.c.html#LN800"><span class='Ref_To_Local'>func_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../../../backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                     <span class='String'>"PL/pgSQL inline code context"</span><span class='Delimiter'>, 
</span>                                     <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN56"><span class='Ref_to_Global_Var'>plpgsql_compile_tmp_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN800"><span class='Ref_To_Local'>func_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN819"><span class='Ref_to_Member'>fn_signature</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN795"><span class='Ref_To_Local'>func_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN823"><span class='Ref_to_Member'>fn_is_trigger</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN811"><span class='Ref_to_EnumConst'>PLPGSQL_NOT_TRIGGER</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN826"><span class='Ref_to_Member'>fn_cxt</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN800"><span class='Ref_To_Local'>func_cxt</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN837"><span class='Ref_to_Member'>out_param_varno</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* set up for no OUT param */ 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN856"><span class='Ref_to_Member'>resolve_option</span></a> <span class='Operator'>= </span><a href="pl_handler.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_variable_conflict</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN858"><span class='Ref_to_Member'>print_strict_params</span></a> <span class='Operator'>= </span><a href="pl_handler.c.html#LN47"><span class='Ref_to_Global_Var'>plpgsql_print_strict_params</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * don't do extra validation for inline code as we don't want to add spam 
     * at runtime 
     */ 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN861"><span class='Ref_to_Member'>extra_warnings</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN862"><span class='Ref_to_Member'>extra_errors</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pl_funcs.c.html#LN43"><span class='Ref_to_Func'>plpgsql_ns_init</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="pl_funcs.c.html#LN54"><span class='Ref_to_Func'>plpgsql_ns_push</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN795"><span class='Ref_To_Local'>func_name</span></a><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN50"><span class='Ref_to_EnumConst'>PLPGSQL_LABEL_BLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN50"><span class='Ref_to_Global_Var'>plpgsql_DumpExecTree</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN109"><span class='Ref_to_Proto'>plpgsql_start_datums</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up as though in a function returning VOID */ 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN828"><span class='Ref_to_Member'>fn_rettype</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN832"><span class='Ref_to_Member'>fn_retset</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN831"><span class='Ref_to_Member'>fn_retistuple</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* a bit of hardwired knowledge about type VOID here */ 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN830"><span class='Ref_to_Member'>fn_retbyval</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN829"><span class='Ref_to_Member'>fn_rettyplen</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Remember if function is STABLE/IMMUTABLE.  XXX would it be better to 
     * set this TRUE inside a read-only transaction?  Not clear. 
     */ 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN833"><span class='Ref_to_Member'>fn_readonly</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the magic FOUND variable. 
     */ 
</span>    <a href="pl_comp.c.html#LN798"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><span class='String'>"found"</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                 <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, 
</span>                                                        <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                        <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN838"><span class='Ref_to_Member'>found_varno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN798"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now parse the function's text 
     */ 
</span>    <a href="pl_comp.c.html#LN799"><span class='Ref_To_Local'>parse_rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1153"><span class='Ref_to_Proto'>plpgsql_yyparse</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN799"><span class='Ref_To_Local'>parse_rc</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"plpgsql parser returned %d"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN799"><span class='Ref_To_Local'>parse_rc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN42"><span class='Ref_to_Global_Var'>plpgsql_parse_result</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_scanner.c.html#LN727"><span class='Ref_to_Func'>plpgsql_scanner_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it returns VOID (always true at the moment), we allow control to 
     * fall off the end without an explicit RETURN statement. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN828"><span class='Ref_to_Member'>fn_rettype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a><span class='Parentheses'>) 
</span>        <a href="pl_comp.c.html#LN99"><span class='Ref_to_Proto'>add_dummy_return</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Complete the function's info 
     */ 
</span>    <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN835"><span class='Ref_to_Member'>fn_nargs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN110"><span class='Ref_to_Proto'>plpgsql_finish_datums</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pop the error context stack 
     */ 
</span>    <a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN797"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN49"><span class='Ref_to_Global_Var'>plpgsql_error_funcname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN51"><span class='Ref_to_Global_Var'>plpgsql_check_syntax</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN56"><span class='Ref_to_Global_Var'>plpgsql_compile_tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN56"><span class='Ref_to_Global_Var'>plpgsql_compile_tmp_cxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pl_comp.c.html#LN796"><span class='Ref_To_Local'>function</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_compile_inline &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * error context callback to let us supply a call-stack traceback. 
 * If we are validating or executing an anonymous code block, the function 
 * source text is passed as an argument. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN924"></a><span class='Declare_Function'>plpgsql_compile_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN924"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Try to convert syntax error position to reference text of original 
         * CREATE FUNCTION or DO command. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/catalog/pg_proc_fn.h.html#LN46"><span class='Ref_to_Proto'>function_parse_error_transpose</span></a><span class='Parentheses'>((</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN924"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Done if a syntax error position was reported; otherwise we have to 
         * fall back to a "near line N" report. 
         */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN49"><span class='Ref_to_Global_Var'>plpgsql_error_funcname</span></a><span class='Parentheses'>) 
</span>        errcontext<span class='Parentheses'>(</span><span class='String'>"compilation of PL/pgSQL function \"%s\" near line %d"</span><span class='Delimiter'>, 
</span>                   <a href="pl_comp.c.html#LN49"><span class='Ref_to_Global_Var'>plpgsql_error_funcname</span></a><span class='Delimiter'>, </span><a href="pl_scanner.c.html#LN686"><span class='Ref_to_Func'>plpgsql_latest_lineno</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_compile_error_callback &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Add a name for a function parameter to the function's namespace 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN951"></a><span class='Declare_Function'>add_parameter_name</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN37"><span class='Ref_to_Enum'>PLpgSQL_nsitem_type</span></a> <span class='Declare_Parameter'>itemtype</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>itemno</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Before adding the name, check for duplicates.  We need this even though 
     * functioncmds.c has a similar check, because that code explicitly 
     * doesn't complain about conflicting IN and OUT parameter names.  In 
     * plpgsql, such names are in the same namespace, so there is no way to 
     * disambiguate. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_funcs.c.html#LN130"><span class='Ref_to_Func'>plpgsql_ns_lookup</span></a><span class='Parentheses'>(</span><a href="pl_funcs.c.html#LN81"><span class='Ref_to_Func'>plpgsql_ns_top</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                          <a href="pl_comp.c.html#LN951"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                          <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"parameter name \"%s\" used more than once"</span><span class='Delimiter'>, 
</span>                        <a href="pl_comp.c.html#LN951"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* OK, add the name */ 
</span>    <a href="pl_funcs.c.html#LN92"><span class='Ref_to_Func'>plpgsql_ns_additem</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN951"><span class='Ref_to_Parameter'>itemtype</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN951"><span class='Ref_to_Parameter'>itemno</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN951"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end add_parameter_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add a dummy RETURN statement to the given function's body 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN976"></a><span class='Declare_Function'>add_dummy_return</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>function</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * If the outer block has an EXCEPTION clause, we need to make a new outer 
     * block, since the added RETURN shouldn't act like it is inside the 
     * EXCEPTION clause. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN976"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN411"><span class='Ref_to_Member'>exceptions</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN985"></a>        <a href="plpgsql.h.html#LN403"><span class='Ref_to_Struct'>PLpgSQL_stmt_block</span></a> <span class='Operator'>*</span><span class='Declare_Local'>new</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>new</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN403"><span class='Ref_to_Struct'>PLpgSQL_stmt_block</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN405"><span class='Ref_to_Member'>cmd_type</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN84"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_BLOCK</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN408"><span class='Ref_to_Member'>body</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN976"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pl_comp.c.html#LN976"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>= </span><span class='Control'>new</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN976"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN408"><span class='Ref_to_Member'>body</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>|| 
</span>        <span class='Parentheses'>((</span><a href="plpgsql.h.html#LN364"><span class='Ref_to_Struct'>PLpgSQL_stmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN130"><span class='Ref_to_Macro'>llast</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN976"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN408"><span class='Ref_to_Member'>body</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>cmd_type <span class='Operator'>!= </span><a href="plpgsql.h.html#LN95"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_RETURN</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN996"></a>        <a href="plpgsql.h.html#LN675"><span class='Ref_to_Struct'>PLpgSQL_stmt_return</span></a> <span class='Operator'>*</span><span class='Declare_Local'>new</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>new</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN675"><span class='Ref_to_Struct'>PLpgSQL_stmt_return</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN677"><span class='Ref_to_Member'>cmd_type</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN95"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_RETURN</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN679"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN680"><span class='Ref_to_Member'>retvarno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN976"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN837"><span class='Ref_to_Member'>out_param_varno</span></a><span class='Delimiter'>; 
</span> 
        <a href="pl_comp.c.html#LN976"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN408"><span class='Ref_to_Member'>body</span></a> <span class='Operator'>= </span><a href="../../../backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN976"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN408"><span class='Ref_to_Member'>body</span></a><span class='Delimiter'>, </span><span class='Control'>new</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end add_dummy_return &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_parser_setup     set up parser hooks for dynamic parameters 
 * 
 * Note: this routine, and the hook functions it prepares for, are logically 
 * part of plpgsql parsing.  But they actually run during function execution, 
 * when we are ready to evaluate a SQL query or expression that has not 
 * previously been parsed and planned. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1017"></a><span class='Declare_Function'>plpgsql_parser_setup</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pl_comp.c.html#LN1017"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/parser/parse_node.h.html#LN205"><span class='Ref_to_Member'>p_pre_columnref_hook</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN100"><span class='Ref_to_Proto'>plpgsql_pre_column_ref</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1017"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/parser/parse_node.h.html#LN206"><span class='Ref_to_Member'>p_post_columnref_hook</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN101"><span class='Ref_to_Proto'>plpgsql_post_column_ref</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1017"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/parser/parse_node.h.html#LN207"><span class='Ref_to_Member'>p_paramref_hook</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN102"><span class='Ref_to_Proto'>plpgsql_param_ref</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* no need to use p_coerce_param_hook */ 
</span>    <a href="pl_comp.c.html#LN1017"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/parser/parse_node.h.html#LN209"><span class='Ref_to_Member'>p_ref_hook_state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1017"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_pre_column_ref       parser callback before parsing a ColumnRef 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1030"></a><span class='Declare_Function'>plpgsql_pre_column_ref</span><span class='Parentheses'>(</span><a href="../../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cref</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1032"></a>    <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1030"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/parser/parse_node.h.html#LN209"><span class='Ref_to_Member'>p_ref_hook_state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1032"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN228"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN856"><span class='Ref_to_Member'>resolve_option</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN163"><span class='Ref_to_EnumConst'>PLPGSQL_RESOLVE_VARIABLE</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pl_comp.c.html#LN103"><span class='Ref_to_Proto'>resolve_column_ref</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1030"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1032"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1030"><span class='Ref_to_Parameter'>cref</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_post_column_ref      parser callback after parsing a ColumnRef 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1044"></a><span class='Declare_Function'>plpgsql_post_column_ref</span><span class='Parentheses'>(</span><a href="../../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cref</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1046"></a>    <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1044"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/parser/parse_node.h.html#LN209"><span class='Ref_to_Member'>p_ref_hook_state</span></a><span class='Delimiter'>; 
</span><a name="LN1047"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>myvar</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1046"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN228"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN856"><span class='Ref_to_Member'>resolve_option</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN163"><span class='Ref_to_EnumConst'>PLPGSQL_RESOLVE_VARIABLE</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* we already found there's no match */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1046"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN228"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN856"><span class='Ref_to_Member'>resolve_option</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN164"><span class='Ref_to_EnumConst'>PLPGSQL_RESOLVE_COLUMN</span></a> <span class='Operator'>&& </span><a href="pl_comp.c.html#LN1044"><span class='Ref_to_Parameter'>var</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* there's a table column, prefer that */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we find a record/row variable but can't match a field name, throw 
     * error if there was no core resolution for the ColumnRef either.  In 
     * that situation, the reference is inevitably going to fail, and 
     * complaining about the record/row variable is likely to be more on-point 
     * than the core parser's error message.  (It's too bad we don't have 
     * access to transformColumnRef's internal crerr state here, as in case of 
     * a conflict with a table name this could still be less than the most 
     * helpful error message possible.) 
     */ 
</span>    <a href="pl_comp.c.html#LN1047"><span class='Ref_To_Local'>myvar</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN103"><span class='Ref_to_Proto'>resolve_column_ref</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1044"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1046"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1044"><span class='Ref_to_Parameter'>cref</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1044"><span class='Ref_to_Parameter'>var</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1047"><span class='Ref_To_Local'>myvar</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="pl_comp.c.html#LN1044"><span class='Ref_to_Parameter'>var</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We could leave it to the core parser to throw this error, but we 
         * can add a more useful detail message than the core could. 
         */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_AMBIGUOUS_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column reference \"%s\" is ambiguous"</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1044"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"It could refer to either a PL/pgSQL variable or a table column."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1044"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1044"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pl_comp.c.html#LN1047"><span class='Ref_To_Local'>myvar</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_post_column_ref &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_param_ref        parser callback for ParamRefs ($n symbols) 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1088"></a><span class='Declare_Function'>plpgsql_param_ref</span><span class='Parentheses'>(</span><a href="../../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN241"><span class='Ref_to_Struct'>ParamRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pref</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1090"></a>    <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1088"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/parser/parse_node.h.html#LN209"><span class='Ref_to_Member'>p_ref_hook_state</span></a><span class='Delimiter'>; 
</span><a name="LN1091"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>pname</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>]; 
</span><a name="LN1092"></a>    <a href="plpgsql.h.html#LN348"><span class='Ref_to_Struct'>PLpgSQL_nsitem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nse</span><span class='Delimiter'>; 
</span> 
    <a href="../../plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1091"><span class='Ref_To_Local'>pname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1091"><span class='Ref_To_Local'>pname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"$%d"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1088"><span class='Ref_to_Parameter'>pref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN244"><span class='Ref_to_Member'>number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN1092"><span class='Ref_To_Local'>nse</span></a> <span class='Operator'>= </span><a href="pl_funcs.c.html#LN130"><span class='Ref_to_Func'>plpgsql_ns_lookup</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1090"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN231"><span class='Ref_to_Member'>ns</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                            <a href="pl_comp.c.html#LN1091"><span class='Ref_To_Local'>pname</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1092"><span class='Ref_To_Local'>nse</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* name not known to plpgsql */ 
</span> 
    <span class='Control'>return</span> <a href="pl_comp.c.html#LN105"><span class='Ref_to_Proto'>make_datum_param</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1090"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1092"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1088"><span class='Ref_to_Parameter'>pref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN245"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * resolve_column_ref       attempt to resolve a ColumnRef as a plpgsql var 
 * 
 * Returns the translated node structure, or NULL if name not found 
 * 
 * error_if_no_field tells whether to throw error or quietly return NULL if 
 * we are able to match a record/row name but don't find a field name match. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1115"></a><span class='Declare_Function'>resolve_column_ref</span><span class='Parentheses'>(</span><a href="../../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN1116"></a>                   <a href="../../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cref</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>error_if_no_field</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1118"></a>    <a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN1119"></a>    <a href="plpgsql.h.html#LN348"><span class='Ref_to_Struct'>PLpgSQL_nsitem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nse</span><span class='Delimiter'>; 
</span><a name="LN1120"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>name1</span><span class='Delimiter'>; 
</span><a name="LN1121"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>name2</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1122"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>name3</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1123"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>colname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1124"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nnames</span><span class='Delimiter'>; 
</span><a name="LN1125"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nnames_scalar</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1126"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nnames_wholerow</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1127"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nnames_field</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We use the function's current estate to resolve parameter data types. 
     * This is really pretty bogus because there is no provision for updating 
     * plans when those types change ... 
     */ 
</span>    <a href="pl_comp.c.html#LN1118"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1115"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN228"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN873"><span class='Ref_to_Member'>cur_estate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * The allowed syntaxes are: 
     * 
     * A        Scalar variable reference, or whole-row record reference. 
     * A.B      Qualified scalar or whole-row reference, or field reference. 
     * A.B.C    Qualified record field reference. 
     * A.*      Whole-row record reference. 
     * A.B.*    Qualified whole-row record reference. 
     *---------- 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1150"></a>                <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>field1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1150"><span class='Ref_To_Local'>field1</span></a><span class='Delimiter'>, </span>String<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1120"><span class='Ref_To_Local'>name1</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1150"><span class='Ref_To_Local'>field1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1125"><span class='Ref_To_Local'>nnames_scalar</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1126"><span class='Ref_To_Local'>nnames_wholerow</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1160"></a>                <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>field1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1161"></a>                <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>field2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1160"><span class='Ref_To_Local'>field1</span></a><span class='Delimiter'>, </span>String<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1120"><span class='Ref_To_Local'>name1</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1160"><span class='Ref_To_Local'>field1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Whole-row reference? */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1161"><span class='Ref_To_Local'>field2</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN367"><span class='Ref_to_Struct'>A_Star</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Set name2 to prevent matches to scalar variables */ 
</span>                    <a href="pl_comp.c.html#LN1121"><span class='Ref_To_Local'>name2</span></a> <span class='Operator'>= </span><span class='String'>"*"</span><span class='Delimiter'>; 
</span>                    <a href="pl_comp.c.html#LN1126"><span class='Ref_To_Local'>nnames_wholerow</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1161"><span class='Ref_To_Local'>field2</span></a><span class='Delimiter'>, </span>String<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1121"><span class='Ref_To_Local'>name2</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1161"><span class='Ref_To_Local'>field2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1123"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1121"><span class='Ref_To_Local'>name2</span></a><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1125"><span class='Ref_To_Local'>nnames_scalar</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1126"><span class='Ref_To_Local'>nnames_wholerow</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1127"><span class='Ref_To_Local'>nnames_field</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1185"></a>                <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>field1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1186"></a>                <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>field2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1187"></a>                <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>field3</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN120"><span class='Ref_to_Macro'>lthird</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1185"><span class='Ref_To_Local'>field1</span></a><span class='Delimiter'>, </span>String<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1120"><span class='Ref_To_Local'>name1</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1185"><span class='Ref_To_Local'>field1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1186"><span class='Ref_To_Local'>field2</span></a><span class='Delimiter'>, </span>String<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1121"><span class='Ref_To_Local'>name2</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1186"><span class='Ref_To_Local'>field2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Whole-row reference? */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1187"><span class='Ref_To_Local'>field3</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN367"><span class='Ref_to_Struct'>A_Star</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Set name3 to prevent matches to scalar variables */ 
</span>                    <a href="pl_comp.c.html#LN1122"><span class='Ref_To_Local'>name3</span></a> <span class='Operator'>= </span><span class='String'>"*"</span><span class='Delimiter'>; 
</span>                    <a href="pl_comp.c.html#LN1126"><span class='Ref_To_Local'>nnames_wholerow</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1187"><span class='Ref_To_Local'>field3</span></a><span class='Delimiter'>, </span>String<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1122"><span class='Ref_To_Local'>name3</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1187"><span class='Ref_To_Local'>field3</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1123"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1122"><span class='Ref_To_Local'>name3</span></a><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1127"><span class='Ref_To_Local'>nnames_field</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* too many names, ignore */ 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch list_length(cref-&GT;fie... &raquo; </span> 
 
    <a href="pl_comp.c.html#LN1119"><span class='Ref_To_Local'>nse</span></a> <span class='Operator'>= </span><a href="pl_funcs.c.html#LN130"><span class='Ref_to_Func'>plpgsql_ns_lookup</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1115"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN231"><span class='Ref_to_Member'>ns</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                            <a href="pl_comp.c.html#LN1120"><span class='Ref_To_Local'>name1</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1121"><span class='Ref_To_Local'>name2</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1122"><span class='Ref_To_Local'>name3</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="pl_comp.c.html#LN1124"><span class='Ref_To_Local'>nnames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1119"><span class='Ref_To_Local'>nse</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* name not known to plpgsql */ 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1119"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN350"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN40"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_VAR</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1124"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>== </span><a href="pl_comp.c.html#LN1125"><span class='Ref_To_Local'>nnames_scalar</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="pl_comp.c.html#LN105"><span class='Ref_to_Proto'>make_datum_param</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1115"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1119"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN42"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_REC</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1124"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>== </span><a href="pl_comp.c.html#LN1126"><span class='Ref_To_Local'>nnames_wholerow</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="pl_comp.c.html#LN105"><span class='Ref_to_Proto'>make_datum_param</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1115"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1119"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1124"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>== </span><a href="pl_comp.c.html#LN1127"><span class='Ref_To_Local'>nnames_field</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* colname could be a field in this record */ 
</span><a name="LN1233"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* search for a datum referencing this field */ 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1233"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN1233"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN1118"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN1233"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1238"></a>                    <a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fld</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1118"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1233"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1238"><span class='Ref_To_Local'>fld</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN317"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN63"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_RECFIELD</span></a> <span class='Operator'>&& 
</span>                        <a href="pl_comp.c.html#LN1238"><span class='Ref_To_Local'>fld</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN320"><span class='Ref_to_Member'>recparentno</span></a> <span class='Operator'>== </span><a href="pl_comp.c.html#LN1119"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a> <span class='Operator'>&& 
</span>                        strcmp<span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1238"><span class='Ref_To_Local'>fld</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN319"><span class='Ref_to_Member'>fieldname</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1123"><span class='Ref_To_Local'>colname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>return</span> <a href="pl_comp.c.html#LN105"><span class='Ref_to_Proto'>make_datum_param</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1115"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1233"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We should not get here, because a RECFIELD datum should 
                 * have been built at parse time for every possible qualified 
                 * reference to fields of this record.  But if we do, handle 
                 * it like field-not-found: throw error or return NULL. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>error_if_no_field</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" has no field \"%s\""</span><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1127"><span class='Ref_To_Local'>nnames_field</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="pl_comp.c.html#LN1120"><span class='Ref_To_Local'>name1</span></a> <span class='Operator'>: </span><a href="pl_comp.c.html#LN1121"><span class='Ref_To_Local'>name2</span></a><span class='Delimiter'>, 
</span>                                    <a href="pl_comp.c.html#LN1123"><span class='Ref_To_Local'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1115"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nnames==nnames_field &raquo; </span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN41"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_ROW</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1124"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>== </span><a href="pl_comp.c.html#LN1126"><span class='Ref_To_Local'>nnames_wholerow</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="pl_comp.c.html#LN105"><span class='Ref_to_Proto'>make_datum_param</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1115"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1119"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1124"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>== </span><a href="pl_comp.c.html#LN1127"><span class='Ref_To_Local'>nnames_field</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* colname could be a field in this row */ 
</span><a name="LN1269"></a>                <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1118"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1119"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>]; 
</span><a name="LN1270"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1270"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN1270"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN1269"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN291"><span class='Ref_to_Member'>nfields</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN1270"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1269"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN292"><span class='Ref_to_Member'>fieldnames</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1270"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>                        strcmp<span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1269"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN292"><span class='Ref_to_Member'>fieldnames</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1270"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="pl_comp.c.html#LN1123"><span class='Ref_To_Local'>colname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>return</span> <a href="pl_comp.c.html#LN105"><span class='Ref_to_Proto'>make_datum_param</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1115"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1269"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1270"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                <a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* Not found, so throw error or return NULL */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>error_if_no_field</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" has no field \"%s\""</span><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1127"><span class='Ref_To_Local'>nnames_field</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="pl_comp.c.html#LN1120"><span class='Ref_To_Local'>name1</span></a> <span class='Operator'>: </span><a href="pl_comp.c.html#LN1121"><span class='Ref_To_Local'>name2</span></a><span class='Delimiter'>, 
</span>                                    <a href="pl_comp.c.html#LN1123"><span class='Ref_To_Local'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1115"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1116"><span class='Ref_to_Parameter'>cref</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nnames==nnames_field &raquo; </span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized plpgsql itemtype: %d"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1119"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN350"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch nse-&GT;itemtype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Name format doesn't match the plpgsql variable type */ 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end resolve_column_ref &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Helper for columnref parsing: build a Param referencing a plpgsql datum, 
 * and make sure that that datum is listed in the expression's paramnos. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN1304"></a><span class='Declare_Function'>make_datum_param</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dno</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1306"></a>    <a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN1307"></a>    <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN1308"></a>    <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>param</span><span class='Delimiter'>; 
</span><a name="LN1309"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* see comment in resolve_column_ref */ 
</span>    <a href="pl_comp.c.html#LN1306"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1304"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN228"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN873"><span class='Ref_to_Member'>cur_estate</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1304"><span class='Ref_to_Parameter'>dno</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pl_comp.c.html#LN1304"><span class='Ref_to_Parameter'>dno</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN1306"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1307"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1306"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1304"><span class='Ref_to_Parameter'>dno</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Bitmapset must be allocated in function's permanent memory context 
     */ 
</span>    <a href="pl_comp.c.html#LN1309"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1304"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN228"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN826"><span class='Ref_to_Member'>fn_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1304"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN224"><span class='Ref_to_Member'>paramnos</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1304"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN224"><span class='Ref_to_Member'>paramnos</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1304"><span class='Ref_to_Parameter'>dno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1309"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN1308"><span class='Ref_To_Local'>param</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1308"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN234"><span class='Ref_to_EnumConst'>PARAM_EXTERN</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1308"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1304"><span class='Ref_to_Parameter'>dno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="plpgsql.h.html#LN1103"><span class='Ref_to_Proto'>plpgsql_exec_get_datum_type_info</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1306"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_comp.c.html#LN1307"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="pl_comp.c.html#LN1308"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN245"><span class='Ref_to_Member'>paramtype</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="pl_comp.c.html#LN1308"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN246"><span class='Ref_to_Member'>paramtypmod</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="pl_comp.c.html#LN1308"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN247"><span class='Ref_to_Member'>paramcollid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1308"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN248"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1304"><span class='Ref_to_Parameter'>location</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1308"><span class='Ref_To_Local'>param</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_datum_param &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_parse_word       The scanner calls this to postparse 
 *              any single word that is not a reserved keyword. 
 * 
 * word1 is the downcased/dequoted identifier; it must be palloc'd in the 
 * function's long-term memory context. 
 * 
 * yytxt is the original token text; we need this to check for quoting, 
 * so that later checks for unreserved keywords work properly. 
 * 
 * If recognized as a variable, fill in *wdatum and return TRUE; 
 * if not recognized, fill in *word and return FALSE. 
 * (Note: those two pointers actually point to members of the same union, 
 * but for notational reasons we pass them separately.) 
 * ---------- 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1354"></a><span class='Declare_Function'>plpgsql_parse_word</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>word1</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>yytxt</span><span class='Delimiter'>, 
</span><a name="LN1355"></a>                   <a href="plpgsql.h.html#LN997"><span class='Ref_to_Struct'>PLwdatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>wdatum</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN986"><span class='Ref_to_Struct'>PLword</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>word</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1357"></a>    <a href="plpgsql.h.html#LN348"><span class='Ref_to_Struct'>PLpgSQL_nsitem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ns</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We should do nothing in DECLARE sections.  In SQL expressions, there's 
     * no need to do anything either --- lookup will happen when the 
     * expression is compiled. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_scanner.c.html#LN28"><span class='Ref_to_Global_Var'>plpgsql_IdentifierLookup</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN1011"><span class='Ref_to_EnumConst'>IDENTIFIER_LOOKUP_NORMAL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Do a lookup in the current namespace stack 
         */ 
</span>        <a href="pl_comp.c.html#LN1357"><span class='Ref_To_Local'>ns</span></a> <span class='Operator'>= </span><a href="pl_funcs.c.html#LN130"><span class='Ref_to_Func'>plpgsql_ns_lookup</span></a><span class='Parentheses'>(</span><a href="pl_funcs.c.html#LN81"><span class='Ref_to_Func'>plpgsql_ns_top</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                               <a href="pl_comp.c.html#LN1354"><span class='Ref_to_Parameter'>word1</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                               <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1357"><span class='Ref_To_Local'>ns</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1357"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN350"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="plpgsql.h.html#LN40"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_VAR</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="plpgsql.h.html#LN41"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_ROW</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="plpgsql.h.html#LN42"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_REC</span></a><span class='Operator'>: 
</span>                    <a href="pl_comp.c.html#LN1355"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN999"><span class='Ref_to_Member'>datum</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1357"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>]; 
</span>                    <a href="pl_comp.c.html#LN1355"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1000"><span class='Ref_to_Member'>ident</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1354"><span class='Ref_to_Parameter'>word1</span></a><span class='Delimiter'>; 
</span>                    <a href="pl_comp.c.html#LN1355"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1001"><span class='Ref_to_Member'>quoted</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1354"><span class='Ref_to_Parameter'>yytxt</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pl_comp.c.html#LN1355"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1002"><span class='Ref_to_Member'>idents</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* plpgsql_ns_lookup should never return anything else */ 
</span>                    <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized plpgsql itemtype: %d"</span><span class='Delimiter'>, 
</span>                         <a href="pl_comp.c.html#LN1357"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN350"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if plpgsql_IdentifierLoo... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Nothing found - up to now it's a word without any special meaning for 
     * us. 
     */ 
</span>    <a href="pl_comp.c.html#LN1355"><span class='Ref_to_Parameter'>word</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN988"><span class='Ref_to_Member'>ident</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1354"><span class='Ref_to_Parameter'>word1</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1355"><span class='Ref_to_Parameter'>word</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN989"><span class='Ref_to_Member'>quoted</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1354"><span class='Ref_to_Parameter'>yytxt</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_parse_word &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_parse_dblword        Same lookup for two words 
 *                  separated by a dot. 
 * ---------- 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1410"></a><span class='Declare_Function'>plpgsql_parse_dblword</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>word1</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>word2</span><span class='Delimiter'>, 
</span><a name="LN1411"></a>                      <a href="plpgsql.h.html#LN997"><span class='Ref_to_Struct'>PLwdatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>wdatum</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN992"><span class='Ref_to_Struct'>PLcword</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cword</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1413"></a>    <a href="plpgsql.h.html#LN348"><span class='Ref_to_Struct'>PLpgSQL_nsitem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ns</span><span class='Delimiter'>; 
</span><a name="LN1414"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>idents</span><span class='Delimiter'>; 
</span><a name="LN1415"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nnames</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN1414"><span class='Ref_To_Local'>idents</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="../../../backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1410"><span class='Ref_to_Parameter'>word1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../../backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1410"><span class='Ref_to_Parameter'>word2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We should do nothing in DECLARE sections.  In SQL expressions, we 
     * really only need to make sure that RECFIELD datums are created when 
     * needed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_scanner.c.html#LN28"><span class='Ref_to_Global_Var'>plpgsql_IdentifierLookup</span></a> <span class='Operator'>!= </span><a href="plpgsql.h.html#LN1012"><span class='Ref_to_EnumConst'>IDENTIFIER_LOOKUP_DECLARE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Do a lookup in the current namespace stack 
         */ 
</span>        <a href="pl_comp.c.html#LN1413"><span class='Ref_To_Local'>ns</span></a> <span class='Operator'>= </span><a href="pl_funcs.c.html#LN130"><span class='Ref_to_Func'>plpgsql_ns_lookup</span></a><span class='Parentheses'>(</span><a href="pl_funcs.c.html#LN81"><span class='Ref_to_Func'>plpgsql_ns_top</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                               <a href="pl_comp.c.html#LN1410"><span class='Ref_to_Parameter'>word1</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1410"><span class='Ref_to_Parameter'>word2</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="pl_comp.c.html#LN1415"><span class='Ref_To_Local'>nnames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1413"><span class='Ref_To_Local'>ns</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1413"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN350"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="plpgsql.h.html#LN40"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_VAR</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* Block-qualified reference to scalar variable. */ 
</span>                    <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN999"><span class='Ref_to_Member'>datum</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1413"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>]; 
</span>                    <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1000"><span class='Ref_to_Member'>ident</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1001"><span class='Ref_to_Member'>quoted</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* not used */ 
</span>                    <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1002"><span class='Ref_to_Member'>idents</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1414"><span class='Ref_To_Local'>idents</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="plpgsql.h.html#LN42"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_REC</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1415"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * First word is a record name, so second word could 
                         * be a field in this record.  We build a RECFIELD 
                         * datum whether it is or not --- any error will be 
                         * detected later. 
                         */ 
</span><a name="LN1454"></a>                        <a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Declare_Local'>new</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>new</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN317"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN63"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_RECFIELD</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN319"><span class='Ref_to_Member'>fieldname</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1410"><span class='Ref_to_Parameter'>word2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN320"><span class='Ref_to_Member'>recparentno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1413"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>; 
</span> 
                        <a href="plpgsql.h.html#LN1079"><span class='Ref_to_Proto'>plpgsql_adddatum</span></a><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Control'>new</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN999"><span class='Ref_to_Member'>datum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Control'>new</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Block-qualified reference to record variable. */ 
</span>                        <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN999"><span class='Ref_to_Member'>datum</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1413"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>]; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1000"><span class='Ref_to_Member'>ident</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1001"><span class='Ref_to_Member'>quoted</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* not used */ 
</span>                    <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1002"><span class='Ref_to_Member'>idents</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1414"><span class='Ref_To_Local'>idents</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="plpgsql.h.html#LN41"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_ROW</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1415"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * First word is a row name, so second word could be a 
                         * field in this row.  Again, no error now if it 
                         * isn't. 
                         */ 
</span><a name="LN1483"></a>                        <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span><span class='Delimiter'>; 
</span><a name="LN1484"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                        <a href="pl_comp.c.html#LN1483"><span class='Ref_To_Local'>row</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1413"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1484"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN1484"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN1483"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN291"><span class='Ref_to_Member'>nfields</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN1484"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1483"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN292"><span class='Ref_to_Member'>fieldnames</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1484"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>                                strcmp<span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1483"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN292"><span class='Ref_to_Member'>fieldnames</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1484"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="pl_comp.c.html#LN1410"><span class='Ref_to_Parameter'>word2</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <span class='Delimiter'>{ 
</span>                                <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN999"><span class='Ref_to_Member'>datum</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1483"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1484"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]]; 
</span>                                <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1000"><span class='Ref_to_Member'>ident</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                                <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1001"><span class='Ref_to_Member'>quoted</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* not used */ 
</span>                                <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1002"><span class='Ref_to_Member'>idents</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1414"><span class='Ref_To_Local'>idents</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Comment_Multi_Line'>/* fall through to return CWORD */ 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nnames==1 &raquo; </span> 
                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Block-qualified reference to row variable. */ 
</span>                        <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN999"><span class='Ref_to_Member'>datum</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1413"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>]; 
</span>                        <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1000"><span class='Ref_to_Member'>ident</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                        <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1001"><span class='Ref_to_Member'>quoted</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* not used */ 
</span>                        <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1002"><span class='Ref_to_Member'>idents</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1414"><span class='Ref_To_Local'>idents</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ns-&GT;itemtype &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ns!=NULL &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if plpgsql_IdentifierLoo... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Nothing found */ 
</span>    <a href="pl_comp.c.html#LN1411"><span class='Ref_to_Parameter'>cword</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN994"><span class='Ref_to_Member'>idents</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1414"><span class='Ref_To_Local'>idents</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_parse_dblword &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_parse_tripword       Same lookup for three words 
 *                  separated by dots. 
 * ---------- 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1530"></a><span class='Declare_Function'>plpgsql_parse_tripword</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>word1</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>word2</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>word3</span><span class='Delimiter'>, 
</span><a name="LN1531"></a>                       <a href="plpgsql.h.html#LN997"><span class='Ref_to_Struct'>PLwdatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>wdatum</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN992"><span class='Ref_to_Struct'>PLcword</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cword</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1533"></a>    <a href="plpgsql.h.html#LN348"><span class='Ref_to_Struct'>PLpgSQL_nsitem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ns</span><span class='Delimiter'>; 
</span><a name="LN1534"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>idents</span><span class='Delimiter'>; 
</span><a name="LN1535"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nnames</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN1534"><span class='Ref_To_Local'>idents</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN140"><span class='Ref_to_Macro'>list_make3</span></a><span class='Parentheses'>(</span><a href="../../../backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1530"><span class='Ref_to_Parameter'>word1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../../backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1530"><span class='Ref_to_Parameter'>word2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../../backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1530"><span class='Ref_to_Parameter'>word3</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We should do nothing in DECLARE sections.  In SQL expressions, we 
     * really only need to make sure that RECFIELD datums are created when 
     * needed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_scanner.c.html#LN28"><span class='Ref_to_Global_Var'>plpgsql_IdentifierLookup</span></a> <span class='Operator'>!= </span><a href="plpgsql.h.html#LN1012"><span class='Ref_to_EnumConst'>IDENTIFIER_LOOKUP_DECLARE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Do a lookup in the current namespace stack. Must find a qualified 
         * reference, else ignore. 
         */ 
</span>        <a href="pl_comp.c.html#LN1533"><span class='Ref_To_Local'>ns</span></a> <span class='Operator'>= </span><a href="pl_funcs.c.html#LN130"><span class='Ref_to_Func'>plpgsql_ns_lookup</span></a><span class='Parentheses'>(</span><a href="pl_funcs.c.html#LN81"><span class='Ref_to_Func'>plpgsql_ns_top</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                               <a href="pl_comp.c.html#LN1530"><span class='Ref_to_Parameter'>word1</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1530"><span class='Ref_to_Parameter'>word2</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1530"><span class='Ref_to_Parameter'>word3</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="pl_comp.c.html#LN1535"><span class='Ref_To_Local'>nnames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1533"><span class='Ref_To_Local'>ns</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="pl_comp.c.html#LN1535"><span class='Ref_To_Local'>nnames</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1533"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN350"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="plpgsql.h.html#LN42"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_REC</span></a><span class='Operator'>: 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * words 1/2 are a record name, so third word could be 
                         * a field in this record. 
                         */ 
</span><a name="LN1565"></a>                        <a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Declare_Local'>new</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>new</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN317"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN63"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_RECFIELD</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN319"><span class='Ref_to_Member'>fieldname</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1530"><span class='Ref_to_Parameter'>word3</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN320"><span class='Ref_to_Member'>recparentno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1533"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>; 
</span> 
                        <a href="plpgsql.h.html#LN1079"><span class='Ref_to_Proto'>plpgsql_adddatum</span></a><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Control'>new</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <a href="pl_comp.c.html#LN1531"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN999"><span class='Ref_to_Member'>datum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Control'>new</span><span class='Delimiter'>; 
</span>                        <a href="pl_comp.c.html#LN1531"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1000"><span class='Ref_to_Member'>ident</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                        <a href="pl_comp.c.html#LN1531"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1001"><span class='Ref_to_Member'>quoted</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* not used */ 
</span>                        <a href="pl_comp.c.html#LN1531"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1002"><span class='Ref_to_Member'>idents</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1534"><span class='Ref_To_Local'>idents</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                <span class='Control'>case</span> <a href="plpgsql.h.html#LN41"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_ROW</span></a><span class='Operator'>: 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * words 1/2 are a row name, so third word could be a 
                         * field in this row. 
                         */ 
</span><a name="LN1587"></a>                        <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span><span class='Delimiter'>; 
</span><a name="LN1588"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                        <a href="pl_comp.c.html#LN1587"><span class='Ref_To_Local'>row</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1533"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1588"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN1588"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN1587"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN291"><span class='Ref_to_Member'>nfields</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN1588"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1587"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN292"><span class='Ref_to_Member'>fieldnames</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1588"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>                                strcmp<span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1587"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN292"><span class='Ref_to_Member'>fieldnames</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1588"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="pl_comp.c.html#LN1530"><span class='Ref_to_Parameter'>word3</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <span class='Delimiter'>{ 
</span>                                <a href="pl_comp.c.html#LN1531"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN999"><span class='Ref_to_Member'>datum</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1587"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1588"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]]; 
</span>                                <a href="pl_comp.c.html#LN1531"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1000"><span class='Ref_to_Member'>ident</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                                <a href="pl_comp.c.html#LN1531"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1001"><span class='Ref_to_Member'>quoted</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* not used */ 
</span>                                <a href="pl_comp.c.html#LN1531"><span class='Ref_to_Parameter'>wdatum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN1002"><span class='Ref_to_Member'>idents</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1534"><span class='Ref_To_Local'>idents</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Comment_Multi_Line'>/* fall through to return CWORD */ 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ns-&GT;itemtype &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ns!=NULL&&nnames==2 &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if plpgsql_IdentifierLoo... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Nothing found */ 
</span>    <a href="pl_comp.c.html#LN1531"><span class='Ref_to_Parameter'>cword</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN994"><span class='Ref_to_Member'>idents</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1534"><span class='Ref_To_Local'>idents</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_parse_tripword &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_parse_wordtype   The scanner found word%TYPE. word can be 
 *              a variable name or a basetype. 
 * 
 * Returns datatype struct, or NULL if no match found for word. 
 * ---------- 
 */ 
</span><a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>* 
</span><a name="LN1627"></a><span class='Declare_Function'>plpgsql_parse_wordtype</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ident</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1629"></a>    <a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dtype</span><span class='Delimiter'>; 
</span><a name="LN1630"></a>    <a href="plpgsql.h.html#LN348"><span class='Ref_to_Struct'>PLpgSQL_nsitem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nse</span><span class='Delimiter'>; 
</span><a name="LN1631"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>typeTup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do a lookup in the current namespace stack 
     */ 
</span>    <a href="pl_comp.c.html#LN1630"><span class='Ref_To_Local'>nse</span></a> <span class='Operator'>= </span><a href="pl_funcs.c.html#LN130"><span class='Ref_to_Func'>plpgsql_ns_lookup</span></a><span class='Parentheses'>(</span><a href="pl_funcs.c.html#LN81"><span class='Ref_to_Func'>plpgsql_ns_top</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                            <a href="pl_comp.c.html#LN1627"><span class='Ref_to_Parameter'>ident</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1630"><span class='Ref_To_Local'>nse</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1630"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN350"><span class='Ref_to_Member'>itemtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN40"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_VAR</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <span class='Parentheses'>((</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1630"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>datatype<span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* XXX perhaps allow REC/ROW here? */ 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Word wasn't found in the namespace stack. Try to find a data type with 
     * that name, but ignore shell types and complex types. 
     */ 
</span>    <a href="pl_comp.c.html#LN1631"><span class='Ref_To_Local'>typeTup</span></a> <span class='Operator'>= </span><a href="../../../include/parser/parse_type.h.html#LN21"><span class='Ref_to_Proto'>LookupTypeName</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../../include/nodes/makefuncs.h.html#LN70"><span class='Ref_to_Proto'>makeTypeName</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1627"><span class='Ref_to_Parameter'>ident</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1631"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1661"></a>        <a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typeStruct</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1631"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_comp.c.html#LN1661"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typisdefined <span class='Operator'>|| 
</span>            <a href="pl_comp.c.html#LN1661"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typrelid <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1631"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pl_comp.c.html#LN1629"><span class='Ref_To_Local'>dtype</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN108"><span class='Ref_to_Proto'>build_datatype</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1631"><span class='Ref_To_Local'>typeTup</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                               <a href="pl_comp.c.html#LN53"><span class='Ref_to_Global_Var'>plpgsql_curr_compile</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1631"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="pl_comp.c.html#LN1629"><span class='Ref_To_Local'>dtype</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Nothing found - up to now it's a word without any special meaning for 
     * us. 
     */ 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_parse_wordtype &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_parse_cwordtype      Same lookup for compositeword%TYPE 
 * ---------- 
 */ 
</span><a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>* 
</span><a name="LN1690"></a><span class='Declare_Function'>plpgsql_parse_cwordtype</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>idents</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1692"></a>    <a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dtype</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1693"></a>    <a href="plpgsql.h.html#LN348"><span class='Ref_to_Struct'>PLpgSQL_nsitem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nse</span><span class='Delimiter'>; 
</span><a name="LN1694"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>fldname</span><span class='Delimiter'>; 
</span><a name="LN1695"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>classOid</span><span class='Delimiter'>; 
</span><a name="LN1696"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>classtup</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1697"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>attrtup</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1698"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>typetup</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1699"></a>    <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>classStruct</span><span class='Delimiter'>; 
</span><a name="LN1700"></a>    <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attrStruct</span><span class='Delimiter'>; 
</span><a name="LN1701"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldCxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Avoid memory leaks in the long-term function context */ 
</span>    <a href="pl_comp.c.html#LN1701"><span class='Ref_To_Local'>oldCxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN56"><span class='Ref_to_Global_Var'>plpgsql_compile_tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1690"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Do a lookup in the current namespace stack. We don't need to check 
         * number of names matched, because we will only consider scalar 
         * variables. 
         */ 
</span>        <a href="pl_comp.c.html#LN1693"><span class='Ref_To_Local'>nse</span></a> <span class='Operator'>= </span><a href="pl_funcs.c.html#LN130"><span class='Ref_to_Func'>plpgsql_ns_lookup</span></a><span class='Parentheses'>(</span><a href="pl_funcs.c.html#LN81"><span class='Ref_to_Func'>plpgsql_ns_top</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1690"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1690"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1693"><span class='Ref_To_Local'>nse</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="pl_comp.c.html#LN1693"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN350"><span class='Ref_to_Member'>itemtype</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN40"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_VAR</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pl_comp.c.html#LN1692"><span class='Ref_To_Local'>dtype</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1693"><span class='Ref_To_Local'>nse</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN356"><span class='Ref_to_Member'>itemno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>datatype<span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pl_comp.c.html#LN1789"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * First word could also be a table name 
         */ 
</span>        <a href="pl_comp.c.html#LN1695"><span class='Ref_To_Local'>classOid</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/namespace.h.html#LN64"><span class='Ref_to_Proto'>RelnameGetRelid</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1690"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1695"><span class='Ref_To_Local'>classOid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pl_comp.c.html#LN1789"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>        <a href="pl_comp.c.html#LN1694"><span class='Ref_To_Local'>fldname</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1690"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if list_length(idents)==... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1690"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1735"></a>        <a href="../../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>relvar</span><span class='Delimiter'>; 
</span> 
        <a href="pl_comp.c.html#LN1735"><span class='Ref_To_Local'>relvar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN68"><span class='Ref_to_Proto'>makeRangeVar</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1690"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                              <a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1690"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                              <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Can't lock relation - we might not have privileges. */ 
</span>        <a href="pl_comp.c.html#LN1695"><span class='Ref_To_Local'>classOid</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/namespace.h.html#LN52"><span class='Ref_to_Macro'>RangeVarGetRelid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1735"><span class='Ref_To_Local'>relvar</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1695"><span class='Ref_To_Local'>classOid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pl_comp.c.html#LN1789"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>        <a href="pl_comp.c.html#LN1694"><span class='Ref_To_Local'>fldname</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN120"><span class='Ref_to_Macro'>lthird</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1690"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pl_comp.c.html#LN1789"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN1696"><span class='Ref_To_Local'>classtup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1695"><span class='Ref_To_Local'>classOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1696"><span class='Ref_To_Local'>classtup</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pl_comp.c.html#LN1789"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1699"><span class='Ref_To_Local'>classStruct</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1696"><span class='Ref_To_Local'>classtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It must be a relation, sequence, view, materialized view, composite 
     * type, or foreign table 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1699"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>        <a href="pl_comp.c.html#LN1699"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a> <span class='Operator'>&& 
</span>        <a href="pl_comp.c.html#LN1699"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a> <span class='Operator'>&& 
</span>        <a href="pl_comp.c.html#LN1699"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>&& 
</span>        <a href="pl_comp.c.html#LN1699"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a> <span class='Operator'>&& 
</span>        <a href="pl_comp.c.html#LN1699"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pl_comp.c.html#LN1789"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fetch the named table field and its type 
     */ 
</span>    <a href="pl_comp.c.html#LN1697"><span class='Ref_To_Local'>attrtup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN129"><span class='Ref_to_Proto'>SearchSysCacheAttName</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1695"><span class='Ref_To_Local'>classOid</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1694"><span class='Ref_To_Local'>fldname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1697"><span class='Ref_To_Local'>attrtup</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pl_comp.c.html#LN1789"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1700"><span class='Ref_To_Local'>attrStruct</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1697"><span class='Ref_To_Local'>attrtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN1698"><span class='Ref_To_Local'>typetup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, 
</span>                              <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1700"><span class='Ref_To_Local'>attrStruct</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1698"><span class='Ref_To_Local'>typetup</span></a><span class='Parentheses'>))</span> 
        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1700"><span class='Ref_To_Local'>attrStruct</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Found that - build a compiler type struct in the caller's cxt and 
     * return it 
     */ 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1701"><span class='Ref_To_Local'>oldCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1692"><span class='Ref_To_Local'>dtype</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN108"><span class='Ref_to_Proto'>build_datatype</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1698"><span class='Ref_To_Local'>typetup</span></a><span class='Delimiter'>, 
</span>                           <a href="pl_comp.c.html#LN1700"><span class='Ref_To_Local'>attrStruct</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>, 
</span>                           <a href="pl_comp.c.html#LN1700"><span class='Ref_To_Local'>attrStruct</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN56"><span class='Ref_to_Global_Var'>plpgsql_compile_tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN1789"></a><span class='Label'>done</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1696"><span class='Ref_To_Local'>classtup</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1696"><span class='Ref_To_Local'>classtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1697"><span class='Ref_To_Local'>attrtup</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1697"><span class='Ref_To_Local'>attrtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1698"><span class='Ref_To_Local'>typetup</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1698"><span class='Ref_To_Local'>typetup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1701"><span class='Ref_To_Local'>oldCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pl_comp.c.html#LN1692"><span class='Ref_To_Local'>dtype</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_parse_cwordtype &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_parse_wordrowtype        Scanner found word%ROWTYPE. 
 *                  So word must be a table name. 
 * ---------- 
 */ 
</span><a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>* 
</span><a name="LN1807"></a><span class='Declare_Function'>plpgsql_parse_wordrowtype</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ident</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1809"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>classOid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Lookup the relation */ 
</span>    <a href="pl_comp.c.html#LN1809"><span class='Ref_To_Local'>classOid</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/namespace.h.html#LN64"><span class='Ref_to_Proto'>RelnameGetRelid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1807"><span class='Ref_to_Parameter'>ident</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1809"><span class='Ref_To_Local'>classOid</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../../bin/scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1807"><span class='Ref_to_Parameter'>ident</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build and return the row type struct */ 
</span>    <span class='Control'>return</span> <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN126"><span class='Ref_to_Proto'>get_rel_type_id</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1809"><span class='Ref_To_Local'>classOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_parse_cwordrowtype       Scanner found compositeword%ROWTYPE. 
 *          So word must be a namespace qualified table name. 
 * ---------- 
 */ 
</span><a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>* 
</span><a name="LN1828"></a><span class='Declare_Function'>plpgsql_parse_cwordrowtype</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>idents</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1830"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>classOid</span><span class='Delimiter'>; 
</span><a name="LN1831"></a>    <a href="../../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>relvar</span><span class='Delimiter'>; 
</span><a name="LN1832"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldCxt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1828"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Avoid memory leaks in long-term function context */ 
</span>    <a href="pl_comp.c.html#LN1832"><span class='Ref_To_Local'>oldCxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN56"><span class='Ref_to_Global_Var'>plpgsql_compile_tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up relation name.  Can't lock it - we might not have privileges. */ 
</span>    <a href="pl_comp.c.html#LN1831"><span class='Ref_To_Local'>relvar</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/makefuncs.h.html#LN68"><span class='Ref_to_Proto'>makeRangeVar</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1828"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                          <a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1828"><span class='Ref_to_Parameter'>idents</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                          <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1830"><span class='Ref_To_Local'>classOid</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/namespace.h.html#LN52"><span class='Ref_to_Macro'>RangeVarGetRelid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1831"><span class='Ref_To_Local'>relvar</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1832"><span class='Ref_To_Local'>oldCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build and return the row type struct */ 
</span>    <span class='Control'>return</span> <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN126"><span class='Ref_to_Proto'>get_rel_type_id</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1830"><span class='Ref_To_Local'>classOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_parse_cwordrowtype &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_build_variable - build a datum-array entry of a given 
 * datatype 
 * 
 * The returned struct may be a PLpgSQL_var, PLpgSQL_row, or 
 * PLpgSQL_rec depending on the given datatype, and is allocated via 
 * palloc.  The struct is automatically added to the current datum 
 * array, and optionally to the current namespace. 
 */ 
</span><a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>* 
</span><a name="LN1862"></a><span class='Declare_Function'>plpgsql_build_variable</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>refname</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lineno</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dtype</span><span class='Delimiter'>, 
</span><a name="LN1863"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>add2namespace</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1865"></a>    <a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>dtype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN179"><span class='Ref_to_Member'>ttype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN73"><span class='Ref_to_EnumConst'>PLPGSQL_TTYPE_SCALAR</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Ordinary scalar datatype */ 
</span><a name="LN1872"></a>                <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
                <a href="pl_comp.c.html#LN1872"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1872"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN255"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1872"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN257"><span class='Ref_to_Member'>refname</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1872"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN258"><span class='Ref_to_Member'>lineno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>lineno</span></a><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1872"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>dtype</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* other fields might be filled by caller */ 
</span> 
                <span class='Comment_Multi_Line'>/* preset to NULL */ 
</span>                <a href="pl_comp.c.html#LN1872"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1872"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1872"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN270"><span class='Ref_to_Member'>freeval</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <a href="plpgsql.h.html#LN1079"><span class='Ref_to_Proto'>plpgsql_adddatum</span></a><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1872"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1863"><span class='Ref_to_Parameter'>add2namespace</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_funcs.c.html#LN92"><span class='Ref_to_Func'>plpgsql_ns_additem</span></a><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN40"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_VAR</span></a><span class='Delimiter'>, 
</span>                                       <a href="pl_comp.c.html#LN1872"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN256"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>, 
</span>                                       <a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1865"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1872"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN74"><span class='Ref_to_EnumConst'>PLPGSQL_TTYPE_ROW</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Composite type -- build a row variable */ 
</span><a name="LN1897"></a>                <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span><span class='Delimiter'>; 
</span> 
                <a href="pl_comp.c.html#LN1897"><span class='Ref_To_Local'>row</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN106"><span class='Ref_to_Proto'>build_row_from_class</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>dtype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN183"><span class='Ref_to_Member'>typrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pl_comp.c.html#LN1897"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN278"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1897"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN280"><span class='Ref_to_Member'>refname</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1897"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN281"><span class='Ref_to_Member'>lineno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>lineno</span></a><span class='Delimiter'>; 
</span> 
                <a href="plpgsql.h.html#LN1079"><span class='Ref_to_Proto'>plpgsql_adddatum</span></a><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1897"><span class='Ref_To_Local'>row</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1863"><span class='Ref_to_Parameter'>add2namespace</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_funcs.c.html#LN92"><span class='Ref_to_Func'>plpgsql_ns_additem</span></a><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN41"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_ROW</span></a><span class='Delimiter'>, 
</span>                                       <a href="pl_comp.c.html#LN1897"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN279"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>, 
</span>                                       <a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1865"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1897"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN75"><span class='Ref_to_EnumConst'>PLPGSQL_TTYPE_REC</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* "record" type -- build a record variable */ 
</span><a name="LN1916"></a>                <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span><span class='Delimiter'>; 
</span> 
                <a href="pl_comp.c.html#LN1916"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1074"><span class='Ref_to_Proto'>plpgsql_build_record</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>refname</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>lineno</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1863"><span class='Ref_to_Parameter'>add2namespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN1865"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1916"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN76"><span class='Ref_to_EnumConst'>PLPGSQL_TTYPE_PSEUDO</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"variable \"%s\" has pseudo-type %s"</span><span class='Delimiter'>, 
</span>                            <a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>refname</span></a><span class='Delimiter'>, </span><a href="../../../backend/utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>dtype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN1865"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized ttype: %d"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1862"><span class='Ref_to_Parameter'>dtype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN179"><span class='Ref_to_Member'>ttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN1865"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch dtype-&GT;ttype &raquo; </span> 
 
    <span class='Control'>return</span> <a href="pl_comp.c.html#LN1865"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_build_variable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Build empty named record variable, and optionally add it to namespace 
 */ 
</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>* 
</span><a name="LN1942"></a><span class='Declare_Function'>plpgsql_build_record</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>refname</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lineno</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>add2namespace</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1944"></a>    <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN301"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1942"><span class='Ref_to_Parameter'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN304"><span class='Ref_to_Member'>lineno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1942"><span class='Ref_to_Parameter'>lineno</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN308"><span class='Ref_to_Member'>freetup</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN309"><span class='Ref_to_Member'>freetupdesc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="plpgsql.h.html#LN1079"><span class='Ref_to_Proto'>plpgsql_adddatum</span></a><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1942"><span class='Ref_to_Parameter'>add2namespace</span></a><span class='Parentheses'>) 
</span>        <a href="pl_funcs.c.html#LN92"><span class='Ref_to_Func'>plpgsql_ns_additem</span></a><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN42"><span class='Ref_to_EnumConst'>PLPGSQL_NSTYPE_REC</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN302"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_comp.c.html#LN1944"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Build a row-variable data structure given the pg_class OID. 
 */ 
</span><span class='Keyword'>static </span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>* 
</span><a name="LN1965"></a><span class='Declare_Function'>build_row_from_class</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1967"></a>    <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span><span class='Delimiter'>; 
</span><a name="LN1968"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1969"></a>    <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>classStruct</span><span class='Delimiter'>; 
</span><a name="LN1970"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>relname</span><span class='Delimiter'>; 
</span><a name="LN1971"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open the relation to get info. 
     */ 
</span>    <a href="pl_comp.c.html#LN1968"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1965"><span class='Ref_to_Parameter'>classOid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1969"><span class='Ref_To_Local'>classStruct</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN410"><span class='Ref_to_Macro'>RelationGetForm</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1968"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1970"><span class='Ref_To_Local'>relname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1968"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Accept relation, sequence, view, materialized view, composite type, or 
     * foreign table. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1969"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>        <a href="pl_comp.c.html#LN1969"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a> <span class='Operator'>&& 
</span>        <a href="pl_comp.c.html#LN1969"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a> <span class='Operator'>&& 
</span>        <a href="pl_comp.c.html#LN1969"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>&& 
</span>        <a href="pl_comp.c.html#LN1969"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a> <span class='Operator'>&& 
</span>        <a href="pl_comp.c.html#LN1969"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" is not a table"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1970"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a row datum entry and all the required variables that it will 
     * point to. 
     */ 
</span>    <a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN278"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1968"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN291"><span class='Ref_to_Member'>nfields</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1969"><span class='Ref_To_Local'>classStruct</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN292"><span class='Ref_to_Member'>fieldnames</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN291"><span class='Ref_to_Member'>nfields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN291"><span class='Ref_to_Member'>nfields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1971"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN1971"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN291"><span class='Ref_to_Member'>nfields</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN1971"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2007"></a>        <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attrStruct</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get the attribute and check for dropped column 
         */ 
</span>        <a href="pl_comp.c.html#LN2007"><span class='Ref_To_Local'>attrStruct</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1971"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_comp.c.html#LN2007"><span class='Ref_To_Local'>attrStruct</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2016"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attname</span><span class='Delimiter'>; 
</span><a name="LN2017"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>refname</span><span class='Delimiter'>[</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>100</span><span class='Delimiter'>]; 
</span><a name="LN2018"></a>            <a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
            <a href="pl_comp.c.html#LN2016"><span class='Ref_To_Local'>attname</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2007"><span class='Ref_To_Local'>attrStruct</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2017"><span class='Ref_To_Local'>refname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2017"><span class='Ref_To_Local'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s.%s"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN1970"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2016"><span class='Ref_To_Local'>attname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Create the internal variable for the field 
             * 
             * We know if the table definitions contain a default value or if 
             * the field is declared in the table as NOT NULL. But it's 
             * possible to create a table field as NOT NULL without a default 
             * value and that would lead to problems later when initializing 
             * the variables due to entering a block at execution time. Thus 
             * we ignore this information for now. 
             */ 
</span>            <a href="pl_comp.c.html#LN2018"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1071"><span class='Ref_to_Proto'>plpgsql_build_variable</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2017"><span class='Ref_To_Local'>refname</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                 <a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2007"><span class='Ref_To_Local'>attrStruct</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                                        <a href="pl_comp.c.html#LN2007"><span class='Ref_To_Local'>attrStruct</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>, 
</span>                                                   <a href="pl_comp.c.html#LN2007"><span class='Ref_To_Local'>attrStruct</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add the variable to the row */ 
</span>            <a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN292"><span class='Ref_to_Member'>fieldnames</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1971"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_comp.c.html#LN2016"><span class='Ref_To_Local'>attname</span></a><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1971"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_comp.c.html#LN2018"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !attrStruct-&GT;attisdro... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Leave a hole in the row structure for the dropped col */ 
</span>            <a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN292"><span class='Ref_to_Member'>fieldnames</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1971"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN1971"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;row-&GT;nfields;i+... &raquo; </span> 
 
    <a href="../../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN1968"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_comp.c.html#LN1967"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_row_from_class &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Build a row-variable data structure given the component variables. 
 */ 
</span><span class='Keyword'>static </span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>* 
</span><a name="LN2060"></a><span class='Declare_Function'>build_row_from_vars</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>vars</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>numvars</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2062"></a>    <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span><span class='Delimiter'>; 
</span><a name="LN2063"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN2062"><span class='Ref_To_Local'>row</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2062"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN278"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2062"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a> <span class='Operator'>= </span><a href="../../../backend/access/common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2060"><span class='Ref_to_Parameter'>numvars</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2062"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN291"><span class='Ref_to_Member'>nfields</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2060"><span class='Ref_to_Parameter'>numvars</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2062"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN292"><span class='Ref_to_Member'>fieldnames</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2060"><span class='Ref_to_Parameter'>numvars</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2062"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2060"><span class='Ref_to_Parameter'>numvars</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2063"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2063"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN2060"><span class='Ref_to_Parameter'>numvars</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2063"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2074"></a>        <a href="plpgsql.h.html#LN207"><span class='Ref_to_Struct'>PLpgSQL_variable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2060"><span class='Ref_to_Parameter'>vars</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2063"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN2075"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typoid</span> <span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Delimiter'>; 
</span><a name="LN2076"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN2077"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typcoll</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2074"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN209"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>                <a href="pl_comp.c.html#LN2075"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN2074"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>datatype<span class='Operator'>-&GT;</span>typoid<span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN2076"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN2074"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>datatype<span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>; 
</span>                <a href="pl_comp.c.html#LN2077"><span class='Ref_To_Local'>typcoll</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN2074"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>datatype<span class='Operator'>-&GT;</span>collation<span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN2074"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rowtupdesc<span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pl_comp.c.html#LN2075"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN2074"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rowtupdesc<span class='Operator'>-&GT;</span>tdtypeid<span class='Delimiter'>; 
</span>                    <a href="pl_comp.c.html#LN2076"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN2074"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rowtupdesc<span class='Operator'>-&GT;</span>tdtypmod<span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* composite types have no collation */ 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized dtype: %d"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2074"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN209"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch var-&GT;dtype &raquo; </span> 
 
        <a href="pl_comp.c.html#LN2062"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN292"><span class='Ref_to_Member'>fieldnames</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2063"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_comp.c.html#LN2074"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN211"><span class='Ref_to_Member'>refname</span></a><span class='Delimiter'>; 
</span>        <a href="pl_comp.c.html#LN2062"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2063"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_comp.c.html#LN2074"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN210"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2062"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2063"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                           <a href="pl_comp.c.html#LN2074"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN211"><span class='Ref_to_Member'>refname</span></a><span class='Delimiter'>, 
</span>                           <a href="pl_comp.c.html#LN2075"><span class='Ref_To_Local'>typoid</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2076"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>, 
</span>                           <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN128"><span class='Ref_to_Proto'>TupleDescInitEntryCollation</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2062"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2063"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2077"><span class='Ref_To_Local'>typcoll</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;numvars;i++ &raquo; </span> 
 
    <span class='Control'>return</span> <a href="pl_comp.c.html#LN2062"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_row_from_vars &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_build_datatype 
 *      Build PLpgSQL_type struct given type OID, typmod, and collation. 
 * 
 * If collation is not InvalidOid then it overrides the type's default 
 * collation.  But collation is ignored if the datatype is non-collatable. 
 */ 
</span><a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>* 
</span><a name="LN2124"></a><span class='Declare_Function'>plpgsql_build_datatype</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2126"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>typeTup</span><span class='Delimiter'>; 
</span><a name="LN2127"></a>    <a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typ</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN2126"><span class='Ref_To_Local'>typeTup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2124"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2126"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>))</span> 
        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2124"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN2127"><span class='Ref_To_Local'>typ</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN108"><span class='Ref_to_Proto'>build_datatype</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2126"><span class='Ref_To_Local'>typeTup</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2124"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2124"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2126"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_comp.c.html#LN2127"><span class='Ref_To_Local'>typ</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Utility subroutine to make a PLpgSQL_type struct given a pg_type entry 
 */ 
</span><span class='Keyword'>static </span><a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>* 
</span><a name="LN2144"></a><span class='Declare_Function'>build_datatype</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>typeTup</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2146"></a>    <a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typeStruct</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2144"><span class='Ref_to_Parameter'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2147"></a>    <a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typ</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typisdefined<span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" is only a shell"</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN175"><span class='Ref_to_Struct'>PLpgSQL_type</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN177"><span class='Ref_to_Member'>typname</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2144"><span class='Ref_to_Parameter'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typtype<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN719"><span class='Ref_to_Const'>TYPTYPE_BASE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN722"><span class='Ref_to_Const'>TYPTYPE_ENUM</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN724"><span class='Ref_to_Const'>TYPTYPE_RANGE</span></a><span class='Operator'>: 
</span>            <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN179"><span class='Ref_to_Member'>ttype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN73"><span class='Ref_to_EnumConst'>PLPGSQL_TTYPE_SCALAR</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN179"><span class='Ref_to_Member'>ttype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN74"><span class='Ref_to_EnumConst'>PLPGSQL_TTYPE_ROW</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN723"><span class='Ref_to_Const'>TYPTYPE_PSEUDO</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>                <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN179"><span class='Ref_to_Member'>ttype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN75"><span class='Ref_to_EnumConst'>PLPGSQL_TTYPE_REC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN179"><span class='Ref_to_Member'>ttype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN76"><span class='Ref_to_EnumConst'>PLPGSQL_TTYPE_PSEUDO</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized typtype: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typtype<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch typeStruct-&GT;typtype &raquo; </span> 
    <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN180"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typlen<span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN181"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typbyval<span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN182"><span class='Ref_to_Member'>typtype</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typtype<span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN183"><span class='Ref_to_Member'>typrelid</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typrelid<span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN184"><span class='Ref_to_Member'>collation</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typcollation<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2144"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN184"><span class='Ref_to_Member'>collation</span></a><span class='Parentheses'>))</span> 
        <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN184"><span class='Ref_to_Member'>collation</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2144"><span class='Ref_to_Parameter'>collation</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Detect if type is true array, or domain thereof */ 
</span>    <span class='Comment_Multi_Line'>/* NB: this is only used to decide whether to apply expand_array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN719"><span class='Ref_to_Const'>TYPTYPE_BASE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * This test should include what get_element_type() checks.  We also 
         * disallow non-toastable array types (i.e. oidvector and int2vector). 
         */ 
</span>        <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN185"><span class='Ref_to_Member'>typisarray</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typlen <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>&& 
</span>                           <a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typelem<span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                           <a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typstorage <span class='Operator'>!= </span><span class='String'>'p'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* we can short-circuit looking up base types if it's not varlena */ 
</span>        <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN185"><span class='Ref_to_Member'>typisarray</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typlen <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>&& 
</span>                           <a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typstorage <span class='Operator'>!= </span><span class='String'>'p'</span> <span class='Operator'>&& 
</span>                 <a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN160"><span class='Ref_to_Proto'>get_base_element_type</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2146"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typbasetype<span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN185"><span class='Ref_to_Member'>typisarray</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN186"><span class='Ref_to_Member'>atttypmod</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2144"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_comp.c.html#LN2147"><span class='Ref_To_Local'>typ</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_datatype &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  plpgsql_recognize_err_condition 
 *      Check condition name and translate it to SQLSTATE. 
 * 
 * Note: there are some cases where the same condition name has multiple 
 * entries in the table.  We arbitrarily return the first match. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN2223"></a><span class='Declare_Function'>plpgsql_recognize_err_condition</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>condname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>allow_sqlstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2225"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2223"><span class='Ref_to_Parameter'>allow_sqlstate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2223"><span class='Ref_to_Parameter'>condname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>5</span> <span class='Operator'>&& 
</span>            strspn<span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2223"><span class='Ref_to_Parameter'>condname</span></a><span class='Delimiter'>, </span><span class='String'>"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>5</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/elog.h.html#LN61"><span class='Ref_to_Macro'>MAKE_SQLSTATE</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2223"><span class='Ref_to_Parameter'>condname</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                 <a href="pl_comp.c.html#LN2223"><span class='Ref_to_Parameter'>condname</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                 <a href="pl_comp.c.html#LN2223"><span class='Ref_to_Parameter'>condname</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                                 <a href="pl_comp.c.html#LN2223"><span class='Ref_to_Parameter'>condname</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>], 
</span>                                 <a href="pl_comp.c.html#LN2223"><span class='Ref_to_Parameter'>condname</span></a><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2225"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN82"><span class='Ref_to_Global_Var'>exception_label_map</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2225"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pl_comp.c.html#LN78"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2225"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2223"><span class='Ref_to_Parameter'>condname</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN82"><span class='Ref_to_Global_Var'>exception_label_map</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2225"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pl_comp.c.html#LN78"><span class='Ref_to_Member'>label</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="pl_comp.c.html#LN82"><span class='Ref_to_Global_Var'>exception_label_map</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2225"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pl_comp.c.html#LN79"><span class='Ref_to_Member'>sqlerrstate</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized exception condition \"%s\""</span><span class='Delimiter'>, 
</span>                    <a href="pl_comp.c.html#LN2223"><span class='Ref_to_Parameter'>condname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end plpgsql_recognize_err_condition &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_parse_err_condition 
 *      Generate PLpgSQL_condition entry(s) for an exception condition name 
 * 
 * This has to be able to return a list because there are some duplicate 
 * names in the table of error code names. 
 */ 
</span><a href="plpgsql.h.html#LN373"><span class='Ref_to_Struct'>PLpgSQL_condition</span></a> <span class='Operator'>* 
</span><a name="LN2259"></a><span class='Declare_Function'>plpgsql_parse_err_condition</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>condname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2261"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2262"></a>    <a href="plpgsql.h.html#LN373"><span class='Ref_to_Struct'>PLpgSQL_condition</span></a> <span class='Operator'>*</span><span class='Declare_Local'>new</span><span class='Delimiter'>; 
</span><a name="LN2263"></a>    <a href="plpgsql.h.html#LN373"><span class='Ref_to_Struct'>PLpgSQL_condition</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prev</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * XXX Eventually we will want to look for user-defined exception names 
     * here. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OTHERS is represented as code 0 (which would map to '00000', but we 
     * have no need to represent that as an exception condition). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2259"><span class='Ref_to_Parameter'>condname</span></a><span class='Delimiter'>, </span><span class='String'>"others"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>new</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN373"><span class='Ref_to_Struct'>PLpgSQL_condition</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN375"><span class='Ref_to_Member'>sqlerrstate</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN376"><span class='Ref_to_Member'>condname</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2259"><span class='Ref_to_Parameter'>condname</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN377"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Control'>new</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pl_comp.c.html#LN2263"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2261"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN82"><span class='Ref_to_Global_Var'>exception_label_map</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2261"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pl_comp.c.html#LN78"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2261"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2259"><span class='Ref_to_Parameter'>condname</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN82"><span class='Ref_to_Global_Var'>exception_label_map</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2261"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pl_comp.c.html#LN78"><span class='Ref_to_Member'>label</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>new</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN373"><span class='Ref_to_Struct'>PLpgSQL_condition</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN375"><span class='Ref_to_Member'>sqlerrstate</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN82"><span class='Ref_to_Global_Var'>exception_label_map</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2261"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pl_comp.c.html#LN79"><span class='Ref_to_Member'>sqlerrstate</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN376"><span class='Ref_to_Member'>condname</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2259"><span class='Ref_to_Parameter'>condname</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN377"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2263"><span class='Ref_To_Local'>prev</span></a><span class='Delimiter'>; 
</span>            <a href="pl_comp.c.html#LN2263"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><span class='Control'>new</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_comp.c.html#LN2263"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized exception condition \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="pl_comp.c.html#LN2259"><span class='Ref_to_Parameter'>condname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_comp.c.html#LN2263"><span class='Ref_To_Local'>prev</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_parse_err_condition &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_start_datums         Initialize datum list at compile startup. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2310"></a><span class='Declare_Function'>plpgsql_start_datums</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pl_comp.c.html#LN44"><span class='Ref_to_Global_Var'>datums_alloc</span></a> <span class='Operator'>= </span><span class='Number'>128</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_nDatums</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* This is short-lived, so needn't allocate in function's cxt */ 
</span>    <a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN56"><span class='Ref_to_Global_Var'>plpgsql_compile_tmp_cxt</span></a><span class='Delimiter'>, 
</span>                                     <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pl_comp.c.html#LN44"><span class='Ref_to_Global_Var'>datums_alloc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* datums_last tracks what's been seen by plpgsql_add_initdatums() */ 
</span>    <a href="pl_comp.c.html#LN47"><span class='Ref_to_Global_Var'>datums_last</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_adddatum         Add a variable, record or row 
 *                  to the compiler's datum list. 
 * ---------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2327"></a><span class='Declare_Function'>plpgsql_adddatum</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>new</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_nDatums</span></a> <span class='Operator'>== </span><a href="pl_comp.c.html#LN44"><span class='Ref_to_Global_Var'>datums_alloc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_comp.c.html#LN44"><span class='Ref_to_Global_Var'>datums_alloc</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pl_comp.c.html#LN44"><span class='Ref_to_Global_Var'>datums_alloc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN198"><span class='Ref_to_Member'>dno</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_nDatums</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_nDatums</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Control'>new</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_finish_datums    Copy completed datum info into function struct. 
 * 
 * This is also responsible for building resettable_datums, a bitmapset 
 * of the dnos of all ROW, REC, and RECFIELD datums in the function. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2347"></a><span class='Declare_Function'>plpgsql_finish_datums</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>function</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2349"></a>    <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>resettable_datums</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2350"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN2347"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN865"><span class='Ref_to_Member'>ndatums</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_nDatums</span></a><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2347"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN866"><span class='Ref_to_Member'>datums</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pl_comp.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_nDatums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2350"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2350"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_nDatums</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2350"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_comp.c.html#LN2347"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN866"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2350"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2350"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2347"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN866"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2350"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN63"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_RECFIELD</span></a><span class='Operator'>: 
</span>                <a href="pl_comp.c.html#LN2349"><span class='Ref_To_Local'>resettable_datums</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2349"><span class='Ref_To_Local'>resettable_datums</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2350"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="pl_comp.c.html#LN2347"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN867"><span class='Ref_to_Member'>resettable_datums</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2349"><span class='Ref_To_Local'>resettable_datums</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_finish_datums &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_add_initdatums       Make an array of the datum numbers of 
 *                  all the simple VAR datums created since the last call 
 *                  to this function. 
 * 
 * If varnos is NULL, we just forget any datum entries created since the 
 * last call. 
 * 
 * This is used around a DECLARE section to create a list of the VARs 
 * that have to be initialized at block entry.  Note that VARs can also 
 * be created elsewhere than DECLARE, eg by a FOR-loop, but it is then 
 * the responsibility of special-purpose code to initialize them. 
 * ---------- 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN2388"></a><span class='Declare_Function'>plpgsql_add_initdatums</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>**</span><span class='Declare_Parameter'>varnos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2390"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2391"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2390"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN47"><span class='Ref_to_Global_Var'>datums_last</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2390"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_nDatums</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2390"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2390"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>                <a href="pl_comp.c.html#LN2391"><span class='Ref_To_Local'>n</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2388"><span class='Ref_to_Parameter'>varnos</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2391"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="pl_comp.c.html#LN2388"><span class='Ref_to_Parameter'>varnos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pl_comp.c.html#LN2391"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pl_comp.c.html#LN2391"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2390"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN47"><span class='Ref_to_Global_Var'>datums_last</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2390"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_nDatums</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2390"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2390"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>                        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_comp.c.html#LN2388"><span class='Ref_to_Parameter'>varnos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2391"><span class='Ref_To_Local'>n</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_comp.c.html#LN46"><span class='Ref_to_Global_Var'>plpgsql_Datums</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2390"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN198"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Operator'>*</span><a href="pl_comp.c.html#LN2388"><span class='Ref_to_Parameter'>varnos</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if varnos!=NULL &raquo; </span> 
 
    <a href="pl_comp.c.html#LN47"><span class='Ref_to_Global_Var'>datums_last</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN45"><span class='Ref_to_Global_Var'>plpgsql_nDatums</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pl_comp.c.html#LN2391"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_add_initdatums &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Compute the hashkey for a given function invocation 
 * 
 * The hashkey is returned into the caller-provided storage at *hashkey. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2440"></a><span class='Declare_Function'>compute_function_hashkey</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, 
</span><a name="LN2441"></a>                         <a href="../../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a> <span class='Declare_Parameter'>procStruct</span><span class='Delimiter'>, 
</span><a name="LN2442"></a>                         <a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hashkey</span><span class='Delimiter'>, 
</span><a name="LN2443"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>forValidator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Make sure any unused bytes of the struct are zero */ 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2442"><span class='Ref_to_Parameter'>hashkey</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* get function OID */ 
</span>    <a href="pl_comp.c.html#LN2442"><span class='Ref_to_Parameter'>hashkey</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN776"><span class='Ref_to_Member'>funcOid</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2440"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* get call context */ 
</span>    <a href="pl_comp.c.html#LN2442"><span class='Ref_to_Parameter'>hashkey</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN778"><span class='Ref_to_Member'>isTrigger</span></a> <span class='Operator'>= </span><a href="../../../include/commands/trigger.h.html#LN24"><span class='Ref_to_Macro'>CALLED_AS_TRIGGER</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2440"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if trigger, get its OID.  In validation mode we do not know what 
     * relation or transition table names are intended to be used, so we leave 
     * trigOid zero; the hash entry built in this case will never really be 
     * used. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2442"><span class='Ref_to_Parameter'>hashkey</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN778"><span class='Ref_to_Member'>isTrigger</span></a> <span class='Operator'>&& !</span><a href="pl_comp.c.html#LN2443"><span class='Ref_to_Parameter'>forValidator</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2462"></a>        <a href="../../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN2440"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN79"><span class='Ref_to_Member'>context</span></a><span class='Delimiter'>; 
</span> 
        <a href="pl_comp.c.html#LN2442"><span class='Ref_to_Parameter'>hashkey</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN788"><span class='Ref_to_Member'>trigOid</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2462"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN24"><span class='Ref_to_Member'>tgoid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* get input collation, if known */ 
</span>    <a href="pl_comp.c.html#LN2442"><span class='Ref_to_Parameter'>hashkey</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN795"><span class='Ref_to_Member'>inputCollation</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2440"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN81"><span class='Ref_to_Member'>fncollation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2441"><span class='Ref_to_Parameter'>procStruct</span></a><span class='Operator'>-&GT;</span>pronargs <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* get the argument types */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2442"><span class='Ref_to_Parameter'>hashkey</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN801"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2441"><span class='Ref_to_Parameter'>procStruct</span></a><span class='Operator'>-&GT;</span>proargtypes<span class='Operator'>.</span>values<span class='Delimiter'>, 
</span>               <a href="pl_comp.c.html#LN2441"><span class='Ref_to_Parameter'>procStruct</span></a><span class='Operator'>-&GT;</span>pronargs <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* resolve any polymorphic argument types */ 
</span>        <a href="pl_comp.c.html#LN115"><span class='Ref_to_Proto'>plpgsql_resolve_polymorphic_argtypes</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2441"><span class='Ref_to_Parameter'>procStruct</span></a><span class='Operator'>-&GT;</span>pronargs<span class='Delimiter'>, 
</span>                                             <a href="pl_comp.c.html#LN2442"><span class='Ref_to_Parameter'>hashkey</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN801"><span class='Ref_to_Member'>argtypes</span></a><span class='Delimiter'>, 
</span>                                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                             <a href="pl_comp.c.html#LN2440"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN65"><span class='Ref_to_Member'>fn_expr</span></a><span class='Delimiter'>, 
</span>                                             <a href="pl_comp.c.html#LN2443"><span class='Ref_to_Parameter'>forValidator</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2441"><span class='Ref_to_Parameter'>procStruct</span></a><span class='Operator'>-&GT;</span>proname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end compute_function_hashkey &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This is the same as the standard resolve_polymorphic_argtypes() function, 
 * but with a special case for validation: assume that polymorphic arguments 
 * are integer, integer-array or integer-range.  Also, we go ahead and report 
 * the error if we can't resolve the types. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2493"></a><span class='Declare_Function'>plpgsql_resolve_polymorphic_argtypes</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>numargs</span><span class='Delimiter'>, 
</span><a name="LN2494"></a>                                     <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>argtypes</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>argmodes</span><span class='Delimiter'>, 
</span><a name="LN2495"></a>                                     <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>call_expr</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>forValidator</span><span class='Delimiter'>, 
</span><a name="LN2496"></a>                                     <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>proname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2498"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_comp.c.html#LN2495"><span class='Ref_to_Parameter'>forValidator</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* normal case, pass to standard routine */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/funcapi.h.html#LN167"><span class='Ref_to_Proto'>resolve_polymorphic_argtypes</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2493"><span class='Ref_to_Parameter'>numargs</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2494"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>, </span><a href="pl_comp.c.html#LN2494"><span class='Ref_to_Parameter'>argmodes</span></a><span class='Delimiter'>, 
</span>                                          <a href="pl_comp.c.html#LN2495"><span class='Ref_to_Parameter'>call_expr</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine actual argument "</span> 
                            <span class='String'>"type for polymorphic function \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="pl_comp.c.html#LN2496"><span class='Ref_to_Parameter'>proname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* special validation case */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2498"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2498"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_comp.c.html#LN2493"><span class='Ref_to_Parameter'>numargs</span></a><span class='Delimiter'>; </span><a href="pl_comp.c.html#LN2498"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2494"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2498"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN701"><span class='Ref_to_Const'>ANYELEMENTOID</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN703"><span class='Ref_to_Const'>ANYNONARRAYOID</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN705"><span class='Ref_to_Const'>ANYENUMOID</span></a><span class='Operator'>:</span>        <span class='Comment_Single_Line'>/* XXX dubious */ 
</span>                    <a href="pl_comp.c.html#LN2494"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2498"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN687"><span class='Ref_to_Const'>ANYARRAYOID</span></a><span class='Operator'>: 
</span>                    <a href="pl_comp.c.html#LN2494"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2498"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN466"><span class='Ref_to_Const'>INT4ARRAYOID</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN713"><span class='Ref_to_Const'>ANYRANGEOID</span></a><span class='Operator'>: 
</span>                    <a href="pl_comp.c.html#LN2494"><span class='Ref_to_Parameter'>argtypes</span></a><span class='Delimiter'>[</span><a href="pl_comp.c.html#LN2498"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN76"><span class='Ref_to_Const'>INT4RANGEOID</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end plpgsql_resolve_polymorphic_argtypes &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * delete_function - clean up as much as possible of a stale function cache 
 * 
 * We can't release the PLpgSQL_function struct itself, because of the 
 * possibility that there are fn_extra pointers to it.  We can release 
 * the subsidiary storage, but only if there are no active evaluations 
 * in progress.  Otherwise we'll just leak that storage.  Since the 
 * case would only occur if a pg_proc update is detected during a nested 
 * recursive call on the function, a leak seems acceptable. 
 * 
 * Note that this can be called more than once if there are multiple fn_extra 
 * pointers to the same function cache.  Hence be careful not to do things 
 * twice. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2551"></a><span class='Declare_Function'>delete_function</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* remove function from hash table (might be done already) */ 
</span>    <a href="pl_comp.c.html#LN122"><span class='Ref_to_Proto'>plpgsql_HashTableDelete</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2551"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* release the function's storage if safe and not done already */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2551"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN874"><span class='Ref_to_Member'>use_count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pl_funcs.c.html#LN693"><span class='Ref_to_Func'>plpgsql_free_function_memory</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2551"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* exported so we can call it from plpgsql_init() */ 
</span><span class='Keyword'>void 
</span><a name="LN2563"></a><span class='Declare_Function'>plpgsql_HashTableInit</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2565"></a>    <a href="../../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* don't allow double-initialization */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN62"><span class='Ref_to_Global_Var'>plpgsql_HashTable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_comp.c.html#LN2565"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2565"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2565"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN2565"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN64"><span class='Ref_to_Typedef'>plpgsql_HashEnt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_comp.c.html#LN62"><span class='Ref_to_Global_Var'>plpgsql_HashTable</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"PLpgSQL function cache"</span><span class='Delimiter'>, 
</span>                                    <a href="pl_comp.c.html#LN70"><span class='Ref_to_Const'>FUNCS_PER_USER</span></a><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="pl_comp.c.html#LN2565"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>* 
</span><a name="LN2580"></a><span class='Declare_Function'>plpgsql_HashTableLookup</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func_key</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2582"></a>    <a href="pl_comp.c.html#LN64"><span class='Ref_to_Typedef'>plpgsql_HashEnt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hentry</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN2582"><span class='Ref_To_Local'>hentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN64"><span class='Ref_to_Typedef'>plpgsql_HashEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN62"><span class='Ref_to_Global_Var'>plpgsql_HashTable</span></a><span class='Delimiter'>, 
</span>                                             <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN2580"><span class='Ref_to_Parameter'>func_key</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../../include/utils/hsearch.h.html#LN104"><span class='Ref_to_EnumConst'>HASH_FIND</span></a><span class='Delimiter'>, 
</span>                                             <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2582"><span class='Ref_To_Local'>hentry</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pl_comp.c.html#LN2582"><span class='Ref_To_Local'>hentry</span></a><span class='Operator'>-&GT;</span><a href="pl_comp.c.html#LN67"><span class='Ref_to_Member'>function</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN2595"></a><span class='Declare_Function'>plpgsql_HashTableInsert</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>function</span><span class='Delimiter'>, 
</span><a name="LN2596"></a>                        <a href="plpgsql.h.html#LN774"><span class='Ref_to_Struct'>PLpgSQL_func_hashkey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func_key</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2598"></a>    <a href="pl_comp.c.html#LN64"><span class='Ref_to_Typedef'>plpgsql_HashEnt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hentry</span><span class='Delimiter'>; 
</span><a name="LN2599"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN2598"><span class='Ref_To_Local'>hentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN64"><span class='Ref_to_Typedef'>plpgsql_HashEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN62"><span class='Ref_to_Global_Var'>plpgsql_HashTable</span></a><span class='Delimiter'>, 
</span>                                             <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN2596"><span class='Ref_to_Parameter'>func_key</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="pl_comp.c.html#LN2599"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2599"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"trying to insert a function that already exists"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN2598"><span class='Ref_To_Local'>hentry</span></a><span class='Operator'>-&GT;</span><a href="pl_comp.c.html#LN67"><span class='Ref_to_Member'>function</span></a> <span class='Operator'>= </span><a href="pl_comp.c.html#LN2595"><span class='Ref_to_Parameter'>function</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* prepare back link from function to hashtable key */ 
</span>    <a href="pl_comp.c.html#LN2595"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN825"><span class='Ref_to_Member'>fn_hashkey</span></a> <span class='Operator'>= &</span><a href="pl_comp.c.html#LN2598"><span class='Ref_To_Local'>hentry</span></a><span class='Operator'>-&GT;</span><a href="pl_comp.c.html#LN66"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN2614"></a><span class='Declare_Function'>plpgsql_HashTableDelete</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>function</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2616"></a>    <a href="pl_comp.c.html#LN64"><span class='Ref_to_Typedef'>plpgsql_HashEnt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hentry</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* do nothing if not in table */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2614"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN825"><span class='Ref_to_Member'>fn_hashkey</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="pl_comp.c.html#LN2616"><span class='Ref_To_Local'>hentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN64"><span class='Ref_to_Typedef'>plpgsql_HashEnt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="pl_comp.c.html#LN62"><span class='Ref_to_Global_Var'>plpgsql_HashTable</span></a><span class='Delimiter'>, 
</span>                                             <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN2614"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN825"><span class='Ref_to_Member'>fn_hashkey</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../../include/utils/hsearch.h.html#LN106"><span class='Ref_to_EnumConst'>HASH_REMOVE</span></a><span class='Delimiter'>, 
</span>                                             <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_comp.c.html#LN2616"><span class='Ref_To_Local'>hentry</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"trying to delete function that does not exist"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* remove back link, which no longer points to allocated storage */ 
</span>    <a href="pl_comp.c.html#LN2614"><span class='Ref_to_Parameter'>function</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN825"><span class='Ref_to_Member'>fn_hashkey</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>