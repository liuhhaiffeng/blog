<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\pl\plpgsql\src\pl_exec.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\pl\plpgsql\src\pl_exec.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:12 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pl_exec.c        - Executor for the PL/pgSQL 
 *            procedural language 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/pl/plpgsql/src/pl_exec.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/tupconvert.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/spi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planner.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_coerce.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/scansup.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/tcopprot.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"plpgsql.h"</span> 
 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN48"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nargs</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* number of arguments */ 
</span><a name="LN49"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Member'>types</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* types of arguments */ 
</span><a name="LN50"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Member'>values</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* evaluated argument values */ 
</span><a name="LN51"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>nulls</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* null markers (' '/'n' style) */ 
</span><a name="LN52"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PreparedParamsData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * All plpgsql function executions within a single transaction share the same 
 * executor EState for evaluating "simple" expressions.  Each function call 
 * creates its own "eval_econtext" ExprContext within this estate for 
 * per-evaluation workspace.  eval_econtext is freed at normal function exit, 
 * and the EState is freed at transaction end (in case of error, we assume 
 * that the abort mechanisms clean it all up).  Furthermore, any exception 
 * block within a function has to have its own eval_econtext separate from 
 * the containing function's, so that we can clean up ExprContext callbacks 
 * properly at subtransaction exit.  We maintain a stack that tracks the 
 * individual econtexts so that we can clean up correctly at subxact exit. 
 * 
 * This arrangement is a bit tedious to maintain, but it's worth the trouble 
 * so that we don't have to re-prepare simple expressions on each trip through 
 * a function.  (We assume the case to optimize is many repetitions of a 
 * function within a transaction.) 
 * 
 * However, there's no value in trying to amortize simple expression setup 
 * across multiple executions of a DO block (inline code block), since there 
 * can never be any.  If we use the shared EState for a DO block, the expr 
 * state trees are effectively leaked till end of transaction, and that can 
 * add up if the user keeps on submitting DO blocks.  Therefore, each DO block 
 * has its own simple-expression EState, which is cleaned up at exit from 
 * plpgsql_inline_handler().  DO blocks still use the simple_econtext_stack, 
 * though, so that subxact abort cleanup does the right thing. 
 */ 
</span><a name="LN80"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>SimpleEcontextStackEntry</span> 
<span class='Delimiter'>{ 
</span><a name="LN82"></a>    <a href="../../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>stack_econtext</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* a stacked econtext */ 
</span><a name="LN83"></a>    <a href="../../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Member'>xact_subxid</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ID for current subxact */ 
</span><a name="LN84"></a>    <span class='Control'>struct</span> <a href="pl_exec.c.html#LN80"><span class='Ref_to_Struct'>SimpleEcontextStackEntry</span></a> <span class='Operator'>*</span><span class='Declare_Member'>next</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* next stack entry up */ 
</span><a name="LN85"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>SimpleEcontextStackEntry</span><span class='Delimiter'>; 
</span> 
<a name="LN87"></a><span class='Keyword'>static </span><a href="../../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Var'>shared_simple_eval_estate</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static </span><a href="pl_exec.c.html#LN80"><span class='Ref_to_Struct'>SimpleEcontextStackEntry</span></a> <span class='Operator'>*</span><span class='Declare_Var'>simple_econtext_stack</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Memory management within a plpgsql function generally works with three 
 * contexts: 
 * 
 * 1. Function-call-lifespan data, such as variable values, is kept in the 
 * "main" context, a/k/a the "SPI Proc" context established by SPI_connect(). 
 * This is usually the CurrentMemoryContext while running code in this module 
 * (which is not good, because careless coding can easily cause 
 * function-lifespan memory leaks, but we live with it for now). 
 * 
 * 2. Some statement-execution routines need statement-lifespan workspace. 
 * A suitable context is created on-demand by get_stmt_mcontext(), and must 
 * be reset at the end of the requesting routine.  Error recovery will clean 
 * it up automatically.  Nested statements requiring statement-lifespan 
 * workspace will result in a stack of such contexts, see push_stmt_mcontext(). 
 * 
 * 3. We use the eval_econtext's per-tuple memory context for expression 
 * evaluation, and as a general-purpose workspace for short-lived allocations. 
 * Such allocations usually aren't explicitly freed, but are left to be 
 * cleaned up by a context reset, typically done by exec_eval_cleanup(). 
 * 
 * These macros are for use in making short-lived allocations: 
 */ 
</span><a name="LN113"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>get_eval_mcontext</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>eval_econtext<span class='Operator'>-&GT;</span>ecxt_per_tuple_memory<span class='Parentheses'>)</span> 
<a name="LN115"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>eval_mcontext_alloc</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>sz</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN115"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN115"><span class='Ref_to_Parameter'>sz</span></a><span class='Parentheses'>)</span> 
<a name="LN117"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>eval_mcontext_alloc0</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>sz</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN117"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN117"><span class='Ref_to_Parameter'>sz</span></a><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * We use a session-wide hash table for caching cast information. 
 * 
 * Once built, the compiled expression trees (cast_expr fields) survive for 
 * the life of the session.  At some point it might be worth invalidating 
 * those after pg_cast changes, but for the moment we don't bother. 
 * 
 * The evaluation state trees (cast_exprstate) are managed in the same way as 
 * simple expressions (i.e., we assume cast expressions are always simple). 
 * 
 * As with simple expressions, DO blocks don't use the shared hash table but 
 * must have their own.  This isn't ideal, but we don't want to deal with 
 * multiple simple_eval_estates within a DO block. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span>                  <span class='Comment_Single_Line'>/* lookup key for cast info */ 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* NB: we assume this struct contains no padding bytes */ 
</span><a name="LN137"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>srctype</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* source type for cast */ 
</span><a name="LN138"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>dsttype</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* destination type for cast */ 
</span><a name="LN139"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>srctypmod</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* source typmod for cast */ 
</span><a name="LN140"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>dsttypmod</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* destination typmod for cast */ 
</span><a name="LN141"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>plpgsql_CastHashKey</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span>                  <span class='Comment_Single_Line'>/* cast_hash table entry */ 
</span><span class='Delimiter'>{ 
</span><a name="LN145"></a>    <a href="pl_exec.c.html#LN134"><span class='Ref_to_Typedef'>plpgsql_CastHashKey</span></a> <span class='Declare_Member'>key</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* hash key --- MUST BE FIRST */ 
</span><a name="LN146"></a>    <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>cast_expr</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* cast expression, or NULL if no-op cast */ 
</span>    <span class='Comment_Multi_Line'>/* ExprState is valid only when cast_lxid matches current LXID */ 
</span><a name="LN148"></a>    <a href="../../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>cast_exprstate</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* expression's eval tree */ 
</span><a name="LN149"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>cast_in_use</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* true while we're executing eval tree */ 
</span><a name="LN150"></a>    <a href="../../../include/c.h.html#LN398"><span class='Ref_to_Typedef'>LocalTransactionId</span></a> <span class='Declare_Member'>cast_lxid</span><span class='Delimiter'>; 
</span><a name="LN151"></a>} <span class='Declare_Typedef'>plpgsql_CastHashEntry</span><span class='Delimiter'>; 
</span> 
<a name="LN153"></a><span class='Keyword'>static </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>shared_cast_context</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN154"></a><span class='Keyword'>static </span><a href="../../../backend/utils/hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Var'>shared_cast_hash</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/************************************************************ 
 * Local function forward declarations 
 ************************************************************/ 
</span><a name="LN159"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>plpgsql_exec_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN160"></a><span class='Keyword'>static </span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>copy_plpgsql_datum</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>datum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN161"></a><span class='Keyword'>static </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Prototype'>get_stmt_mcontext</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN162"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>push_stmt_mcontext</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN163"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pop_stmt_mcontext</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN165"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_block</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN166"></a>                <a href="plpgsql.h.html#LN403"><span class='Ref_to_Struct'>PLpgSQL_stmt_block</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>block</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN167"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmts</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN168"></a>           <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmts</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN169"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN170"></a>          <a href="plpgsql.h.html#LN364"><span class='Ref_to_Struct'>PLpgSQL_stmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN171"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_assign</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN172"></a>                 <a href="plpgsql.h.html#LN417"><span class='Ref_to_Struct'>PLpgSQL_stmt_assign</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN173"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_perform</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN174"></a>                  <a href="plpgsql.h.html#LN428"><span class='Ref_to_Struct'>PLpgSQL_stmt_perform</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN175"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_getdiag</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN176"></a>                  <a href="plpgsql.h.html#LN447"><span class='Ref_to_Struct'>PLpgSQL_stmt_getdiag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN177"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_if</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN178"></a>             <a href="plpgsql.h.html#LN458"><span class='Ref_to_Struct'>PLpgSQL_stmt_if</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN179"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_case</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN180"></a>               <a href="plpgsql.h.html#LN481"><span class='Ref_to_Struct'>PLpgSQL_stmt_case</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN181"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_loop</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN182"></a>               <a href="plpgsql.h.html#LN505"><span class='Ref_to_Struct'>PLpgSQL_stmt_loop</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN183"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_while</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN184"></a>                <a href="plpgsql.h.html#LN516"><span class='Ref_to_Struct'>PLpgSQL_stmt_while</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN185"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_fori</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN186"></a>               <a href="plpgsql.h.html#LN528"><span class='Ref_to_Struct'>PLpgSQL_stmt_fori</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN187"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_fors</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN188"></a>               <a href="plpgsql.h.html#LN559"><span class='Ref_to_Struct'>PLpgSQL_stmt_fors</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN189"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_forc</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN190"></a>               <a href="plpgsql.h.html#LN574"><span class='Ref_to_Struct'>PLpgSQL_stmt_forc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN191"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_foreach_a</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN192"></a>                    <a href="plpgsql.h.html#LN606"><span class='Ref_to_Struct'>PLpgSQL_stmt_foreach_a</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN193"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_open</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN194"></a>               <a href="plpgsql.h.html#LN620"><span class='Ref_to_Struct'>PLpgSQL_stmt_open</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN195"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_fetch</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN196"></a>                <a href="plpgsql.h.html#LN636"><span class='Ref_to_Struct'>PLpgSQL_stmt_fetch</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN197"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_close</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN198"></a>                <a href="plpgsql.h.html#LN653"><span class='Ref_to_Struct'>PLpgSQL_stmt_close</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN199"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_exit</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN200"></a>               <a href="plpgsql.h.html#LN663"><span class='Ref_to_Struct'>PLpgSQL_stmt_exit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN201"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_return</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN202"></a>                 <a href="plpgsql.h.html#LN675"><span class='Ref_to_Struct'>PLpgSQL_stmt_return</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN203"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_return_next</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN204"></a>                      <a href="plpgsql.h.html#LN686"><span class='Ref_to_Struct'>PLpgSQL_stmt_return_next</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN205"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_return_query</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN206"></a>                       <a href="plpgsql.h.html#LN697"><span class='Ref_to_Struct'>PLpgSQL_stmt_return_query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN207"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_raise</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN208"></a>                <a href="plpgsql.h.html#LN709"><span class='Ref_to_Struct'>PLpgSQL_stmt_raise</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN209"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_assert</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN210"></a>                 <a href="plpgsql.h.html#LN732"><span class='Ref_to_Struct'>PLpgSQL_stmt_assert</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN211"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_execsql</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN212"></a>                  <a href="plpgsql.h.html#LN743"><span class='Ref_to_Struct'>PLpgSQL_stmt_execsql</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN213"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_dynexecute</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN214"></a>                     <a href="plpgsql.h.html#LN759"><span class='Ref_to_Struct'>PLpgSQL_stmt_dynexecute</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN215"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_stmt_dynfors</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN216"></a>                  <a href="plpgsql.h.html#LN590"><span class='Ref_to_Struct'>PLpgSQL_stmt_dynfors</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN218"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>plpgsql_estate_setup</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN219"></a>                     <a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func</span><span class='Delimiter'>, 
</span><a name="LN220"></a>                     <a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rsi</span><span class='Delimiter'>, 
</span><a name="LN221"></a>                     <a href="../../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>simple_eval_estate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN222"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_eval_cleanup</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN224"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_prepare_plan</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN225"></a>                  <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cursorOptions</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN226"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>exec_simple_check_node</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN227"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_simple_check_plan</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN228"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_simple_recheck_plan</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><a href="../../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cplan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN229"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_check_rw_parameter</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>target_dno</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN230"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>contains_target_param</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>target_dno</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN231"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>exec_eval_simple_expr</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN232"></a>                      <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN233"></a>                      <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN234"></a>                      <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN235"></a>                      <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rettype</span><span class='Delimiter'>, 
</span><a name="LN236"></a>                      <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rettypmod</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN238"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_assign_expr</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN239"></a>                 <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>target</span><span class='Delimiter'>, 
</span><a name="LN240"></a>                 <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN241"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_assign_c_string</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN242"></a>                     <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>target</span><span class='Delimiter'>, 
</span><a name="LN243"></a>                     <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN244"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_assign_value</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN245"></a>                  <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>target</span><span class='Delimiter'>, 
</span><a name="LN246"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN247"></a>                  <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>valtype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>valtypmod</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN248"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_eval_datum</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN249"></a>                <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>datum</span><span class='Delimiter'>, 
</span><a name="LN250"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typeid</span><span class='Delimiter'>, 
</span><a name="LN251"></a>                <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typetypmod</span><span class='Delimiter'>, 
</span><a name="LN252"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, 
</span><a name="LN253"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN254"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_eval_integer</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN255"></a>                  <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN256"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN257"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>exec_eval_boolean</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN258"></a>                  <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN259"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN260"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>exec_eval_expr</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN261"></a>               <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN262"></a>               <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN263"></a>               <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rettype</span><span class='Delimiter'>, 
</span><a name="LN264"></a>               <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rettypmod</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN265"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_run_select</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN266"></a>                <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>maxtuples</span><span class='Delimiter'>, </span><a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>portalP</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN267"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>exec_for_query</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN546"><span class='Ref_to_Struct'>PLpgSQL_stmt_forq</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, 
</span><a name="LN268"></a>               <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>prefetch_ok</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN269"></a><span class='Keyword'>static </span><a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Prototype'>setup_param_list</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN270"></a>                 <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN271"></a><span class='Keyword'>static </span><a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Prototype'>setup_unshared_param_list</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN272"></a>                          <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN273"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>plpgsql_param_fetch</span><span class='Parentheses'>(</span><a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>paramid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN274"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_move_row</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN275"></a>              <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rec</span><span class='Delimiter'>, 
</span><a name="LN276"></a>              <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>row</span><span class='Delimiter'>, 
</span><a name="LN277"></a>              <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Delimiter'>, </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN278"></a><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>make_tuple_from_row</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN279"></a>                    <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>row</span><span class='Delimiter'>, 
</span><a name="LN280"></a>                    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN281"></a><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>get_tuple_from_datum</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN282"></a><span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Prototype'>get_tupdesc_from_datum</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN283"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_move_row_from_datum</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN284"></a>                         <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rec</span><span class='Delimiter'>, 
</span><a name="LN285"></a>                         <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>row</span><span class='Delimiter'>, 
</span><a name="LN286"></a>                         <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN287"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>convert_value_to_string</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN288"></a>                        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>valtype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN289"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>exec_cast_value</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN290"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Delimiter'>, 
</span><a name="LN291"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>valtype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>valtypmod</span><span class='Delimiter'>, 
</span><a name="LN292"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>reqtype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>reqtypmod</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN293"></a><span class='Keyword'>static </span><a href="pl_exec.c.html#LN143"><span class='Ref_to_Typedef'>plpgsql_CastHashEntry</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_cast_hashentry</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN294"></a>                   <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>srctype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>srctypmod</span><span class='Delimiter'>, 
</span><a name="LN295"></a>                   <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>dsttype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>dsttypmod</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN296"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_init_tuple_store</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN297"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exec_set_found</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN298"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>plpgsql_create_econtext</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN299"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>plpgsql_destroy_econtext</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN300"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>assign_simple_var</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, 
</span><a name="LN301"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>newvalue</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>freeable</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN302"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>assign_text_var</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, 
</span><a name="LN303"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN304"></a><span class='Keyword'>static </span><a href="pl_exec.c.html#LN46"><span class='Ref_to_Typedef'>PreparedParamsData</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>exec_eval_using_params</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN305"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>params</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN306"></a><span class='Keyword'>static </span><a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Prototype'>exec_dynquery_with_params</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN307"></a>                          <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dynquery</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>params</span><span class='Delimiter'>, 
</span><a name="LN308"></a>                          <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>portalname</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cursorOptions</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN309"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>format_expr_params</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN310"></a>                   <span class='Keyword'>const </span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN311"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>format_preparedparamsdata</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN312"></a>                          <span class='Keyword'>const </span><a href="pl_exec.c.html#LN46"><span class='Ref_to_Typedef'>PreparedParamsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ppd</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_exec_function    Called by the call handler for 
 *              function execution. 
 * 
 * This is also used to execute inline code blocks (DO blocks).  The only 
 * difference that this code is aware of is that for a DO block, we want 
 * to use a private simple_eval_estate, which is created and passed in by 
 * the caller.  For regular functions, pass NULL, which implies using 
 * shared_simple_eval_estate.  (When using a private simple_eval_estate, 
 * we must also use a private cast hashtable, but that's taken care of 
 * within plpgsql_estate_setup.) 
 * ---------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN329"></a><span class='Declare_Function'>plpgsql_exec_function</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func</span><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, 
</span><a name="LN330"></a>                      <a href="../../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>simple_eval_estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN332"></a>    <a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN333"></a>    ErrorContextCallback <span class='Declare_Local'>plerrcontext</span><span class='Delimiter'>; 
</span><a name="LN334"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN335"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup the execution state 
     */ 
</span>    <a href="pl_exec.c.html#LN218"><span class='Ref_to_Proto'>plpgsql_estate_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN80"><span class='Ref_to_Member'>resultinfo</span></a><span class='Delimiter'>, 
</span>                         <a href="pl_exec.c.html#LN330"><span class='Ref_to_Parameter'>simple_eval_estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup error traceback support for ereport() 
     */ 
</span>    <a href="pl_exec.c.html#LN333"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="pl_exec.c.html#LN159"><span class='Ref_to_Proto'>plpgsql_exec_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN333"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= &</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN333"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="pl_exec.c.html#LN333"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make local execution copies of all the datums 
     */ 
</span>    <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during initialization of execution state"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN160"><span class='Ref_to_Proto'>copy_plpgsql_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN866"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Store the actual call argument values into the appropriate variables 
     */ 
</span>    <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"while storing call arguments into local variables"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN835"><span class='Ref_to_Member'>fn_nargs</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN364"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN836"><span class='Ref_to_Member'>fn_argvarnos</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN364"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN370"></a>                    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN364"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>]; 
</span> 
                    <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN370"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                      <a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                      <a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                      <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Force any array-valued parameter to be stored in 
                     * expanded form in our local variable, in hopes of 
                     * improving efficiency of uses of the variable.  (This is 
                     * a hack, really: why only arrays? Need more thought 
                     * about which cases are likely to win.  See also 
                     * typisarray-specific heuristic in exec_assign_value.) 
                     * 
                     * Special cases: If passed a R/W expanded pointer, assume 
                     * we can commandeer the object rather than having to copy 
                     * it.  If passed a R/O expanded pointer, just keep it as 
                     * the value of the variable for the moment.  (We'll force 
                     * it to R/W if the variable gets modified, but that may 
                     * very well never happen.) 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN370"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN370"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN185"><span class='Ref_to_Member'>typisarray</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN320"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_EXPANDED_RW</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN370"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)))</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* take ownership of R/W object */ 
</span>                            <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN370"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../backend/utils/adt/expandeddatum.c.html#LN116"><span class='Ref_to_Func'>TransferExpandedObject</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN370"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                                                       <a href="../../../backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                              <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN318"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_EXPANDED_RO</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN370"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)))</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* R/O pointer, keep it as-is until assigned to */ 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* flat array, so force to expanded form */ 
</span>                            <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN370"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../backend/utils/adt/array_expanded.c.html#LN48"><span class='Ref_to_Func'>expand_array</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN370"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                                                        <a href="../../../backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                                           <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                              <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !var-&GT;isnull&&var-&GT;da... &raquo; </span> 
                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN423"></a>                    <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN364"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>]; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN85"><span class='Ref_to_Member'>argnull</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Assign row value from composite datum */ 
</span>                        <a href="pl_exec.c.html#LN283"><span class='Ref_to_Proto'>exec_move_row_from_datum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN423"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, 
</span>                                                 <a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN84"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* If arg is null, treat it as an empty row */ 
</span>                        <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN423"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* clean up after exec_move_row() */ 
</span>                    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized dtype: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN866"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch estate.datums[n]-&GT;dty... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;func-&GT;fn_nargs;... &raquo; </span> 
 
    <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during function entry"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set the magic variable FOUND to false 
     */ 
</span>    <a href="pl_exec.c.html#LN297"><span class='Ref_to_Proto'>exec_set_found</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Let the instrumentation plugin peek at this function 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN971"><span class='Ref_to_Member'>func_beg</span></a><span class='Parentheses'>)</span> 
        <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN971"><span class='Ref_to_Member'>func_beg</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now call the toplevel block of statements 
     */ 
</span>    <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN364"><span class='Ref_to_Struct'>PLpgSQL_stmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN335"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN165"><span class='Ref_to_Proto'>exec_stmt_block</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN335"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>!= </span><a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_S_R_E_FUNCTION_EXECUTED_NO_RETURN_STATEMENT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"control reached end of function without RETURN"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We got a return value - process it 
     */ 
</span>    <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"while casting return value to function's return type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN890"><span class='Ref_to_Member'>retisset</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN484"></a>        <a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsi</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN902"><span class='Ref_to_Member'>rsi</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check caller can handle a set result */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN484"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>|| !</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN484"><span class='Ref_To_Local'>rsi</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN484"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN484"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If we produced any tuples, send back the result */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pl_exec.c.html#LN484"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN500"></a>                <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN500"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN900"><span class='Ref_to_Member'>tuple_store_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN484"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN500"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if estate.retisset &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN889"><span class='Ref_to_Member'>retistuple</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We have to check that the returned tuple actually matches the 
             * expected result type.  XXX would be better to cache the tupdesc 
             * instead of repeating get_call_result_type() 
             */ 
</span><a name="LN519"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>rettup</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN520"></a>            <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN521"></a>            <a href="../../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tupmap</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN520"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../../include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* got the expected result rowtype, now check it */ 
</span>                    <a href="pl_exec.c.html#LN521"><span class='Ref_To_Local'>tupmap</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupconvert.h.html#LN32"><span class='Ref_to_Proto'>convert_tuples_by_position</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a><span class='Delimiter'>, 
</span>                                                        <a href="pl_exec.c.html#LN520"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                                        <a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"returned record type does not match expected record type"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* it might need conversion */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN521"><span class='Ref_To_Local'>tupmap</span></a><span class='Parentheses'>) 
</span>                        <a href="pl_exec.c.html#LN519"><span class='Ref_To_Local'>rettup</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupconvert.h.html#LN44"><span class='Ref_to_Proto'>do_convert_tuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN519"><span class='Ref_To_Local'>rettup</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN521"><span class='Ref_To_Local'>tupmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* no need to free map, we're about to return anyway */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../include/funcapi.h.html#LN153"><span class='Ref_to_EnumConst'>TYPEFUNC_RECORD</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Failed to determine actual type of RECORD.  We could 
                     * raise an error here, but what this means in practice is 
                     * that the caller is expecting any old generic rowtype, 
                     * so we don't really need to be restrictive. Pass back 
                     * the generated result type, instead. 
                     */ 
</span>                    <a href="pl_exec.c.html#LN520"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN520"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>        <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>                        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"return type must be a row type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* shouldn't get here if retistuple is true ... */ 
</span>                    <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"return type must be a row type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch get_call_result_type(... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Copy tuple to upper executor memory, as a tuple Datum. Make 
             * sure it is labeled with the caller-supplied tuple type. 
             */ 
</span>            <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/executor/spi.h.html#LN120"><span class='Ref_to_Proto'>SPI_returntuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN519"><span class='Ref_To_Local'>rettup</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN520"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if estate.retistuple &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Cast value to proper type */ 
</span>            <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN289"><span class='Ref_to_Proto'>exec_cast_value</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN886"><span class='Ref_to_Member'>rettype</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN828"><span class='Ref_to_Member'>fn_rettype</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If the function's return type isn't by value, copy the value 
             * into upper executor memory context.  However, if we have a R/W 
             * expanded datum, we can just transfer its ownership out to the 
             * upper executor context. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN82"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>&& !</span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN830"><span class='Ref_to_Member'>fn_retbyval</span></a><span class='Parentheses'>) 
</span>                <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN134"><span class='Ref_to_Proto'>SPI_datumTransfer</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN829"><span class='Ref_to_Member'>fn_rettyplen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !estate.retisnull &raquo; </span> 
 
    <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during function exit"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Let the instrumentation plugin peek at this function 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN972"><span class='Ref_to_Member'>func_end</span></a><span class='Parentheses'>)</span> 
        <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN972"><span class='Ref_to_Member'>func_end</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN329"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up any leftover temporary memory */ 
</span>    <a href="pl_exec.c.html#LN299"><span class='Ref_to_Proto'>plpgsql_destroy_econtext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* stmt_mcontext will be destroyed when function's main context is */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pop the error context stack 
     */ 
</span>    <a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN333"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return the function's result 
     */ 
</span>    <span class='Control'>return</span> <a href="pl_exec.c.html#LN332"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_exec_function &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_exec_trigger     Called by the call handler for 
 *              trigger execution. 
 * ---------- 
 */ 
</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN615"></a><span class='Declare_Function'>plpgsql_exec_trigger</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func</span><span class='Delimiter'>, 
</span><a name="LN616"></a>                     <a href="../../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN618"></a>    <a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN619"></a>    ErrorContextCallback <span class='Declare_Local'>plerrcontext</span><span class='Delimiter'>; 
</span><a name="LN620"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN621"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span><a name="LN622"></a>    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN623"></a>    <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec_new</span><span class='Delimiter'>, 
</span><a name="LN624"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rec_old</span><span class='Delimiter'>; 
</span><a name="LN625"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>rettup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup the execution state 
     */ 
</span>    <a href="pl_exec.c.html#LN218"><span class='Ref_to_Proto'>plpgsql_estate_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup error traceback support for ereport() 
     */ 
</span>    <a href="pl_exec.c.html#LN619"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="pl_exec.c.html#LN159"><span class='Ref_to_Proto'>plpgsql_exec_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN619"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= &</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN619"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="pl_exec.c.html#LN619"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make local execution copies of all the datums 
     */ 
</span>    <a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during initialization of execution state"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN620"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN620"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN620"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN620"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN160"><span class='Ref_to_Proto'>copy_plpgsql_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN866"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN620"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Put the OLD and NEW tuples into record variables 
     * 
     * We make the tupdescs available in both records even though only one may 
     * have a value.  This allows parsing of record references to succeed in 
     * functions that are used for multiple trigger types.  For example, we 
     * might have a test like "if (TG_OP = 'INSERT' and NEW.foo = 'xyz')", 
     * which should parse regardless of the current trigger type. 
     */ 
</span>    <a href="pl_exec.c.html#LN623"><span class='Ref_To_Local'>rec_new</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN839"><span class='Ref_to_Member'>new_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN623"><span class='Ref_To_Local'>rec_new</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN308"><span class='Ref_to_Member'>freetup</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN623"><span class='Ref_To_Local'>rec_new</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN623"><span class='Ref_To_Local'>rec_new</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN309"><span class='Ref_to_Member'>freetupdesc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN624"><span class='Ref_To_Local'>rec_old</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN840"><span class='Ref_to_Member'>old_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN624"><span class='Ref_To_Local'>rec_old</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN308"><span class='Ref_to_Member'>freetup</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN624"><span class='Ref_To_Local'>rec_old</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN624"><span class='Ref_To_Local'>rec_old</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN309"><span class='Ref_to_Member'>freetupdesc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/commands/trigger.h.html#LN81"><span class='Ref_to_Macro'>TRIGGER_FIRED_FOR_ROW</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Per-statement triggers don't use OLD/NEW variables 
         */ 
</span>        <a href="pl_exec.c.html#LN623"><span class='Ref_To_Local'>rec_new</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN624"><span class='Ref_To_Local'>rec_old</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN69"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_INSERT</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN623"><span class='Ref_To_Local'>rec_new</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN624"><span class='Ref_To_Local'>rec_old</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN75"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_UPDATE</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN623"><span class='Ref_To_Local'>rec_new</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN624"><span class='Ref_To_Local'>rec_old</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN72"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_DELETE</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN623"><span class='Ref_To_Local'>rec_new</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN624"><span class='Ref_To_Local'>rec_old</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized trigger action: not INSERT, DELETE, or UPDATE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make transition tables visible to this SPI connection */ 
</span>    <a href="pl_exec.c.html#LN621"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN156"><span class='Ref_to_Proto'>SPI_register_trigger_data</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN621"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Assign the special tg_ variables 
     */ 
</span> 
    <a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN844"><span class='Ref_to_Member'>tg_op_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN69"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_INSERT</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='String'>"INSERT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN75"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_UPDATE</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='String'>"UPDATE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN72"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_DELETE</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='String'>"DELETE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN78"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_TRUNCATE</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='String'>"TRUNCATE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized trigger action: not INSERT, DELETE, UPDATE, or TRUNCATE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN841"><span class='Ref_to_Member'>tg_name_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../../backend/utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, 
</span>                              <a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN26"><span class='Ref_to_Member'>tgname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                      <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN842"><span class='Ref_to_Member'>tg_when_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN87"><span class='Ref_to_Macro'>TRIGGER_FIRED_BEFORE</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='String'>"BEFORE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN90"><span class='Ref_to_Macro'>TRIGGER_FIRED_AFTER</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='String'>"AFTER"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN93"><span class='Ref_to_Macro'>TRIGGER_FIRED_INSTEAD</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='String'>"INSTEAD OF"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized trigger execution time: not BEFORE, AFTER, or INSTEAD OF"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN843"><span class='Ref_to_Member'>tg_level_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN81"><span class='Ref_to_Macro'>TRIGGER_FIRED_FOR_ROW</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='String'>"ROW"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN84"><span class='Ref_to_Macro'>TRIGGER_FIRED_FOR_STATEMENT</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='String'>"STATEMENT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized trigger event type: not ROW or STATEMENT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN845"><span class='Ref_to_Member'>tg_relid_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN115"><span class='Ref_to_Member'>rd_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN846"><span class='Ref_to_Member'>tg_relname_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../../backend/utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, 
</span>            <a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>, 
</span>                      <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN847"><span class='Ref_to_Member'>tg_table_name_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../../backend/utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, 
</span>            <a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>, 
</span>                      <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN848"><span class='Ref_to_Member'>tg_table_schema_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../../backend/utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span> 
                                                        <a href="../../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>( 
</span>                                                   <a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>, 
</span>                      <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN849"><span class='Ref_to_Member'>tg_nargs_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN850"><span class='Ref_to_Member'>tg_argv_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For historical reasons, tg_argv[] subscripts start at zero not one. 
         * So we can't use construct_array(). 
         */ 
</span><a name="LN772"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a><span class='Delimiter'>; 
</span><a name="LN773"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elems</span><span class='Delimiter'>; 
</span><a name="LN774"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>dims</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN775"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>lbs</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <a href="pl_exec.c.html#LN773"><span class='Ref_To_Local'>elems</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pl_exec.c.html#LN772"><span class='Ref_To_Local'>nelems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN620"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN620"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN772"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN620"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN773"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN620"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN620"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN774"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN772"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN775"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                          <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN372"><span class='Ref_to_Proto'>construct_md_array</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN773"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                             <span class='Number'>1</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN774"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN775"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, 
</span>                                                             <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, 
</span>                                                             <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                          <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if trigdata-&GT;tg_trigger-... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN622"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during function entry"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set the magic variable FOUND to false 
     */ 
</span>    <a href="pl_exec.c.html#LN297"><span class='Ref_to_Proto'>exec_set_found</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Let the instrumentation plugin peek at this function 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN971"><span class='Ref_to_Member'>func_beg</span></a><span class='Parentheses'>)</span> 
        <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN971"><span class='Ref_to_Member'>func_beg</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now call the toplevel block of statements 
     */ 
</span>    <a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN364"><span class='Ref_to_Struct'>PLpgSQL_stmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN621"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN165"><span class='Ref_to_Proto'>exec_stmt_block</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN621"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>!= </span><a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_S_R_E_FUNCTION_EXECUTED_NO_RETURN_STATEMENT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"control reached end of trigger procedure without RETURN"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during function exit"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN890"><span class='Ref_to_Member'>retisset</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"trigger procedure cannot return a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the returned tuple structure has the same attributes, the 
     * relation that fired the trigger has. A per-statement trigger always 
     * needs to return NULL, so we ignore any return value the function itself 
     * produces (XXX: is this a good idea?) 
     * 
     * XXX This way it is possible, that the trigger returns a tuple where 
     * attributes don't have the correct atttypmod's length. It's up to the 
     * trigger's programmer to ensure that this doesn't happen. Jan 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a> <span class='Operator'>|| !</span><a href="../../../include/commands/trigger.h.html#LN81"><span class='Ref_to_Macro'>TRIGGER_FIRED_FOR_ROW</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="pl_exec.c.html#LN625"><span class='Ref_To_Local'>rettup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN845"></a>        <a href="../../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tupmap</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN625"><span class='Ref_To_Local'>rettup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* check rowtype compatibility */ 
</span>        <a href="pl_exec.c.html#LN845"><span class='Ref_To_Local'>tupmap</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupconvert.h.html#LN32"><span class='Ref_to_Proto'>convert_tuples_by_position</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN616"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"returned row structure does not match the structure of the triggering table"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* it might need conversion */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN845"><span class='Ref_To_Local'>tupmap</span></a><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN625"><span class='Ref_To_Local'>rettup</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupconvert.h.html#LN44"><span class='Ref_to_Proto'>do_convert_tuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN625"><span class='Ref_To_Local'>rettup</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN845"><span class='Ref_To_Local'>tupmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* no need to free map, we're about to return anyway */ 
</span> 
        <span class='Comment_Multi_Line'>/* Copy tuple to upper executor memory */ 
</span>        <a href="pl_exec.c.html#LN625"><span class='Ref_To_Local'>rettup</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN119"><span class='Ref_to_Proto'>SPI_copytuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN625"><span class='Ref_To_Local'>rettup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Let the instrumentation plugin peek at this function 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN972"><span class='Ref_to_Member'>func_end</span></a><span class='Parentheses'>)</span> 
        <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN972"><span class='Ref_to_Member'>func_end</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN615"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up any leftover temporary memory */ 
</span>    <a href="pl_exec.c.html#LN299"><span class='Ref_to_Proto'>plpgsql_destroy_econtext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN618"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* stmt_mcontext will be destroyed when function's main context is */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pop the error context stack 
     */ 
</span>    <a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN619"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return the trigger's result 
     */ 
</span>    <span class='Control'>return</span> <a href="pl_exec.c.html#LN625"><span class='Ref_To_Local'>rettup</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_exec_trigger &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * plpgsql_exec_event_trigger       Called by the call handler for 
 *              event trigger execution. 
 * ---------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN889"></a><span class='Declare_Function'>plpgsql_exec_event_trigger</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func</span><span class='Delimiter'>, </span><a href="../../../include/commands/event_trigger.h.html#LN22"><span class='Ref_to_Struct'>EventTriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN891"></a>    <a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN892"></a>    ErrorContextCallback <span class='Declare_Local'>plerrcontext</span><span class='Delimiter'>; 
</span><a name="LN893"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN894"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span><a name="LN895"></a>    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup the execution state 
     */ 
</span>    <a href="pl_exec.c.html#LN218"><span class='Ref_to_Proto'>plpgsql_estate_setup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN889"><span class='Ref_to_Parameter'>func</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Setup error traceback support for ereport() 
     */ 
</span>    <a href="pl_exec.c.html#LN892"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="pl_exec.c.html#LN159"><span class='Ref_to_Proto'>plpgsql_exec_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN892"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>arg <span class='Operator'>= &</span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN892"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="pl_exec.c.html#LN892"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make local execution copies of all the datums 
     */ 
</span>    <a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during initialization of execution state"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN893"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN893"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN893"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN893"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN160"><span class='Ref_to_Proto'>copy_plpgsql_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN889"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN866"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN893"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Assign the special tg_ variables 
     */ 
</span>    <a href="pl_exec.c.html#LN895"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN889"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN853"><span class='Ref_to_Member'>tg_event_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN895"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN889"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/event_trigger.h.html#LN25"><span class='Ref_to_Member'>event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN895"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN889"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN854"><span class='Ref_to_Member'>tg_tag_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN895"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN889"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/event_trigger.h.html#LN27"><span class='Ref_to_Member'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Let the instrumentation plugin peek at this function 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN971"><span class='Ref_to_Member'>func_beg</span></a><span class='Parentheses'>)</span> 
        <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN971"><span class='Ref_to_Member'>func_beg</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN889"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now call the toplevel block of statements 
     */ 
</span>    <a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN364"><span class='Ref_to_Struct'>PLpgSQL_stmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN889"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN894"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN165"><span class='Ref_to_Proto'>exec_stmt_block</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN889"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN870"><span class='Ref_to_Member'>action</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN894"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>!= </span><a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_S_R_E_FUNCTION_EXECUTED_NO_RETURN_STATEMENT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"control reached end of trigger procedure without RETURN"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during function exit"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Let the instrumentation plugin peek at this function 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN972"><span class='Ref_to_Member'>func_end</span></a><span class='Parentheses'>)</span> 
        <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN972"><span class='Ref_to_Member'>func_end</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN889"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up any leftover temporary memory */ 
</span>    <a href="pl_exec.c.html#LN299"><span class='Ref_to_Proto'>plpgsql_destroy_econtext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN891"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* stmt_mcontext will be destroyed when function's main context is */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pop the error context stack 
     */ 
</span>    <a href="../../../backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN892"><span class='Ref_To_Local'>plerrcontext</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_exec_event_trigger &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * error context callback to let us supply a call-stack traceback 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN973"></a><span class='Declare_Function'>plpgsql_exec_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN975"></a>    <a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN973"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We don't expend the cycles to run gettext() on err_text unless we 
         * actually need it.  Therefore, places that set up err_text should 
         * use gettext_noop() to ensure the strings get recorded in the 
         * message dictionary. 
         * 
         * If both err_text and err_stmt are set, use the err_text as 
         * description, but report the err_stmt's line number.  When err_stmt 
         * is not set, we're in function entry/exit, or some such place not 
         * attached to a specific line number. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * translator: last %s is a phrase such as "during statement block 
             * local variable initialization" 
             */ 
</span>            errcontext<span class='Parentheses'>(</span><span class='String'>"PL/pgSQL function %s line %d %s"</span><span class='Delimiter'>, 
</span>                       <a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN819"><span class='Ref_to_Member'>fn_signature</span></a><span class='Delimiter'>, 
</span>                       <a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN367"><span class='Ref_to_Member'>lineno</span></a><span class='Delimiter'>, 
</span>                       _<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * translator: last %s is a phrase such as "while storing call 
             * arguments into local variables" 
             */ 
</span>            errcontext<span class='Parentheses'>(</span><span class='String'>"PL/pgSQL function %s %s"</span><span class='Delimiter'>, 
</span>                       <a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN819"><span class='Ref_to_Member'>fn_signature</span></a><span class='Delimiter'>, 
</span>                       _<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if estate-&GT;err_text!=NUL... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* translator: last %s is a plpgsql statement type name */ 
</span>        errcontext<span class='Parentheses'>(</span><span class='String'>"PL/pgSQL function %s line %d at %s"</span><span class='Delimiter'>, 
</span>                   <a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN819"><span class='Ref_to_Member'>fn_signature</span></a><span class='Delimiter'>, 
</span>                   <a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN367"><span class='Ref_to_Member'>lineno</span></a><span class='Delimiter'>, 
</span>                   <a href="pl_funcs.c.html#LN232"><span class='Ref_to_Func'>plpgsql_stmt_typename</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        errcontext<span class='Parentheses'>(</span><span class='String'>"PL/pgSQL function %s"</span><span class='Delimiter'>, 
</span>                   <a href="pl_exec.c.html#LN975"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN819"><span class='Ref_to_Member'>fn_signature</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_exec_error_callback &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Support function for initializing local execution variables 
 * ---------- 
 */ 
</span><span class='Keyword'>static </span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>* 
</span><a name="LN1031"></a><span class='Declare_Function'>copy_plpgsql_datum</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>datum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1033"></a>    <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1031"><span class='Ref_to_Parameter'>datum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1039"></a>                <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>new</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                memcpy<span class='Parentheses'>(</span><span class='Control'>new</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1031"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* should be preset to null/non-freeable */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN270"><span class='Ref_to_Member'>freeval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN1033"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Control'>new</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1052"></a>                <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>new</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                memcpy<span class='Parentheses'>(</span><span class='Control'>new</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1031"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* should be preset to null/non-freeable */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN308"><span class='Ref_to_Member'>freetup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN309"><span class='Ref_to_Member'>freetupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN1033"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Control'>new</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN63"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_RECFIELD</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN64"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ARRAYELEM</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * These datum records are read-only at runtime, so no need to 
             * copy them (well, ARRAYELEM contains some cached type data, but 
             * we'd just as soon centralize the caching anyway) 
             */ 
</span>            <a href="pl_exec.c.html#LN1033"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1031"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized dtype: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1031"><span class='Ref_to_Parameter'>datum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN1033"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch datum-&GT;dtype &raquo; </span> 
 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN1033"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end copy_plpgsql_datum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create a memory context for statement-lifespan variables, if we don't 
 * have one already.  It will be a child of stmt_mcontext_parent, which is 
 * either the function's main context or a pushed-down outer stmt_mcontext. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> 
<a name="LN1092"></a><span class='Declare_Function'>get_stmt_mcontext</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1092"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN1092"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a> <span class='Operator'>= 
</span>            <a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1092"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN922"><span class='Ref_to_Member'>stmt_mcontext_parent</span></a><span class='Delimiter'>, 
</span>                                  <span class='String'>"PLpgSQL per-statement data"</span><span class='Delimiter'>, 
</span>                                  <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="pl_exec.c.html#LN1092"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Push down the current stmt_mcontext so that called statements won't use it. 
 * This is needed by statements that have statement-lifespan data and need to 
 * preserve it across some inner statements.  The caller should eventually do 
 * pop_stmt_mcontext(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1111"></a><span class='Declare_Function'>push_stmt_mcontext</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Should have done get_stmt_mcontext() first */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1111"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Assert we've not messed up the stack linkage */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/memutils.h.html#LN81"><span class='Ref_to_Proto'>MemoryContextGetParent</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1111"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="pl_exec.c.html#LN1111"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN922"><span class='Ref_to_Member'>stmt_mcontext_parent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Push it down to become the parent of any nested stmt mcontext */ 
</span>    <a href="pl_exec.c.html#LN1111"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN922"><span class='Ref_to_Member'>stmt_mcontext_parent</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1111"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* And make it not available for use directly */ 
</span>    <a href="pl_exec.c.html#LN1111"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Undo push_stmt_mcontext().  We assume this is done just before or after 
 * resetting the caller's stmt_mcontext; since that action will also delete 
 * any child contexts, there's no need to explicitly delete whatever context 
 * might currently be estate-&GT;stmt_mcontext. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1130"></a><span class='Declare_Function'>pop_stmt_mcontext</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* We need only pop the stack */ 
</span>    <a href="pl_exec.c.html#LN1130"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1130"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN922"><span class='Ref_to_Member'>stmt_mcontext_parent</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN1130"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN922"><span class='Ref_to_Member'>stmt_mcontext_parent</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN81"><span class='Ref_to_Proto'>MemoryContextGetParent</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1130"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Subroutine for exec_stmt_block: does any condition in the condition list 
 * match the current exception? 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1143"></a><span class='Declare_Function'>exception_matches_conditions</span><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>edata</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN373"><span class='Ref_to_Struct'>PLpgSQL_condition</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cond</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN1143"><span class='Ref_to_Parameter'>cond</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN1143"><span class='Ref_to_Parameter'>cond</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1143"><span class='Ref_to_Parameter'>cond</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN377"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1147"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>sqlerrstate</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1143"><span class='Ref_to_Parameter'>cond</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN375"><span class='Ref_to_Member'>sqlerrstate</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * OTHERS matches everything *except* query-canceled and 
         * assert-failure.  If you're foolish enough, you can match those 
         * explicitly. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1147"><span class='Ref_To_Local'>sqlerrstate</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1143"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>!= </span>ERRCODE_QUERY_CANCELED <span class='Operator'>&& 
</span>                <a href="pl_exec.c.html#LN1143"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>!= </span>ERRCODE_ASSERT_FAILURE<span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Exact match? */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1143"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>== </span><a href="pl_exec.c.html#LN1147"><span class='Ref_To_Local'>sqlerrstate</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Category match? */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN67"><span class='Ref_to_Macro'>ERRCODE_IS_CATEGORY</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1147"><span class='Ref_To_Local'>sqlerrstate</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                 <a href="../../../include/utils/elog.h.html#LN66"><span class='Ref_to_Macro'>ERRCODE_TO_CATEGORY</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1143"><span class='Ref_to_Parameter'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="pl_exec.c.html#LN1147"><span class='Ref_To_Local'>sqlerrstate</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;cond!=NULL;cond=cond... &raquo; </span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exception_matches_conditions &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_block          Execute a block of statements 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1177"></a><span class='Declare_Function'>exec_stmt_block</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN403"><span class='Ref_to_Struct'>PLpgSQL_stmt_block</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>block</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1179"></a>    <span class='Keyword'>volatile int </span><span class='Declare_Local'>rc</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN1180"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1181"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First initialize all variables declared in this block 
     */ 
</span>    <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during statement block local variable initialization"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1180"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN1180"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>block</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN409"><span class='Ref_to_Member'>n_initvars</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN1180"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN1181"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>block</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN410"><span class='Ref_to_Member'>initvarnos</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN1180"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN1181"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1196"></a>                    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN1181"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Free any old value, in case re-entering block, and 
                     * initialize to NULL 
                     */ 
</span>                    <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1196"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1196"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN263"><span class='Ref_to_Member'>default_val</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * If needed, give the datatype a chance to reject 
                         * NULLs, by assigning a NULL to the variable. We 
                         * claim the value is of type UNKNOWN, not the var's 
                         * datatype, else coercion will be skipped. (Do this 
                         * before the notnull check to be consistent with 
                         * exec_assign_value.) 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1196"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN182"><span class='Ref_to_Member'>typtype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) 
</span>                            <a href="pl_exec.c.html#LN244"><span class='Ref_to_Proto'>exec_assign_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1196"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                              <span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                              <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN43"><span class='Ref_to_Const'>UNKNOWNOID</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1196"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN262"><span class='Ref_to_Member'>notnull</span></a><span class='Parentheses'>) 
</span>                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"variable \"%s\" declared NOT NULL cannot default to NULL"</span><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN1196"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN257"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if var-&GT;default_val==NUL... &raquo; </span> 
                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="pl_exec.c.html#LN238"><span class='Ref_to_Proto'>exec_assign_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1196"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                         <a href="pl_exec.c.html#LN1196"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN263"><span class='Ref_to_Member'>default_val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1238"></a>                    <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN1181"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1238"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN308"><span class='Ref_to_Member'>freetup</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="../../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1238"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pl_exec.c.html#LN1238"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN308"><span class='Ref_to_Member'>freetup</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1238"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN309"><span class='Ref_to_Member'>freetupdesc</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="../../../include/access/tupdesc.h.html#LN95"><span class='Ref_to_Proto'>FreeTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1238"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pl_exec.c.html#LN1238"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN309"><span class='Ref_to_Member'>freetupdesc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="pl_exec.c.html#LN1238"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN1238"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN63"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_RECFIELD</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN64"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ARRAYELEM</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized dtype: %d"</span><span class='Delimiter'>, 
</span>                     <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN1181"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch estate-&GT;datums[n]-&GT;dt... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;block-&GT;n_initva... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>block</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN411"><span class='Ref_to_Member'>exceptions</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Execute the statements in the block's body inside a sub-transaction 
         */ 
</span><a name="LN1270"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span> <span class='Operator'>= </span><a href="../../../backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span><a name="LN1271"></a>        <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>oldowner</span> <span class='Operator'>= </span><a href="../../../backend/utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>; 
</span><a name="LN1272"></a>        <a href="../../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>old_eval_econtext</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a><span class='Delimiter'>; 
</span><a name="LN1273"></a>        <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>save_cur_error</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Delimiter'>; 
</span><a name="LN1274"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>stmt_mcontext</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during statement block entry"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We will need a stmt_mcontext to hold the error data if an error 
         * occurs.  It seems best to force it to exist before entering the 
         * subtransaction, so that we reduce the risk of out-of-memory during 
         * error recovery, and because this greatly simplifies restoring the 
         * stmt_mcontext stack to the correct state after an error.  We can 
         * ameliorate the cost of this by allowing the called statements to 
         * use this mcontext too; so we don't push it down here. 
         */ 
</span>        <a href="pl_exec.c.html#LN1274"><span class='Ref_To_Local'>stmt_mcontext</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN161"><span class='Ref_to_Proto'>get_stmt_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/xact.h.html#LN358"><span class='Ref_to_Proto'>BeginInternalSubTransaction</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Want to run statements inside function's memory context */ 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1270"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We need to run the block's statements with a new eval_econtext 
             * that belongs to the current subtransaction; if we try to use 
             * the outer econtext then ExprContext shutdown callbacks will be 
             * called at the wrong times. 
             */ 
</span>            <a href="pl_exec.c.html#LN298"><span class='Ref_to_Proto'>plpgsql_create_econtext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Run the block's statements */ 
</span>            <a href="pl_exec.c.html#LN1179"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>block</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN408"><span class='Ref_to_Member'>body</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during statement block exit"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If the block ended with RETURN, we may need to copy the return 
             * value out of the subtransaction eval_context.  This is 
             * currently only needed for scalar result types --- rowtype 
             * values will always exist in the function's main memory context, 
             * cf. exec_stmt_return().  We can avoid a physical copy if the 
             * value happens to be a R/W expanded object. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1179"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a> <span class='Operator'>&& 
</span>                <span class='Operator'>!</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN890"><span class='Ref_to_Member'>retisset</span></a> <span class='Operator'>&& 
</span>                <span class='Operator'>!</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a> <span class='Operator'>&& 
</span>                <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1323"></a>                <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>resTypLen</span><span class='Delimiter'>; 
</span><a name="LN1324"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>resTypByVal</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/utils/lsyscache.h.html#LN135"><span class='Ref_to_Proto'>get_typlenbyval</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN886"><span class='Ref_to_Member'>rettype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN1323"><span class='Ref_To_Local'>resTypLen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN1324"><span class='Ref_To_Local'>resTypByVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN37"><span class='Ref_to_Proto'>datumTransfer</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a><span class='Delimiter'>, 
</span>                                               <a href="pl_exec.c.html#LN1324"><span class='Ref_To_Local'>resTypByVal</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1323"><span class='Ref_To_Local'>resTypLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Commit the inner transaction, return to outer xact context */ 
</span>            <a href="../../../include/access/xact.h.html#LN359"><span class='Ref_to_Proto'>ReleaseCurrentSubTransaction</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1270"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../backend/utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1271"><span class='Ref_To_Local'>oldowner</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Assert that the stmt_mcontext stack is unchanged */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1274"><span class='Ref_To_Local'>stmt_mcontext</span></a> <span class='Operator'>== </span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Revert to outer eval_econtext.  (The inner one was 
             * automatically cleaned up during subxact exit.) 
             */ 
</span>            <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1272"><span class='Ref_To_Local'>old_eval_econtext</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1347"></a>            <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>edata</span><span class='Delimiter'>; 
</span><a name="LN1348"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>e</span><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"during exception cleanup"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Save error info in our stmt_mcontext */ 
</span>            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1274"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN1347"><span class='Ref_To_Local'>edata</span></a> <span class='Operator'>= </span><a href="../../../include/utils/elog.h.html#LN363"><span class='Ref_to_Proto'>CopyErrorData</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/elog.h.html#LN365"><span class='Ref_to_Proto'>FlushErrorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Abort the inner transaction */ 
</span>            <a href="../../../include/access/xact.h.html#LN360"><span class='Ref_to_Proto'>RollbackAndReleaseCurrentSubTransaction</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1270"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../backend/utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1271"><span class='Ref_To_Local'>oldowner</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Set up the stmt_mcontext stack as though we had restored our 
             * previous state and then done push_stmt_mcontext().  The push is 
             * needed so that statements in the exception handler won't 
             * clobber the error data that's in our stmt_mcontext. 
             */ 
</span>            <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN922"><span class='Ref_to_Member'>stmt_mcontext_parent</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1274"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Now we can delete any nested stmt_mcontexts that might have 
             * been created as children of ours.  (Note: we do not immediately 
             * release any statement-lifespan data that might have been left 
             * behind in stmt_mcontext itself.  We could attempt that by doing 
             * a MemoryContextReset on it before collecting the error data 
             * above, but it seems too risky to do any significant amount of 
             * work before collecting the error.) 
             */ 
</span>            <a href="../../../include/utils/memutils.h.html#LN77"><span class='Ref_to_Proto'>MemoryContextDeleteChildren</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1274"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Revert to outer eval_econtext */ 
</span>            <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1272"><span class='Ref_To_Local'>old_eval_econtext</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Must clean up the econtext too.  However, any tuple table made 
             * in the subxact will have been thrown away by SPI during subxact 
             * abort, so we don't need to (and mustn't try to) free the 
             * eval_tuptable. 
             */ 
</span>            <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Look for a matching exception handler */ 
</span>            <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1348"><span class='Ref_To_Local'>e</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>block</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN411"><span class='Ref_to_Member'>exceptions</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN387"><span class='Ref_to_Member'>exc_list</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1397"></a>                <a href="plpgsql.h.html#LN393"><span class='Ref_to_Struct'>PLpgSQL_exception</span></a> <span class='Operator'>*</span><span class='Declare_Local'>exception</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN393"><span class='Ref_to_Struct'>PLpgSQL_exception</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1348"><span class='Ref_To_Local'>e</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1142"><span class='Ref_to_Func'>exception_matches_conditions</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1347"><span class='Ref_To_Local'>edata</span></a><span class='Delimiter'>, </span><span class='Keyword'>exception</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN396"><span class='Ref_to_Member'>conditions</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Initialize the magic SQLSTATE and SQLERRM variables for 
                     * the exception block; this also frees values from any 
                     * prior use of the same exception. We needn't do this 
                     * until we have found a matching exception. 
                     */ 
</span><a name="LN1407"></a>                    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state_var</span><span class='Delimiter'>; 
</span><a name="LN1408"></a>                    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>errm_var</span><span class='Delimiter'>; 
</span> 
                    <a href="pl_exec.c.html#LN1407"><span class='Ref_To_Local'>state_var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                        <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>block</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN411"><span class='Ref_to_Member'>exceptions</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN385"><span class='Ref_to_Member'>sqlstate_varno</span></a><span class='Delimiter'>]; 
</span>                    <a href="pl_exec.c.html#LN1408"><span class='Ref_To_Local'>errm_var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                        <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>block</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN411"><span class='Ref_to_Member'>exceptions</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN386"><span class='Ref_to_Member'>sqlerrm_varno</span></a><span class='Delimiter'>]; 
</span> 
                    <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1407"><span class='Ref_To_Local'>state_var</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../../include/utils/elog.h.html#LN401"><span class='Ref_to_Proto'>unpack_sql_state</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1347"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1408"><span class='Ref_To_Local'>errm_var</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1347"><span class='Ref_To_Local'>edata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Also set up cur_error so the error data is accessible 
                     * inside the handler. 
                     */ 
</span>                    <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1347"><span class='Ref_To_Local'>edata</span></a><span class='Delimiter'>; 
</span> 
                    <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                    <a href="pl_exec.c.html#LN1179"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Keyword'>exception</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN397"><span class='Ref_to_Member'>action</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if exception_matches_con... &raquo; </span> 
            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Restore previous state of cur_error, whether or not we executed 
             * a handler.  This is needed in case an error got thrown from 
             * some inner block's exception handler. 
             */ 
</span>            <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1273"><span class='Ref_To_Local'>save_cur_error</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* If no match found, re-throw the error */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1348"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN366"><span class='Ref_to_Func'>ReThrowError</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1347"><span class='Ref_To_Local'>edata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Restore stmt_mcontext stack and release the error data */ 
</span>            <a href="pl_exec.c.html#LN163"><span class='Ref_to_Proto'>pop_stmt_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1274"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1273"><span class='Ref_To_Local'>save_cur_error</span></a> <span class='Operator'>== </span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if block-&GT;exceptions &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Just execute the statements in the block's body 
         */ 
</span>        <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN1179"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>block</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN408"><span class='Ref_to_Member'>body</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle the return code. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1179"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN118"><span class='Ref_to_EnumConst'>PLPGSQL_RC_CONTINUE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN1179"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * This is intentionally different from the handling of RC_EXIT 
             * for loops: to match a block, we require a match by label. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>block</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN407"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>block</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN407"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN1177"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized rc: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1179"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rc &raquo; </span> 
 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_block &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmts           Iterate over a list of statements 
 *              as long as their return code is OK 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1503"></a><span class='Declare_Function'>exec_stmts</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmts</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1505"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1503"><span class='Ref_to_Parameter'>stmts</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Ensure we do a CHECK_FOR_INTERRUPTS() even though there is no 
         * statement.  This prevents hangup in a tight loop if, for instance, 
         * there is a LOOP construct with an empty body. 
         */ 
</span>        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1505"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1503"><span class='Ref_to_Parameter'>stmts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1520"></a>        <a href="plpgsql.h.html#LN364"><span class='Ref_to_Struct'>PLpgSQL_stmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN364"><span class='Ref_to_Struct'>PLpgSQL_stmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1505"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1521"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN169"><span class='Ref_to_Proto'>exec_stmt</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1503"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1520"><span class='Ref_To_Local'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1521"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>!= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN1521"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmts &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt            Distribute one statement to the statements 
 *              type specific execution function. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1537"></a><span class='Declare_Function'>exec_stmt</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN364"><span class='Ref_to_Struct'>PLpgSQL_stmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1539"></a>    <a href="plpgsql.h.html#LN364"><span class='Ref_to_Struct'>PLpgSQL_stmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>save_estmt</span><span class='Delimiter'>; 
</span><a name="LN1540"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN1539"><span class='Ref_To_Local'>save_estmt</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Let the plugin know that we are about to execute this statement */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN973"><span class='Ref_to_Member'>stmt_beg</span></a><span class='Parentheses'>)</span> 
        <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN973"><span class='Ref_to_Member'>stmt_beg</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN366"><span class='Ref_to_Member'>cmd_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN84"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_BLOCK</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN165"><span class='Ref_to_Proto'>exec_stmt_block</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN403"><span class='Ref_to_Struct'>PLpgSQL_stmt_block</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN85"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_ASSIGN</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN171"><span class='Ref_to_Proto'>exec_stmt_assign</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN417"><span class='Ref_to_Struct'>PLpgSQL_stmt_assign</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN107"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_PERFORM</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN173"><span class='Ref_to_Proto'>exec_stmt_perform</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN428"><span class='Ref_to_Struct'>PLpgSQL_stmt_perform</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN103"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_GETDIAG</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN175"><span class='Ref_to_Proto'>exec_stmt_getdiag</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN447"><span class='Ref_to_Struct'>PLpgSQL_stmt_getdiag</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN86"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_IF</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN177"><span class='Ref_to_Proto'>exec_stmt_if</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN458"><span class='Ref_to_Struct'>PLpgSQL_stmt_if</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN87"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_CASE</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN179"><span class='Ref_to_Proto'>exec_stmt_case</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN481"><span class='Ref_to_Struct'>PLpgSQL_stmt_case</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN88"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_LOOP</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN181"><span class='Ref_to_Proto'>exec_stmt_loop</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN505"><span class='Ref_to_Struct'>PLpgSQL_stmt_loop</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN89"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_WHILE</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN183"><span class='Ref_to_Proto'>exec_stmt_while</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN516"><span class='Ref_to_Struct'>PLpgSQL_stmt_while</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN90"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_FORI</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN185"><span class='Ref_to_Proto'>exec_stmt_fori</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN528"><span class='Ref_to_Struct'>PLpgSQL_stmt_fori</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN91"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_FORS</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN187"><span class='Ref_to_Proto'>exec_stmt_fors</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN559"><span class='Ref_to_Struct'>PLpgSQL_stmt_fors</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN92"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_FORC</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN189"><span class='Ref_to_Proto'>exec_stmt_forc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN574"><span class='Ref_to_Struct'>PLpgSQL_stmt_forc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN93"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_FOREACH_A</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN191"><span class='Ref_to_Proto'>exec_stmt_foreach_a</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN606"><span class='Ref_to_Struct'>PLpgSQL_stmt_foreach_a</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN94"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_EXIT</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN199"><span class='Ref_to_Proto'>exec_stmt_exit</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN663"><span class='Ref_to_Struct'>PLpgSQL_stmt_exit</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN95"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_RETURN</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN201"><span class='Ref_to_Proto'>exec_stmt_return</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN675"><span class='Ref_to_Struct'>PLpgSQL_stmt_return</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN96"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_RETURN_NEXT</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN203"><span class='Ref_to_Proto'>exec_stmt_return_next</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN686"><span class='Ref_to_Struct'>PLpgSQL_stmt_return_next</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN97"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_RETURN_QUERY</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN205"><span class='Ref_to_Proto'>exec_stmt_return_query</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN697"><span class='Ref_to_Struct'>PLpgSQL_stmt_return_query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN98"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_RAISE</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN207"><span class='Ref_to_Proto'>exec_stmt_raise</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN709"><span class='Ref_to_Struct'>PLpgSQL_stmt_raise</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN99"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_ASSERT</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN209"><span class='Ref_to_Proto'>exec_stmt_assert</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN732"><span class='Ref_to_Struct'>PLpgSQL_stmt_assert</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN100"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_EXECSQL</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN211"><span class='Ref_to_Proto'>exec_stmt_execsql</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN743"><span class='Ref_to_Struct'>PLpgSQL_stmt_execsql</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN101"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_DYNEXECUTE</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN213"><span class='Ref_to_Proto'>exec_stmt_dynexecute</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN759"><span class='Ref_to_Struct'>PLpgSQL_stmt_dynexecute</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN102"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_DYNFORS</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN215"><span class='Ref_to_Proto'>exec_stmt_dynfors</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN590"><span class='Ref_to_Struct'>PLpgSQL_stmt_dynfors</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN104"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_OPEN</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN193"><span class='Ref_to_Proto'>exec_stmt_open</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN620"><span class='Ref_to_Struct'>PLpgSQL_stmt_open</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN105"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_FETCH</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN195"><span class='Ref_to_Proto'>exec_stmt_fetch</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN636"><span class='Ref_to_Struct'>PLpgSQL_stmt_fetch</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN106"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_CLOSE</span></a><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN197"><span class='Ref_to_Proto'>exec_stmt_close</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN653"><span class='Ref_to_Struct'>PLpgSQL_stmt_close</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1539"><span class='Ref_To_Local'>save_estmt</span></a><span class='Delimiter'>; 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized cmdtype: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN366"><span class='Ref_to_Member'>cmd_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch stmt-&GT;cmd_type &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Let the plugin know that we have finished executing this statement */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN974"><span class='Ref_to_Member'>stmt_end</span></a><span class='Parentheses'>)</span> 
        <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN974"><span class='Ref_to_Member'>stmt_end</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN1537"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1539"><span class='Ref_To_Local'>save_estmt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN1540"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_assign         Evaluate an expression and 
 *                  put the result into a variable. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1670"></a><span class='Declare_Function'>exec_stmt_assign</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN417"><span class='Ref_to_Struct'>PLpgSQL_stmt_assign</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1670"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN421"><span class='Ref_to_Member'>varno</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN238"><span class='Ref_to_Proto'>exec_assign_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1670"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1670"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN1670"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN421"><span class='Ref_to_Member'>varno</span></a><span class='Delimiter'>], </span><a href="pl_exec.c.html#LN1670"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN422"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_perform        Evaluate query and discard result (but set 
 *                          FOUND depending on whether at least one row 
 *                          was returned). 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1686"></a><span class='Declare_Function'>exec_stmt_perform</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN428"><span class='Ref_to_Struct'>PLpgSQL_stmt_perform</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1688"></a>    <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1686"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN432"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN265"><span class='Ref_to_Proto'>exec_run_select</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1686"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1688"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN297"><span class='Ref_to_Proto'>exec_set_found</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1686"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1686"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN926"><span class='Ref_to_Member'>eval_processed</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1686"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_getdiag                    Put internal PG information into 
 *                                      specified variables. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1703"></a><span class='Declare_Function'>exec_stmt_getdiag</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN447"><span class='Ref_to_Struct'>PLpgSQL_stmt_getdiag</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1705"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * GET STACKED DIAGNOSTICS is only valid inside an exception handler. 
     * 
     * Note: we trust the grammar to have disallowed the relevant item kinds 
     * if not is_stacked, otherwise we'd dump core below. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN451"><span class='Ref_to_Member'>is_stacked</span></a> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_STACKED_DIAGNOSTICS_ACCESSED_WITHOUT_ACTIVE_HANDLER<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"GET STACKED DIAGNOSTICS cannot be used outside an exception handler"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1705"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN452"><span class='Ref_to_Member'>diag_items</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1720"></a>        <a href="plpgsql.h.html#LN438"><span class='Ref_to_Struct'>PLpgSQL_diag_item</span></a> <span class='Operator'>*</span><span class='Declare_Local'>diag_item</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN438"><span class='Ref_to_Struct'>PLpgSQL_diag_item</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1705"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1721"></a>        <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN1720"><span class='Ref_To_Local'>diag_item</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN441"><span class='Ref_to_Member'>target</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1720"><span class='Ref_To_Local'>diag_item</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN440"><span class='Ref_to_Member'>kind</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN126"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_ROW_COUNT</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN244"><span class='Ref_to_Proto'>exec_assign_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/postgres.h.html#LN651"><span class='Ref_to_Macro'>UInt64GetDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN926"><span class='Ref_to_Member'>eval_processed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN127"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_RESULT_OID</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN244"><span class='Ref_to_Proto'>exec_assign_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN927"><span class='Ref_to_Member'>eval_lastoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN129"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_ERROR_CONTEXT</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN241"><span class='Ref_to_Proto'>exec_assign_c_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN346"><span class='Ref_to_Member'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN130"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_ERROR_DETAIL</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN241"><span class='Ref_to_Proto'>exec_assign_c_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN343"><span class='Ref_to_Member'>detail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN131"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_ERROR_HINT</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN241"><span class='Ref_to_Proto'>exec_assign_c_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN345"><span class='Ref_to_Member'>hint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN132"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_RETURNED_SQLSTATE</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN241"><span class='Ref_to_Proto'>exec_assign_c_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/utils/elog.h.html#LN401"><span class='Ref_to_Proto'>unpack_sql_state</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN133"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_COLUMN_NAME</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN241"><span class='Ref_to_Proto'>exec_assign_c_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN350"><span class='Ref_to_Member'>column_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN134"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_CONSTRAINT_NAME</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN241"><span class='Ref_to_Proto'>exec_assign_c_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN352"><span class='Ref_to_Member'>constraint_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN135"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_DATATYPE_NAME</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN241"><span class='Ref_to_Proto'>exec_assign_c_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN351"><span class='Ref_to_Member'>datatype_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN136"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_MESSAGE_TEXT</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN241"><span class='Ref_to_Proto'>exec_assign_c_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN342"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN137"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_TABLE_NAME</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN241"><span class='Ref_to_Proto'>exec_assign_c_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN349"><span class='Ref_to_Member'>table_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN138"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_SCHEMA_NAME</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN241"><span class='Ref_to_Proto'>exec_assign_c_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN348"><span class='Ref_to_Member'>schema_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN128"><span class='Ref_to_EnumConst'>PLPGSQL_GETDIAG_CONTEXT</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1789"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>contextstackstr</span><span class='Delimiter'>; 
</span><a name="LN1790"></a>                    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Use eval_mcontext for short-lived string */ 
</span>                    <a href="pl_exec.c.html#LN1790"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN1789"><span class='Ref_To_Local'>contextstackstr</span></a> <span class='Operator'>= </span><a href="../../../backend/utils/error/elog.c.html#LN1794"><span class='Ref_to_Func'>GetErrorContextStack</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1790"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="pl_exec.c.html#LN241"><span class='Ref_to_Proto'>exec_assign_c_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1721"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1789"><span class='Ref_To_Local'>contextstackstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized diagnostic item kind: %d"</span><span class='Delimiter'>, 
</span>                     <a href="pl_exec.c.html#LN1720"><span class='Ref_To_Local'>diag_item</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN440"><span class='Ref_to_Member'>kind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch diag_item-&GT;kind &raquo; </span> 
    <span class='Delimiter'>} 
</span> 
    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1703"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_getdiag &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_if             Evaluate a bool expression and 
 *                  execute the true or false body 
 *                  conditionally. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1819"></a><span class='Declare_Function'>exec_stmt_if</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN458"><span class='Ref_to_Struct'>PLpgSQL_stmt_if</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1821"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN1822"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN1823"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN257"><span class='Ref_to_Proto'>exec_eval_boolean</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1819"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1819"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN462"><span class='Ref_to_Member'>cond</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN1822"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1819"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN1822"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>&& </span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1819"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1819"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN463"><span class='Ref_to_Member'>then_body</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1823"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1819"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN464"><span class='Ref_to_Member'>elsif_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1832"></a>        <a href="plpgsql.h.html#LN471"><span class='Ref_to_Struct'>PLpgSQL_if_elsif</span></a> <span class='Operator'>*</span><span class='Declare_Local'>elif</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN471"><span class='Ref_to_Struct'>PLpgSQL_if_elsif</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1823"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN257"><span class='Ref_to_Proto'>exec_eval_boolean</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1819"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1832"><span class='Ref_To_Local'>elif</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN474"><span class='Ref_to_Member'>cond</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN1822"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1819"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN1822"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>&& </span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1819"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1832"><span class='Ref_To_Local'>elif</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN475"><span class='Ref_to_Member'>stmts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1819"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1819"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN465"><span class='Ref_to_Member'>else_body</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_if &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/*----------- 
 * exec_stmt_case 
 *----------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1849"></a><span class='Declare_Function'>exec_stmt_case</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN481"><span class='Ref_to_Struct'>PLpgSQL_stmt_case</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1851"></a>    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>t_var</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1852"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN1853"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN485"><span class='Ref_to_Member'>t_expr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* simple case */ 
</span><a name="LN1858"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>t_val</span><span class='Delimiter'>; 
</span><a name="LN1859"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>t_typoid</span><span class='Delimiter'>; 
</span><a name="LN1860"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>t_typmod</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN1858"><span class='Ref_To_Local'>t_val</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN485"><span class='Ref_to_Member'>t_expr</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="pl_exec.c.html#LN1852"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN1859"><span class='Ref_To_Local'>t_typoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN1860"><span class='Ref_To_Local'>t_typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN1851"><span class='Ref_To_Local'>t_var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN486"><span class='Ref_to_Member'>t_varno</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * When expected datatype is different from real, change it. Note that 
         * what we're modifying here is an execution copy of the datum, so 
         * this doesn't affect the originally stored function parse tree. (In 
         * theory, if the expression datatype keeps changing during execution, 
         * this could cause a function-lifespan memory leak.  Doesn't seem 
         * worth worrying about though.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1851"><span class='Ref_To_Local'>t_var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN1859"><span class='Ref_To_Local'>t_typoid</span></a> <span class='Operator'>|| 
</span>            <a href="pl_exec.c.html#LN1851"><span class='Ref_To_Local'>t_var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN186"><span class='Ref_to_Member'>atttypmod</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN1860"><span class='Ref_To_Local'>t_typmod</span></a><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN1851"><span class='Ref_To_Local'>t_var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1069"><span class='Ref_to_Proto'>plpgsql_build_datatype</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1859"><span class='Ref_To_Local'>t_typoid</span></a><span class='Delimiter'>, 
</span>                                                     <a href="pl_exec.c.html#LN1860"><span class='Ref_To_Local'>t_typmod</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN824"><span class='Ref_to_Member'>fn_input_collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* now we can assign to the variable */ 
</span>        <a href="pl_exec.c.html#LN244"><span class='Ref_to_Proto'>exec_assign_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN1851"><span class='Ref_To_Local'>t_var</span></a><span class='Delimiter'>, 
</span>                          <a href="pl_exec.c.html#LN1858"><span class='Ref_To_Local'>t_val</span></a><span class='Delimiter'>, 
</span>                          <a href="pl_exec.c.html#LN1852"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, 
</span>                          <a href="pl_exec.c.html#LN1859"><span class='Ref_To_Local'>t_typoid</span></a><span class='Delimiter'>, 
</span>                          <a href="pl_exec.c.html#LN1860"><span class='Ref_To_Local'>t_typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;t_expr!=NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Now search for a successful WHEN clause */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1853"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN487"><span class='Ref_to_Member'>case_when_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1895"></a>        <a href="plpgsql.h.html#LN495"><span class='Ref_to_Struct'>PLpgSQL_case_when</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cwt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN495"><span class='Ref_to_Struct'>PLpgSQL_case_when</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1853"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1896"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN257"><span class='Ref_to_Proto'>exec_eval_boolean</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1895"><span class='Ref_To_Local'>cwt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN498"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN1852"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN1852"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>&& </span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Found it */ 
</span> 
            <span class='Comment_Multi_Line'>/* We can now discard any value we had for the temp variable */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1851"><span class='Ref_To_Local'>t_var</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1851"><span class='Ref_To_Local'>t_var</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Evaluate the statement(s), and we're done */ 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1895"><span class='Ref_To_Local'>cwt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN499"><span class='Ref_to_Member'>stmts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* We can now discard any value we had for the temp variable */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1851"><span class='Ref_To_Local'>t_var</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1851"><span class='Ref_To_Local'>t_var</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* SQL2003 mandates this error if there was no ELSE clause */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN488"><span class='Ref_to_Member'>have_else</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CASE_NOT_FOUND<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"case not found"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"CASE statement is missing ELSE part."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Evaluate the ELSE statements, and we're done */ 
</span>    <span class='Control'>return</span> <a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1849"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN489"><span class='Ref_to_Member'>else_stmts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_case &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_loop           Loop over statements until 
 *                  an exit occurs. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1935"></a><span class='Declare_Function'>exec_stmt_loop</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN505"><span class='Ref_to_Struct'>PLpgSQL_stmt_loop</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1939"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN510"><span class='Ref_to_Member'>body</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1939"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN509"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN509"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Control'>return</span> <a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN118"><span class='Ref_to_EnumConst'>PLPGSQL_RC_CONTINUE</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Comment_Multi_Line'>/* anonymous continue, so re-run the loop */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN509"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                         strcmp<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN509"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Comment_Multi_Line'>/* label matches named continue, so re-run loop */ 
</span>                    <a href="pl_exec.c.html#LN1935"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Comment_Multi_Line'>/* label doesn't match named continue, so propagate upward */ 
</span>                    <span class='Control'>return</span> <a href="plpgsql.h.html#LN118"><span class='Ref_to_EnumConst'>PLPGSQL_RC_CONTINUE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="pl_exec.c.html#LN1939"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized rc: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1939"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rc &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_loop &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_while          Loop over statements as long 
 *                  as an expression evaluates to 
 *                  true or an exit occurs. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1986"></a><span class='Declare_Function'>exec_stmt_while</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN516"><span class='Ref_to_Struct'>PLpgSQL_stmt_while</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1990"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span><a name="LN1991"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN1992"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN257"><span class='Ref_to_Proto'>exec_eval_boolean</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN521"><span class='Ref_to_Member'>cond</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN1992"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1992"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>|| !</span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN1990"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN522"><span class='Ref_to_Member'>body</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1990"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN520"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN520"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Control'>return</span> <a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN118"><span class='Ref_to_EnumConst'>PLPGSQL_RC_CONTINUE</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Comment_Multi_Line'>/* anonymous continue, so re-run loop */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN520"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                         strcmp<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN520"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Comment_Multi_Line'>/* label matches named continue, so re-run loop */ 
</span>                    <a href="pl_exec.c.html#LN1986"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Comment_Multi_Line'>/* label doesn't match named continue, propagate upward */ 
</span>                    <span class='Control'>return</span> <a href="plpgsql.h.html#LN118"><span class='Ref_to_EnumConst'>PLPGSQL_RC_CONTINUE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="pl_exec.c.html#LN1990"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized rc: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN1990"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rc &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_while &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_fori           Iterate an integer variable 
 *                  from a lower to an upper value 
 *                  incrementing or decrementing by the BY value 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2049"></a><span class='Declare_Function'>exec_stmt_fori</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN528"><span class='Ref_to_Struct'>PLpgSQL_stmt_fori</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2051"></a>    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN2052"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN2053"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN2054"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>valtype</span><span class='Delimiter'>; 
</span><a name="LN2055"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>valtypmod</span><span class='Delimiter'>; 
</span><a name="LN2056"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>loop_value</span><span class='Delimiter'>; 
</span><a name="LN2057"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>end_value</span><span class='Delimiter'>; 
</span><a name="LN2058"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>step_value</span><span class='Delimiter'>; 
</span><a name="LN2059"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2060"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN2051"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN533"><span class='Ref_to_Member'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN256"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the value of the lower bound 
     */ 
</span>    <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN534"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>, 
</span>                           <span class='Operator'>&</span><a href="pl_exec.c.html#LN2053"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2054"><span class='Ref_To_Local'>valtype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2055"><span class='Ref_To_Local'>valtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN289"><span class='Ref_to_Proto'>exec_cast_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2053"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, 
</span>                            <a href="pl_exec.c.html#LN2054"><span class='Ref_To_Local'>valtype</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2055"><span class='Ref_To_Local'>valtypmod</span></a><span class='Delimiter'>, 
</span>                            <a href="pl_exec.c.html#LN2051"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>, 
</span>                            <a href="pl_exec.c.html#LN2051"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN186"><span class='Ref_to_Member'>atttypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2053"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"lower bound of FOR loop cannot be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN2056"><span class='Ref_To_Local'>loop_value</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the value of the upper bound 
     */ 
</span>    <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN535"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>, 
</span>                           <span class='Operator'>&</span><a href="pl_exec.c.html#LN2053"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2054"><span class='Ref_To_Local'>valtype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2055"><span class='Ref_To_Local'>valtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN289"><span class='Ref_to_Proto'>exec_cast_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2053"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, 
</span>                            <a href="pl_exec.c.html#LN2054"><span class='Ref_To_Local'>valtype</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2055"><span class='Ref_To_Local'>valtypmod</span></a><span class='Delimiter'>, 
</span>                            <a href="pl_exec.c.html#LN2051"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>, 
</span>                            <a href="pl_exec.c.html#LN2051"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN186"><span class='Ref_to_Member'>atttypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2053"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"upper bound of FOR loop cannot be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN2057"><span class='Ref_To_Local'>end_value</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the step value 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN536"><span class='Ref_to_Member'>step</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN536"><span class='Ref_to_Member'>step</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="pl_exec.c.html#LN2053"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2054"><span class='Ref_To_Local'>valtype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2055"><span class='Ref_To_Local'>valtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN289"><span class='Ref_to_Proto'>exec_cast_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2053"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, 
</span>                                <a href="pl_exec.c.html#LN2054"><span class='Ref_To_Local'>valtype</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2055"><span class='Ref_To_Local'>valtypmod</span></a><span class='Delimiter'>, 
</span>                                <a href="pl_exec.c.html#LN2051"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>, 
</span>                                <a href="pl_exec.c.html#LN2051"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN186"><span class='Ref_to_Member'>atttypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2053"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"BY value of FOR loop cannot be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN2058"><span class='Ref_To_Local'>step_value</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2058"><span class='Ref_To_Local'>step_value</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"BY value of FOR loop must be greater than zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pl_exec.c.html#LN2058"><span class='Ref_To_Local'>step_value</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now do the loop 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Check against upper bound 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN537"><span class='Ref_to_Member'>reverse</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2056"><span class='Ref_To_Local'>loop_value</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN2057"><span class='Ref_To_Local'>end_value</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2056"><span class='Ref_To_Local'>loop_value</span></a> <span class='Operator'>&GT; </span><a href="pl_exec.c.html#LN2057"><span class='Ref_To_Local'>end_value</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pl_exec.c.html#LN2059"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* looped at least once */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Assign current value to loop var 
         */ 
</span>        <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2051"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2056"><span class='Ref_To_Local'>loop_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Execute the statements 
         */ 
</span>        <a href="pl_exec.c.html#LN2060"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN538"><span class='Ref_to_Member'>body</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2060"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* break out of the loop */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2060"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Comment_Multi_Line'>/* unlabelled exit, finish the current loop */ 
</span>                <a href="pl_exec.c.html#LN2060"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN532"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                     strcmp<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN532"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* labelled exit, matches the current stmt's label */ 
</span>                <a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN2060"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * otherwise, this is a labelled exit that does not match the 
             * current statement's label, if any: return RC_EXIT so that the 
             * EXIT continues to propagate up the stack. 
             */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rc==PLPGSQL_RC_EXIT &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2060"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN118"><span class='Ref_to_EnumConst'>PLPGSQL_RC_CONTINUE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Comment_Multi_Line'>/* unlabelled continue, so re-run the current loop */ 
</span>                <a href="pl_exec.c.html#LN2060"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN532"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                     strcmp<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN532"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* label matches named continue, so re-run loop */ 
</span>                <a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN2060"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * otherwise, this is a named continue that does not match the 
                 * current statement's label, if any: return RC_CONTINUE so 
                 * that the CONTINUE will propagate up the stack. 
                 */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rc==PLPGSQL_RC_CONTIN... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Increase/decrease loop value, unless it would overflow, in which 
         * case exit the loop. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN537"><span class='Ref_to_Member'>reverse</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN2056"><span class='Ref_To_Local'>loop_value</span></a> <span class='Operator'>- </span><a href="pl_exec.c.html#LN2058"><span class='Ref_To_Local'>step_value</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="pl_exec.c.html#LN2056"><span class='Ref_To_Local'>loop_value</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN2056"><span class='Ref_To_Local'>loop_value</span></a> <span class='Operator'>-= </span><a href="pl_exec.c.html#LN2058"><span class='Ref_To_Local'>step_value</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN2056"><span class='Ref_To_Local'>loop_value</span></a> <span class='Operator'>+ </span><a href="pl_exec.c.html#LN2058"><span class='Ref_To_Local'>step_value</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN2056"><span class='Ref_To_Local'>loop_value</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN2056"><span class='Ref_To_Local'>loop_value</span></a> <span class='Operator'>+= </span><a href="pl_exec.c.html#LN2058"><span class='Ref_To_Local'>step_value</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Set the FOUND variable to indicate the result of executing the loop 
     * (namely, whether we looped one or more times). This must be set here so 
     * that it does not interfere with the value of the FOUND variable inside 
     * the loop processing itself. 
     */ 
</span>    <a href="pl_exec.c.html#LN297"><span class='Ref_to_Proto'>exec_set_found</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2049"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2059"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN2060"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_fori &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_fors           Execute a query, assign each 
 *                  tuple to a record or row and 
 *                  execute a group of statements 
 *                  for it. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2235"></a><span class='Declare_Function'>exec_stmt_fors</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN559"><span class='Ref_to_Struct'>PLpgSQL_stmt_fors</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2237"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN2238"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open the implicit cursor for the statement using exec_run_select 
     */ 
</span>    <a href="pl_exec.c.html#LN265"><span class='Ref_to_Proto'>exec_run_select</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2235"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2235"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN568"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2237"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Execute the loop 
     */ 
</span>    <a href="pl_exec.c.html#LN2238"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN267"><span class='Ref_to_Proto'>exec_for_query</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2235"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN546"><span class='Ref_to_Struct'>PLpgSQL_stmt_forq</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN2235"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2237"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close the implicit cursor 
     */ 
</span>    <a href="../../../include/executor/spi.h.html#LN152"><span class='Ref_to_Proto'>SPI_cursor_close</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2237"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN2238"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_fors &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_forc           Execute a loop for each row from a cursor. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2264"></a><span class='Declare_Function'>exec_stmt_forc</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN574"><span class='Ref_to_Struct'>PLpgSQL_stmt_forc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2266"></a>    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>curvar</span><span class='Delimiter'>; 
</span><a name="LN2267"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>stmt_mcontext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2268"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>curname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2269"></a>    <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN2270"></a>    <a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span><a name="LN2271"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN2272"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ---------- 
     * Get the cursor variable and if it has an assigned name, check 
     * that it's not in use currently. 
     * ---------- 
     */ 
</span>    <a href="pl_exec.c.html#LN2266"><span class='Ref_To_Local'>curvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN583"><span class='Ref_to_Member'>curvar</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN2266"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2282"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We only need stmt_mcontext to hold the cursor name string */ 
</span>        <a href="pl_exec.c.html#LN2267"><span class='Ref_To_Local'>stmt_mcontext</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN161"><span class='Ref_to_Proto'>get_stmt_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN2282"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2267"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN2268"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2266"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2282"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/executor/spi.h.html#LN147"><span class='Ref_to_Proto'>SPI_cursor_find</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2268"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_CURSOR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cursor \"%s\" already in use"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2268"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* ---------- 
     * Open the cursor just like an OPEN command 
     * 
     * Note: parser should already have checked that statement supplies 
     * args iff cursor needs them, but we check again to be safe. 
     * ---------- 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN584"><span class='Ref_to_Member'>argquery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* ---------- 
         * OPEN CURSOR with args.  We fake a SELECT ... INTO ... 
         * statement to evaluate the args and put 'em into the 
         * internal row. 
         * ---------- 
         */ 
</span><a name="LN2311"></a>        <a href="plpgsql.h.html#LN743"><span class='Ref_to_Struct'>PLpgSQL_stmt_execsql</span></a> <span class='Declare_Local'>set_args</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2266"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN265"><span class='Ref_to_Member'>cursor_explicit_argrow</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"arguments given for cursor without arguments"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2311"><span class='Ref_To_Local'>set_args</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2311"><span class='Ref_To_Local'>set_args</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN2311"><span class='Ref_To_Local'>set_args</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN745"><span class='Ref_to_Member'>cmd_type</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN100"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_EXECSQL</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN2311"><span class='Ref_To_Local'>set_args</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN746"><span class='Ref_to_Member'>lineno</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN577"><span class='Ref_to_Member'>lineno</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN2311"><span class='Ref_To_Local'>set_args</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN747"><span class='Ref_to_Member'>sqlstmt</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN584"><span class='Ref_to_Member'>argquery</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN2311"><span class='Ref_To_Local'>set_args</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN750"><span class='Ref_to_Member'>into</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* XXX historically this has not been STRICT */ 
</span>        <a href="pl_exec.c.html#LN2311"><span class='Ref_To_Local'>set_args</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN753"><span class='Ref_to_Member'>row</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN2266"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN265"><span class='Ref_to_Member'>cursor_explicit_argrow</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN211"><span class='Ref_to_Proto'>exec_stmt_execsql</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2311"><span class='Ref_To_Local'>set_args</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Parentheses'>)</span> 
            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"open cursor failed during argument processing"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;argquery!=NULL &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2266"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN265"><span class='Ref_to_Member'>cursor_explicit_argrow</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"arguments required for cursor"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pl_exec.c.html#LN2269"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2266"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN264"><span class='Ref_to_Member'>cursor_explicit_expr</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2269"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2269"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN224"><span class='Ref_to_Proto'>exec_prepare_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2269"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2266"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN266"><span class='Ref_to_Member'>cursor_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up short-lived ParamListInfo 
     */ 
</span>    <a href="pl_exec.c.html#LN2270"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN271"><span class='Ref_to_Proto'>setup_unshared_param_list</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2269"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open the cursor (the paramlist will get copied into the portal) 
     */ 
</span>    <a href="pl_exec.c.html#LN2271"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN145"><span class='Ref_to_Proto'>SPI_cursor_open_with_paramlist</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2268"><span class='Ref_To_Local'>curname</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2269"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN2270"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2271"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not open cursor: %s"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/executor/spi.h.html#LN114"><span class='Ref_to_Proto'>SPI_result_code_string</span></a><span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If cursor variable was NULL, store the generated portal name in it 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2268"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2266"><span class='Ref_To_Local'>curvar</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2271"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/portal.h.html#LN116"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clean up before entering exec_for_query 
     */ 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2267"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2267"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Execute the loop.  We can't prefetch because the cursor is accessible 
     * to the user, for instance via UPDATE WHERE CURRENT OF within the loop. 
     */ 
</span>    <a href="pl_exec.c.html#LN2272"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN267"><span class='Ref_to_Proto'>exec_for_query</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN546"><span class='Ref_to_Struct'>PLpgSQL_stmt_forq</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2271"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ---------- 
     * Close portal, and restore cursor variable if it was initially NULL. 
     * ---------- 
     */ 
</span>    <a href="../../../include/executor/spi.h.html#LN152"><span class='Ref_to_Proto'>SPI_cursor_close</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2271"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2268"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2264"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2266"><span class='Ref_To_Local'>curvar</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN2272"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_forc &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_foreach_a          Loop over elements or slices of an array 
 * 
 * When looping over elements, the loop variable is the same type that the 
 * array stores (eg: integer), when looping through slices, the loop variable 
 * is an array of size and dimensions to match the size of the slice. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2400"></a><span class='Declare_Function'>exec_stmt_foreach_a</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN606"><span class='Ref_to_Struct'>PLpgSQL_stmt_foreach_a</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2402"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arr</span><span class='Delimiter'>; 
</span><a name="LN2403"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>arrtype</span><span class='Delimiter'>; 
</span><a name="LN2404"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>arrtypmod</span><span class='Delimiter'>; 
</span><a name="LN2405"></a>    <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>loop_var</span><span class='Delimiter'>; 
</span><a name="LN2406"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>loop_var_elem_type</span><span class='Delimiter'>; 
</span><a name="LN2407"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2408"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span><a name="LN2409"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>stmt_mcontext</span><span class='Delimiter'>; 
</span><a name="LN2410"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN2411"></a>    <a href="../../../include/utils/array.h.html#LN238"><span class='Ref_to_Typedef'>ArrayIterator</span></a> <span class='Declare_Local'>array_iterator</span><span class='Delimiter'>; 
</span><a name="LN2412"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>iterator_result_type</span><span class='Delimiter'>; 
</span><a name="LN2413"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>iterator_result_typmod</span><span class='Delimiter'>; 
</span><a name="LN2414"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN2415"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* get the value of the array expression */ 
</span>    <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN613"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2415"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2403"><span class='Ref_To_Local'>arrtype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2404"><span class='Ref_To_Local'>arrtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2415"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"FOREACH expression must not be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do as much as possible of the code below in stmt_mcontext, to avoid any 
     * leaks from called subroutines.  We need a private stmt_mcontext since 
     * we'll be calling arbitrary statement code. 
     */ 
</span>    <a href="pl_exec.c.html#LN2409"><span class='Ref_To_Local'>stmt_mcontext</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN161"><span class='Ref_to_Proto'>get_stmt_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN162"><span class='Ref_to_Proto'>push_stmt_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN2410"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2409"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check the type of the expression - must be an array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN157"><span class='Ref_to_Proto'>get_element_type</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2403"><span class='Ref_To_Local'>arrtype</span></a><span class='Parentheses'>)))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"FOREACH expression must yield an array, not type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../../backend/utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2403"><span class='Ref_To_Local'>arrtype</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must copy the array into stmt_mcontext, else it will disappear in 
     * exec_eval_cleanup.  This is annoying, but cleanup will certainly happen 
     * while running the loop body, so we have little choice. 
     */ 
</span>    <a href="pl_exec.c.html#LN2402"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN242"><span class='Ref_to_Macro'>DatumGetArrayTypePCopy</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up any leftover temporary memory */ 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Slice dimension must be less than or equal to array dimension */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN612"><span class='Ref_to_Member'>slice</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN612"><span class='Ref_to_Member'>slice</span></a> <span class='Operator'>&GT; </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2402"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"slice dimension (%d) is out of the valid range 0..%d"</span><span class='Delimiter'>, 
</span>                      <a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN612"><span class='Ref_to_Member'>slice</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2402"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up the loop variable and see if it is of an array type */ 
</span>    <a href="pl_exec.c.html#LN2405"><span class='Ref_To_Local'>loop_var</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN611"><span class='Ref_to_Member'>varno</span></a><span class='Delimiter'>]; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2405"><span class='Ref_To_Local'>loop_var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN2405"><span class='Ref_To_Local'>loop_var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Record/row variable is certainly not of array type, and might not 
         * be initialized at all yet, so don't try to get its type 
         */ 
</span>        <a href="pl_exec.c.html#LN2406"><span class='Ref_To_Local'>loop_var_elem_type</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pl_exec.c.html#LN2406"><span class='Ref_To_Local'>loop_var_elem_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN157"><span class='Ref_to_Proto'>get_element_type</span></a><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN1101"><span class='Ref_to_Proto'>plpgsql_exec_get_datum_type</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                                                  <a href="pl_exec.c.html#LN2405"><span class='Ref_To_Local'>loop_var</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Sanity-check the loop variable type.  We don't try very hard here, and 
     * should not be too picky since it's possible that exec_assign_value can 
     * coerce values of different types.  But it seems worthwhile to complain 
     * if the array-ness of the loop variable is not right. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN612"><span class='Ref_to_Member'>slice</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN2406"><span class='Ref_To_Local'>loop_var_elem_type</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"FOREACH ... SLICE loop variable must be of an array type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN612"><span class='Ref_to_Member'>slice</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN2406"><span class='Ref_To_Local'>loop_var_elem_type</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"FOREACH loop variable must not be of an array type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create an iterator to step through the array */ 
</span>    <a href="pl_exec.c.html#LN2411"><span class='Ref_To_Local'>array_iterator</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN417"><span class='Ref_to_Proto'>array_create_iterator</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2402"><span class='Ref_To_Local'>arr</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN612"><span class='Ref_to_Member'>slice</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify iterator result type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN612"><span class='Ref_to_Member'>slice</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* When slicing, nominal type of result is same as array type */ 
</span>        <a href="pl_exec.c.html#LN2412"><span class='Ref_To_Local'>iterator_result_type</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2403"><span class='Ref_To_Local'>arrtype</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN2413"><span class='Ref_To_Local'>iterator_result_typmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2404"><span class='Ref_To_Local'>arrtypmod</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Without slicing, results are individual array elements */ 
</span>        <a href="pl_exec.c.html#LN2412"><span class='Ref_To_Local'>iterator_result_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2402"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN2413"><span class='Ref_To_Local'>iterator_result_typmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2404"><span class='Ref_To_Local'>arrtypmod</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Iterate over the array elements or slices */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN418"><span class='Ref_to_Proto'>array_iterate</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2411"><span class='Ref_To_Local'>array_iterator</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2415"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN2407"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* looped at least once */ 
</span> 
        <span class='Comment_Multi_Line'>/* exec_assign_value and exec_stmts must run in the main context */ 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2410"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Assign current element/slice to the loop variable */ 
</span>        <a href="pl_exec.c.html#LN244"><span class='Ref_to_Proto'>exec_assign_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2405"><span class='Ref_To_Local'>loop_var</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2415"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, 
</span>                          <a href="pl_exec.c.html#LN2412"><span class='Ref_To_Local'>iterator_result_type</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2413"><span class='Ref_To_Local'>iterator_result_typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* In slice case, value is temporary; must free it to avoid leakage */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN612"><span class='Ref_to_Member'>slice</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Execute the statements 
         */ 
</span>        <a href="pl_exec.c.html#LN2408"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN614"><span class='Ref_to_Member'>body</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Handle the return code */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2408"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* break out of the loop */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2408"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Comment_Multi_Line'>/* unlabelled exit, finish the current loop */ 
</span>                <a href="pl_exec.c.html#LN2408"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN610"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                     strcmp<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN610"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* labelled exit, matches the current stmt's label */ 
</span>                <a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN2408"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * otherwise, this is a labelled exit that does not match the 
             * current statement's label, if any: return RC_EXIT so that the 
             * EXIT continues to propagate up the stack. 
             */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rc==PLPGSQL_RC_EXIT &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2408"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN118"><span class='Ref_to_EnumConst'>PLPGSQL_RC_CONTINUE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Comment_Multi_Line'>/* unlabelled continue, so re-run the current loop */ 
</span>                <a href="pl_exec.c.html#LN2408"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN610"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                     strcmp<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN610"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* label matches named continue, so re-run loop */ 
</span>                <a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN2408"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * otherwise, this is a named continue that does not match the 
                 * current statement's label, if any: return RC_CONTINUE so 
                 * that the CONTINUE will propagate up the stack. 
                 */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rc==PLPGSQL_RC_CONTIN... &raquo; </span> 
 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2409"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while array_iterate(array_i... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Restore memory context state */ 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2410"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN163"><span class='Ref_to_Proto'>pop_stmt_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release temporary memory, including the array value */ 
</span>    <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2409"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set the FOUND variable to indicate the result of executing the loop 
     * (namely, whether we looped one or more times). This must be set here so 
     * that it does not interfere with the value of the FOUND variable inside 
     * the loop processing itself. 
     */ 
</span>    <a href="pl_exec.c.html#LN297"><span class='Ref_to_Proto'>exec_set_found</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2400"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2407"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN2408"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_foreach_a &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_exit           Implements EXIT and CONTINUE 
 * 
 * This begins the process of exiting / restarting a loop. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2600"></a><span class='Declare_Function'>exec_stmt_exit</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN663"><span class='Ref_to_Struct'>PLpgSQL_stmt_exit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * If the exit / continue has a condition, evaluate it 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2600"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN669"><span class='Ref_to_Member'>cond</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2607"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN2608"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN257"><span class='Ref_to_Proto'>exec_eval_boolean</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2600"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2600"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN669"><span class='Ref_to_Member'>cond</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2608"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2600"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2608"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>|| </span><span class='Keyword'>value </span><span class='Operator'>== </span><span class='Boolean'>false</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pl_exec.c.html#LN2600"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2600"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN668"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2600"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN667"><span class='Ref_to_Member'>is_exit</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="plpgsql.h.html#LN118"><span class='Ref_to_EnumConst'>PLPGSQL_RC_CONTINUE</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_exit &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_return         Evaluate an expression and start 
 *                  returning from the function. 
 * 
 * Note: in the retistuple code paths, the returned tuple is always in the 
 * function's main context, whereas for non-tuple data types the result may 
 * be in the eval_mcontext.  The former case is not a memory leak since we're 
 * about to exit the function anyway.  (If you want to change it, note that 
 * exec_stmt_block() knows about this behavior.)  The latter case means that 
 * we must not do exec_eval_cleanup while unwinding the control stack. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2637"></a><span class='Declare_Function'>exec_stmt_return</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN675"><span class='Ref_to_Struct'>PLpgSQL_stmt_return</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * If processing a set-returning PL/pgSQL function, the final RETURN 
     * indicates that the function is finished producing tuples.  The rest of 
     * the work will be done at the top level. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN890"><span class='Ref_to_Member'>retisset</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* initialize for null result (possibly a tuple) */ 
</span>    <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN886"><span class='Ref_to_Member'>rettype</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Special case path when the RETURN expression is a simple variable 
     * reference; in particular, this path is always taken in functions with 
     * one or more OUT parameters. 
     * 
     * This special case is especially efficient for returning variables that 
     * have R/W expanded values: we can put the R/W pointer directly into 
     * estate-&GT;retval, leading to transferring the value to the caller's 
     * context cheaply.  If we went through exec_eval_expr we'd end up with a 
     * R/O pointer.  It's okay to skip MakeExpandedObjectReadOnly here since 
     * we know we won't need the variable's value within the function anymore. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN680"><span class='Ref_to_Member'>retvarno</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2667"></a>        <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>retvar</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN680"><span class='Ref_to_Member'>retvarno</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2667"><span class='Ref_To_Local'>retvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2673"></a>                    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN2667"><span class='Ref_To_Local'>retvar</span></a><span class='Delimiter'>; 
</span> 
                    <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2673"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2673"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN886"><span class='Ref_to_Member'>rettype</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2673"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Cope with retistuple case.  A PLpgSQL_var could not be 
                     * of composite type, so we needn't make any effort to 
                     * convert.  However, for consistency with the expression 
                     * code path, don't throw error if the result is NULL. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN889"><span class='Ref_to_Member'>retistuple</span></a> <span class='Operator'>&& !</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a><span class='Parentheses'>) 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot return non-composite value from function returning composite type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2694"></a>                    <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN2667"><span class='Ref_To_Local'>retvar</span></a><span class='Delimiter'>; 
</span><a name="LN2695"></a>                    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>rettypmod</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2694"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN889"><span class='Ref_to_Member'>retistuple</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2694"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2694"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>; 
</span>                            <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                            <a href="pl_exec.c.html#LN248"><span class='Ref_to_Proto'>exec_eval_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN2667"><span class='Ref_To_Local'>retvar</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN886"><span class='Ref_to_Member'>rettype</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="pl_exec.c.html#LN2695"><span class='Ref_To_Local'>rettypmod</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2718"></a>                    <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN2667"><span class='Ref_To_Local'>retvar</span></a><span class='Delimiter'>; 
</span><a name="LN2719"></a>                    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>rettypmod</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN889"><span class='Ref_to_Member'>retistuple</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN2723"></a>                        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN2718"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* should not happen */ 
</span>                            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"row variable has no tupdesc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pl_exec.c.html#LN2723"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN278"><span class='Ref_to_Proto'>make_tuple_from_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2718"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2718"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2723"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>        <span class='Comment_Single_Line'>/* should not happen */ 
</span>                            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"row not compatible with its own tupdesc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2723"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2718"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Delimiter'>; 
</span>                        <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="pl_exec.c.html#LN248"><span class='Ref_to_Proto'>exec_eval_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                        <a href="pl_exec.c.html#LN2667"><span class='Ref_To_Local'>retvar</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN886"><span class='Ref_to_Member'>rettype</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN2719"><span class='Ref_To_Local'>rettypmod</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized dtype: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2667"><span class='Ref_To_Local'>retvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch retvar-&GT;dtype &raquo; </span> 
 
        <span class='Control'>return</span> <a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;retvarno&GT;=0 &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN679"><span class='Ref_to_Member'>expr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2753"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>rettypmod</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN679"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN886"><span class='Ref_to_Member'>rettype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN2753"><span class='Ref_To_Local'>rettypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN889"><span class='Ref_to_Member'>retistuple</span></a> <span class='Operator'>&& !</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Convert composite datum to a HeapTuple and TupleDesc */ 
</span><a name="LN2763"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2764"></a>            <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Source must be of RECORD or composite type */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/lsyscache.h.html#LN150"><span class='Ref_to_Proto'>type_is_rowtype</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN886"><span class='Ref_to_Member'>rettype</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot return non-composite value from function returning composite type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN2763"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN281"><span class='Ref_to_Proto'>get_tuple_from_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN2764"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN282"><span class='Ref_to_Proto'>get_tupdesc_from_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2763"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2764"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/access/tupdesc.h.html#LN106"><span class='Ref_to_Macro'>ReleaseTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2764"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>return</span> <a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;expr!=NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Special hack for function returning VOID: instead of NULL, return a 
     * non-null VOID value.  This is of dubious importance but is kept for 
     * backwards compatibility. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN888"><span class='Ref_to_Member'>fn_rettype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN2637"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN886"><span class='Ref_to_Member'>rettype</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN117"><span class='Ref_to_EnumConst'>PLPGSQL_RC_RETURN</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_return &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_return_next        Evaluate an expression and add it to the 
 *                              list of tuples returned by the current 
 *                              SRF. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2803"></a><span class='Declare_Function'>exec_stmt_return_next</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN2804"></a>                      <a href="plpgsql.h.html#LN686"><span class='Ref_to_Struct'>PLpgSQL_stmt_return_next</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2806"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN2807"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span><span class='Delimiter'>; 
</span><a name="LN2808"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2809"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN890"><span class='Ref_to_Member'>retisset</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use RETURN NEXT in a non-SETOF function"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN296"><span class='Ref_to_Proto'>exec_init_tuple_store</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* rettupdesc will be filled by exec_init_tuple_store */ 
</span>    <a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN2807"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Special case path when the RETURN NEXT expression is a simple variable 
     * reference; in particular, this path is always taken in functions with 
     * one or more OUT parameters. 
     * 
     * Unlike exec_statement_return, there's no special win here for R/W 
     * expanded values, since they'll have to get flattened to go into the 
     * tuplestore.  Indeed, we'd better make them R/O to avoid any risk of the 
     * casting step changing them in-place. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2804"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN691"><span class='Ref_to_Member'>retvarno</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2835"></a>        <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>retvar</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN2804"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN691"><span class='Ref_to_Member'>retvarno</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2835"><span class='Ref_To_Local'>retvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2841"></a>                    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN2835"><span class='Ref_To_Local'>retvar</span></a><span class='Delimiter'>; 
</span><a name="LN2842"></a>                    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>retval</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2841"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span><a name="LN2843"></a>                    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2841"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2807"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong result type supplied in RETURN NEXT"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* let's be very paranoid about the cast step */ 
</span>                    <a href="pl_exec.c.html#LN2842"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/expandeddatum.h.html#LN143"><span class='Ref_to_Macro'>MakeExpandedObjectReadOnly</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2842"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, 
</span>                                                        <a href="pl_exec.c.html#LN2843"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>, 
</span>                                                      <a href="pl_exec.c.html#LN2841"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN180"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* coerce type if needed */ 
</span>                    <a href="pl_exec.c.html#LN2842"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN289"><span class='Ref_to_Proto'>exec_cast_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                             <a href="pl_exec.c.html#LN2842"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="pl_exec.c.html#LN2843"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>, 
</span>                                             <a href="pl_exec.c.html#LN2841"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>, 
</span>                                             <a href="pl_exec.c.html#LN2841"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN186"><span class='Ref_to_Member'>atttypmod</span></a><span class='Delimiter'>, 
</span>                                             <a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                             <a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="../../../include/utils/tuplestore.h.html#LN55"><span class='Ref_to_Proto'>tuplestore_putvalues</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                         <span class='Operator'>&</span><a href="pl_exec.c.html#LN2842"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2843"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2871"></a>                    <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN2835"><span class='Ref_To_Local'>retvar</span></a><span class='Delimiter'>; 
</span><a name="LN2872"></a>                    <a href="../../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tupmap</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2871"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" is not assigned yet"</span><span class='Delimiter'>, 
</span>                                  <a href="pl_exec.c.html#LN2871"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../../backend/utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The tuple structure of a not-yet-assigned"</span> 
                                  <span class='String'>" record is indeterminate."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Use eval_mcontext for tuple conversion work */ 
</span>                    <a href="pl_exec.c.html#LN2809"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN2872"><span class='Ref_To_Local'>tupmap</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupconvert.h.html#LN32"><span class='Ref_to_Proto'>convert_tuples_by_position</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2871"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                                        <a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                                        <a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"wrong record type supplied in RETURN NEXT"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN2808"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN2871"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2872"><span class='Ref_To_Local'>tupmap</span></a><span class='Parentheses'>) 
</span>                        <a href="pl_exec.c.html#LN2808"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupconvert.h.html#LN44"><span class='Ref_to_Proto'>do_convert_tuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2808"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2872"><span class='Ref_To_Local'>tupmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2808"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2809"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2897"></a>                    <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN2835"><span class='Ref_To_Local'>retvar</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Use eval_mcontext for tuple conversion work */ 
</span>                    <a href="pl_exec.c.html#LN2809"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN2808"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN278"><span class='Ref_to_Proto'>make_tuple_from_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2897"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2808"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong record type supplied in RETURN NEXT"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2808"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2809"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized dtype: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2835"><span class='Ref_To_Local'>retvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch retvar-&GT;dtype &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;retvarno&GT;=0 &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2804"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN690"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2918"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span><a name="LN2919"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN2920"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>rettype</span><span class='Delimiter'>; 
</span><a name="LN2921"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>rettypmod</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN2918"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                <a href="pl_exec.c.html#LN2804"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN690"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="pl_exec.c.html#LN2919"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="pl_exec.c.html#LN2920"><span class='Ref_To_Local'>rettype</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="pl_exec.c.html#LN2921"><span class='Ref_To_Local'>rettypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN889"><span class='Ref_to_Member'>retistuple</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Expression should be of RECORD or composite type */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN2919"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2934"></a>                <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>retvaldesc</span><span class='Delimiter'>; 
</span><a name="LN2935"></a>                <a href="../../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tupmap</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/lsyscache.h.html#LN150"><span class='Ref_to_Proto'>type_is_rowtype</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2920"><span class='Ref_To_Local'>rettype</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot return non-composite value from function returning composite type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Use eval_mcontext for tuple conversion work */ 
</span>                <a href="pl_exec.c.html#LN2809"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN2808"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN281"><span class='Ref_to_Proto'>get_tuple_from_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2918"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN2934"><span class='Ref_To_Local'>retvaldesc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN282"><span class='Ref_to_Proto'>get_tupdesc_from_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2918"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN2935"><span class='Ref_To_Local'>tupmap</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupconvert.h.html#LN32"><span class='Ref_to_Proto'>convert_tuples_by_position</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2934"><span class='Ref_To_Local'>retvaldesc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"returned record type does not match expected record type"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2935"><span class='Ref_To_Local'>tupmap</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_exec.c.html#LN2808"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupconvert.h.html#LN44"><span class='Ref_to_Proto'>do_convert_tuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2808"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2935"><span class='Ref_To_Local'>tupmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2808"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/access/tupdesc.h.html#LN106"><span class='Ref_to_Macro'>ReleaseTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2934"><span class='Ref_To_Local'>retvaldesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2809"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !isNull &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Composite NULL --- store a row of nulls */ 
</span><a name="LN2957"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>nulldatums</span><span class='Delimiter'>; 
</span><a name="LN2958"></a>                <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nullflags</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN2957"><span class='Ref_To_Local'>nulldatums</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                    <a href="pl_exec.c.html#LN117"><span class='Ref_to_Macro'>eval_mcontext_alloc0</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2807"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN2958"><span class='Ref_To_Local'>nullflags</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) 
</span>                    <a href="pl_exec.c.html#LN115"><span class='Ref_to_Macro'>eval_mcontext_alloc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2807"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                memset<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2958"><span class='Ref_To_Local'>nullflags</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2807"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../../include/utils/tuplestore.h.html#LN55"><span class='Ref_to_Proto'>tuplestore_putvalues</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN2957"><span class='Ref_To_Local'>nulldatums</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2958"><span class='Ref_To_Local'>nullflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if estate-&GT;retistuple &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Simple scalar result */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2807"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong result type supplied in RETURN NEXT"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* coerce type if needed */ 
</span>            <a href="pl_exec.c.html#LN2918"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN289"><span class='Ref_to_Proto'>exec_cast_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN2918"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="pl_exec.c.html#LN2919"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN2920"><span class='Ref_To_Local'>rettype</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN2921"><span class='Ref_To_Local'>rettypmod</span></a><span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                     <a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/tuplestore.h.html#LN55"><span class='Ref_to_Proto'>tuplestore_putvalues</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN2806"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="pl_exec.c.html#LN2918"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN2919"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;expr &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"RETURN NEXT must have a parameter"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN2803"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_return_next &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_return_query       Evaluate a query and add it to the 
 *                              list of tuples returned by the current 
 *                              SRF. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3009"></a><span class='Declare_Function'>exec_stmt_return_query</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN3010"></a>                       <a href="plpgsql.h.html#LN697"><span class='Ref_to_Struct'>PLpgSQL_stmt_return_query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3012"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN3013"></a>    <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>processed</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN3014"></a>    <a href="../../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tupmap</span><span class='Delimiter'>; 
</span><a name="LN3015"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN890"><span class='Ref_to_Member'>retisset</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use RETURN QUERY in a non-SETOF function"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN296"><span class='Ref_to_Proto'>exec_init_tuple_store</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3010"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN701"><span class='Ref_to_Member'>query</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* static query */ 
</span>        <a href="pl_exec.c.html#LN265"><span class='Ref_to_Proto'>exec_run_select</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3010"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN701"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3012"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* RETURN QUERY EXECUTE */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3010"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN702"><span class='Ref_to_Member'>dynquery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3012"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN306"><span class='Ref_to_Proto'>exec_dynquery_with_params</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3010"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN702"><span class='Ref_to_Member'>dynquery</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN3010"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN703"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Use eval_mcontext for tuple conversion work */ 
</span>    <a href="pl_exec.c.html#LN3015"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3014"><span class='Ref_To_Local'>tupmap</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupconvert.h.html#LN32"><span class='Ref_to_Proto'>convert_tuples_by_position</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3012"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a><span class='Delimiter'>, 
</span>                                        <a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a><span class='Delimiter'>, 
</span>     <a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"structure of query does not match function result type"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3048"></a>        <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/executor/spi.h.html#LN148"><span class='Ref_to_Proto'>SPI_cursor_fetch</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3012"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>50</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* SPI will have changed CurrentMemoryContext */ 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3048"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN3048"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN3048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3060"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN3048"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3014"><span class='Ref_To_Local'>tupmap</span></a><span class='Parentheses'>) 
</span>                <a href="pl_exec.c.html#LN3060"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupconvert.h.html#LN44"><span class='Ref_to_Proto'>do_convert_tuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3060"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3014"><span class='Ref_To_Local'>tupmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3060"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3014"><span class='Ref_To_Local'>tupmap</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3060"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN3013"><span class='Ref_To_Local'>processed</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while true &raquo; </span> 
 
    <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/executor/spi.h.html#LN152"><span class='Ref_to_Proto'>SPI_cursor_close</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3012"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3015"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN926"><span class='Ref_to_Member'>eval_processed</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3013"><span class='Ref_To_Local'>processed</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN297"><span class='Ref_to_Proto'>exec_set_found</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3009"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3013"><span class='Ref_To_Local'>processed</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_return_query &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3086"></a><span class='Declare_Function'>exec_init_tuple_store</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3088"></a>    <a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsi</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3086"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN902"><span class='Ref_to_Member'>rsi</span></a><span class='Delimiter'>; 
</span><a name="LN3089"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN3090"></a>    <a href="../../../include/utils/resowner.h.html#LN26"><span class='Ref_to_Typedef'>ResourceOwner</span></a> <span class='Declare_Local'>oldowner</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check caller can handle a set result in the way we want 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN3088"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>|| !</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3088"><span class='Ref_To_Local'>rsi</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3088"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN3088"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN266"><span class='Ref_to_Member'>expectedDesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Switch to the right memory context and resource owner for storing the 
     * tuplestore for return set. If we're within a subtransaction opened for 
     * an exception-block, for example, we must still create the tuplestore in 
     * the resource owner that was active when this function was entered, and 
     * not in the subtransaction resource owner. 
     */ 
</span>    <a href="pl_exec.c.html#LN3089"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3086"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN900"><span class='Ref_to_Member'>tuple_store_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3090"><span class='Ref_To_Local'>oldowner</span></a> <span class='Operator'>= </span><a href="../../../backend/utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>; 
</span>    <a href="../../../backend/utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3086"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN901"><span class='Ref_to_Member'>tuple_store_owner</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3086"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a> <span class='Operator'>= 
</span>        <a href="../../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3088"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN251"><span class='Ref_to_EnumConst'>SFRM_Materialize_Random</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../../../backend/utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../backend/utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3090"><span class='Ref_To_Local'>oldowner</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3089"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3086"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3088"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN266"><span class='Ref_to_Member'>expectedDesc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_init_tuple_store &raquo; </span> 
 
<a name="LN3123"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SET_RAISE_OPTION_TEXT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>opt</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3123"><span class='Ref_to_Parameter'>opt</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"RAISE option already specified: %s"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                        <a href="pl_exec.c.html#LN3123"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <a href="pl_exec.c.html#LN3123"><span class='Ref_to_Parameter'>opt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span>stmt_mcontext<span class='Delimiter'>, </span>extval<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_raise          Build a message and throw it with elog() 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3138"></a><span class='Declare_Function'>exec_stmt_raise</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN709"><span class='Ref_to_Struct'>PLpgSQL_stmt_raise</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3140"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>err_code</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN3141"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>condname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3142"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err_message</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3143"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err_detail</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3144"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err_hint</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3145"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err_column</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3146"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err_constraint</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3147"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err_datatype</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3148"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err_table</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3149"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>err_schema</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3150"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>stmt_mcontext</span><span class='Delimiter'>; 
</span><a name="LN3151"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* RAISE with no parameters: re-throw current exception */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN714"><span class='Ref_to_Member'>condname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN715"><span class='Ref_to_Member'>message</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN717"><span class='Ref_to_Member'>options</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN366"><span class='Ref_to_Func'>ReThrowError</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* oops, we're not inside a handler */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_STACKED_DIAGNOSTICS_ACCESSED_WITHOUT_ACTIVE_HANDLER<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"RAISE without parameters cannot be used outside an exception handler"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* We'll need to accumulate the various strings in stmt_mcontext */ 
</span>    <a href="pl_exec.c.html#LN3150"><span class='Ref_To_Local'>stmt_mcontext</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN161"><span class='Ref_to_Proto'>get_stmt_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN714"><span class='Ref_to_Member'>condname</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN3140"><span class='Ref_To_Local'>err_code</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1076"><span class='Ref_to_Proto'>plpgsql_recognize_err_condition</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN714"><span class='Ref_to_Member'>condname</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3141"><span class='Ref_To_Local'>condname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3150"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN714"><span class='Ref_to_Member'>condname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN715"><span class='Ref_to_Member'>message</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3176"></a>        <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>ds</span><span class='Delimiter'>; 
</span><a name="LN3177"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>current_param</span><span class='Delimiter'>; 
</span><a name="LN3178"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN3179"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* build string in stmt_mcontext */ 
</span>        <a href="pl_exec.c.html#LN3179"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3150"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3176"><span class='Ref_To_Local'>ds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3179"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN3177"><span class='Ref_To_Local'>current_param</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN716"><span class='Ref_to_Member'>params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3178"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN715"><span class='Ref_to_Member'>message</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="pl_exec.c.html#LN3178"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN3178"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Occurrences of a single % are replaced by the next parameter's 
             * external representation. Double %'s are converted to one %. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3178"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'%'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3196"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>paramtypeid</span><span class='Delimiter'>; 
</span><a name="LN3197"></a>                <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>paramtypmod</span><span class='Delimiter'>; 
</span><a name="LN3198"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>paramvalue</span><span class='Delimiter'>; 
</span><a name="LN3199"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>paramisnull</span><span class='Delimiter'>; 
</span><a name="LN3200"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>extval</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3178"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'%'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../backend/replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3176"><span class='Ref_To_Local'>ds</span></a><span class='Delimiter'>, </span><span class='String'>'%'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN3178"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* should have been checked at compile time */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3177"><span class='Ref_To_Local'>current_param</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected RAISE parameter list length"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN3198"><span class='Ref_To_Local'>paramvalue</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3177"><span class='Ref_To_Local'>current_param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="pl_exec.c.html#LN3199"><span class='Ref_To_Local'>paramisnull</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="pl_exec.c.html#LN3196"><span class='Ref_To_Local'>paramtypeid</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="pl_exec.c.html#LN3197"><span class='Ref_To_Local'>paramtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3199"><span class='Ref_To_Local'>paramisnull</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_exec.c.html#LN3200"><span class='Ref_To_Local'>extval</span></a> <span class='Operator'>= </span><span class='String'>"&LT;NULL&GT;"</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pl_exec.c.html#LN3200"><span class='Ref_To_Local'>extval</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN287"><span class='Ref_to_Proto'>convert_value_to_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                                     <a href="pl_exec.c.html#LN3198"><span class='Ref_To_Local'>paramvalue</span></a><span class='Delimiter'>, 
</span>                                                     <a href="pl_exec.c.html#LN3196"><span class='Ref_To_Local'>paramtypeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3176"><span class='Ref_To_Local'>ds</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3200"><span class='Ref_To_Local'>extval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN3177"><span class='Ref_To_Local'>current_param</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3177"><span class='Ref_To_Local'>current_param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cp[0]=='%' &raquo; </span> 
            <span class='Control'>else</span> 
                <a href="../../../backend/replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3176"><span class='Ref_To_Local'>ds</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3178"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for cp=stmt-&GT;message;*cp;... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* should have been checked at compile time */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3177"><span class='Ref_To_Local'>current_param</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected RAISE parameter list length"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN3142"><span class='Ref_To_Local'>err_message</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3176"><span class='Ref_To_Local'>ds</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;message &raquo; </span> 
 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3151"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN717"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3242"></a>        <a href="plpgsql.h.html#LN723"><span class='Ref_to_Struct'>PLpgSQL_raise_option</span></a> <span class='Operator'>*</span><span class='Declare_Local'>opt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN723"><span class='Ref_to_Struct'>PLpgSQL_raise_option</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3151"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3243"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>optionvalue</span><span class='Delimiter'>; 
</span><a name="LN3244"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>optionisnull</span><span class='Delimiter'>; 
</span><a name="LN3245"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>optiontypeid</span><span class='Delimiter'>; 
</span><a name="LN3246"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>optiontypmod</span><span class='Delimiter'>; 
</span><a name="LN3247"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>extval</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN3243"><span class='Ref_To_Local'>optionvalue</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3242"><span class='Ref_To_Local'>opt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN726"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="pl_exec.c.html#LN3244"><span class='Ref_To_Local'>optionisnull</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="pl_exec.c.html#LN3245"><span class='Ref_To_Local'>optiontypeid</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="pl_exec.c.html#LN3246"><span class='Ref_To_Local'>optiontypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3244"><span class='Ref_To_Local'>optionisnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"RAISE statement option cannot be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN3247"><span class='Ref_To_Local'>extval</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN287"><span class='Ref_to_Proto'>convert_value_to_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3243"><span class='Ref_To_Local'>optionvalue</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3245"><span class='Ref_To_Local'>optiontypeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3242"><span class='Ref_To_Local'>opt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN725"><span class='Ref_to_Member'>opt_type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN146"><span class='Ref_to_EnumConst'>PLPGSQL_RAISEOPTION_ERRCODE</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3140"><span class='Ref_To_Local'>err_code</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"RAISE option already specified: %s"</span><span class='Delimiter'>, 
</span>                                    <span class='String'>"ERRCODE"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN3140"><span class='Ref_To_Local'>err_code</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN1076"><span class='Ref_to_Proto'>plpgsql_recognize_err_condition</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3247"><span class='Ref_To_Local'>extval</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN3141"><span class='Ref_To_Local'>condname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3150"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3247"><span class='Ref_To_Local'>extval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN147"><span class='Ref_to_EnumConst'>PLPGSQL_RAISEOPTION_MESSAGE</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN3123"><span class='Ref_to_Macro'>SET_RAISE_OPTION_TEXT</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3142"><span class='Ref_To_Local'>err_message</span></a><span class='Delimiter'>, </span><span class='String'>"MESSAGE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN148"><span class='Ref_to_EnumConst'>PLPGSQL_RAISEOPTION_DETAIL</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN3123"><span class='Ref_to_Macro'>SET_RAISE_OPTION_TEXT</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3143"><span class='Ref_To_Local'>err_detail</span></a><span class='Delimiter'>, </span><span class='String'>"DETAIL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN149"><span class='Ref_to_EnumConst'>PLPGSQL_RAISEOPTION_HINT</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN3123"><span class='Ref_to_Macro'>SET_RAISE_OPTION_TEXT</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3144"><span class='Ref_To_Local'>err_hint</span></a><span class='Delimiter'>, </span><span class='String'>"HINT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN150"><span class='Ref_to_EnumConst'>PLPGSQL_RAISEOPTION_COLUMN</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN3123"><span class='Ref_to_Macro'>SET_RAISE_OPTION_TEXT</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3145"><span class='Ref_To_Local'>err_column</span></a><span class='Delimiter'>, </span><span class='String'>"COLUMN"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN151"><span class='Ref_to_EnumConst'>PLPGSQL_RAISEOPTION_CONSTRAINT</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN3123"><span class='Ref_to_Macro'>SET_RAISE_OPTION_TEXT</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3146"><span class='Ref_To_Local'>err_constraint</span></a><span class='Delimiter'>, </span><span class='String'>"CONSTRAINT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN152"><span class='Ref_to_EnumConst'>PLPGSQL_RAISEOPTION_DATATYPE</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN3123"><span class='Ref_to_Macro'>SET_RAISE_OPTION_TEXT</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3147"><span class='Ref_To_Local'>err_datatype</span></a><span class='Delimiter'>, </span><span class='String'>"DATATYPE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN153"><span class='Ref_to_EnumConst'>PLPGSQL_RAISEOPTION_TABLE</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN3123"><span class='Ref_to_Macro'>SET_RAISE_OPTION_TEXT</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3148"><span class='Ref_To_Local'>err_table</span></a><span class='Delimiter'>, </span><span class='String'>"TABLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN154"><span class='Ref_to_EnumConst'>PLPGSQL_RAISEOPTION_SCHEMA</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN3123"><span class='Ref_to_Macro'>SET_RAISE_OPTION_TEXT</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3149"><span class='Ref_To_Local'>err_schema</span></a><span class='Delimiter'>, </span><span class='String'>"SCHEMA"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized raise option: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3242"><span class='Ref_To_Local'>opt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN725"><span class='Ref_to_Member'>opt_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch opt-&GT;opt_type &raquo; </span> 
 
        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Default code if nothing specified */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3140"><span class='Ref_To_Local'>err_code</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN713"><span class='Ref_to_Member'>elog_level</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN3140"><span class='Ref_To_Local'>err_code</span></a> <span class='Operator'>= </span>ERRCODE_RAISE_EXCEPTION<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Default error message if nothing specified */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3142"><span class='Ref_To_Local'>err_message</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3141"><span class='Ref_To_Local'>condname</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pl_exec.c.html#LN3142"><span class='Ref_To_Local'>err_message</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3141"><span class='Ref_To_Local'>condname</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN3141"><span class='Ref_To_Local'>condname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pl_exec.c.html#LN3142"><span class='Ref_To_Local'>err_message</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3150"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/elog.h.html#LN401"><span class='Ref_to_Proto'>unpack_sql_state</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3140"><span class='Ref_To_Local'>err_code</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Throw the error (may or may not come back) 
     */ 
</span>    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3138"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN713"><span class='Ref_to_Member'>elog_level</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3140"><span class='Ref_To_Local'>err_code</span></a> <span class='Operator'>? </span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3140"><span class='Ref_To_Local'>err_code</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>             <a href="../../../backend/utils/error/elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3142"><span class='Ref_To_Local'>err_message</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3143"><span class='Ref_To_Local'>err_detail</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../../backend/utils/error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3143"><span class='Ref_To_Local'>err_detail</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3144"><span class='Ref_To_Local'>err_hint</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3144"><span class='Ref_To_Local'>err_hint</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3145"><span class='Ref_To_Local'>err_column</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>? 
</span>             <a href="../../../backend/utils/error/elog.c.html#LN1189"><span class='Ref_to_Func'>err_generic_string</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN66"><span class='Ref_to_Const'>PG_DIAG_COLUMN_NAME</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3145"><span class='Ref_To_Local'>err_column</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3146"><span class='Ref_To_Local'>err_constraint</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>? 
</span>             <a href="../../../backend/utils/error/elog.c.html#LN1189"><span class='Ref_to_Func'>err_generic_string</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN68"><span class='Ref_to_Const'>PG_DIAG_CONSTRAINT_NAME</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3146"><span class='Ref_To_Local'>err_constraint</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3147"><span class='Ref_To_Local'>err_datatype</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>? 
</span>             <a href="../../../backend/utils/error/elog.c.html#LN1189"><span class='Ref_to_Func'>err_generic_string</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN67"><span class='Ref_to_Const'>PG_DIAG_DATATYPE_NAME</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3147"><span class='Ref_To_Local'>err_datatype</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3148"><span class='Ref_To_Local'>err_table</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>? 
</span>             <a href="../../../backend/utils/error/elog.c.html#LN1189"><span class='Ref_to_Func'>err_generic_string</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN65"><span class='Ref_to_Const'>PG_DIAG_TABLE_NAME</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3148"><span class='Ref_To_Local'>err_table</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3149"><span class='Ref_To_Local'>err_schema</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>? 
</span>             <a href="../../../backend/utils/error/elog.c.html#LN1189"><span class='Ref_to_Func'>err_generic_string</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN64"><span class='Ref_to_Const'>PG_DIAG_SCHEMA_NAME</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3149"><span class='Ref_To_Local'>err_schema</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up transient strings */ 
</span>    <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3150"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_raise &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_assert         Assert statement 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3349"></a><span class='Declare_Function'>exec_stmt_assert</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN732"><span class='Ref_to_Struct'>PLpgSQL_stmt_assert</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3351"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN3352"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* do nothing when asserts are not enabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_handler.c.html#LN49"><span class='Ref_to_Global_Var'>plpgsql_check_asserts</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN257"><span class='Ref_to_Proto'>exec_eval_boolean</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3349"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3349"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN736"><span class='Ref_to_Member'>cond</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3352"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3349"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3352"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>|| !</span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3363"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>message</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3349"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN737"><span class='Ref_to_Member'>message</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3367"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN3368"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeid</span><span class='Delimiter'>; 
</span><a name="LN3369"></a>            <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN3367"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3349"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3349"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN737"><span class='Ref_to_Member'>message</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="pl_exec.c.html#LN3352"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>typeid</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3369"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN3352"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                <a href="pl_exec.c.html#LN3363"><span class='Ref_To_Local'>message</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN287"><span class='Ref_to_Proto'>convert_value_to_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3349"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3367"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Keyword'>typeid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* we mustn't do exec_eval_cleanup here */ 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ASSERT_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="pl_exec.c.html#LN3363"><span class='Ref_To_Local'>message</span></a> <span class='Operator'>? </span><a href="../../../backend/utils/error/elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3363"><span class='Ref_To_Local'>message</span></a><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"assertion failed"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if isnull||!value &raquo; </span> 
 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_assert &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Initialize a mostly empty execution state 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3392"></a><span class='Declare_Function'>plpgsql_estate_setup</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN3393"></a>                     <a href="plpgsql.h.html#LN817"><span class='Ref_to_Struct'>PLpgSQL_function</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func</span><span class='Delimiter'>, 
</span><a name="LN3394"></a>                     <a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rsi</span><span class='Delimiter'>, 
</span><a name="LN3395"></a>                     <a href="../../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>simple_eval_estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3397"></a>    <a href="../../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* this link will be restored at exit from plpgsql_call_handler */ 
</span>    <a href="pl_exec.c.html#LN3393"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN873"><span class='Ref_to_Member'>cur_estate</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3393"><span class='Ref_to_Parameter'>func</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN884"><span class='Ref_to_Member'>retval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN885"><span class='Ref_to_Member'>retisnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN886"><span class='Ref_to_Member'>rettype</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN888"><span class='Ref_to_Member'>fn_rettype</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3393"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN828"><span class='Ref_to_Member'>fn_rettype</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN889"><span class='Ref_to_Member'>retistuple</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3393"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN831"><span class='Ref_to_Member'>fn_retistuple</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN890"><span class='Ref_to_Member'>retisset</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3393"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN832"><span class='Ref_to_Member'>fn_retset</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3393"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN833"><span class='Ref_to_Member'>fn_readonly</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN894"><span class='Ref_to_Member'>rettupdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN897"><span class='Ref_to_Member'>cur_error</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN899"><span class='Ref_to_Member'>tuple_store</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3394"><span class='Ref_to_Parameter'>rsi</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN900"><span class='Ref_to_Member'>tuple_store_cxt</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3394"><span class='Ref_to_Parameter'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN901"><span class='Ref_to_Member'>tuple_store_owner</span></a> <span class='Operator'>= </span><a href="../../../backend/utils/resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN900"><span class='Ref_to_Member'>tuple_store_cxt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN901"><span class='Ref_to_Member'>tuple_store_owner</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN902"><span class='Ref_to_Member'>rsi</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3394"><span class='Ref_to_Parameter'>rsi</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN905"><span class='Ref_to_Member'>found_varno</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3393"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN838"><span class='Ref_to_Member'>found_varno</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3393"><span class='Ref_to_Parameter'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN865"><span class='Ref_to_Member'>ndatums</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* caller is expected to fill the datums array */ 
</span> 
    <span class='Comment_Multi_Line'>/* initialize ParamListInfo with one entry per datum, all invalid */ 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/params.h.html#LN67"><span class='Ref_to_Struct'>ParamListInfoData</span></a><span class='Delimiter'>, </span>params<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN69"><span class='Ref_to_Member'>paramFetch</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN273"><span class='Ref_to_Proto'>plpgsql_param_fetch</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN70"><span class='Ref_to_Member'>paramFetchArg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN71"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/params.h.html#LN65"><span class='Ref_to_Typedef'>ParserSetupHook</span></a><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1016"><span class='Ref_to_Func'>plpgsql_parser_setup</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN72"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* filled during use */ 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN73"><span class='Ref_to_Member'>numParams</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN74"><span class='Ref_to_Member'>paramMask</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN911"><span class='Ref_to_Member'>params_dirty</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set up for use of appropriate simple-expression EState and cast hash */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3395"><span class='Ref_to_Parameter'>simple_eval_estate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN914"><span class='Ref_to_Member'>simple_eval_estate</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3395"><span class='Ref_to_Parameter'>simple_eval_estate</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Private cast hash just lives in function's main context */ 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN134"><span class='Ref_to_Typedef'>plpgsql_CastHashKey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN143"><span class='Ref_to_Typedef'>plpgsql_CastHashEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN77"><span class='Ref_to_Member'>hcxt</span></a> <span class='Operator'>= </span><a href="../../../backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN917"><span class='Ref_to_Member'>cast_hash</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"PLpgSQL private cast cache"</span><span class='Delimiter'>, 
</span>                                        <span class='Number'>16</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* start small and extend */ 
</span>                                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN92"><span class='Ref_to_Const'>HASH_CONTEXT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN918"><span class='Ref_to_Member'>cast_hash_context</span></a> <span class='Operator'>= </span><a href="../../../backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN914"><span class='Ref_to_Member'>simple_eval_estate</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN87"><span class='Ref_to_Global_Var'>shared_simple_eval_estate</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Create the session-wide cast-info hash table if we didn't already */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN154"><span class='Ref_to_Global_Var'>shared_cast_hash</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pl_exec.c.html#LN153"><span class='Ref_to_Global_Var'>shared_cast_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../../../backend/utils/mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                                                        <span class='String'>"PLpgSQL cast info"</span><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN134"><span class='Ref_to_Typedef'>plpgsql_CastHashKey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN143"><span class='Ref_to_Typedef'>plpgsql_CastHashEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN77"><span class='Ref_to_Member'>hcxt</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN153"><span class='Ref_to_Global_Var'>shared_cast_context</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN154"><span class='Ref_to_Global_Var'>shared_cast_hash</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"PLpgSQL cast cache"</span><span class='Delimiter'>, 
</span>                                           <span class='Number'>16</span><span class='Delimiter'>,</span>  <span class='Comment_Single_Line'>/* start small and extend */ 
</span>                                           <span class='Operator'>&</span><a href="pl_exec.c.html#LN3397"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN92"><span class='Ref_to_Const'>HASH_CONTEXT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN917"><span class='Ref_to_Member'>cast_hash</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN154"><span class='Ref_to_Global_Var'>shared_cast_hash</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN918"><span class='Ref_to_Member'>cast_hash_context</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN153"><span class='Ref_to_Global_Var'>shared_cast_context</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * We start with no stmt_mcontext; one will be created only if needed. 
     * That context will be a direct child of the function's main execution 
     * context.  Additional stmt_mcontexts might be created as children of it. 
     */ 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN921"><span class='Ref_to_Member'>stmt_mcontext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN922"><span class='Ref_to_Member'>stmt_mcontext_parent</span></a> <span class='Operator'>= </span><a href="../../../backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN926"><span class='Ref_to_Member'>eval_processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN927"><span class='Ref_to_Member'>eval_lastoid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN931"><span class='Ref_to_Member'>err_stmt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN932"><span class='Ref_to_Member'>err_text</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN934"><span class='Ref_to_Member'>plugin_info</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create an EState and ExprContext for evaluation of simple expressions. 
     */ 
</span>    <a href="pl_exec.c.html#LN298"><span class='Ref_to_Proto'>plpgsql_create_econtext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Let the plugin see this function before we initialize any local 
     * PL/pgSQL variables - note that we also give the plugin a few function 
     * pointers so it can call back into PL/pgSQL for doing things like 
     * variable assignments and stack traces 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN977"><span class='Ref_to_Member'>error_callback</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN159"><span class='Ref_to_Proto'>plpgsql_exec_error_callback</span></a><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN978"><span class='Ref_to_Member'>assign_expr</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN238"><span class='Ref_to_Proto'>exec_assign_expr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN970"><span class='Ref_to_Member'>func_setup</span></a><span class='Parentheses'>)</span> 
            <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pl_handler.c.html#LN57"><span class='Ref_to_Global_Var'>plpgsql_plugin_ptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN970"><span class='Ref_to_Member'>func_setup</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3392"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3393"><span class='Ref_to_Parameter'>func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_estate_setup &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Release temporary memory used by expression/subselect evaluation 
 * 
 * NB: the result of the evaluation is no longer valid after this is done, 
 * unless it is a pass-by-value datatype. 
 * 
 * NB: if you change this code, see also the hacks in exec_assign_value's 
 * PLPGSQL_DTYPE_ARRAYELEM case for partial cleanup after subscript evals. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3535"></a><span class='Declare_Function'>exec_eval_cleanup</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Clear result of a full SPI_execute */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3535"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3535"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3535"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clear result of exec_eval_simple_expr (but keep the econtext).  This 
     * also clears any short-lived allocations done via get_eval_mcontext. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3535"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/executor/executor.h.html#LN449"><span class='Ref_to_Macro'>ResetExprContext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3535"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Generate a prepared plan 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3556"></a><span class='Declare_Function'>exec_prepare_plan</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN3557"></a>                  <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cursorOptions</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3559"></a>    <a href="../../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a>  <span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The grammar can't conveniently set expr-&GT;func while building the parse 
     * tree, so make sure it's set before parser hooks need it. 
     */ 
</span>    <a href="pl_exec.c.html#LN3557"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN228"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3556"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Generate and save the plan 
     */ 
</span>    <a href="pl_exec.c.html#LN3559"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN102"><span class='Ref_to_Proto'>SPI_prepare_params</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3557"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN222"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>, 
</span>                              <span class='Parentheses'>(</span><a href="../../../include/nodes/params.h.html#LN65"><span class='Ref_to_Typedef'>ParserSetupHook</span></a><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1016"><span class='Ref_to_Func'>plpgsql_parser_setup</span></a><span class='Delimiter'>, 
</span>                              <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN3557"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, 
</span>                              <a href="pl_exec.c.html#LN3557"><span class='Ref_to_Parameter'>cursorOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3559"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Some SPI errors deserve specific error messages */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN36"><span class='Ref_to_Const'>SPI_ERROR_COPY</span></a><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot COPY to/from client in PL/pgSQL"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN42"><span class='Ref_to_Const'>SPI_ERROR_TRANSACTION</span></a><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot begin/end transactions in PL/pgSQL"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use a BEGIN block with an EXCEPTION clause instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_prepare_params failed for \"%s\": %s"</span><span class='Delimiter'>, 
</span>                     <a href="pl_exec.c.html#LN3557"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN222"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>, </span><a href="../../../include/executor/spi.h.html#LN114"><span class='Ref_to_Proto'>SPI_result_code_string</span></a><span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/executor/spi.h.html#LN106"><span class='Ref_to_Proto'>SPI_keepplan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3559"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3557"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3559"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check to see if it's a simple expression */ 
</span>    <a href="pl_exec.c.html#LN227"><span class='Ref_to_Proto'>exec_simple_check_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3556"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3557"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Mark expression as not using a read-write param.  exec_assign_value has 
     * to take steps to override this if appropriate; that seems cleaner than 
     * adding parameters to all other callers. 
     */ 
</span>    <a href="pl_exec.c.html#LN3557"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN225"><span class='Ref_to_Member'>rwparam</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_prepare_plan &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_execsql            Execute an SQL statement (possibly with INTO). 
 * 
 * Note: some callers rely on this not touching stmt_mcontext.  If it ever 
 * needs to use that, fix those callers to push/pop stmt_mcontext. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3616"></a><span class='Declare_Function'>exec_stmt_execsql</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN3617"></a>                  <a href="plpgsql.h.html#LN743"><span class='Ref_to_Struct'>PLpgSQL_stmt_execsql</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3619"></a>    <a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span><a name="LN3620"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>tcount</span><span class='Delimiter'>; 
</span><a name="LN3621"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span><a name="LN3622"></a>    <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN747"><span class='Ref_to_Member'>sqlstmt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * On the first call for this statement generate the plan, and detect 
     * whether the statement is INSERT/UPDATE/DELETE 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3622"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3630"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN224"><span class='Ref_to_Proto'>exec_prepare_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3622"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN2610"><span class='Ref_to_Const'>CURSOR_OPT_PARALLEL_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN748"><span class='Ref_to_Member'>mod_stmt</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3630"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="../../../include/executor/spi.h.html#LN116"><span class='Ref_to_Proto'>SPI_plan_get_plan_sources</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3622"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN3636"></a>            <a href="../../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3630"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3637"></a>            <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l2</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3637"><span class='Ref_To_Local'>l2</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3636"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/plancache.h.html#LN94"><span class='Ref_to_Member'>query_list</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3641"></a>                <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>q</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3637"><span class='Ref_To_Local'>l2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3641"><span class='Ref_To_Local'>q</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN115"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3641"><span class='Ref_To_Local'>q</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a> <span class='Operator'>|| 
</span>                        <a href="pl_exec.c.html#LN3641"><span class='Ref_To_Local'>q</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a> <span class='Operator'>|| 
</span>                        <a href="pl_exec.c.html#LN3641"><span class='Ref_To_Local'>q</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Parentheses'>) 
</span>                        <a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN748"><span class='Ref_to_Member'>mod_stmt</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if expr-&GT;plan==NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Set up ParamListInfo to pass to executor 
     */ 
</span>    <a href="pl_exec.c.html#LN3619"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN269"><span class='Ref_to_Proto'>setup_param_list</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3622"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have INTO, then we only need one row back ... but if we have INTO 
     * STRICT, ask for two rows, so that we can verify the statement returns 
     * only one.  INSERT/UPDATE/DELETE are always treated strictly. Without 
     * INTO, just run the statement to completion (tcount = 0). 
     * 
     * We could just ask for two rows always when using INTO, but there are 
     * some cases where demanding the extra row costs significant time, eg by 
     * forcing completion of a sequential scan.  So don't do it unless we need 
     * to enforce strictness. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN750"><span class='Ref_to_Member'>into</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN751"><span class='Ref_to_Member'>strict</span></a> <span class='Operator'>|| </span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN748"><span class='Ref_to_Member'>mod_stmt</span></a><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN3620"><span class='Ref_To_Local'>tcount</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pl_exec.c.html#LN3620"><span class='Ref_To_Local'>tcount</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pl_exec.c.html#LN3620"><span class='Ref_To_Local'>tcount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Execute the plan 
     */ 
</span>    <a href="pl_exec.c.html#LN3621"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN84"><span class='Ref_to_Proto'>SPI_execute_plan_with_paramlist</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3622"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3619"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>, 
</span>                                         <a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3620"><span class='Ref_To_Local'>tcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for error, and set FOUND if appropriate (for historical reasons 
     * we set FOUND only for certain query types).  Also Assert that we 
     * identified the statement type the same as SPI did. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3621"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN53"><span class='Ref_to_Const'>SPI_OK_SELECT</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN748"><span class='Ref_to_Member'>mod_stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN297"><span class='Ref_to_Proto'>exec_set_found</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN55"><span class='Ref_to_Const'>SPI_OK_INSERT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN57"><span class='Ref_to_Const'>SPI_OK_UPDATE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN56"><span class='Ref_to_Const'>SPI_OK_DELETE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN59"><span class='Ref_to_Const'>SPI_OK_INSERT_RETURNING</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN61"><span class='Ref_to_Const'>SPI_OK_UPDATE_RETURNING</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN60"><span class='Ref_to_Const'>SPI_OK_DELETE_RETURNING</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN748"><span class='Ref_to_Member'>mod_stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN297"><span class='Ref_to_Proto'>exec_set_found</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN54"><span class='Ref_to_Const'>SPI_OK_SELINTO</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN52"><span class='Ref_to_Const'>SPI_OK_UTILITY</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN748"><span class='Ref_to_Member'>mod_stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN62"><span class='Ref_to_Const'>SPI_OK_REWRITTEN</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN748"><span class='Ref_to_Member'>mod_stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The command was rewritten into another kind of command. It's 
             * not clear what FOUND would mean in that case (and SPI doesn't 
             * return the row count either), so just set it to false. 
             */ 
</span>            <a href="pl_exec.c.html#LN297"><span class='Ref_to_Proto'>exec_set_found</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Some SPI errors deserve specific error messages */ 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN36"><span class='Ref_to_Const'>SPI_ERROR_COPY</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot COPY to/from client in PL/pgSQL"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN42"><span class='Ref_to_Const'>SPI_ERROR_TRANSACTION</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot begin/end transactions in PL/pgSQL"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use a BEGIN block with an EXCEPTION clause instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_execute_plan_with_paramlist failed executing query \"%s\": %s"</span><span class='Delimiter'>, 
</span>                 <a href="pl_exec.c.html#LN3622"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN222"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>, </span><a href="../../../include/executor/spi.h.html#LN114"><span class='Ref_to_Proto'>SPI_result_code_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3621"><span class='Ref_To_Local'>rc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rc &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* All variants should save result info for GET DIAGNOSTICS */ 
</span>    <a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN926"><span class='Ref_to_Member'>eval_processed</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN927"><span class='Ref_to_Member'>eval_lastoid</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN39"><span class='Ref_to_Global_Var'>SPI_lastoid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process INTO if present */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN750"><span class='Ref_to_Member'>into</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3747"></a>        <a href="../../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuptab</span> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Delimiter'>; 
</span><a name="LN3748"></a>        <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; 
</span><a name="LN3749"></a>        <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3750"></a>        <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If the statement did not return a tuple table, complain */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3747"><span class='Ref_To_Local'>tuptab</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"INTO used with a command that cannot return data"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Determine if we assign to a record or a row */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN752"><span class='Ref_to_Member'>rec</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN3749"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN752"><span class='Ref_to_Member'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN302"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN753"><span class='Ref_to_Member'>row</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN3750"><span class='Ref_To_Local'>row</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN753"><span class='Ref_to_Member'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN279"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported target"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If SELECT ... INTO specified STRICT, and the query didn't find 
         * exactly one row, throw an error.  If STRICT was not specified, then 
         * allow the query to find any number of rows. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3748"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN751"><span class='Ref_to_Member'>strict</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3775"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>errdetail</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN858"><span class='Ref_to_Member'>print_strict_params</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_exec.c.html#LN3775"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN309"><span class='Ref_to_Proto'>format_expr_params</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3622"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pl_exec.c.html#LN3775"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NO_DATA_FOUND<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"query returned no rows"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="pl_exec.c.html#LN3775"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>? </span><a href="../../../backend/utils/error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"parameters: %s"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3775"><span class='Ref_To_Local'>errdetail</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* set the target to NULL(s) */ 
</span>            <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3749"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3750"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3747"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3748"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN751"><span class='Ref_to_Member'>strict</span></a> <span class='Operator'>|| </span><a href="pl_exec.c.html#LN3617"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN748"><span class='Ref_to_Member'>mod_stmt</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span><a name="LN3794"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>errdetail</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN858"><span class='Ref_to_Member'>print_strict_params</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_exec.c.html#LN3794"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN309"><span class='Ref_to_Proto'>format_expr_params</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3622"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pl_exec.c.html#LN3794"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TOO_MANY_ROWS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"query returned more than one row"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="pl_exec.c.html#LN3794"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>? </span><a href="../../../backend/utils/error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"parameters: %s"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3794"><span class='Ref_To_Local'>errdetail</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* Put the first result row into the target */ 
</span>            <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3749"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3750"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3747"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="pl_exec.c.html#LN3747"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Clean up */ 
</span>        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3616"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;into &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If the statement returned a tuple table, complain */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"query has no destination for result data"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3621"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>== </span><a href="../../../include/executor/spi.h.html#LN53"><span class='Ref_to_Const'>SPI_OK_SELECT</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"If you want to discard the results of a SELECT, use PERFORM instead."</span><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_execsql &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_dynexecute         Execute a dynamic SQL query 
 *                  (possibly with INTO). 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3834"></a><span class='Declare_Function'>exec_stmt_dynexecute</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN3835"></a>                     <a href="plpgsql.h.html#LN759"><span class='Ref_to_Struct'>PLpgSQL_stmt_dynexecute</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3837"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN3838"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN3839"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>restype</span><span class='Delimiter'>; 
</span><a name="LN3840"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>restypmod</span><span class='Delimiter'>; 
</span><a name="LN3841"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>querystr</span><span class='Delimiter'>; 
</span><a name="LN3842"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>exec_res</span><span class='Delimiter'>; 
</span><a name="LN3843"></a>    <a href="pl_exec.c.html#LN46"><span class='Ref_to_Typedef'>PreparedParamsData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ppd</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3844"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>stmt_mcontext</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN161"><span class='Ref_to_Proto'>get_stmt_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First we evaluate the string expression after the EXECUTE keyword. Its 
     * result is the querystring we have to execute. 
     */ 
</span>    <a href="pl_exec.c.html#LN3837"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3835"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN763"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3838"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3839"><span class='Ref_To_Local'>restype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN3840"><span class='Ref_To_Local'>restypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3838"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"query string argument of EXECUTE is null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the C-String representation */ 
</span>    <a href="pl_exec.c.html#LN3841"><span class='Ref_To_Local'>querystr</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN287"><span class='Ref_to_Proto'>convert_value_to_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3837"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3839"><span class='Ref_To_Local'>restype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy it into the stmt_mcontext before we clean up */ 
</span>    <a href="pl_exec.c.html#LN3841"><span class='Ref_To_Local'>querystr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3844"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3841"><span class='Ref_To_Local'>querystr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Execute the query without preparing a saved plan. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3835"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN768"><span class='Ref_to_Member'>params</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN3843"><span class='Ref_To_Local'>ppd</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN304"><span class='Ref_to_Proto'>exec_eval_using_params</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3835"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN768"><span class='Ref_to_Member'>params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN3842"><span class='Ref_To_Local'>exec_res</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN95"><span class='Ref_to_Proto'>SPI_execute_with_args</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3841"><span class='Ref_To_Local'>querystr</span></a><span class='Delimiter'>, 
</span>                                         <a href="pl_exec.c.html#LN3843"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN48"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3843"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN49"><span class='Ref_to_Member'>types</span></a><span class='Delimiter'>, 
</span>                                         <a href="pl_exec.c.html#LN3843"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN50"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3843"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN51"><span class='Ref_to_Member'>nulls</span></a><span class='Delimiter'>, 
</span>                                         <a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pl_exec.c.html#LN3842"><span class='Ref_To_Local'>exec_res</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN81"><span class='Ref_to_Proto'>SPI_execute</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3841"><span class='Ref_To_Local'>querystr</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3842"><span class='Ref_To_Local'>exec_res</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN53"><span class='Ref_to_Const'>SPI_OK_SELECT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN55"><span class='Ref_to_Const'>SPI_OK_INSERT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN57"><span class='Ref_to_Const'>SPI_OK_UPDATE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN56"><span class='Ref_to_Const'>SPI_OK_DELETE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN59"><span class='Ref_to_Const'>SPI_OK_INSERT_RETURNING</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN61"><span class='Ref_to_Const'>SPI_OK_UPDATE_RETURNING</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN60"><span class='Ref_to_Const'>SPI_OK_DELETE_RETURNING</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN52"><span class='Ref_to_Const'>SPI_OK_UTILITY</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN62"><span class='Ref_to_Const'>SPI_OK_REWRITTEN</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Also allow a zero return, which implies the querystring 
             * contained no commands. 
             */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN54"><span class='Ref_to_Const'>SPI_OK_SELINTO</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We want to disallow SELECT INTO for now, because its behavior 
             * is not consistent with SELECT INTO in a normal plpgsql context. 
             * (We need to reimplement EXECUTE to parse the string as a 
             * plpgsql command, not just feed it to SPI_execute.)  This is not 
             * a functional limitation because CREATE TABLE AS is allowed. 
             */ 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"EXECUTE of SELECT ... INTO is not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"You might want to use EXECUTE ... INTO or EXECUTE CREATE TABLE ... AS instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Some SPI errors deserve specific error messages */ 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN36"><span class='Ref_to_Const'>SPI_ERROR_COPY</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot COPY to/from client in PL/pgSQL"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/executor/spi.h.html#LN42"><span class='Ref_to_Const'>SPI_ERROR_TRANSACTION</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot begin/end transactions in PL/pgSQL"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use a BEGIN block with an EXCEPTION clause instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_execute failed executing query \"%s\": %s"</span><span class='Delimiter'>, 
</span>                 <a href="pl_exec.c.html#LN3841"><span class='Ref_To_Local'>querystr</span></a><span class='Delimiter'>, </span><a href="../../../include/executor/spi.h.html#LN114"><span class='Ref_to_Proto'>SPI_result_code_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3842"><span class='Ref_To_Local'>exec_res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch exec_res &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Save result info for GET DIAGNOSTICS */ 
</span>    <a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN926"><span class='Ref_to_Member'>eval_processed</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN927"><span class='Ref_to_Member'>eval_lastoid</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN39"><span class='Ref_to_Global_Var'>SPI_lastoid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process INTO if present */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3835"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN764"><span class='Ref_to_Member'>into</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3938"></a>        <a href="../../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuptab</span> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Delimiter'>; 
</span><a name="LN3939"></a>        <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; 
</span><a name="LN3940"></a>        <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3941"></a>        <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If the statement did not return a tuple table, complain */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3938"><span class='Ref_To_Local'>tuptab</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"INTO used with a command that cannot return data"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Determine if we assign to a record or a row */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3835"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN766"><span class='Ref_to_Member'>rec</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN3940"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN3835"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN766"><span class='Ref_to_Member'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN302"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3835"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN767"><span class='Ref_to_Member'>row</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN3941"><span class='Ref_To_Local'>row</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN3835"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN767"><span class='Ref_to_Member'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN279"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported target"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If SELECT ... INTO specified STRICT, and the query didn't find 
         * exactly one row, throw an error.  If STRICT was not specified, then 
         * allow the query to find any number of rows. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3939"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3835"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN765"><span class='Ref_to_Member'>strict</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3966"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>errdetail</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN858"><span class='Ref_to_Member'>print_strict_params</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_exec.c.html#LN3966"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN311"><span class='Ref_to_Proto'>format_preparedparamsdata</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3843"><span class='Ref_To_Local'>ppd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pl_exec.c.html#LN3966"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NO_DATA_FOUND<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"query returned no rows"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="pl_exec.c.html#LN3966"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>? </span><a href="../../../backend/utils/error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"parameters: %s"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3966"><span class='Ref_To_Local'>errdetail</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* set the target to NULL(s) */ 
</span>            <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3940"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3941"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3938"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3939"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN3835"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN765"><span class='Ref_to_Member'>strict</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3985"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>errdetail</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN858"><span class='Ref_to_Member'>print_strict_params</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_exec.c.html#LN3985"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN311"><span class='Ref_to_Proto'>format_preparedparamsdata</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3843"><span class='Ref_To_Local'>ppd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pl_exec.c.html#LN3985"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TOO_MANY_ROWS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"query returned more than one row"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="pl_exec.c.html#LN3985"><span class='Ref_To_Local'>errdetail</span></a> <span class='Operator'>? </span><a href="../../../backend/utils/error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"parameters: %s"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3985"><span class='Ref_To_Local'>errdetail</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Put the first result row into the target */ 
</span>            <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3940"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3941"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN3938"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="pl_exec.c.html#LN3938"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Comment_Multi_Line'>/* clean up after exec_move_row() */ 
</span>        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3834"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;into &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * It might be a good idea to raise an error if the query returned 
         * tuples that are being ignored, but historically we have not done 
         * that. 
         */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Release any result from SPI_execute, as well as transient data */ 
</span>    <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN3844"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_dynexecute &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_dynfors            Execute a dynamic query, assign each 
 *                  tuple to a record or row and 
 *                  execute a group of statements 
 *                  for it. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN4029"></a><span class='Declare_Function'>exec_stmt_dynfors</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN590"><span class='Ref_to_Struct'>PLpgSQL_stmt_dynfors</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4031"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN4032"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN4031"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN306"><span class='Ref_to_Proto'>exec_dynquery_with_params</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4029"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4029"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN599"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4029"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN600"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>, 
</span>                                       <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Execute the loop 
     */ 
</span>    <a href="pl_exec.c.html#LN4032"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN267"><span class='Ref_to_Proto'>exec_for_query</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4029"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN546"><span class='Ref_to_Struct'>PLpgSQL_stmt_forq</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4029"><span class='Ref_to_Parameter'>stmt</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4031"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close the implicit cursor 
     */ 
</span>    <a href="../../../include/executor/spi.h.html#LN152"><span class='Ref_to_Proto'>SPI_cursor_close</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4031"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN4032"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_dynfors &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_open           Execute an OPEN cursor statement 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN4056"></a><span class='Declare_Function'>exec_stmt_open</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN620"><span class='Ref_to_Struct'>PLpgSQL_stmt_open</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4058"></a>    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>curvar</span><span class='Delimiter'>; 
</span><a name="LN4059"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>stmt_mcontext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4060"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>curname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4061"></a>    <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN4062"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN4063"></a>    <a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ---------- 
     * Get the cursor variable and if it has an assigned name, check 
     * that it's not in use currently. 
     * ---------- 
     */ 
</span>    <a href="pl_exec.c.html#LN4058"><span class='Ref_To_Local'>curvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN624"><span class='Ref_to_Member'>curvar</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN4058"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4073"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We only need stmt_mcontext to hold the cursor name string */ 
</span>        <a href="pl_exec.c.html#LN4059"><span class='Ref_To_Local'>stmt_mcontext</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN161"><span class='Ref_to_Proto'>get_stmt_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN4073"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4059"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN4060"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4058"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4073"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/executor/spi.h.html#LN147"><span class='Ref_to_Proto'>SPI_cursor_find</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4060"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_CURSOR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cursor \"%s\" already in use"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4060"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* ---------- 
     * Process the OPEN according to it's type. 
     * ---------- 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN628"><span class='Ref_to_Member'>query</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* ---------- 
         * This is an OPEN refcursor FOR SELECT ... 
         * 
         * We just make sure the query is planned. The real work is 
         * done downstairs. 
         * ---------- 
         */ 
</span>        <a href="pl_exec.c.html#LN4061"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN628"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4061"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN224"><span class='Ref_to_Proto'>exec_prepare_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4061"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN625"><span class='Ref_to_Member'>cursor_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN629"><span class='Ref_to_Member'>dynquery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* ---------- 
         * This is an OPEN refcursor FOR EXECUTE ... 
         * ---------- 
         */ 
</span>        <a href="pl_exec.c.html#LN4062"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN306"><span class='Ref_to_Proto'>exec_dynquery_with_params</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN629"><span class='Ref_to_Member'>dynquery</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN630"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN4060"><span class='Ref_To_Local'>curname</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN625"><span class='Ref_to_Member'>cursor_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If cursor variable was NULL, store the generated portal name in it. 
         * Note: exec_dynquery_with_params already reset the stmt_mcontext, so 
         * curname is a dangling pointer here; but testing it for nullness is 
         * OK. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4060"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4058"><span class='Ref_To_Local'>curvar</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4062"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/portal.h.html#LN116"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;dynquery!=NULL &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* ---------- 
         * This is an OPEN cursor 
         * 
         * Note: parser should already have checked that statement supplies 
         * args iff cursor needs them, but we check again to be safe. 
         * ---------- 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN627"><span class='Ref_to_Member'>argquery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ---------- 
             * OPEN CURSOR with args.  We fake a SELECT ... INTO ... 
             * statement to evaluate the args and put 'em into the 
             * internal row. 
             * ---------- 
             */ 
</span><a name="LN4144"></a>            <a href="plpgsql.h.html#LN743"><span class='Ref_to_Struct'>PLpgSQL_stmt_execsql</span></a> <span class='Declare_Local'>set_args</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4058"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN265"><span class='Ref_to_Member'>cursor_explicit_argrow</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"arguments given for cursor without arguments"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN4144"><span class='Ref_To_Local'>set_args</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4144"><span class='Ref_To_Local'>set_args</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN4144"><span class='Ref_To_Local'>set_args</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN745"><span class='Ref_to_Member'>cmd_type</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN100"><span class='Ref_to_EnumConst'>PLPGSQL_STMT_EXECSQL</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN4144"><span class='Ref_To_Local'>set_args</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN746"><span class='Ref_to_Member'>lineno</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN623"><span class='Ref_to_Member'>lineno</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN4144"><span class='Ref_To_Local'>set_args</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN747"><span class='Ref_to_Member'>sqlstmt</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN627"><span class='Ref_to_Member'>argquery</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN4144"><span class='Ref_To_Local'>set_args</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN750"><span class='Ref_to_Member'>into</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* XXX historically this has not been STRICT */ 
</span>            <a href="pl_exec.c.html#LN4144"><span class='Ref_To_Local'>set_args</span></a><span class='Operator'>.</span><a href="plpgsql.h.html#LN753"><span class='Ref_to_Member'>row</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4058"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN265"><span class='Ref_to_Member'>cursor_explicit_argrow</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN211"><span class='Ref_to_Proto'>exec_stmt_execsql</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN4144"><span class='Ref_To_Local'>set_args</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Parentheses'>)</span> 
                <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"open cursor failed during argument processing"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;argquery!=NULL &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4058"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN265"><span class='Ref_to_Member'>cursor_explicit_argrow</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"arguments required for cursor"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pl_exec.c.html#LN4061"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4058"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN264"><span class='Ref_to_Member'>cursor_explicit_expr</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4061"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN224"><span class='Ref_to_Proto'>exec_prepare_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4061"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4058"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN266"><span class='Ref_to_Member'>cursor_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Set up short-lived ParamListInfo 
     */ 
</span>    <a href="pl_exec.c.html#LN4063"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN271"><span class='Ref_to_Proto'>setup_unshared_param_list</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4061"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open the cursor 
     */ 
</span>    <a href="pl_exec.c.html#LN4062"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN145"><span class='Ref_to_Proto'>SPI_cursor_open_with_paramlist</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4060"><span class='Ref_To_Local'>curname</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4061"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN4063"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4062"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not open cursor: %s"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/executor/spi.h.html#LN114"><span class='Ref_to_Proto'>SPI_result_code_string</span></a><span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If cursor variable was NULL, store the generated portal name in it 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4060"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN302"><span class='Ref_to_Proto'>assign_text_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4058"><span class='Ref_To_Local'>curvar</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4062"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/portal.h.html#LN116"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we had any transient data, clean it up */ 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4056"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4059"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4059"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_open &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_fetch          Fetch from a cursor into a target, or just 
 *                          move the current position of the cursor 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN4212"></a><span class='Declare_Function'>exec_stmt_fetch</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN636"><span class='Ref_to_Struct'>PLpgSQL_stmt_fetch</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4214"></a>    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>curvar</span><span class='Delimiter'>; 
</span><a name="LN4215"></a>    <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4216"></a>    <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4217"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>how_many</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN644"><span class='Ref_to_Member'>how_many</span></a><span class='Delimiter'>; 
</span><a name="LN4218"></a>    <a href="../../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuptab</span><span class='Delimiter'>; 
</span><a name="LN4219"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN4220"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>curname</span><span class='Delimiter'>; 
</span><a name="LN4221"></a>    <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span><a name="LN4222"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ---------- 
     * Get the portal of the cursor by name 
     * ---------- 
     */ 
</span>    <a href="pl_exec.c.html#LN4214"><span class='Ref_To_Local'>curvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN642"><span class='Ref_to_Member'>curvar</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4214"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cursor variable \"%s\" is null"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4214"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN257"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use eval_mcontext for short-lived string */ 
</span>    <a href="pl_exec.c.html#LN4222"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN4220"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4214"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4222"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN4219"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN147"><span class='Ref_to_Proto'>SPI_cursor_find</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4220"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4219"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_CURSOR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cursor \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4220"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Calculate position for FETCH_RELATIVE or FETCH_ABSOLUTE */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN645"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4248"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* XXX should be doing this in LONG not INT width */ 
</span>        <a href="pl_exec.c.html#LN4217"><span class='Ref_To_Local'>how_many</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN254"><span class='Ref_to_Proto'>exec_eval_integer</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN645"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN4248"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4248"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relative or absolute cursor position is null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN646"><span class='Ref_to_Member'>is_move</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* ---------- 
         * Determine if we fetch into a record or a row 
         * ---------- 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN640"><span class='Ref_to_Member'>rec</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN4215"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN640"><span class='Ref_to_Member'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN302"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN641"><span class='Ref_to_Member'>row</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN4216"><span class='Ref_To_Local'>row</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN641"><span class='Ref_to_Member'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN279"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported target"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ---------- 
         * Fetch 1 tuple from the cursor 
         * ---------- 
         */ 
</span>        <a href="../../../include/executor/spi.h.html#LN150"><span class='Ref_to_Proto'>SPI_scroll_cursor_fetch</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4219"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN643"><span class='Ref_to_Member'>direction</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4217"><span class='Ref_To_Local'>how_many</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN4218"><span class='Ref_To_Local'>tuptab</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN4221"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ---------- 
         * Set the target appropriately. 
         * ---------- 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4221"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4215"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4216"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4218"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4215"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4216"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4218"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="pl_exec.c.html#LN4218"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4218"><span class='Ref_To_Local'>tuptab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !stmt-&GT;is_move &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Move the cursor */ 
</span>        <a href="../../../include/executor/spi.h.html#LN151"><span class='Ref_to_Proto'>SPI_scroll_cursor_move</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4219"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN643"><span class='Ref_to_Member'>direction</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4217"><span class='Ref_To_Local'>how_many</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN4221"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Set the ROW_COUNT and the global FOUND variable appropriately. */ 
</span>    <a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN926"><span class='Ref_to_Member'>eval_processed</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4221"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN297"><span class='Ref_to_Proto'>exec_set_found</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4212"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4221"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_fetch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_stmt_close          Close a cursor 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN4313"></a><span class='Declare_Function'>exec_stmt_close</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN653"><span class='Ref_to_Struct'>PLpgSQL_stmt_close</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4315"></a>    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>curvar</span><span class='Delimiter'>; 
</span><a name="LN4316"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN4317"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>curname</span><span class='Delimiter'>; 
</span><a name="LN4318"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ---------- 
     * Get the portal of the cursor by name 
     * ---------- 
     */ 
</span>    <a href="pl_exec.c.html#LN4315"><span class='Ref_To_Local'>curvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN4313"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4313"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN657"><span class='Ref_to_Member'>curvar</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4315"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cursor variable \"%s\" is null"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4315"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN257"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use eval_mcontext for short-lived string */ 
</span>    <a href="pl_exec.c.html#LN4318"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4313"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN4317"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4315"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4318"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN4316"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN147"><span class='Ref_to_Proto'>SPI_cursor_find</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4317"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4316"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_CURSOR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cursor \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4317"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ---------- 
     * And close it. 
     * ---------- 
     */ 
</span>    <a href="../../../include/executor/spi.h.html#LN152"><span class='Ref_to_Proto'>SPI_cursor_close</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4316"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_stmt_close &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_assign_expr         Put an expression's result into a variable. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4356"></a><span class='Declare_Function'>exec_assign_expr</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>target</span><span class='Delimiter'>, 
</span><a name="LN4357"></a>                 <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4359"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN4360"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN4361"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>valtype</span><span class='Delimiter'>; 
</span><a name="LN4362"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>valtypmod</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If first time through, create a plan for this expression, and then see 
     * if we can pass the target variable as a read-write parameter to the 
     * expression.  (This is a bit messy, but it seems cleaner than modifying 
     * the API of exec_eval_expr for the purpose.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4357"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN224"><span class='Ref_to_Proto'>exec_prepare_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4356"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4357"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4356"><span class='Ref_to_Parameter'>target</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN229"><span class='Ref_to_Proto'>exec_check_rw_parameter</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4357"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4356"><span class='Ref_to_Parameter'>target</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN198"><span class='Ref_to_Member'>dno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4356"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4357"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN4360"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN4361"><span class='Ref_To_Local'>valtype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN4362"><span class='Ref_To_Local'>valtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN244"><span class='Ref_to_Proto'>exec_assign_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4356"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4356"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4360"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4361"><span class='Ref_To_Local'>valtype</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4362"><span class='Ref_To_Local'>valtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4356"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_assign_expr &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_assign_c_string     Put a C string into a text variable. 
 * 
 * We take a NULL pointer as signifying empty string, not SQL null. 
 * 
 * As with the underlying exec_assign_value, caller is expected to do 
 * exec_eval_cleanup later. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4393"></a><span class='Declare_Function'>exec_assign_c_string</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>target</span><span class='Delimiter'>, 
</span><a name="LN4394"></a>                     <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4396"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN4397"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use eval_mcontext for short-lived text value */ 
</span>    <a href="pl_exec.c.html#LN4397"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4393"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4394"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4394"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4397"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN244"><span class='Ref_to_Proto'>exec_assign_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4393"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4393"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                      <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_assign_value            Put a value into a target datum 
 * 
 * Note: in some code paths, this will leak memory in the eval_mcontext; 
 * we assume that will be cleaned up later by exec_eval_cleanup.  We cannot 
 * call exec_eval_cleanup here for fear of destroying the input Datum value. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4421"></a><span class='Declare_Function'>exec_assign_value</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN4422"></a>                  <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>target</span><span class='Delimiter'>, 
</span><a name="LN4423"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN4424"></a>                  <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>valtype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>valtypmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4422"><span class='Ref_to_Parameter'>target</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Target is a variable 
                 */ 
</span><a name="LN4433"></a>                <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4422"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>; 
</span><a name="LN4434"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>newvalue</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN4434"><span class='Ref_To_Local'>newvalue</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN289"><span class='Ref_to_Proto'>exec_cast_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                           <span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN4424"><span class='Ref_to_Parameter'>valtype</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN4424"><span class='Ref_to_Parameter'>valtypmod</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN4433"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN4433"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN186"><span class='Ref_to_Member'>atttypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN4433"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN262"><span class='Ref_to_Member'>notnull</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null value cannot be assigned to variable \"%s\" declared NOT NULL"</span><span class='Delimiter'>, 
</span>                                    <a href="pl_exec.c.html#LN4433"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN257"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If type is by-reference, copy the new value (which is 
                 * probably in the eval_mcontext) into the procedure's main 
                 * memory context.  But if it's a read/write reference to an 
                 * expanded object, no physical copy needs to happen; at most 
                 * we need to reparent the object's memory context. 
                 * 
                 * If it's an array, we force the value to be stored in R/W 
                 * expanded form.  This wins if the function later does, say, 
                 * a lot of array subscripting operations on the variable, and 
                 * otherwise might lose.  We might need to use a different 
                 * heuristic, but it's too soon to tell.  Also, are there 
                 * cases where it'd be useful to force non-array values into 
                 * expanded form? 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN4433"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN181"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>&& !</span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4433"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN185"><span class='Ref_to_Member'>typisarray</span></a> <span class='Operator'>&& 
</span>                        <span class='Operator'>!</span><a href="../../../include/postgres.h.html#LN320"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_EXPANDED_RW</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4434"><span class='Ref_To_Local'>newvalue</span></a><span class='Parentheses'>)))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* array and not already R/W, so apply expand_array */ 
</span>                        <a href="pl_exec.c.html#LN4434"><span class='Ref_To_Local'>newvalue</span></a> <span class='Operator'>= </span><a href="../../../backend/utils/adt/array_expanded.c.html#LN48"><span class='Ref_to_Func'>expand_array</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4434"><span class='Ref_To_Local'>newvalue</span></a><span class='Delimiter'>, 
</span>                                                <a href="../../../backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                                <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* else transfer value if R/W, else just datumCopy */ 
</span>                        <a href="pl_exec.c.html#LN4434"><span class='Ref_To_Local'>newvalue</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN37"><span class='Ref_to_Proto'>datumTransfer</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4434"><span class='Ref_To_Local'>newvalue</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                                 <a href="pl_exec.c.html#LN4433"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN180"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Now free the old value, if any, and assign the new one. But 
                 * skip the assignment if old and new values are the same. 
                 * Note that for expanded objects, this test is necessary and 
                 * cannot reliably be made any earlier; we have to be looking 
                 * at the object's standard R/W pointer to be sure pointer 
                 * equality is meaningful. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4433"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>!= </span><a href="pl_exec.c.html#LN4434"><span class='Ref_To_Local'>newvalue</span></a> <span class='Operator'>|| </span><a href="pl_exec.c.html#LN4433"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>|| </span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4433"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4434"><span class='Ref_To_Local'>newvalue</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN4433"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN181"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>&& !</span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Target is a row variable 
                 */ 
</span><a name="LN4503"></a>                <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4422"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* If source is null, just assign nulls to the row */ 
</span>                    <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4503"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Source must be of RECORD or composite type */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/lsyscache.h.html#LN150"><span class='Ref_to_Proto'>type_is_rowtype</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4424"><span class='Ref_to_Parameter'>valtype</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot assign non-composite value to a row variable"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN283"><span class='Ref_to_Proto'>exec_move_row_from_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4503"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Target is a record variable 
                 */ 
</span><a name="LN4527"></a>                <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4422"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* If source is null, just assign nulls to the record */ 
</span>                    <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4527"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Source must be of RECORD or composite type */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/lsyscache.h.html#LN150"><span class='Ref_to_Proto'>type_is_rowtype</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4424"><span class='Ref_to_Parameter'>valtype</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot assign non-composite value to a record variable"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN283"><span class='Ref_to_Proto'>exec_move_row_from_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4527"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN63"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_RECFIELD</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Target is a field of a record 
                 */ 
</span><a name="LN4551"></a>                <a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Declare_Local'>recfield</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4422"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>; 
</span><a name="LN4552"></a>                <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span><span class='Delimiter'>; 
</span><a name="LN4553"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>fno</span><span class='Delimiter'>; 
</span><a name="LN4554"></a>                <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtup</span><span class='Delimiter'>; 
</span><a name="LN4555"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>colnums</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN4556"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN4557"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN4558"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>atttype</span><span class='Delimiter'>; 
</span><a name="LN4559"></a>                <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>atttypmod</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4551"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN320"><span class='Ref_to_Member'>recparentno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Check that there is already a tuple in the record. We need 
                 * that because records don't have any predefined field 
                 * structure. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" is not assigned yet"</span><span class='Delimiter'>, 
</span>                                  <a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The tuple structure of a not-yet-assigned record is indeterminate."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Get the number of the record field to change.  Disallow 
                 * system columns because the code below won't cope. 
                 */ 
</span>                <a href="pl_exec.c.html#LN4553"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN123"><span class='Ref_to_Proto'>SPI_fnumber</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4551"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN319"><span class='Ref_to_Member'>fieldname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4553"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" has no field \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4551"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN319"><span class='Ref_to_Member'>fieldname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN4555"><span class='Ref_To_Local'>colnums</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN4553"><span class='Ref_To_Local'>fno</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Now insert the new value, being careful to cast it to the 
                 * right type. 
                 */ 
</span>                <a href="pl_exec.c.html#LN4558"><span class='Ref_To_Local'>atttype</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4553"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN4559"><span class='Ref_To_Local'>atttypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4553"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN4556"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN289"><span class='Ref_to_Proto'>exec_cast_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                            <span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN4424"><span class='Ref_to_Parameter'>valtype</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN4424"><span class='Ref_to_Parameter'>valtypmod</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN4558"><span class='Ref_To_Local'>atttype</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN4559"><span class='Ref_To_Local'>atttypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN4557"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN4554"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN807"><span class='Ref_to_Proto'>heap_modify_tuple_by_cols</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Number'>1</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4555"><span class='Ref_To_Local'>colnums</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4556"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4557"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN308"><span class='Ref_to_Member'>freetup</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4554"><span class='Ref_To_Local'>newtup</span></a><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN4552"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN308"><span class='Ref_to_Member'>freetup</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN64"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ARRAYELEM</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Target is an element of an array 
                 */ 
</span><a name="LN4619"></a>                <a href="plpgsql.h.html#LN326"><span class='Ref_to_Struct'>PLpgSQL_arrayelem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>arrayelem</span><span class='Delimiter'>; 
</span><a name="LN4620"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>nsubscripts</span><span class='Delimiter'>; 
</span><a name="LN4621"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN4622"></a>                <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>subscripts</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN4623"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>subscriptvals</span><span class='Delimiter'>[</span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN4624"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>oldarraydatum</span><span class='Delimiter'>, 
</span><a name="LN4625"></a>                            <span class='Declare_Local'>newarraydatum</span><span class='Delimiter'>, 
</span><a name="LN4626"></a>                            <span class='Declare_Local'>coerced_value</span><span class='Delimiter'>; 
</span><a name="LN4627"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>oldarrayisnull</span><span class='Delimiter'>; 
</span><a name="LN4628"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>parenttypoid</span><span class='Delimiter'>; 
</span><a name="LN4629"></a>                <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>parenttypmod</span><span class='Delimiter'>; 
</span><a name="LN4630"></a>                <a href="../../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>save_eval_tuptable</span><span class='Delimiter'>; 
</span><a name="LN4631"></a>                <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We need to do subscript evaluation, which might require 
                 * evaluating general expressions; and the caller might have 
                 * done that too in order to prepare the input Datum.  We have 
                 * to save and restore the caller's SPI_execute result, if 
                 * any. 
                 */ 
</span>                <a href="pl_exec.c.html#LN4630"><span class='Ref_To_Local'>save_eval_tuptable</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * To handle constructs like x[1][2] := something, we have to 
                 * be prepared to deal with a chain of arrayelem datums. Chase 
                 * back to find the base array datum, and save the subscript 
                 * expressions as we go.  (We are scanning right to left here, 
                 * but want to evaluate the subscripts left-to-right to 
                 * minimize surprises.)  Note that arrayelem is left pointing 
                 * to the leftmost arrayelem datum, where we will cache the 
                 * array element type data. 
                 */ 
</span>                <a href="pl_exec.c.html#LN4620"><span class='Ref_To_Local'>nsubscripts</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>do</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN326"><span class='Ref_to_Struct'>PLpgSQL_arrayelem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4422"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4620"><span class='Ref_To_Local'>nsubscripts</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of array dimensions (%d) exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                                        <a href="pl_exec.c.html#LN4620"><span class='Ref_To_Local'>nsubscripts</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN4622"><span class='Ref_To_Local'>subscripts</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4620"><span class='Ref_To_Local'>nsubscripts</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN330"><span class='Ref_to_Member'>subscript</span></a><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN4422"><span class='Ref_to_Parameter'>target</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN331"><span class='Ref_to_Member'>arrayparentno</span></a><span class='Delimiter'>]; 
</span>                <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4422"><span class='Ref_to_Parameter'>target</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN64"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ARRAYELEM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Fetch current value of array datum */ 
</span>                <a href="pl_exec.c.html#LN248"><span class='Ref_to_Proto'>exec_eval_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4422"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="pl_exec.c.html#LN4628"><span class='Ref_To_Local'>parenttypoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN4629"><span class='Ref_To_Local'>parenttypmod</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="pl_exec.c.html#LN4624"><span class='Ref_To_Local'>oldarraydatum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN4627"><span class='Ref_To_Local'>oldarrayisnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Update cached type data if necessary */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN334"><span class='Ref_to_Member'>parenttypoid</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN4628"><span class='Ref_To_Local'>parenttypoid</span></a> <span class='Operator'>|| 
</span>                    <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN335"><span class='Ref_to_Member'>parenttypmod</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN4629"><span class='Ref_To_Local'>parenttypmod</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN4675"></a>                    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>arraytypoid</span><span class='Delimiter'>; 
</span><a name="LN4676"></a>                    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>arraytypmod</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4629"><span class='Ref_To_Local'>parenttypmod</span></a><span class='Delimiter'>; 
</span><a name="LN4677"></a>                    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>arraytyplen</span><span class='Delimiter'>; 
</span><a name="LN4678"></a>                    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elemtypoid</span><span class='Delimiter'>; 
</span><a name="LN4679"></a>                    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>elemtyplen</span><span class='Delimiter'>; 
</span><a name="LN4680"></a>                    <span class='Keyword'>bool</span>        <span class='Declare_Local'>elemtypbyval</span><span class='Delimiter'>; 
</span><a name="LN4681"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>elemtypalign</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* If target is domain over array, reduce to base type */ 
</span>                    <a href="pl_exec.c.html#LN4675"><span class='Ref_To_Local'>arraytypoid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN169"><span class='Ref_to_Proto'>getBaseTypeAndTypmod</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4628"><span class='Ref_To_Local'>parenttypoid</span></a><span class='Delimiter'>, 
</span>                                                       <span class='Operator'>&</span><a href="pl_exec.c.html#LN4676"><span class='Ref_To_Local'>arraytypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* ... and identify the element type */ 
</span>                    <a href="pl_exec.c.html#LN4678"><span class='Ref_To_Local'>elemtypoid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN157"><span class='Ref_to_Proto'>get_element_type</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4675"><span class='Ref_To_Local'>arraytypoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4678"><span class='Ref_To_Local'>elemtypoid</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subscripted object is not an array"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Collect needed data about the types */ 
</span>                    <a href="pl_exec.c.html#LN4677"><span class='Ref_To_Local'>arraytyplen</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN133"><span class='Ref_to_Proto'>get_typlen</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4675"><span class='Ref_To_Local'>arraytypoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4678"><span class='Ref_To_Local'>elemtypoid</span></a><span class='Delimiter'>, 
</span>                                         <span class='Operator'>&</span><a href="pl_exec.c.html#LN4679"><span class='Ref_To_Local'>elemtyplen</span></a><span class='Delimiter'>, 
</span>                                         <span class='Operator'>&</span><a href="pl_exec.c.html#LN4680"><span class='Ref_To_Local'>elemtypbyval</span></a><span class='Delimiter'>, 
</span>                                         <span class='Operator'>&</span><a href="pl_exec.c.html#LN4681"><span class='Ref_To_Local'>elemtypalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Now safe to update the cached data */ 
</span>                    <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN334"><span class='Ref_to_Member'>parenttypoid</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4628"><span class='Ref_To_Local'>parenttypoid</span></a><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN335"><span class='Ref_to_Member'>parenttypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4629"><span class='Ref_To_Local'>parenttypmod</span></a><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN336"><span class='Ref_to_Member'>arraytypoid</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4675"><span class='Ref_To_Local'>arraytypoid</span></a><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN337"><span class='Ref_to_Member'>arraytypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4676"><span class='Ref_To_Local'>arraytypmod</span></a><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN338"><span class='Ref_to_Member'>arraytyplen</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4677"><span class='Ref_To_Local'>arraytyplen</span></a><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN339"><span class='Ref_to_Member'>elemtypoid</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4678"><span class='Ref_To_Local'>elemtypoid</span></a><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN340"><span class='Ref_to_Member'>elemtyplen</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4679"><span class='Ref_To_Local'>elemtyplen</span></a><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN341"><span class='Ref_to_Member'>elemtypbyval</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4680"><span class='Ref_To_Local'>elemtypbyval</span></a><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN342"><span class='Ref_to_Member'>elemtypalign</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4681"><span class='Ref_To_Local'>elemtypalign</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if arrayelem-&GT;parenttypo... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * Evaluate the subscripts, switch into left-to-right order. 
                 * Like the expression built by ExecInitArrayRef(), complain 
                 * if any subscript is null. 
                 */ 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4621"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN4621"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN4620"><span class='Ref_To_Local'>nsubscripts</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN4621"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN4721"></a>                    <span class='Keyword'>bool</span>        <span class='Declare_Local'>subisnull</span><span class='Delimiter'>; 
</span> 
                    <a href="pl_exec.c.html#LN4623"><span class='Ref_To_Local'>subscriptvals</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4621"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                        <a href="pl_exec.c.html#LN254"><span class='Ref_to_Proto'>exec_eval_integer</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                          <a href="pl_exec.c.html#LN4622"><span class='Ref_To_Local'>subscripts</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4620"><span class='Ref_To_Local'>nsubscripts</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>- </span><a href="pl_exec.c.html#LN4621"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                          <span class='Operator'>&</span><a href="pl_exec.c.html#LN4721"><span class='Ref_To_Local'>subisnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4721"><span class='Ref_To_Local'>subisnull</span></a><span class='Parentheses'>) 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array subscript in assignment must not be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Clean up in case the subscript expression wasn't 
                     * simple. We can't do exec_eval_cleanup, but we can do 
                     * this much (which is safe because the integer subscript 
                     * value is surely pass-by-value), and we must do it in 
                     * case the next subscript expression isn't simple either. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nsubscripts;i++ &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* Now we can restore caller's SPI_execute result if any. */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4630"><span class='Ref_To_Local'>save_eval_tuptable</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Coerce source value to match array element type. */ 
</span>                <a href="pl_exec.c.html#LN4626"><span class='Ref_To_Local'>coerced_value</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN289"><span class='Ref_to_Proto'>exec_cast_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                                <span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                                                <span class='Operator'>&</span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, 
</span>                                                <a href="pl_exec.c.html#LN4424"><span class='Ref_to_Parameter'>valtype</span></a><span class='Delimiter'>, 
</span>                                                <a href="pl_exec.c.html#LN4424"><span class='Ref_to_Parameter'>valtypmod</span></a><span class='Delimiter'>, 
</span>                                                <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN339"><span class='Ref_to_Member'>elemtypoid</span></a><span class='Delimiter'>, 
</span>                                                <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN337"><span class='Ref_to_Member'>arraytypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If the original array is null, cons up an empty array so 
                 * that the assignment can proceed; we'll end with a 
                 * one-element array containing just the assigned-to 
                 * subscript.  This only works for varlena arrays, though; for 
                 * fixed-length array types we skip the assignment.  We can't 
                 * support assignment of a null entry into a fixed-length 
                 * array, either, so that's a no-op too.  This is all ugly but 
                 * corresponds to the current behavior of execExpr*.c. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN338"><span class='Ref_to_Member'>arraytyplen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&&</span>       <span class='Comment_Single_Line'>/* fixed-length array? */ 
</span>                    <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4627"><span class='Ref_To_Local'>oldarrayisnull</span></a> <span class='Operator'>|| </span><a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* empty array, if any, and newarraydatum are short-lived */ 
</span>                <a href="pl_exec.c.html#LN4631"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4627"><span class='Ref_To_Local'>oldarrayisnull</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_exec.c.html#LN4624"><span class='Ref_To_Local'>oldarraydatum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN339"><span class='Ref_to_Member'>elemtypoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Build the modified array value. 
                 */ 
</span>                <a href="pl_exec.c.html#LN4625"><span class='Ref_To_Local'>newarraydatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN342"><span class='Ref_to_Proto'>array_set_element</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4624"><span class='Ref_To_Local'>oldarraydatum</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN4620"><span class='Ref_To_Local'>nsubscripts</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN4623"><span class='Ref_To_Local'>subscriptvals</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN4626"><span class='Ref_To_Local'>coerced_value</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN4423"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN338"><span class='Ref_to_Member'>arraytyplen</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN340"><span class='Ref_to_Member'>elemtyplen</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN341"><span class='Ref_to_Member'>elemtypbyval</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN342"><span class='Ref_to_Member'>elemtypalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4631"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Assign the new array to the base variable.  It's never NULL 
                 * at this point.  Note that if the target is a domain, 
                 * coercing the base array type back up to the domain will 
                 * happen within exec_assign_value. 
                 */ 
</span>                <a href="pl_exec.c.html#LN244"><span class='Ref_to_Proto'>exec_assign_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4421"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4422"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>, 
</span>                                  <a href="pl_exec.c.html#LN4625"><span class='Ref_To_Local'>newarraydatum</span></a><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                  <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN336"><span class='Ref_to_Member'>arraytypoid</span></a><span class='Delimiter'>, 
</span>                                  <a href="pl_exec.c.html#LN4619"><span class='Ref_To_Local'>arrayelem</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN337"><span class='Ref_to_Member'>arraytypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized dtype: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4422"><span class='Ref_to_Parameter'>target</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch target-&GT;dtype &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end exec_assign_value &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * exec_eval_datum              Get current value of a PLpgSQL_datum 
 * 
 * The type oid, typmod, value in Datum format, and null flag are returned. 
 * 
 * At present this doesn't handle PLpgSQL_expr or PLpgSQL_arrayelem datums; 
 * that's not needed because we never pass references to such datums to SPI. 
 * 
 * NOTE: the returned Datum points right at the stored value in the case of 
 * pass-by-reference datatypes.  Generally callers should take care not to 
 * modify the stored value.  Some callers intentionally manipulate variables 
 * referenced by R/W expanded pointers, though; it is those callers' 
 * responsibility that the results are semantically OK. 
 * 
 * In some cases we have to palloc a return value, and in such cases we put 
 * it into the estate's eval_mcontext. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4829"></a><span class='Declare_Function'>exec_eval_datum</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN4830"></a>                <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>datum</span><span class='Delimiter'>, 
</span><a name="LN4831"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typeid</span><span class='Delimiter'>, 
</span><a name="LN4832"></a>                <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typetypmod</span><span class='Delimiter'>, 
</span><a name="LN4833"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, 
</span><a name="LN4834"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4836"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4830"><span class='Ref_to_Parameter'>datum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4842"></a>                <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4830"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span> 
                <span class='Operator'>*</span><span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN4842"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN4832"><span class='Ref_to_Parameter'>typetypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4842"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN186"><span class='Ref_to_Member'>atttypmod</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN4842"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN4834"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4842"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4853"></a>                <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4830"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span><a name="LN4854"></a>                <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN4853"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* should not happen */ 
</span>                    <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"row variable has no tupdesc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Make sure we have a valid type/typmod setting */ 
</span>                <a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4853"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN4836"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4829"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN4854"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN278"><span class='Ref_to_Proto'>make_tuple_from_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4829"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4853"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4853"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4854"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* should not happen */ 
</span>                    <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"row not compatible with its own tupdesc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN4853"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN4832"><span class='Ref_to_Parameter'>typetypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4853"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN221"><span class='Ref_to_Macro'>HeapTupleGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4854"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN4834"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4836"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4874"></a>                <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4830"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4874"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" is not assigned yet"</span><span class='Delimiter'>, 
</span>                                  <a href="pl_exec.c.html#LN4874"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The tuple structure of a not-yet-assigned record is indeterminate."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4874"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Make sure we have a valid type/typmod setting */ 
</span>                <a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4874"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN4836"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4829"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN4874"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN4832"><span class='Ref_to_Parameter'>typetypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4874"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../backend/access/common/heaptuple.c.html#LN654"><span class='Ref_to_Func'>heap_copy_tuple_as_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4874"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4874"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN4834"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4836"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN63"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_RECFIELD</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4897"></a>                <a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Declare_Local'>recfield</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4830"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span><a name="LN4898"></a>                <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span><span class='Delimiter'>; 
</span><a name="LN4899"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>fno</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN4898"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN4829"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4897"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN320"><span class='Ref_to_Member'>recparentno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4898"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" is not assigned yet"</span><span class='Delimiter'>, 
</span>                                  <a href="pl_exec.c.html#LN4898"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The tuple structure of a not-yet-assigned record is indeterminate."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN4899"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN123"><span class='Ref_to_Proto'>SPI_fnumber</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4898"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4897"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN319"><span class='Ref_to_Member'>fieldname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4899"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>== </span><a href="../../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" has no field \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="pl_exec.c.html#LN4898"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4897"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN319"><span class='Ref_to_Member'>fieldname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4898"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4899"><span class='Ref_To_Local'>fno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4899"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="pl_exec.c.html#LN4832"><span class='Ref_to_Parameter'>typetypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN4898"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4899"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Operator'>*</span><a href="pl_exec.c.html#LN4832"><span class='Ref_to_Parameter'>typetypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4898"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4898"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4899"><span class='Ref_To_Local'>fno</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4834"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized dtype: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4830"><span class='Ref_to_Parameter'>datum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch datum-&GT;dtype &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end exec_eval_datum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_exec_get_datum_type              Get datatype of a PLpgSQL_datum 
 * 
 * This is the same logic as in exec_eval_datum, except that it can handle 
 * some cases where exec_eval_datum has to fail; specifically, we may have 
 * a tupdesc but no row value for a record variable.  (This currently can 
 * happen only for a trigger's NEW/OLD records.) 
 */ 
</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN4937"></a><span class='Declare_Function'>plpgsql_exec_get_datum_type</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN4938"></a>                            <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>datum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4940"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeid</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4938"><span class='Ref_to_Parameter'>datum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4946"></a>                <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4938"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span> 
                <span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN4946"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4954"></a>                <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4938"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN4954"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* should not happen */ 
</span>                    <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"row variable has no tupdesc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Make sure we have a valid type/typmod setting */ 
</span>                <a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4954"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN4954"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4966"></a>                <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4938"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4966"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" is not assigned yet"</span><span class='Delimiter'>, 
</span>                                  <a href="pl_exec.c.html#LN4966"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The tuple structure of a not-yet-assigned record is indeterminate."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Make sure we have a valid type/typmod setting */ 
</span>                <a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4966"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN4966"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN63"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_RECFIELD</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4982"></a>                <a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Declare_Local'>recfield</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN4938"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span><a name="LN4983"></a>                <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span><span class='Delimiter'>; 
</span><a name="LN4984"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>fno</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN4983"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN4937"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN4982"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN320"><span class='Ref_to_Member'>recparentno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4983"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" is not assigned yet"</span><span class='Delimiter'>, 
</span>                                  <a href="pl_exec.c.html#LN4983"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The tuple structure of a not-yet-assigned record is indeterminate."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN4984"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN123"><span class='Ref_to_Proto'>SPI_fnumber</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4983"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4982"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN319"><span class='Ref_to_Member'>fieldname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4984"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>== </span><a href="../../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" has no field \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="pl_exec.c.html#LN4983"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4982"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN319"><span class='Ref_to_Member'>fieldname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN4983"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4984"><span class='Ref_To_Local'>fno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized dtype: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN4938"><span class='Ref_to_Parameter'>datum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch datum-&GT;dtype &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Keyword'>typeid</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_exec_get_datum_type &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_exec_get_datum_type_info         Get datatype etc of a PLpgSQL_datum 
 * 
 * An extended version of plpgsql_exec_get_datum_type, which also retrieves the 
 * typmod and collation of the datum. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN5019"></a><span class='Declare_Function'>plpgsql_exec_get_datum_type_info</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN5020"></a>                                 <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>datum</span><span class='Delimiter'>, 
</span><a name="LN5021"></a>                                 <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typeid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>collation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5020"><span class='Ref_to_Parameter'>datum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN5027"></a>                <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN5020"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span> 
                <span class='Operator'>*</span><span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN5027"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5027"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN186"><span class='Ref_to_Member'>atttypmod</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>collation</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5027"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN184"><span class='Ref_to_Member'>collation</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN5037"></a>                <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN5020"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN5037"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* should not happen */ 
</span>                    <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"row variable has no tupdesc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Make sure we have a valid type/typmod setting */ 
</span>                <a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5037"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN5037"><span class='Ref_To_Local'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN284"><span class='Ref_to_Member'>rowtupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* do NOT return the mutable typmod of a RECORD variable */ 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* composite types are never collatable */ 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>collation</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN5053"></a>                <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN5020"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5053"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" is not assigned yet"</span><span class='Delimiter'>, 
</span>                                  <a href="pl_exec.c.html#LN5053"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The tuple structure of a not-yet-assigned record is indeterminate."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Make sure we have a valid type/typmod setting */ 
</span>                <a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5053"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN5053"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* do NOT return the mutable typmod of a RECORD variable */ 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* composite types are never collatable */ 
</span>                <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>collation</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="plpgsql.h.html#LN63"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_RECFIELD</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN5073"></a>                <a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Declare_Local'>recfield</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN315"><span class='Ref_to_Struct'>PLpgSQL_recfield</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN5020"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>; 
</span><a name="LN5074"></a>                <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span><span class='Delimiter'>; 
</span><a name="LN5075"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>fno</span><span class='Delimiter'>; 
</span> 
                <a href="pl_exec.c.html#LN5074"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN5019"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5073"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN320"><span class='Ref_to_Member'>recparentno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5074"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" is not assigned yet"</span><span class='Delimiter'>, 
</span>                                  <a href="pl_exec.c.html#LN5074"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../backend/utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The tuple structure of a not-yet-assigned record is indeterminate."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN5075"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN123"><span class='Ref_to_Proto'>SPI_fnumber</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5074"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5073"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN319"><span class='Ref_to_Member'>fieldname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5075"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>== </span><a href="../../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"record \"%s\" has no field \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="pl_exec.c.html#LN5074"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN303"><span class='Ref_to_Member'>refname</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5073"><span class='Ref_To_Local'>recfield</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN319"><span class='Ref_to_Member'>fieldname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5074"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5075"><span class='Ref_To_Local'>fno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5075"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5074"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5075"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5075"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>collation</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5074"><span class='Ref_To_Local'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5075"><span class='Ref_To_Local'>fno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcollation<span class='Delimiter'>; 
</span>                <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* no system column types have collation */ 
</span>                    <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>collation</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized dtype: %d"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5020"><span class='Ref_to_Parameter'>datum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><span class='Keyword'>typeid </span><span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="pl_exec.c.html#LN5021"><span class='Ref_to_Parameter'>collation</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch datum-&GT;dtype &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end plpgsql_exec_get_datum_type_info &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_eval_integer        Evaluate an expression, coerce result to int4 
 * 
 * Note we do not do exec_eval_cleanup here; the caller must do it at 
 * some later point.  (We do this because the caller may be holding the 
 * results of other, pass-by-reference, expression evaluations, such as 
 * an array value to be subscripted.) 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN5121"></a><span class='Declare_Function'>exec_eval_integer</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN5122"></a>                  <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN5123"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5125"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>exprdatum</span><span class='Delimiter'>; 
</span><a name="LN5126"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>exprtypeid</span><span class='Delimiter'>; 
</span><a name="LN5127"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>exprtypmod</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN5125"><span class='Ref_To_Local'>exprdatum</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5121"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5122"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5123"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN5126"><span class='Ref_To_Local'>exprtypeid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN5127"><span class='Ref_To_Local'>exprtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN5125"><span class='Ref_To_Local'>exprdatum</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN289"><span class='Ref_to_Proto'>exec_cast_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5121"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5125"><span class='Ref_To_Local'>exprdatum</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5123"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, 
</span>                                <a href="pl_exec.c.html#LN5126"><span class='Ref_To_Local'>exprtypeid</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5127"><span class='Ref_To_Local'>exprtypmod</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5125"><span class='Ref_To_Local'>exprdatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_eval_boolean        Evaluate an expression, coerce result to bool 
 * 
 * Note we do not do exec_eval_cleanup here; the caller must do it at 
 * some later point. 
 * ---------- 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN5144"></a><span class='Declare_Function'>exec_eval_boolean</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN5145"></a>                  <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN5146"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5148"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>exprdatum</span><span class='Delimiter'>; 
</span><a name="LN5149"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>exprtypeid</span><span class='Delimiter'>; 
</span><a name="LN5150"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>exprtypmod</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN5148"><span class='Ref_To_Local'>exprdatum</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5144"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5145"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5146"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN5149"><span class='Ref_To_Local'>exprtypeid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN5150"><span class='Ref_To_Local'>exprtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN5148"><span class='Ref_To_Local'>exprdatum</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN289"><span class='Ref_to_Proto'>exec_cast_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5144"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5148"><span class='Ref_To_Local'>exprdatum</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5146"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, 
</span>                                <a href="pl_exec.c.html#LN5149"><span class='Ref_To_Local'>exprtypeid</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5150"><span class='Ref_To_Local'>exprtypmod</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5148"><span class='Ref_To_Local'>exprdatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_eval_expr           Evaluate an expression and return 
 *                  the result Datum, along with data type/typmod. 
 * 
 * NOTE: caller must do exec_eval_cleanup when done with the Datum. 
 * ---------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5167"></a><span class='Declare_Function'>exec_eval_expr</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN5168"></a>               <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN5169"></a>               <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN5170"></a>               <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rettype</span><span class='Delimiter'>, 
</span><a name="LN5171"></a>               <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rettypmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5173"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN5174"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If first time through, create a plan for this expression. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5168"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN224"><span class='Ref_to_Proto'>exec_prepare_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5168"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN2610"><span class='Ref_to_Const'>CURSOR_OPT_PARALLEL_OK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If this is a simple expression, bypass SPI and use the executor 
     * directly 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN231"><span class='Ref_to_Proto'>exec_eval_simple_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5168"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="pl_exec.c.html#LN5173"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5169"><span class='Ref_to_Parameter'>isNull</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5170"><span class='Ref_to_Parameter'>rettype</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5171"><span class='Ref_to_Parameter'>rettypmod</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="pl_exec.c.html#LN5173"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Else do it the hard way via exec_run_select 
     */ 
</span>    <a href="pl_exec.c.html#LN5174"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN265"><span class='Ref_to_Proto'>exec_run_select</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5168"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5174"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>!= </span><a href="../../../include/executor/spi.h.html#LN53"><span class='Ref_to_Const'>SPI_OK_SELECT</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"query \"%s\" did not return data"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5168"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN222"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the expression returns exactly one column... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN848"><span class='Ref_to_Func'>errmsg_plural</span></a><span class='Parentheses'>(</span><span class='String'>"query \"%s\" returned %d column"</span><span class='Delimiter'>, 
</span>                               <span class='String'>"query \"%s\" returned %d columns"</span><span class='Delimiter'>, 
</span>                               <a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>, 
</span>                               <a href="pl_exec.c.html#LN5168"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN222"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>, 
</span>                               <a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * ... and get the column's datatype. 
     */ 
</span>    <span class='Operator'>*</span><a href="pl_exec.c.html#LN5170"><span class='Ref_to_Parameter'>rettype</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="pl_exec.c.html#LN5171"><span class='Ref_to_Parameter'>rettypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there are no rows selected, the result is a NULL of that type. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN926"><span class='Ref_to_Member'>eval_processed</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="pl_exec.c.html#LN5169"><span class='Ref_to_Parameter'>isNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the expression returned no more than one row. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN926"><span class='Ref_to_Member'>eval_processed</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CARDINALITY_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"query \"%s\" returned more than one row"</span><span class='Delimiter'>, 
</span>                        <a href="pl_exec.c.html#LN5168"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN222"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return the single result Datum. 
     */ 
</span>    <span class='Control'>return</span> <a href="../../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                         <a href="pl_exec.c.html#LN5167"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5169"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_eval_expr &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_run_select          Execute a select query 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN5248"></a><span class='Declare_Function'>exec_run_select</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN5249"></a>                <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><span class='Keyword'>long </span><span class='Declare_Parameter'>maxtuples</span><span class='Delimiter'>, </span><a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>portalP</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5251"></a>    <a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span><a name="LN5252"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * On the first call for this expression generate the plan. 
     * 
     * If we don't need to return a portal, then we're just going to execute 
     * the query once, which means it's OK to use a parallel plan, even if the 
     * number of rows being fetched is limited.  If we do need to return a 
     * portal, the caller might do cursor operations, which parallel query 
     * can't support. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN224"><span class='Ref_to_Proto'>exec_prepare_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5248"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, 
</span>                          <a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>portalP</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>? </span><a href="../../../include/nodes/parsenodes.h.html#LN2610"><span class='Ref_to_Const'>CURSOR_OPT_PARALLEL_OK</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If a portal was requested, put the query into the portal 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>portalP</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Set up short-lived ParamListInfo 
         */ 
</span>        <a href="pl_exec.c.html#LN5251"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN271"><span class='Ref_to_Proto'>setup_unshared_param_list</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5248"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Operator'>*</span><a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>portalP</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN145"><span class='Ref_to_Proto'>SPI_cursor_open_with_paramlist</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN5251"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN5248"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>portalP</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not open implicit cursor for query \"%s\": %s"</span><span class='Delimiter'>, 
</span>                 <a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN222"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>, </span><a href="../../../include/executor/spi.h.html#LN114"><span class='Ref_to_Proto'>SPI_result_code_string</span></a><span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5248"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../../include/executor/spi.h.html#LN58"><span class='Ref_to_Const'>SPI_OK_CURSOR</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up ParamListInfo to pass to executor 
     */ 
</span>    <a href="pl_exec.c.html#LN5251"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN269"><span class='Ref_to_Proto'>setup_param_list</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5248"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Execute the query 
     */ 
</span>    <a href="pl_exec.c.html#LN5252"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN84"><span class='Ref_to_Proto'>SPI_execute_plan_with_paramlist</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5251"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>, 
</span>                                         <a href="pl_exec.c.html#LN5248"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>maxtuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5252"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>!= </span><a href="../../../include/executor/spi.h.html#LN53"><span class='Ref_to_Const'>SPI_OK_SELECT</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"query \"%s\" is not a SELECT"</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5249"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN222"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save query results for eventual cleanup */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5248"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN5248"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN925"><span class='Ref_to_Member'>eval_tuptable</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN5248"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN926"><span class='Ref_to_Member'>eval_processed</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN5248"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN927"><span class='Ref_to_Member'>eval_lastoid</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN39"><span class='Ref_to_Global_Var'>SPI_lastoid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN5252"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_run_select &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * exec_for_query --- execute body of FOR loop for each row from a portal 
 * 
 * Used by exec_stmt_fors, exec_stmt_forc and exec_stmt_dynfors 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN5318"></a><span class='Declare_Function'>exec_for_query</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN546"><span class='Ref_to_Struct'>PLpgSQL_stmt_forq</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, 
</span><a name="LN5319"></a>               <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> <span class='Declare_Parameter'>portal</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>prefetch_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5321"></a>    <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN5322"></a>    <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Local'>row</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN5323"></a>    <a href="../../../include/executor/spi.h.html#LN21"><span class='Ref_to_Struct'>SPITupleTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuptab</span><span class='Delimiter'>; 
</span><a name="LN5324"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN5325"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rc</span> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span><a name="LN5326"></a>    <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine if we assign to a record or a row 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN551"><span class='Ref_to_Member'>rec</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN5321"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN551"><span class='Ref_to_Member'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN302"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN552"><span class='Ref_to_Member'>row</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN5322"><span class='Ref_To_Local'>row</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN552"><span class='Ref_to_Member'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN279"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported target"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure the portal doesn't get closed by the user statements we 
     * execute. 
     */ 
</span>    <a href="../../../include/utils/portal.h.html#LN222"><span class='Ref_to_Proto'>PinPortal</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5319"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fetch the initial tuple(s).  If prefetching is allowed then we grab a 
     * few more rows to avoid multiple trips through executor startup 
     * overhead. 
     */ 
</span>    <a href="../../../include/executor/spi.h.html#LN148"><span class='Ref_to_Proto'>SPI_cursor_fetch</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5319"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5319"><span class='Ref_to_Parameter'>prefetch_ok</span></a> <span class='Operator'>? </span><span class='Number'>10</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN5323"><span class='Ref_To_Local'>tuptab</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN5326"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the query didn't return any rows, set the target to NULL and fall 
     * through with found = false. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5326"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5321"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5322"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5323"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pl_exec.c.html#LN5324"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* processed at least one tuple */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now do the loop 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5326"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5370"></a>        <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5370"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN5370"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN5326"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN5370"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Assign the tuple to the target 
             */ 
</span>            <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5321"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5322"><span class='Ref_To_Local'>row</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5323"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5370"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="pl_exec.c.html#LN5323"><span class='Ref_To_Local'>tuptab</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Execute the statements 
             */ 
</span>            <a href="pl_exec.c.html#LN5325"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN167"><span class='Ref_to_Proto'>exec_stmts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN553"><span class='Ref_to_Member'>body</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5325"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>!= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5325"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN116"><span class='Ref_to_EnumConst'>PLPGSQL_RC_EXIT</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* unlabelled exit, so exit the current loop */ 
</span>                        <a href="pl_exec.c.html#LN5325"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN550"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                             strcmp<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN550"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* label matches this loop, so exit loop */ 
</span>                        <a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                        <a href="pl_exec.c.html#LN5325"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * otherwise, we processed a labelled exit that does not 
                     * match the current statement's label, if any; return 
                     * RC_EXIT so that the EXIT continues to recurse upward. 
                     */ 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rc==PLPGSQL_RC_EXIT &raquo; </span> 
                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5325"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN118"><span class='Ref_to_EnumConst'>PLPGSQL_RC_CONTINUE</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* unlabelled continue, so re-run the current loop */ 
</span>                        <a href="pl_exec.c.html#LN5325"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN550"><span class='Ref_to_Member'>label</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                             strcmp<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN550"><span class='Ref_to_Member'>label</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* label matches this loop, so re-run loop */ 
</span>                        <a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN895"><span class='Ref_to_Member'>exitlabel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                        <a href="pl_exec.c.html#LN5325"><span class='Ref_To_Local'>rc</span></a> <span class='Operator'>= </span><a href="plpgsql.h.html#LN115"><span class='Ref_to_EnumConst'>PLPGSQL_RC_OK</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * otherwise, we process a labelled continue that does not 
                     * match the current statement's label, if any; return 
                     * RC_CONTINUE so that the CONTINUE will propagate up the 
                     * stack. 
                     */ 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rc==PLPGSQL_RC_CONTIN... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * We're aborting the loop.  Need a goto to get out of two 
                 * levels of loop... 
                 */ 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pl_exec.c.html#LN5451"><span class='Ref_to_Label'>loop_exit</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rc!=PLPGSQL_RC_OK &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;n;i++ &raquo; </span> 
 
        <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5323"><span class='Ref_To_Local'>tuptab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Fetch more tuples.  If prefetching is allowed, grab 50 at a time. 
         */ 
</span>        <a href="../../../include/executor/spi.h.html#LN148"><span class='Ref_to_Proto'>SPI_cursor_fetch</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5319"><span class='Ref_to_Parameter'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5319"><span class='Ref_to_Parameter'>prefetch_ok</span></a> <span class='Operator'>? </span><span class='Number'>50</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN5323"><span class='Ref_To_Local'>tuptab</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN5326"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while n&GT;0 &raquo; </span> 
 
<a name="LN5451"></a><span class='Label'>loop_exit</span><span class='Operator'>: 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Release last group of tuples (if any) 
     */ 
</span>    <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5323"><span class='Ref_To_Local'>tuptab</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/portal.h.html#LN223"><span class='Ref_to_Proto'>UnpinPortal</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5319"><span class='Ref_to_Parameter'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set the FOUND variable to indicate the result of executing the loop 
     * (namely, whether we looped one or more times). This must be set last so 
     * that it does not interfere with the value of the FOUND variable inside 
     * the loop processing itself. 
     */ 
</span>    <a href="pl_exec.c.html#LN297"><span class='Ref_to_Proto'>exec_set_found</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5318"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5324"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN5325"><span class='Ref_To_Local'>rc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_for_query &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_eval_simple_expr -      Evaluate a simple expression returning 
 *                              a Datum by directly calling ExecEvalExpr(). 
 * 
 * If successful, store results into *result, *isNull, *rettype, *rettypmod 
 * and return TRUE.  If the expression cannot be handled by simple evaluation, 
 * return FALSE. 
 * 
 * Because we only store one execution tree for a simple expression, we 
 * can't handle recursion cases.  So, if we see the tree is already busy 
 * with an evaluation in the current xact, we just return FALSE and let the 
 * caller run the expression the hard way.  (Other alternatives such as 
 * creating a new tree for a recursive call either introduce memory leaks, 
 * or add enough bookkeeping to be doubtful wins anyway.)  Another case that 
 * is covered by the expr_simple_in_use test is where a previous execution 
 * of the tree was aborted by an error: the tree may contain bogus state 
 * so we dare not re-use it. 
 * 
 * It is possible though unlikely for a simple expression to become non-simple 
 * (consider for example redefining a trivial view).  We must handle that for 
 * correctness; fortunately it's normally inexpensive to call 
 * SPI_plan_get_cached_plan for a simple expression.  We do not consider the 
 * other direction (non-simple expression becoming simple) because we'll still 
 * give correct results if that happens, and it's unlikely to be worth the 
 * cycles to check. 
 * 
 * Note: if pass-by-reference, the result is in the eval_mcontext. 
 * It will be freed when exec_eval_cleanup is done. 
 * ---------- 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN5503"></a><span class='Declare_Function'>exec_eval_simple_expr</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN5504"></a>                      <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, 
</span><a name="LN5505"></a>                      <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN5506"></a>                      <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN5507"></a>                      <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rettype</span><span class='Delimiter'>, 
</span><a name="LN5508"></a>                      <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rettypmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5510"></a>    <a href="../../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5503"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a><span class='Delimiter'>; 
</span><a name="LN5511"></a>    <a href="../../../include/c.h.html#LN398"><span class='Ref_to_Typedef'>LocalTransactionId</span></a> <span class='Declare_Local'>curlxid</span> <span class='Operator'>= </span><a href="../../../backend/storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/proc.h.html#LN104"><span class='Ref_to_Member'>lxid</span></a><span class='Delimiter'>; 
</span><a name="LN5512"></a>    <a href="../../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cplan</span><span class='Delimiter'>; 
</span><a name="LN5513"></a>    <a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span><a name="LN5514"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>save_setup_arg</span><span class='Delimiter'>; 
</span><a name="LN5515"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Forget it if expression wasn't simple before. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN234"><span class='Ref_to_Member'>expr_simple_expr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If expression is in use in current xact, don't touch it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN246"><span class='Ref_to_Member'>expr_simple_in_use</span></a> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN247"><span class='Ref_to_Member'>expr_simple_lxid</span></a> <span class='Operator'>== </span><a href="pl_exec.c.html#LN5511"><span class='Ref_To_Local'>curlxid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Revalidate cached plan, so that we will notice if it became stale. (We 
     * need to hold a refcount while using the plan, anyway.)  If replanning 
     * is needed, do that work in the eval_mcontext. 
     */ 
</span>    <a href="pl_exec.c.html#LN5515"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5503"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN5512"><span class='Ref_To_Local'>cplan</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN117"><span class='Ref_to_Proto'>SPI_plan_get_cached_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5515"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can't get a failure here, because the number of CachedPlanSources in 
     * the SPI plan can't change from what exec_simple_check_plan saw; it's a 
     * property of the raw parsetree generated from the query text. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5512"><span class='Ref_To_Local'>cplan</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5512"><span class='Ref_To_Local'>cplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/plancache.h.html#LN140"><span class='Ref_to_Member'>generation</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN235"><span class='Ref_to_Member'>expr_simple_generation</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* It got replanned ... is it still simple? */ 
</span>        <a href="pl_exec.c.html#LN228"><span class='Ref_to_Proto'>exec_simple_recheck_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5512"><span class='Ref_To_Local'>cplan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* better recheck r/w safety, as well */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN225"><span class='Ref_to_Member'>rwparam</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN229"><span class='Ref_to_Proto'>exec_check_rw_parameter</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN225"><span class='Ref_to_Member'>rwparam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN234"><span class='Ref_to_Member'>expr_simple_expr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Oops, release refcount and fail */ 
</span>            <a href="../../../include/utils/plancache.h.html#LN182"><span class='Ref_to_Proto'>ReleaseCachedPlan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5512"><span class='Ref_To_Local'>cplan</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pass back previously-determined result type. 
     */ 
</span>    <span class='Operator'>*</span><a href="pl_exec.c.html#LN5507"><span class='Ref_to_Parameter'>rettype</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN236"><span class='Ref_to_Member'>expr_simple_type</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="pl_exec.c.html#LN5508"><span class='Ref_to_Parameter'>rettypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN237"><span class='Ref_to_Member'>expr_simple_typmod</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare the expression for execution, if it's not been done already in 
     * the current transaction.  (This will be forced to happen if we called 
     * exec_simple_recheck_plan above.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN247"><span class='Ref_to_Member'>expr_simple_lxid</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN5511"><span class='Ref_To_Local'>curlxid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN5515"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5503"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN914"><span class='Ref_to_Member'>simple_eval_estate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN245"><span class='Ref_to_Member'>expr_simple_state</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/execExpr.c.html#LN111"><span class='Ref_to_Func'>ExecInitExpr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN234"><span class='Ref_to_Member'>expr_simple_expr</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN246"><span class='Ref_to_Member'>expr_simple_in_use</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN247"><span class='Ref_to_Member'>expr_simple_lxid</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5511"><span class='Ref_To_Local'>curlxid</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5515"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We have to do some of the things SPI_execute_plan would do, in 
     * particular advance the snapshot if we are in a non-read-only function. 
     * Without this, stable functions within the expression would fail to see 
     * updates made so far by our own function. 
     */ 
</span>    <a href="pl_exec.c.html#LN5515"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5503"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN5503"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up ParamListInfo to pass to executor.  We need an unshared list if 
     * it's going to include any R/W expanded-object pointer.  For safety, 
     * save and restore estate-&GT;paramLI-&GT;parserSetupArg around our use of the 
     * param list. 
     */ 
</span>    <a href="pl_exec.c.html#LN5514"><span class='Ref_To_Local'>save_setup_arg</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5503"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN72"><span class='Ref_to_Member'>parserSetupArg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN225"><span class='Ref_to_Member'>rwparam</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN5513"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN271"><span class='Ref_to_Proto'>setup_unshared_param_list</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5503"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pl_exec.c.html#LN5513"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN269"><span class='Ref_to_Proto'>setup_param_list</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5503"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN5510"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN206"><span class='Ref_to_Member'>ecxt_param_list_info</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5513"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Mark expression as busy for the duration of the ExecEvalExpr call. 
     */ 
</span>    <a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN246"><span class='Ref_to_Member'>expr_simple_in_use</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Finally we can call the executor to evaluate the expression 
     */ 
</span>    <span class='Operator'>*</span><a href="pl_exec.c.html#LN5505"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="../../../include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN245"><span class='Ref_to_Member'>expr_simple_state</span></a><span class='Delimiter'>, 
</span>                           <a href="pl_exec.c.html#LN5510"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                           <a href="pl_exec.c.html#LN5506"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assorted cleanup */ 
</span>    <a href="pl_exec.c.html#LN5504"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN246"><span class='Ref_to_Member'>expr_simple_in_use</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN5510"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN206"><span class='Ref_to_Member'>ecxt_param_list_info</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN5503"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN72"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5514"><span class='Ref_To_Local'>save_setup_arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN5503"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5515"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can release our refcount on the cached plan. 
     */ 
</span>    <a href="../../../include/utils/plancache.h.html#LN182"><span class='Ref_to_Proto'>ReleaseCachedPlan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5512"><span class='Ref_To_Local'>cplan</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * That's it. 
     */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_eval_simple_expr &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Create a ParamListInfo to pass to SPI 
 * 
 * We share a single ParamListInfo array across all SPI calls made from this 
 * estate, except calls creating cursors, which use setup_unshared_param_list 
 * (see its comments for reasons why), and calls that pass a R/W expanded 
 * object pointer.  A shared array is generally OK since any given slot in 
 * the array would need to contain the same current datum value no matter 
 * which query or expression we're evaluating; but of course that doesn't 
 * hold when a specific variable is being passed as a R/W pointer, because 
 * other expressions in the same function probably don't want to do that. 
 * 
 * Note that paramLI-&GT;parserSetupArg points to the specific PLpgSQL_expr 
 * being evaluated.  This is not an issue for statement-level callers, but 
 * lower-level callers must save and restore estate-&GT;paramLI-&GT;parserSetupArg 
 * just in case there's an active evaluation at an outer call level. 
 * 
 * The general plan for passing parameters to SPI is that plain VAR datums 
 * always have valid images in the shared param list.  This is ensured by 
 * assign_simple_var(), which also marks those params as PARAM_FLAG_CONST, 
 * allowing the planner to use those values in custom plans.  However, non-VAR 
 * datums cannot conveniently be managed that way.  For one thing, they could 
 * throw errors (for example "no such record field") and we do not want that 
 * to happen in a part of the expression that might never be evaluated at 
 * runtime.  For another thing, exec_eval_datum() may return short-lived 
 * values stored in the estate's eval_mcontext, which will not necessarily 
 * survive to the next SPI operation.  And for a third thing, ROW 
 * and RECFIELD datums' values depend on other datums, and we don't have a 
 * cheap way to track that.  Therefore, param slots for non-VAR datum types 
 * are always reset here and then filled on-demand by plpgsql_param_fetch(). 
 * We can save a few cycles by not bothering with the reset loop unless at 
 * least one such param has actually been filled by plpgsql_param_fetch(). 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> 
<a name="LN5678"></a><span class='Declare_Function'>setup_param_list</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5680"></a>    <a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must have created the SPIPlan already (hence, query text has been 
     * parsed/analyzed at least once); else we cannot rely on expr-&GT;paramnos. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5678"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Expressions with R/W parameters can't use the shared param list. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5678"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN225"><span class='Ref_to_Member'>rwparam</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We only need a ParamListInfo if the expression has parameters.  In 
     * principle we should test with bms_is_empty(), but we use a not-null 
     * test because it's faster.  In current usage bits are never removed from 
     * expr-&GT;paramnos, only added, so this test is correct anyway. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5678"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN224"><span class='Ref_to_Member'>paramnos</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Use the common ParamListInfo */ 
</span>        <a href="pl_exec.c.html#LN5680"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5678"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If any resettable parameters have been passed to the executor since 
         * last time, we need to reset those param slots to "invalid", for the 
         * reasons mentioned in the comment above. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5678"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN911"><span class='Ref_to_Member'>params_dirty</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5711"></a>            <a href="../../../include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>resettable_datums</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5678"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN867"><span class='Ref_to_Member'>resettable_datums</span></a><span class='Delimiter'>; 
</span><a name="LN5712"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>dno</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pl_exec.c.html#LN5712"><span class='Ref_To_Local'>dno</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5711"><span class='Ref_To_Local'>resettable_datums</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5712"><span class='Ref_To_Local'>dno</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><a name="LN5716"></a>                <a href="../../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prm</span> <span class='Operator'>= &</span><a href="pl_exec.c.html#LN5680"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN75"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5712"><span class='Ref_To_Local'>dno</span></a><span class='Delimiter'>]; 
</span> 
                <a href="pl_exec.c.html#LN5716"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN58"><span class='Ref_to_Member'>ptype</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="pl_exec.c.html#LN5678"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN911"><span class='Ref_to_Member'>params_dirty</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Set up link to active expr where the hook functions can find it. 
         * Callers must save and restore parserSetupArg if there is any chance 
         * that they are interrupting an active use of parameters. 
         */ 
</span>        <a href="pl_exec.c.html#LN5680"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN72"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN5678"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Allow parameters that aren't needed by this expression to be 
         * ignored. 
         */ 
</span>        <a href="pl_exec.c.html#LN5680"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN74"><span class='Ref_to_Member'>paramMask</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5678"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN224"><span class='Ref_to_Member'>paramnos</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Also make sure this is set before parser hooks need it.  There is 
         * no need to save and restore, since the value is always correct once 
         * set.  (Should be set already, but let's be sure.) 
         */ 
</span>        <a href="pl_exec.c.html#LN5678"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN228"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5678"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if expr-&GT;paramnos &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Expression requires no parameters.  Be sure we represent this case 
         * as a NULL ParamListInfo, so that plancache.c knows there is no 
         * point in a custom plan. 
         */ 
</span>        <a href="pl_exec.c.html#LN5680"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="pl_exec.c.html#LN5680"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_param_list &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create an unshared, short-lived ParamListInfo to pass to SPI 
 * 
 * When creating a cursor, we do not use the shared ParamListInfo array 
 * but create a short-lived one that will contain only params actually 
 * referenced by the query.  The reason for this is that copyParamList() will 
 * be used to copy the parameters into cursor-lifespan storage, and we don't 
 * want it to copy anything that's not used by the specific cursor; that 
 * could result in uselessly copying some large values. 
 * 
 * We also use this for expressions that are passing a R/W object pointer 
 * to some trusted function.  We don't want the R/W pointer to get into the 
 * shared param list, where it could get passed to some less-trusted function. 
 * 
 * The result, if not NULL, is in the estate's eval_mcontext. 
 * 
 * XXX. Could we use ParamListInfo's new paramMask to avoid creating unshared 
 * parameter lists? 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> 
<a name="LN5775"></a><span class='Declare_Function'>setup_unshared_param_list</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5777"></a>    <a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Local'>paramLI</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must have created the SPIPlan already (hence, query text has been 
     * parsed/analyzed at least once); else we cannot rely on expr-&GT;paramnos. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We only need a ParamListInfo if the expression has parameters.  In 
     * principle we should test with bms_is_empty(), but we use a not-null 
     * test because it's faster.  In current usage bits are never removed from 
     * expr-&GT;paramnos, only added, so this test is correct anyway. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN224"><span class='Ref_to_Member'>paramnos</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5793"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>dno</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* initialize ParamListInfo with one entry per datum, all invalid */ 
</span>        <a href="pl_exec.c.html#LN5777"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN117"><span class='Ref_to_Macro'>eval_mcontext_alloc0</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/params.h.html#LN67"><span class='Ref_to_Struct'>ParamListInfoData</span></a><span class='Delimiter'>, </span>params<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                                 <a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN5777"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN69"><span class='Ref_to_Member'>paramFetch</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN273"><span class='Ref_to_Proto'>plpgsql_param_fetch</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN5777"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN70"><span class='Ref_to_Member'>paramFetchArg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN5777"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN71"><span class='Ref_to_Member'>parserSetup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/params.h.html#LN65"><span class='Ref_to_Typedef'>ParserSetupHook</span></a><span class='Parentheses'>) </span><a href="pl_comp.c.html#LN1016"><span class='Ref_to_Func'>plpgsql_parser_setup</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN5777"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN72"><span class='Ref_to_Member'>parserSetupArg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN5777"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN73"><span class='Ref_to_Member'>numParams</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN5777"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN74"><span class='Ref_to_Member'>paramMask</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Instantiate values for "safe" parameters of the expression.  We 
         * could skip this and leave them to be filled by plpgsql_param_fetch; 
         * but then the values would not be available for query planning, 
         * since the planner doesn't call the paramFetch hook. 
         */ 
</span>        <a href="pl_exec.c.html#LN5793"><span class='Ref_To_Local'>dno</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pl_exec.c.html#LN5793"><span class='Ref_To_Local'>dno</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN224"><span class='Ref_to_Member'>paramnos</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5793"><span class='Ref_To_Local'>dno</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN5816"></a>            <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>datum</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5793"><span class='Ref_To_Local'>dno</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5816"><span class='Ref_To_Local'>datum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN5820"></a>                <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN5816"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>; 
</span><a name="LN5821"></a>                <a href="../../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prm</span> <span class='Operator'>= &</span><a href="pl_exec.c.html#LN5777"><span class='Ref_To_Local'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN75"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5793"><span class='Ref_To_Local'>dno</span></a><span class='Delimiter'>]; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5793"><span class='Ref_To_Local'>dno</span></a> <span class='Operator'>== </span><a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN225"><span class='Ref_to_Member'>rwparam</span></a><span class='Parentheses'>) 
</span>                    <a href="pl_exec.c.html#LN5821"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN5820"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pl_exec.c.html#LN5821"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/utils/expandeddatum.h.html#LN143"><span class='Ref_to_Macro'>MakeExpandedObjectReadOnly</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5820"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                                                            <a href="pl_exec.c.html#LN5820"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>, 
</span>                                                      <a href="pl_exec.c.html#LN5820"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN180"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN5821"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN56"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5820"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN5821"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN57"><span class='Ref_to_Member'>pflags</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/params.h.html#LN51"><span class='Ref_to_Const'>PARAM_FLAG_CONST</span></a><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN5821"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN58"><span class='Ref_to_Member'>ptype</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5820"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (dno=bms_next_member(... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Also make sure this is set before parser hooks need it.  There is 
         * no need to save and restore, since the value is always correct once 
         * set.  (Should be set already, but let's be sure.) 
         */ 
</span>        <a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN228"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5775"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN882"><span class='Ref_to_Member'>func</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if expr-&GT;paramnos &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Expression requires no parameters.  Be sure we represent this case 
         * as a NULL ParamListInfo, so that plancache.c knows there is no 
         * point in a custom plan. 
         */ 
</span>        <a href="pl_exec.c.html#LN5777"><span class='Ref_To_Local'>paramLI</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="pl_exec.c.html#LN5777"><span class='Ref_To_Local'>paramLI</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_unshared_param_list &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_param_fetch      paramFetch callback for dynamic parameter fetch 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5858"></a><span class='Declare_Function'>plpgsql_param_fetch</span><span class='Parentheses'>(</span><a href="../../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>paramid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5860"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dno</span><span class='Delimiter'>; 
</span><a name="LN5861"></a>    <a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN5862"></a>    <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span><span class='Delimiter'>; 
</span><a name="LN5863"></a>    <a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN5864"></a>    <a href="../../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prm</span><span class='Delimiter'>; 
</span><a name="LN5865"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>prmtypmod</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* paramid's are 1-based, but dnos are 0-based */ 
</span>    <a href="pl_exec.c.html#LN5860"><span class='Ref_To_Local'>dno</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5858"><span class='Ref_to_Parameter'>paramid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5860"><span class='Ref_To_Local'>dno</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN5860"><span class='Ref_To_Local'>dno</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN5858"><span class='Ref_to_Parameter'>params</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN73"><span class='Ref_to_Member'>numParams</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fetch back the hook data */ 
</span>    <a href="pl_exec.c.html#LN5861"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN5858"><span class='Ref_to_Parameter'>params</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN70"><span class='Ref_to_Member'>paramFetchArg</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN5862"><span class='Ref_To_Local'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN5858"><span class='Ref_to_Parameter'>params</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN72"><span class='Ref_to_Member'>parserSetupArg</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5858"><span class='Ref_to_Parameter'>params</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN73"><span class='Ref_to_Member'>numParams</span></a> <span class='Operator'>== </span><a href="pl_exec.c.html#LN5861"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN906"><span class='Ref_to_Member'>ndatums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* now we can access the target datum */ 
</span>    <a href="pl_exec.c.html#LN5863"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5861"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5860"><span class='Ref_To_Local'>dno</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since copyParamList() or SerializeParamList() will try to materialize 
     * every single parameter slot, it's important to do nothing when asked 
     * for a datum that's not supposed to be used by this SQL expression. 
     * Otherwise we risk failures in exec_eval_datum(), or copying a lot more 
     * data than necessary. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5860"><span class='Ref_To_Local'>dno</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5862"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN224"><span class='Ref_to_Member'>paramnos</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5858"><span class='Ref_to_Parameter'>params</span></a> <span class='Operator'>== </span><a href="pl_exec.c.html#LN5861"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We need to mark the shared params array dirty if we're about to 
         * evaluate a resettable datum. 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5863"><span class='Ref_To_Local'>datum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN61"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_ROW</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN62"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_REC</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="plpgsql.h.html#LN63"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_RECFIELD</span></a><span class='Operator'>: 
</span>                <a href="pl_exec.c.html#LN5861"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN911"><span class='Ref_to_Member'>params_dirty</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* OK, evaluate the value and store into the appropriate paramlist slot */ 
</span>    <a href="pl_exec.c.html#LN5864"><span class='Ref_To_Local'>prm</span></a> <span class='Operator'>= &</span><a href="pl_exec.c.html#LN5858"><span class='Ref_to_Parameter'>params</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN75"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5860"><span class='Ref_To_Local'>dno</span></a><span class='Delimiter'>]; 
</span>    <a href="pl_exec.c.html#LN248"><span class='Ref_to_Proto'>exec_eval_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5861"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5863"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                    <span class='Operator'>&</span><a href="pl_exec.c.html#LN5864"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN58"><span class='Ref_to_Member'>ptype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN5865"><span class='Ref_To_Local'>prmtypmod</span></a><span class='Delimiter'>, 
</span>                    <span class='Operator'>&</span><a href="pl_exec.c.html#LN5864"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN5864"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN56"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* We can always mark params as "const" for executor's purposes */ 
</span>    <a href="pl_exec.c.html#LN5864"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN57"><span class='Ref_to_Member'>pflags</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/params.h.html#LN51"><span class='Ref_to_Const'>PARAM_FLAG_CONST</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a read/write expanded datum, convert reference to read-only, 
     * unless it's safe to pass as read-write. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5863"><span class='Ref_To_Local'>datum</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN197"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN5860"><span class='Ref_To_Local'>dno</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN5862"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN225"><span class='Ref_to_Member'>rwparam</span></a><span class='Parentheses'>) 
</span>        <a href="pl_exec.c.html#LN5864"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/utils/expandeddatum.h.html#LN143"><span class='Ref_to_Macro'>MakeExpandedObjectReadOnly</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5864"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                                                <a href="pl_exec.c.html#LN5864"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN56"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>((</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN5863"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>datatype<span class='Operator'>-&GT;</span>typlen<span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_param_fetch &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_move_row            Move one tuple's values into a record or row 
 * 
 * Since this uses exec_assign_value, caller should eventually call 
 * exec_eval_cleanup to prevent long-term memory leaks. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5935"></a><span class='Declare_Function'>exec_move_row</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN5936"></a>              <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rec</span><span class='Delimiter'>, 
</span><a name="LN5937"></a>              <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>row</span><span class='Delimiter'>, 
</span><a name="LN5938"></a>              <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Delimiter'>, </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Record is simple - just copy the tuple and its descriptor into the 
     * record variable 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Copy input first, just in case it is pointing at variable's value 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>))</span> 
            <a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tup</span></a> <span class='Operator'>= </span><a href="../../../backend/access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* If we have a tupdesc but no data, form an all-nulls tuple */ 
</span><a name="LN5954"></a>            <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN5954"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="pl_exec.c.html#LN115"><span class='Ref_to_Macro'>eval_mcontext_alloc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5935"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memset<span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5954"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tup</span></a> <span class='Operator'>= </span><a href="../../../backend/access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5954"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Free the old value ... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN308"><span class='Ref_to_Member'>freetup</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN308"><span class='Ref_to_Member'>freetup</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN309"><span class='Ref_to_Member'>freetupdesc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/access/tupdesc.h.html#LN95"><span class='Ref_to_Proto'>FreeTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN309"><span class='Ref_to_Member'>freetupdesc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* ... and install the new */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tup</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN308"><span class='Ref_to_Member'>freetup</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN306"><span class='Ref_to_Member'>tup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN309"><span class='Ref_to_Member'>freetupdesc</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pl_exec.c.html#LN5936"><span class='Ref_to_Parameter'>rec</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN307"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rec!=NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Row is a bit more complicated in that we assign the individual 
     * attributes of the tuple to the variables the row points to. 
     * 
     * NOTE: this code used to demand row-&GT;nfields == 
     * HeapTupleHeaderGetNatts(tup-&GT;t_data), but that's wrong.  The tuple 
     * might have more fields than we expected if it's from an 
     * inheritance-child table of the current table, or it might have fewer if 
     * the table has had columns added by ALTER TABLE. Ignore extra columns 
     * and assume NULL for missing columns, the same as heap_getattr would do. 
     * We also have to skip over dropped columns in either the source or 
     * destination. 
     * 
     * If we have no tuple data at all, we'll assign NULL to all columns of 
     * the row variable. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5937"><span class='Ref_to_Parameter'>row</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6016"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>td_natts</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a> <span class='Operator'>? </span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN6017"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>t_natts</span><span class='Delimiter'>; 
</span><a name="LN6018"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>fnum</span><span class='Delimiter'>; 
</span><a name="LN6019"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>anum</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>))</span> 
            <a href="pl_exec.c.html#LN6017"><span class='Ref_To_Local'>t_natts</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN531"><span class='Ref_to_Macro'>HeapTupleHeaderGetNatts</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pl_exec.c.html#LN6017"><span class='Ref_To_Local'>t_natts</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN6019"><span class='Ref_To_Local'>anum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6018"><span class='Ref_To_Local'>fnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN6018"><span class='Ref_To_Local'>fnum</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN5937"><span class='Ref_to_Parameter'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN291"><span class='Ref_to_Member'>nfields</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN6018"><span class='Ref_To_Local'>fnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN6029"></a>            <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN6030"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN6031"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN6032"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>valtype</span><span class='Delimiter'>; 
</span><a name="LN6033"></a>            <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>valtypmod</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5937"><span class='Ref_to_Parameter'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6018"><span class='Ref_To_Local'>fnum</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* skip dropped column in row struct */ 
</span> 
            <a href="pl_exec.c.html#LN6029"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN5935"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN5937"><span class='Ref_to_Parameter'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6018"><span class='Ref_To_Local'>fnum</span></a><span class='Delimiter'>]]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6019"><span class='Ref_To_Local'>anum</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN6016"><span class='Ref_To_Local'>td_natts</span></a> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6019"><span class='Ref_To_Local'>anum</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <a href="pl_exec.c.html#LN6019"><span class='Ref_To_Local'>anum</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* skip dropped column in tuple */ 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6019"><span class='Ref_To_Local'>anum</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN6016"><span class='Ref_To_Local'>td_natts</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6019"><span class='Ref_To_Local'>anum</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN6017"><span class='Ref_To_Local'>t_natts</span></a><span class='Parentheses'>) 
</span>                    <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tup</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6019"><span class='Ref_To_Local'>anum</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN6031"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="pl_exec.c.html#LN6031"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pl_exec.c.html#LN6032"><span class='Ref_To_Local'>valtype</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6019"><span class='Ref_To_Local'>anum</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN6033"><span class='Ref_To_Local'>valtypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN5938"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6019"><span class='Ref_To_Local'>anum</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN6019"><span class='Ref_To_Local'>anum</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN6031"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN6032"><span class='Ref_To_Local'>valtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN43"><span class='Ref_to_Const'>UNKNOWNOID</span></a><span class='Delimiter'>; 
</span>                <a href="pl_exec.c.html#LN6033"><span class='Ref_To_Local'>valtypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="pl_exec.c.html#LN244"><span class='Ref_to_Proto'>exec_assign_value</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN5935"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6029"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                              <span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6031"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6032"><span class='Ref_To_Local'>valtype</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6033"><span class='Ref_To_Local'>valtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for fnum=0;fnum&LT;row-&GT;nfie... &raquo; </span> 
 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if row!=NULL &raquo; </span> 
 
    <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported target"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_move_row &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * make_tuple_from_row      Make a tuple from the values of a row object 
 * 
 * A NULL return indicates rowtype mismatch; caller must raise suitable error 
 * 
 * The result tuple is freshly palloc'd in caller's context.  Some junk 
 * may be left behind in eval_mcontext, too. 
 * ---------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN6084"></a><span class='Declare_Function'>make_tuple_from_row</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN6085"></a>                    <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>row</span><span class='Delimiter'>, 
</span><a name="LN6086"></a>                    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6088"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6086"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN6089"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN6090"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dvalues</span><span class='Delimiter'>; 
</span><a name="LN6091"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN6092"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6088"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN6085"><span class='Ref_to_Parameter'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN291"><span class='Ref_to_Member'>nfields</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN6090"><span class='Ref_To_Local'>dvalues</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN117"><span class='Ref_to_Macro'>eval_mcontext_alloc0</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6084"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6088"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6091"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN115"><span class='Ref_to_Macro'>eval_mcontext_alloc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6084"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6088"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6092"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN6092"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN6088"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN6092"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6102"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fieldtypeid</span><span class='Delimiter'>; 
</span><a name="LN6103"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>fieldtypmod</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6086"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6092"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pl_exec.c.html#LN6091"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6092"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* leave the column as null */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6085"><span class='Ref_to_Parameter'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6092"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* should not happen */ 
</span>            <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"dropped rowtype entry for non-dropped column"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN248"><span class='Ref_to_Proto'>exec_eval_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6084"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6084"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6085"><span class='Ref_to_Parameter'>row</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN293"><span class='Ref_to_Member'>varnos</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6092"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]], 
</span>                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN6102"><span class='Ref_To_Local'>fieldtypeid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN6103"><span class='Ref_To_Local'>fieldtypmod</span></a><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN6090"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6092"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN6091"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6092"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6102"><span class='Ref_To_Local'>fieldtypeid</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN6086"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6092"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* XXX should we insist on typmod match, too? */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;natts;i++ &raquo; </span> 
 
    <a href="pl_exec.c.html#LN6089"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../backend/access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6086"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6090"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6091"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN6089"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_tuple_from_row &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * get_tuple_from_datum     extract a tuple from a composite Datum 
 * 
 * Returns a HeapTuple, freshly palloc'd in caller's context. 
 * 
 * Note: it's caller's responsibility to be sure value is of composite type. 
 * ---------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN6135"></a><span class='Declare_Function'>get_tuple_from_datum</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6137"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>td</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN258"><span class='Ref_to_Macro'>DatumGetHeapTupleHeader</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6138"></a>    <a href="../../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tmptup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a temporary HeapTuple control structure */ 
</span>    <a href="pl_exec.c.html#LN6138"><span class='Ref_To_Local'>tmptup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6137"><span class='Ref_To_Local'>td</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6138"><span class='Ref_To_Local'>tmptup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6138"><span class='Ref_To_Local'>tmptup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6138"><span class='Ref_To_Local'>tmptup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6137"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a copy and return it */ 
</span>    <span class='Control'>return</span> <a href="../../../backend/access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN6138"><span class='Ref_To_Local'>tmptup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * get_tupdesc_from_datum   get a tuple descriptor for a composite Datum 
 * 
 * Returns a pointer to the TupleDesc of the tuple's rowtype. 
 * Caller is responsible for calling ReleaseTupleDesc when done with it. 
 * 
 * Note: it's caller's responsibility to be sure value is of composite type. 
 * ---------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> 
<a name="LN6160"></a><span class='Declare_Function'>get_tupdesc_from_datum</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6162"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>td</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN258"><span class='Ref_to_Macro'>DatumGetHeapTupleHeader</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6163"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tupType</span><span class='Delimiter'>; 
</span><a name="LN6164"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tupTypmod</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract rowtype info and find a tupdesc */ 
</span>    <a href="pl_exec.c.html#LN6163"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN444"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypeId</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6162"><span class='Ref_To_Local'>td</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6164"><span class='Ref_To_Local'>tupTypmod</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN454"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypMod</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6162"><span class='Ref_To_Local'>td</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/typcache.h.html#LN151"><span class='Ref_to_Proto'>lookup_rowtype_tupdesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6163"><span class='Ref_To_Local'>tupType</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6164"><span class='Ref_To_Local'>tupTypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_move_row_from_datum     Move a composite Datum into a record or row 
 * 
 * This is equivalent to get_tuple_from_datum() followed by exec_move_row(), 
 * but we avoid constructing an intermediate physical copy of the tuple. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6180"></a><span class='Declare_Function'>exec_move_row_from_datum</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN6181"></a>                         <a href="plpgsql.h.html#LN299"><span class='Ref_to_Struct'>PLpgSQL_rec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rec</span><span class='Delimiter'>, 
</span><a name="LN6182"></a>                         <a href="plpgsql.h.html#LN276"><span class='Ref_to_Struct'>PLpgSQL_row</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>row</span><span class='Delimiter'>, 
</span><a name="LN6183"></a>                         <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6185"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>td</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN258"><span class='Ref_to_Macro'>DatumGetHeapTupleHeader</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN6186"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tupType</span><span class='Delimiter'>; 
</span><a name="LN6187"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tupTypmod</span><span class='Delimiter'>; 
</span><a name="LN6188"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN6189"></a>    <a href="../../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tmptup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract rowtype info and find a tupdesc */ 
</span>    <a href="pl_exec.c.html#LN6186"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN444"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypeId</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6185"><span class='Ref_To_Local'>td</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6187"><span class='Ref_To_Local'>tupTypmod</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN454"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypMod</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6185"><span class='Ref_To_Local'>td</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6188"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN151"><span class='Ref_to_Proto'>lookup_rowtype_tupdesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6186"><span class='Ref_To_Local'>tupType</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6187"><span class='Ref_To_Local'>tupTypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a temporary HeapTuple control structure */ 
</span>    <a href="pl_exec.c.html#LN6189"><span class='Ref_To_Local'>tmptup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6185"><span class='Ref_To_Local'>td</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6189"><span class='Ref_To_Local'>tmptup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6189"><span class='Ref_To_Local'>tmptup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6189"><span class='Ref_To_Local'>tmptup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6185"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Do the move */ 
</span>    <a href="pl_exec.c.html#LN274"><span class='Ref_to_Proto'>exec_move_row</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6180"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6181"><span class='Ref_to_Parameter'>rec</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6182"><span class='Ref_to_Parameter'>row</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN6189"><span class='Ref_To_Local'>tmptup</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6188"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release tupdesc usage count */ 
</span>    <a href="../../../include/access/tupdesc.h.html#LN106"><span class='Ref_to_Macro'>ReleaseTupleDesc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6188"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_move_row_from_datum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * convert_value_to_string          Convert a non-null Datum to C string 
 * 
 * Note: the result is in the estate's eval_mcontext, and will be cleared 
 * by the next exec_eval_cleanup() call.  The invoked output function might 
 * leave additional cruft there as well, so just pfree'ing the result string 
 * would not be enough to avoid memory leaks if we did not do it like this. 
 * In most usages the Datum being passed in is also in that context (if 
 * pass-by-reference) and so an exec_eval_cleanup() call is needed anyway. 
 * 
 * Note: not caching the conversion function lookup is bad for performance. 
 * However, this function isn't currently used in any places where an extra 
 * catalog lookup or two seems like a big deal. 
 * ---------- 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN6225"></a><span class='Declare_Function'>convert_value_to_string</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>valtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6227"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN6228"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN6229"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typoutput</span><span class='Delimiter'>; 
</span><a name="LN6230"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typIsVarlena</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN6228"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6225"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6225"><span class='Ref_to_Parameter'>valtype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN6229"><span class='Ref_To_Local'>typoutput</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN6230"><span class='Ref_To_Local'>typIsVarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6227"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN647"><span class='Ref_to_Proto'>OidOutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6229"><span class='Ref_To_Local'>typoutput</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6228"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN6227"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_cast_value          Cast a value if required 
 * 
 * Note that *isnull is an input and also an output parameter.  While it's 
 * unlikely that a cast operation would produce null from non-null or vice 
 * versa, that could happen in principle. 
 * 
 * Note: the estate's eval_mcontext is used for temporary storage, and may 
 * also contain the result Datum if we have to do a conversion to a pass- 
 * by-reference data type.  Be sure to do an exec_eval_cleanup() call when 
 * done with the result. 
 * ---------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN6254"></a><span class='Declare_Function'>exec_cast_value</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN6255"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Delimiter'>, 
</span><a name="LN6256"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>valtype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>valtypmod</span><span class='Delimiter'>, 
</span><a name="LN6257"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>reqtype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>reqtypmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * If the type of the given value isn't what's requested, convert it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6256"><span class='Ref_to_Parameter'>valtype</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN6257"><span class='Ref_to_Parameter'>reqtype</span></a> <span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6256"><span class='Ref_to_Parameter'>valtypmod</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN6257"><span class='Ref_to_Parameter'>reqtypmod</span></a> <span class='Operator'>&& </span><a href="pl_exec.c.html#LN6257"><span class='Ref_to_Parameter'>reqtypmod</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN6265"></a>        <a href="pl_exec.c.html#LN143"><span class='Ref_to_Typedef'>plpgsql_CastHashEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cast_entry</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN6265"><span class='Ref_To_Local'>cast_entry</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN293"><span class='Ref_to_Proto'>get_cast_hashentry</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6254"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, 
</span>                                        <a href="pl_exec.c.html#LN6256"><span class='Ref_to_Parameter'>valtype</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6256"><span class='Ref_to_Parameter'>valtypmod</span></a><span class='Delimiter'>, 
</span>                                        <a href="pl_exec.c.html#LN6257"><span class='Ref_to_Parameter'>reqtype</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6257"><span class='Ref_to_Parameter'>reqtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6265"><span class='Ref_To_Local'>cast_entry</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN6272"></a>            <a href="../../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6254"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a><span class='Delimiter'>; 
</span><a name="LN6273"></a>            <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN6273"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6254"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN6272"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN216"><span class='Ref_to_Member'>caseValue_datum</span></a> <span class='Operator'>= </span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN6272"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN217"><span class='Ref_to_Member'>caseValue_isNull</span></a> <span class='Operator'>= *</span><a href="pl_exec.c.html#LN6255"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN6265"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN149"><span class='Ref_to_Member'>cast_in_use</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6265"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN148"><span class='Ref_to_Member'>cast_exprstate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6272"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                                 <a href="pl_exec.c.html#LN6255"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN6265"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN149"><span class='Ref_to_Member'>cast_in_use</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6273"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if valtype!=reqtype||(va... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Keyword'>value</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_cast_value &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * get_cast_hashentry           Look up how to perform a type cast 
 * 
 * Returns a plpgsql_CastHashEntry if an expression has to be evaluated, 
 * or NULL if the cast is a mere no-op relabeling.  If there's work to be 
 * done, the cast_exprstate field contains an expression evaluation tree 
 * based on a CaseTestExpr input, and the cast_in_use field should be set 
 * TRUE while executing it. 
 * ---------- 
 */ 
</span><span class='Keyword'>static </span><a href="pl_exec.c.html#LN143"><span class='Ref_to_Typedef'>plpgsql_CastHashEntry</span></a> <span class='Operator'>* 
</span><a name="LN6305"></a><span class='Declare_Function'>get_cast_hashentry</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN6306"></a>                   <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>srctype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>srctypmod</span><span class='Delimiter'>, 
</span><a name="LN6307"></a>                   <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>dsttype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>dsttypmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6309"></a>    <a href="pl_exec.c.html#LN134"><span class='Ref_to_Typedef'>plpgsql_CastHashKey</span></a> <span class='Declare_Local'>cast_key</span><span class='Delimiter'>; 
</span><a name="LN6310"></a>    <a href="pl_exec.c.html#LN143"><span class='Ref_to_Typedef'>plpgsql_CastHashEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cast_entry</span><span class='Delimiter'>; 
</span><a name="LN6311"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN6312"></a>    <a href="../../../include/c.h.html#LN398"><span class='Ref_to_Typedef'>LocalTransactionId</span></a> <span class='Declare_Local'>curlxid</span><span class='Delimiter'>; 
</span><a name="LN6313"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look for existing entry */ 
</span>    <a href="pl_exec.c.html#LN6309"><span class='Ref_To_Local'>cast_key</span></a><span class='Operator'>.</span><a href="pl_exec.c.html#LN137"><span class='Ref_to_Member'>srctype</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6306"><span class='Ref_to_Parameter'>srctype</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6309"><span class='Ref_To_Local'>cast_key</span></a><span class='Operator'>.</span><a href="pl_exec.c.html#LN138"><span class='Ref_to_Member'>dsttype</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6307"><span class='Ref_to_Parameter'>dsttype</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6309"><span class='Ref_To_Local'>cast_key</span></a><span class='Operator'>.</span><a href="pl_exec.c.html#LN139"><span class='Ref_to_Member'>srctypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6306"><span class='Ref_to_Parameter'>srctypmod</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6309"><span class='Ref_To_Local'>cast_key</span></a><span class='Operator'>.</span><a href="pl_exec.c.html#LN140"><span class='Ref_to_Member'>dsttypmod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6307"><span class='Ref_to_Parameter'>dsttypmod</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN143"><span class='Ref_to_Typedef'>plpgsql_CastHashEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6305"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN917"><span class='Ref_to_Member'>cast_hash</span></a><span class='Delimiter'>, 
</span>                                                       <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN6309"><span class='Ref_To_Local'>cast_key</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/utils/hsearch.h.html#LN104"><span class='Ref_to_EnumConst'>HASH_FIND</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We've not looked up this coercion before */ 
</span><a name="LN6327"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cast_expr</span><span class='Delimiter'>; 
</span><a name="LN6328"></a>        <a href="../../../include/nodes/primnodes.h.html#LN931"><span class='Ref_to_Struct'>CaseTestExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>placeholder</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Since we could easily fail (no such coercion), construct a 
         * temporary coercion expression tree in the short-lived 
         * eval_mcontext, then if successful copy it to cast_hash_context. 
         */ 
</span>        <a href="pl_exec.c.html#LN6313"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6305"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We use a CaseTestExpr as the base of the coercion tree, since it's 
         * very cheap to insert the source value for that. 
         */ 
</span>        <a href="pl_exec.c.html#LN6328"><span class='Ref_To_Local'>placeholder</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN931"><span class='Ref_to_Struct'>CaseTestExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN6328"><span class='Ref_To_Local'>placeholder</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN934"><span class='Ref_to_Member'>typeId</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6306"><span class='Ref_to_Parameter'>srctype</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN6328"><span class='Ref_To_Local'>placeholder</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN935"><span class='Ref_to_Member'>typeMod</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6306"><span class='Ref_to_Parameter'>srctypmod</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN6328"><span class='Ref_To_Local'>placeholder</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN936"><span class='Ref_to_Member'>collation</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN166"><span class='Ref_to_Proto'>get_typcollation</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6306"><span class='Ref_to_Parameter'>srctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Apply coercion.  We use ASSIGNMENT coercion because that's the 
         * closest match to plpgsql's historical behavior; in particular, 
         * EXPLICIT coercion would allow silent truncation to a destination 
         * varchar/bpchar's length, which we do not want. 
         * 
         * If source type is UNKNOWN, coerce_to_target_type will fail (it only 
         * expects to see that for Const input nodes), so don't call it; we'll 
         * apply CoerceViaIO instead.  Likewise, it doesn't currently work for 
         * coercing RECORD to some other type, so skip for that too. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6306"><span class='Ref_to_Parameter'>srctype</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN43"><span class='Ref_to_Const'>UNKNOWNOID</span></a> <span class='Operator'>|| </span><a href="pl_exec.c.html#LN6306"><span class='Ref_to_Parameter'>srctype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>            <a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a> <span class='Operator'>= </span><a href="../../../include/parser/parse_coerce.h.html#LN37"><span class='Ref_to_Proto'>coerce_to_target_type</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6328"><span class='Ref_To_Local'>placeholder</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6306"><span class='Ref_to_Parameter'>srctype</span></a><span class='Delimiter'>, 
</span>                                              <a href="pl_exec.c.html#LN6307"><span class='Ref_to_Parameter'>dsttype</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6307"><span class='Ref_to_Parameter'>dsttypmod</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/nodes/primnodes.h.html#LN421"><span class='Ref_to_EnumConst'>COERCION_ASSIGNMENT</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If there's no cast path according to the parser, fall back to using 
         * an I/O coercion; this is semantically dubious but matches plpgsql's 
         * historical behavior.  We would need something of the sort for 
         * UNKNOWN literals in any case. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN6375"></a>            <a href="../../../include/nodes/primnodes.h.html#LN806"><span class='Ref_to_Struct'>CoerceViaIO</span></a> <span class='Operator'>*</span><span class='Declare_Local'>iocoerce</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN806"><span class='Ref_to_Struct'>CoerceViaIO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN6375"><span class='Ref_To_Local'>iocoerce</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN809"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6328"><span class='Ref_To_Local'>placeholder</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN6375"><span class='Ref_To_Local'>iocoerce</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN810"><span class='Ref_to_Member'>resulttype</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6307"><span class='Ref_to_Parameter'>dsttype</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN6375"><span class='Ref_To_Local'>iocoerce</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN812"><span class='Ref_to_Member'>resultcollid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN6375"><span class='Ref_To_Local'>iocoerce</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN813"><span class='Ref_to_Member'>coerceformat</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN6375"><span class='Ref_To_Local'>iocoerce</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN814"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6375"><span class='Ref_To_Local'>iocoerce</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6307"><span class='Ref_to_Parameter'>dsttypmod</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a> <span class='Operator'>= </span><a href="../../../include/parser/parse_coerce.h.html#LN37"><span class='Ref_to_Proto'>coerce_to_target_type</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6307"><span class='Ref_to_Parameter'>dsttype</span></a><span class='Delimiter'>, 
</span>                                                  <a href="pl_exec.c.html#LN6307"><span class='Ref_to_Parameter'>dsttype</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6307"><span class='Ref_to_Parameter'>dsttypmod</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/nodes/primnodes.h.html#LN421"><span class='Ref_to_EnumConst'>COERCION_ASSIGNMENT</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/nodes/primnodes.h.html#LN438"><span class='Ref_to_EnumConst'>COERCE_IMPLICIT_CAST</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Note: we don't bother labeling the expression tree with collation */ 
</span> 
        <span class='Comment_Multi_Line'>/* Detect whether we have a no-op (RelabelType) coercion */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="pl_exec.c.html#LN6328"><span class='Ref_To_Local'>placeholder</span></a><span class='Parentheses'>)</span> 
            <a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ExecInitExpr assumes we've planned the expression */ 
</span>            <a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/optimizer/planner.h.html#LN53"><span class='Ref_to_Proto'>expression_planner</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Now copy the tree into cast_hash_context */ 
</span>            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6305"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN918"><span class='Ref_to_Member'>cast_hash_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6313"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Now we can fill in a hashtable entry. */ 
</span>        <a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN143"><span class='Ref_to_Typedef'>plpgsql_CastHashEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6305"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN917"><span class='Ref_to_Member'>cast_hash</span></a><span class='Delimiter'>, 
</span>                                                           <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN6309"><span class='Ref_To_Local'>cast_key</span></a><span class='Delimiter'>, 
</span>                                                         <a href="../../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN6311"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN6311"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* wasn't there a moment ago */ 
</span>        <a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN146"><span class='Ref_to_Member'>cast_expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6327"><span class='Ref_To_Local'>cast_expr</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN148"><span class='Ref_to_Member'>cast_exprstate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN149"><span class='Ref_to_Member'>cast_in_use</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN150"><span class='Ref_to_Member'>cast_lxid</span></a> <span class='Operator'>= </span><a href="../../../include/storage/lock.h.html#LN69"><span class='Ref_to_Const'>InvalidLocalTransactionId</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cast_entry==NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Done if we have determined that this is a no-op cast. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN146"><span class='Ref_to_Member'>cast_expr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare the expression for execution, if it's not been done already in 
     * the current transaction; also, if it's marked busy in the current 
     * transaction, abandon that expression tree and build a new one, so as to 
     * avoid potential problems with recursive cast expressions and failed 
     * executions.  (We will leak some memory intra-transaction if that 
     * happens a lot, but we don't expect it to.)  It's okay to update the 
     * hash table with the new tree because all plpgsql functions within a 
     * given transaction share the same simple_eval_estate.  (Well, regular 
     * functions do; DO blocks have private simple_eval_estates, and private 
     * cast hash tables to go with them.) 
     */ 
</span>    <a href="pl_exec.c.html#LN6312"><span class='Ref_To_Local'>curlxid</span></a> <span class='Operator'>= </span><a href="../../../backend/storage/lmgr/proc.c.html#LN66"><span class='Ref_to_Global_Var'>MyProc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/storage/proc.h.html#LN104"><span class='Ref_to_Member'>lxid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN150"><span class='Ref_to_Member'>cast_lxid</span></a> <span class='Operator'>!= </span><a href="pl_exec.c.html#LN6312"><span class='Ref_To_Local'>curlxid</span></a> <span class='Operator'>|| </span><a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN149"><span class='Ref_to_Member'>cast_in_use</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN6313"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6305"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN914"><span class='Ref_to_Member'>simple_eval_estate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN148"><span class='Ref_to_Member'>cast_exprstate</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/execExpr.c.html#LN111"><span class='Ref_to_Func'>ExecInitExpr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN146"><span class='Ref_to_Member'>cast_expr</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN149"><span class='Ref_to_Member'>cast_in_use</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN150"><span class='Ref_to_Member'>cast_lxid</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6312"><span class='Ref_To_Local'>curlxid</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6313"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN6310"><span class='Ref_To_Local'>cast_entry</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_cast_hashentry &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_simple_check_node -     Recursively check if an expression 
 *                              is made only of simple things we can 
 *                              hand out directly to ExecEvalExpr() 
 *                              instead of calling SPI. 
 * ---------- 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN6460"></a><span class='Declare_Function'>exec_simple_check_node</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN146"><span class='Ref_to_EnumConst'>T_Const</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN147"><span class='Ref_to_EnumConst'>T_Param</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN151"><span class='Ref_to_EnumConst'>T_ArrayRef</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6475"></a>                <a href="../../../include/nodes/primnodes.h.html#LN395"><span class='Ref_to_Struct'>ArrayRef</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN395"><span class='Ref_to_Struct'>ArrayRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6475"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN402"><span class='Ref_to_Member'>refupperindexpr</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6475"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN404"><span class='Ref_to_Member'>reflowerindexpr</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6475"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN406"><span class='Ref_to_Member'>refexpr</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6475"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN408"><span class='Ref_to_Member'>refassgnexpr</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN152"><span class='Ref_to_EnumConst'>T_FuncExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6491"></a>                <a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6491"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN449"><span class='Ref_to_Member'>funcretset</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6491"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN154"><span class='Ref_to_EnumConst'>T_OpExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6503"></a>                <a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6503"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN497"><span class='Ref_to_Member'>opretset</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6503"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN155"><span class='Ref_to_EnumConst'>T_DistinctExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6515"></a>                <a href="../../../include/nodes/primnodes.h.html#LN514"><span class='Ref_to_Typedef'>DistinctExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN514"><span class='Ref_to_Typedef'>DistinctExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6515"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN497"><span class='Ref_to_Member'>opretset</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6515"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN156"><span class='Ref_to_EnumConst'>T_NullIfExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6527"></a>                <a href="../../../include/nodes/primnodes.h.html#LN522"><span class='Ref_to_Typedef'>NullIfExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN522"><span class='Ref_to_Typedef'>NullIfExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6527"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN497"><span class='Ref_to_Member'>opretset</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6527"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN157"><span class='Ref_to_EnumConst'>T_ScalarArrayOpExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6539"></a>                <a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6539"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN541"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN158"><span class='Ref_to_EnumConst'>T_BoolExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6549"></a>                <a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6549"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN561"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN162"><span class='Ref_to_EnumConst'>T_FieldSelect</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN737"><span class='Ref_to_Struct'>FieldSelect</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN163"><span class='Ref_to_EnumConst'>T_FieldStore</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6562"></a>                <a href="../../../include/nodes/primnodes.h.html#LN763"><span class='Ref_to_Struct'>FieldStore</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN763"><span class='Ref_to_Struct'>FieldStore</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6562"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN766"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6562"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN767"><span class='Ref_to_Member'>newvals</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN164"><span class='Ref_to_EnumConst'>T_RelabelType</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN165"><span class='Ref_to_EnumConst'>T_CoerceViaIO</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN806"><span class='Ref_to_Struct'>CoerceViaIO</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN166"><span class='Ref_to_EnumConst'>T_ArrayCoerceExpr</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN829"><span class='Ref_to_Struct'>ArrayCoerceExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN167"><span class='Ref_to_EnumConst'>T_ConvertRowtypeExpr</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN854"><span class='Ref_to_Struct'>ConvertRowtypeExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN169"><span class='Ref_to_EnumConst'>T_CaseExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6586"></a>                <a href="../../../include/nodes/primnodes.h.html#LN901"><span class='Ref_to_Struct'>CaseExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN901"><span class='Ref_to_Struct'>CaseExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6586"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN906"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6586"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN907"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6586"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN908"><span class='Ref_to_Member'>defresult</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN170"><span class='Ref_to_EnumConst'>T_CaseWhen</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6600"></a>                <a href="../../../include/nodes/primnodes.h.html#LN915"><span class='Ref_to_Struct'>CaseWhen</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>when</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN915"><span class='Ref_to_Struct'>CaseWhen</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6600"><span class='Ref_To_Local'>when</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN918"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6600"><span class='Ref_To_Local'>when</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN919"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN171"><span class='Ref_to_EnumConst'>T_CaseTestExpr</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN172"><span class='Ref_to_EnumConst'>T_ArrayExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6615"></a>                <a href="../../../include/nodes/primnodes.h.html#LN947"><span class='Ref_to_Struct'>ArrayExpr</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN947"><span class='Ref_to_Struct'>ArrayExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6615"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN953"><span class='Ref_to_Member'>elements</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN173"><span class='Ref_to_EnumConst'>T_RowExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6625"></a>                <a href="../../../include/nodes/primnodes.h.html#LN981"><span class='Ref_to_Struct'>RowExpr</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN981"><span class='Ref_to_Struct'>RowExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6625"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN984"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN174"><span class='Ref_to_EnumConst'>T_RowCompareExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6635"></a>                <a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6635"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1033"><span class='Ref_to_Member'>largs</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6635"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1034"><span class='Ref_to_Member'>rargs</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN175"><span class='Ref_to_EnumConst'>T_CoalesceExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6647"></a>                <a href="../../../include/nodes/primnodes.h.html#LN1040"><span class='Ref_to_Struct'>CoalesceExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1040"><span class='Ref_to_Struct'>CoalesceExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6647"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1045"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN176"><span class='Ref_to_EnumConst'>T_MinMaxExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6657"></a>                <a href="../../../include/nodes/primnodes.h.html#LN1058"><span class='Ref_to_Struct'>MinMaxExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1058"><span class='Ref_to_Struct'>MinMaxExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6657"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1065"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN177"><span class='Ref_to_EnumConst'>T_SQLValueFunction</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN178"><span class='Ref_to_EnumConst'>T_XmlExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6670"></a>                <a href="../../../include/nodes/primnodes.h.html#LN1137"><span class='Ref_to_Struct'>XmlExpr</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1137"><span class='Ref_to_Struct'>XmlExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6670"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1142"><span class='Ref_to_Member'>named_args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6670"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1144"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN179"><span class='Ref_to_EnumConst'>T_NullTest</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN180"><span class='Ref_to_EnumConst'>T_BooleanTest</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN181"><span class='Ref_to_EnumConst'>T_CoerceToDomain</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN1215"><span class='Ref_to_Struct'>CoerceToDomain</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>arg<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN182"><span class='Ref_to_EnumConst'>T_CoerceToDomainValue</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN290"><span class='Ref_to_EnumConst'>T_List</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN6694"></a>                <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6460"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN6695"></a>                <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6695"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6694"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6695"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)))</span> 
                        <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch nodeTag(node) &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end exec_simple_check_node &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_simple_check_plan -     Check if a plan is simple enough to 
 *                              be evaluated by ExecEvalExpr() instead 
 *                              of SPI. 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6719"></a><span class='Declare_Function'>exec_simple_check_plan</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6721"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>plansources</span><span class='Delimiter'>; 
</span><a name="LN6722"></a>    <a href="../../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plansource</span><span class='Delimiter'>; 
</span><a name="LN6723"></a>    <a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN6724"></a>    <a href="../../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cplan</span><span class='Delimiter'>; 
</span><a name="LN6725"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize to "not simple", and remember the plan generation number we 
     * last checked.  (If we don't get as far as obtaining a plan to check, we 
     * just leave expr_simple_generation set to 0.) 
     */ 
</span>    <a href="pl_exec.c.html#LN6719"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN234"><span class='Ref_to_Member'>expr_simple_expr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6719"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN235"><span class='Ref_to_Member'>expr_simple_generation</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can only test queries that resulted in exactly one CachedPlanSource 
     */ 
</span>    <a href="pl_exec.c.html#LN6721"><span class='Ref_To_Local'>plansources</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN116"><span class='Ref_to_Proto'>SPI_plan_get_plan_sources</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6719"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6721"><span class='Ref_To_Local'>plansources</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6722"><span class='Ref_To_Local'>plansource</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/plancache.h.html#LN79"><span class='Ref_to_Struct'>CachedPlanSource</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6721"><span class='Ref_To_Local'>plansources</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do some checking on the analyzed-and-rewritten form of the query. These 
     * checks are basically redundant with the tests in 
     * exec_simple_recheck_plan, but the point is to avoid building a plan if 
     * possible.  Since this function is only called immediately after 
     * creating the CachedPlanSource, we need not worry about the query being 
     * stale. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 1. There must be one single querytree. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6722"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/plancache.h.html#LN94"><span class='Ref_to_Member'>query_list</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6722"><span class='Ref_To_Local'>plansource</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/plancache.h.html#LN94"><span class='Ref_to_Member'>query_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 2. It must be a plain SELECT query without any input tables 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 3. Can't have any subplans, aggregates, qual clauses either 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN122"><span class='Ref_to_Member'>hasAggs</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN123"><span class='Ref_to_Member'>hasWindowFuncs</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN124"><span class='Ref_to_Member'>hasTargetSRFs</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN125"><span class='Ref_to_Member'>hasSubLinks</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN129"><span class='Ref_to_Member'>hasForUpdate</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN132"><span class='Ref_to_Member'>cteList</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN145"><span class='Ref_to_Member'>groupClause</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN151"><span class='Ref_to_Member'>windowClause</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN153"><span class='Ref_to_Member'>distinctClause</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN155"><span class='Ref_to_Member'>sortClause</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN157"><span class='Ref_to_Member'>limitOffset</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN158"><span class='Ref_to_Member'>limitCount</span></a> <span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 4. The query must have a single attribute as result 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6723"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, it seems worth constructing a plan for more careful checking. 
     * 
     * Get the generic plan for the query.  If replanning is needed, do that 
     * work in the eval_mcontext. 
     */ 
</span>    <a href="pl_exec.c.html#LN6725"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6719"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6724"><span class='Ref_To_Local'>cplan</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN117"><span class='Ref_to_Proto'>SPI_plan_get_cached_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6719"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN223"><span class='Ref_to_Member'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6725"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't fail, because we checked for a single CachedPlanSource above */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6724"><span class='Ref_To_Local'>cplan</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Share the remaining work with recheck code path */ 
</span>    <a href="pl_exec.c.html#LN228"><span class='Ref_to_Proto'>exec_simple_recheck_plan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6719"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6724"><span class='Ref_To_Local'>cplan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release our plan refcount */ 
</span>    <a href="../../../include/utils/plancache.h.html#LN182"><span class='Ref_to_Proto'>ReleaseCachedPlan</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6724"><span class='Ref_To_Local'>cplan</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_simple_check_plan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * exec_simple_recheck_plan --- check for simple plan once we have CachedPlan 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6819"></a><span class='Declare_Function'>exec_simple_recheck_plan</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><a href="../../../include/utils/plancache.h.html#LN129"><span class='Ref_to_Struct'>CachedPlan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cplan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6821"></a>    <a href="../../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span><span class='Delimiter'>; 
</span><a name="LN6822"></a>    <a href="../../../include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN6823"></a>    <a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize to "not simple", and remember the plan generation number we 
     * last checked. 
     */ 
</span>    <a href="pl_exec.c.html#LN6819"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN234"><span class='Ref_to_Member'>expr_simple_expr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6819"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN235"><span class='Ref_to_Member'>expr_simple_generation</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6819"><span class='Ref_to_Parameter'>cplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/plancache.h.html#LN140"><span class='Ref_to_Member'>generation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 1. There must be one single plantree 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6819"><span class='Ref_to_Parameter'>cplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/plancache.h.html#LN132"><span class='Ref_to_Member'>stmt_list</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6821"><span class='Ref_To_Local'>stmt</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6819"><span class='Ref_to_Parameter'>cplan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/plancache.h.html#LN132"><span class='Ref_to_Member'>stmt_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 2. It must be a RESULT plan --&GT; no scan's required 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6821"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN44"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>!= </span><a href="../../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6822"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6821"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN60"><span class='Ref_to_Member'>planTree</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6822"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/plannodes.h.html#LN187"><span class='Ref_to_Struct'>Result</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 3. Can't have any subplan or qual clause, either 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6822"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN145"><span class='Ref_to_Member'>lefttree</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6822"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN146"><span class='Ref_to_Member'>righttree</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6822"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN147"><span class='Ref_to_Member'>initPlan</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="pl_exec.c.html#LN6822"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>((</span><a href="../../../include/nodes/plannodes.h.html#LN187"><span class='Ref_to_Struct'>Result</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6822"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>resconstantqual <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 4. The plan must have a single attribute as result 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6822"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN6823"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6822"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * 5. Check that all the nodes in the expression are non-scary. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN226"><span class='Ref_to_Proto'>exec_simple_check_node</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6823"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Yes - this is a simple expression.  Mark it as such, and initialize 
     * state to "not valid in current transaction". 
     */ 
</span>    <a href="pl_exec.c.html#LN6819"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN234"><span class='Ref_to_Member'>expr_simple_expr</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6823"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6819"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN245"><span class='Ref_to_Member'>expr_simple_state</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6819"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN246"><span class='Ref_to_Member'>expr_simple_in_use</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6819"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN247"><span class='Ref_to_Member'>expr_simple_lxid</span></a> <span class='Operator'>= </span><a href="../../../include/storage/lock.h.html#LN69"><span class='Ref_to_Const'>InvalidLocalTransactionId</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Also stash away the expression result type */ 
</span>    <a href="pl_exec.c.html#LN6819"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN236"><span class='Ref_to_Member'>expr_simple_type</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6823"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN6819"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN237"><span class='Ref_to_Member'>expr_simple_typmod</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6823"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_simple_recheck_plan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * exec_check_rw_parameter --- can we pass expanded object as read/write param? 
 * 
 * If we have an assignment like "x := array_append(x, foo)" in which the 
 * top-level function is trusted not to corrupt its argument in case of an 
 * error, then when x has an expanded object as value, it is safe to pass the 
 * value as a read/write pointer and let the function modify the value 
 * in-place. 
 * 
 * This function checks for a safe expression, and sets expr-&GT;rwparam to the 
 * dno of the target variable (x) if safe, or -1 if not safe. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6898"></a><span class='Declare_Function'>exec_check_rw_parameter</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>target_dno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6900"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcid</span><span class='Delimiter'>; 
</span><a name="LN6901"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fargs</span><span class='Delimiter'>; 
</span><a name="LN6902"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assume unsafe */ 
</span>    <a href="pl_exec.c.html#LN6898"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN225"><span class='Ref_to_Member'>rwparam</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the expression isn't simple, there's no point in trying to optimize 
     * (because the exec_run_select code path will flatten any expanded result 
     * anyway).  Even without that, this seems like a good safety restriction. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6898"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN234"><span class='Ref_to_Member'>expr_simple_expr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If target variable isn't referenced by expression, no need to look 
     * further. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/bitmapset.h.html#LN75"><span class='Ref_to_Proto'>bms_is_member</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6898"><span class='Ref_to_Parameter'>target_dno</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6898"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN224"><span class='Ref_to_Member'>paramnos</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Top level of expression must be a simple FuncExpr or OpExpr. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6898"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN234"><span class='Ref_to_Member'>expr_simple_expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN6927"></a>        <a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>fexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6898"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN234"><span class='Ref_to_Member'>expr_simple_expr</span></a><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN6900"><span class='Ref_To_Local'>funcid</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6927"><span class='Ref_To_Local'>fexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN447"><span class='Ref_to_Member'>funcid</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN6901"><span class='Ref_To_Local'>fargs</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6927"><span class='Ref_To_Local'>fexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6898"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN234"><span class='Ref_to_Member'>expr_simple_expr</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN6934"></a>        <a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>opexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6898"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN234"><span class='Ref_to_Member'>expr_simple_expr</span></a><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN6900"><span class='Ref_To_Local'>funcid</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6934"><span class='Ref_To_Local'>opexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN495"><span class='Ref_to_Member'>opfuncid</span></a><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN6901"><span class='Ref_To_Local'>fargs</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6934"><span class='Ref_To_Local'>opexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The top-level function must be one that we trust to be "safe". 
     * Currently we hard-wire the list, but it would be very desirable to 
     * allow extensions to mark their functions as safe ... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6900"><span class='Ref_To_Local'>funcid</span></a> <span class='Operator'>== </span>F_ARRAY_APPEND <span class='Operator'>|| 
</span>          <a href="pl_exec.c.html#LN6900"><span class='Ref_To_Local'>funcid</span></a> <span class='Operator'>== </span>F_ARRAY_PREPEND<span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The target variable (in the form of a Param) must only appear as a 
     * direct argument of the top-level function. 
     */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6902"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6901"><span class='Ref_To_Local'>fargs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6957"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6902"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* A Param is OK, whether it's the target variable or not */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6957"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>&& </span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6957"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Otherwise, argument expression must not reference target */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN230"><span class='Ref_to_Proto'>contains_target_param</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6957"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN6898"><span class='Ref_to_Parameter'>target_dno</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* OK, we can pass target as a read-write parameter */ 
</span>    <a href="pl_exec.c.html#LN6898"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN225"><span class='Ref_to_Member'>rwparam</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN6898"><span class='Ref_to_Parameter'>target_dno</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_check_rw_parameter &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Recursively check for a Param referencing the target variable 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN6975"></a><span class='Declare_Function'>contains_target_param</span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>target_dno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6975"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6975"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN6981"></a>        <a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>param</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6975"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6981"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN234"><span class='Ref_to_EnumConst'>PARAM_EXTERN</span></a> <span class='Operator'>&& 
</span>            <a href="pl_exec.c.html#LN6981"><span class='Ref_To_Local'>param</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>== *</span><a href="pl_exec.c.html#LN6975"><span class='Ref_to_Parameter'>target_dno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="../../../include/nodes/nodeFuncs.h.html#LN52"><span class='Ref_to_Proto'>expression_tree_walker</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6975"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN230"><span class='Ref_to_Proto'>contains_target_param</span></a><span class='Delimiter'>, 
</span>                                  <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN6975"><span class='Ref_to_Parameter'>target_dno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * exec_set_found           Set the global found variable to true/false 
 * ---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6997"></a><span class='Declare_Function'>exec_set_found</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6999"></a>    <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN6999"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pl_exec.c.html#LN6997"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN6997"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN905"><span class='Ref_to_Member'>found_varno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6997"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN6999"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN6997"><span class='Ref_to_Parameter'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_create_econtext --- create an eval_econtext for the current function 
 * 
 * We may need to create a new shared_simple_eval_estate too, if there's not 
 * one already for the current transaction.  The EState will be cleaned up at 
 * transaction end. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7013"></a><span class='Declare_Function'>plpgsql_create_econtext</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7015"></a>    <a href="pl_exec.c.html#LN80"><span class='Ref_to_Struct'>SimpleEcontextStackEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create an EState for evaluation of simple expressions, if there's not 
     * one already in the current transaction.  The EState is made a child of 
     * TopTransactionContext so it will have the right lifespan. 
     * 
     * Note that this path is never taken when executing a DO block; the 
     * required EState was already made by plpgsql_inline_handler. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7013"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN914"><span class='Ref_to_Member'>simple_eval_estate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN7027"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN87"><span class='Ref_to_Global_Var'>shared_simple_eval_estate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN7027"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../../backend/utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN87"><span class='Ref_to_Global_Var'>shared_simple_eval_estate</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/execUtils.c.html#LN78"><span class='Ref_to_Func'>CreateExecutorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN7013"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN914"><span class='Ref_to_Member'>simple_eval_estate</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN87"><span class='Ref_to_Global_Var'>shared_simple_eval_estate</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7027"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a child econtext for the current function. 
     */ 
</span>    <a href="pl_exec.c.html#LN7013"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a> <span class='Operator'>= </span><a href="../../../backend/executor/execUtils.c.html#LN216"><span class='Ref_to_Func'>CreateExprContext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7013"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN914"><span class='Ref_to_Member'>simple_eval_estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make a stack entry so we can clean up the econtext at subxact end. 
     * Stack entries are kept in TopTransactionContext for simplicity. 
     */ 
</span>    <a href="pl_exec.c.html#LN7015"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN80"><span class='Ref_to_Struct'>SimpleEcontextStackEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="../../../backend/utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Delimiter'>, 
</span>                           <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN80"><span class='Ref_to_Struct'>SimpleEcontextStackEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN7015"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN82"><span class='Ref_to_Member'>stack_econtext</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN7013"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7015"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN83"><span class='Ref_to_Member'>xact_subxid</span></a> <span class='Operator'>= </span><a href="../../../include/access/xact.h.html#LN336"><span class='Ref_to_Proto'>GetCurrentSubTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN7015"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN84"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN7015"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_create_econtext &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_destroy_econtext --- destroy function's econtext 
 * 
 * We check that it matches the top stack entry, and destroy the stack 
 * entry along with the context. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7063"></a><span class='Declare_Function'>plpgsql_destroy_econtext</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7065"></a>    <a href="pl_exec.c.html#LN80"><span class='Ref_to_Struct'>SimpleEcontextStackEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>next</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN82"><span class='Ref_to_Member'>stack_econtext</span></a> <span class='Operator'>== </span><a href="pl_exec.c.html#LN7063"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN7065"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN84"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN7065"><span class='Ref_To_Local'>next</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../backend/executor/execUtils.c.html#LN347"><span class='Ref_to_Func'>FreeExprContext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7063"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7063"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN928"><span class='Ref_to_Member'>eval_econtext</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_xact_cb --- post-transaction-commit-or-abort cleanup 
 * 
 * If a simple-expression EState was created in the current transaction, 
 * it has to be cleaned up. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN7085"></a><span class='Declare_Function'>plpgsql_xact_cb</span><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN98"><span class='Ref_to_Typedef'>XactEvent</span></a> <span class='Declare_Parameter'>event</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * If we are doing a clean transaction shutdown, free the EState (so that 
     * any remaining resources will be released correctly). In an abort, we 
     * expect the regular abort recovery procedures to release everything of 
     * interest. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7085"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../../include/access/xact.h.html#LN100"><span class='Ref_to_EnumConst'>XACT_EVENT_COMMIT</span></a> <span class='Operator'>|| </span><a href="pl_exec.c.html#LN7085"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../../include/access/xact.h.html#LN104"><span class='Ref_to_EnumConst'>XACT_EVENT_PREPARE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Shouldn't be any econtext stack entries left at commit */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN87"><span class='Ref_to_Global_Var'>shared_simple_eval_estate</span></a><span class='Parentheses'>) 
</span>            <a href="../../../backend/executor/execUtils.c.html#LN176"><span class='Ref_to_Func'>FreeExecutorState</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN87"><span class='Ref_to_Global_Var'>shared_simple_eval_estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN87"><span class='Ref_to_Global_Var'>shared_simple_eval_estate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7085"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../../include/access/xact.h.html#LN102"><span class='Ref_to_EnumConst'>XACT_EVENT_ABORT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN87"><span class='Ref_to_Global_Var'>shared_simple_eval_estate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end plpgsql_xact_cb &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * plpgsql_subxact_cb --- post-subtransaction-commit-or-abort cleanup 
 * 
 * Make sure any simple-expression econtexts created in the current 
 * subtransaction get cleaned up.  We have to do this explicitly because 
 * no other code knows which econtexts belong to which level of subxact. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN7117"></a><span class='Declare_Function'>plpgsql_subxact_cb</span><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN112"><span class='Ref_to_Typedef'>SubXactEvent</span></a> <span class='Declare_Parameter'>event</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Parameter'>mySubid</span><span class='Delimiter'>, 
</span><a name="LN7118"></a>                   <a href="../../../include/c.h.html#LN400"><span class='Ref_to_Typedef'>SubTransactionId</span></a> <span class='Declare_Parameter'>parentSubid</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7117"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../../include/access/xact.h.html#LN115"><span class='Ref_to_EnumConst'>SUBXACT_EVENT_COMMIT_SUB</span></a> <span class='Operator'>|| </span><a href="pl_exec.c.html#LN7117"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../../include/access/xact.h.html#LN116"><span class='Ref_to_EnumConst'>SUBXACT_EVENT_ABORT_SUB</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>               <a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN83"><span class='Ref_to_Member'>xact_subxid</span></a> <span class='Operator'>== </span><a href="pl_exec.c.html#LN7117"><span class='Ref_to_Parameter'>mySubid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN7125"></a>            <a href="pl_exec.c.html#LN80"><span class='Ref_to_Struct'>SimpleEcontextStackEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>next</span><span class='Delimiter'>; 
</span> 
            <a href="../../../backend/executor/execUtils.c.html#LN347"><span class='Ref_to_Func'>FreeExprContext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN82"><span class='Ref_to_Member'>stack_econtext</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7117"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../../include/access/xact.h.html#LN115"><span class='Ref_to_EnumConst'>SUBXACT_EVENT_COMMIT_SUB</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN7125"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN84"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pl_exec.c.html#LN88"><span class='Ref_to_Global_Var'>simple_econtext_stack</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN7125"><span class='Ref_To_Local'>next</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * assign_simple_var --- assign a new value to any VAR datum. 
 * 
 * This should be the only mechanism for assignment to simple variables, 
 * lest we forget to update the paramLI image. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7143"></a><span class='Declare_Function'>assign_simple_var</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, 
</span><a name="LN7144"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>newvalue</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>freeable</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7146"></a>    <a href="../../../include/nodes/params.h.html#LN53"><span class='Ref_to_Struct'>ParamExternData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prm</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN255"><span class='Ref_to_Member'>dtype</span></a> <span class='Operator'>== </span><a href="plpgsql.h.html#LN60"><span class='Ref_to_EnumConst'>PLPGSQL_DTYPE_VAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Free the old value if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN270"><span class='Ref_to_Member'>freeval</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/expandeddatum.h.html#LN139"><span class='Ref_to_Macro'>DatumIsReadWriteExpandedObject</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN180"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>))</span> 
            <a href="../../../backend/utils/adt/expandeddatum.c.html#LN134"><span class='Ref_to_Func'>DeleteExpandedObject</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Assign new value to datum */ 
</span>    <a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN7144"><span class='Ref_to_Parameter'>newvalue</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN269"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN7144"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN270"><span class='Ref_to_Member'>freeval</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN7144"><span class='Ref_to_Parameter'>freeable</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* And update the image in the common parameter list */ 
</span>    <a href="pl_exec.c.html#LN7146"><span class='Ref_To_Local'>prm</span></a> <span class='Operator'>= &</span><a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN910"><span class='Ref_to_Member'>paramLI</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN75"><span class='Ref_to_Member'>params</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN256"><span class='Ref_to_Member'>dno</span></a><span class='Delimiter'>]; 
</span>    <a href="pl_exec.c.html#LN7146"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/utils/expandeddatum.h.html#LN143"><span class='Ref_to_Macro'>MakeExpandedObjectReadOnly</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7144"><span class='Ref_to_Parameter'>newvalue</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN7144"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>, 
</span>                                            <a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN180"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7146"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN56"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN7144"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* these might be set already, but let's be sure */ 
</span>    <a href="pl_exec.c.html#LN7146"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN57"><span class='Ref_to_Member'>pflags</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/params.h.html#LN51"><span class='Ref_to_Const'>PARAM_FLAG_CONST</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7146"><span class='Ref_To_Local'>prm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/params.h.html#LN58"><span class='Ref_to_Member'>ptype</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN7143"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN260"><span class='Ref_to_Member'>datatype</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN178"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end assign_simple_var &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * free old value of a text variable and assign new value from C string 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7178"></a><span class='Declare_Function'>assign_text_var</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pl_exec.c.html#LN300"><span class='Ref_to_Proto'>assign_simple_var</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7178"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7178"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7178"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * exec_eval_using_params --- evaluate params of USING clause 
 * 
 * The result data structure is created in the stmt_mcontext, and should 
 * be freed by resetting that context. 
 */ 
</span><span class='Keyword'>static </span><a href="pl_exec.c.html#LN46"><span class='Ref_to_Typedef'>PreparedParamsData</span></a> <span class='Operator'>* 
</span><a name="LN7190"></a><span class='Declare_Function'>exec_eval_using_params</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>params</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7192"></a>    <a href="pl_exec.c.html#LN46"><span class='Ref_to_Typedef'>PreparedParamsData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ppd</span><span class='Delimiter'>; 
</span><a name="LN7193"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>stmt_mcontext</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN161"><span class='Ref_to_Proto'>get_stmt_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7190"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN7194"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nargs</span><span class='Delimiter'>; 
</span><a name="LN7195"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN7196"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN46"><span class='Ref_to_Typedef'>PreparedParamsData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7193"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN46"><span class='Ref_to_Typedef'>PreparedParamsData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7194"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7190"><span class='Ref_to_Parameter'>params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN48"><span class='Ref_to_Member'>nargs</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN7194"><span class='Ref_To_Local'>nargs</span></a><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN49"><span class='Ref_to_Member'>types</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7193"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7194"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN50"><span class='Ref_to_Member'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7193"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7194"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN51"><span class='Ref_to_Member'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7193"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7194"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7196"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7190"><span class='Ref_to_Parameter'>params</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN7213"></a>        <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>param</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7196"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN7214"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN7215"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>ppdtypmod</span><span class='Delimiter'>; 
</span><a name="LN7216"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN50"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7190"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7213"><span class='Ref_To_Local'>param</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN7214"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN49"><span class='Ref_to_Member'>types</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN7215"><span class='Ref_To_Local'>ppdtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN51"><span class='Ref_to_Member'>nulls</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pl_exec.c.html#LN7214"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>? </span><span class='String'>'n'</span> <span class='Operator'>: </span><span class='String'>' '</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN7216"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7193"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN49"><span class='Ref_to_Member'>types</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN43"><span class='Ref_to_Const'>UNKNOWNOID</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Treat 'unknown' parameters as text, since that's what most 
             * people would expect. SPI_execute_with_args can coerce unknown 
             * constants in a more intelligent way, but not unknown Params. 
             * This code also takes care of copying into the right context. 
             * Note we assume 'unknown' has the representation of C-string. 
             */ 
</span>            <a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN49"><span class='Ref_to_Member'>types</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN7214"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                <a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN50"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN50"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* pass-by-ref non null values must be copied into stmt_mcontext */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN7214"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN7242"></a>            <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>typLen</span><span class='Delimiter'>; 
</span><a name="LN7243"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>typByVal</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/lsyscache.h.html#LN135"><span class='Ref_to_Proto'>get_typlenbyval</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN49"><span class='Ref_to_Member'>types</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7242"><span class='Ref_To_Local'>typLen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7243"><span class='Ref_To_Local'>typByVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN7243"><span class='Ref_To_Local'>typByVal</span></a><span class='Parentheses'>) 
</span>                <a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN50"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN50"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="pl_exec.c.html#LN7243"><span class='Ref_To_Local'>typByVal</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7242"><span class='Ref_To_Local'>typLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7216"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7190"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN7195"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN7192"><span class='Ref_To_Local'>ppd</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_eval_using_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Open portal for dynamic query 
 * 
 * Caution: this resets the stmt_mcontext at exit.  We might eventually need 
 * to move that responsibility to the callers, but currently no caller needs 
 * to have statement-lifetime temp data that survives past this, so it's 
 * simpler to do it here. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a> 
<a name="LN7269"></a><span class='Declare_Function'>exec_dynquery_with_params</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN7270"></a>                          <a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dynquery</span><span class='Delimiter'>, 
</span><a name="LN7271"></a>                          <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>params</span><span class='Delimiter'>, 
</span><a name="LN7272"></a>                          <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>portalname</span><span class='Delimiter'>, 
</span><a name="LN7273"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>cursorOptions</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7275"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN7276"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN7277"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN7278"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>restype</span><span class='Delimiter'>; 
</span><a name="LN7279"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>restypmod</span><span class='Delimiter'>; 
</span><a name="LN7280"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>querystr</span><span class='Delimiter'>; 
</span><a name="LN7281"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>stmt_mcontext</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN161"><span class='Ref_to_Proto'>get_stmt_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7269"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Evaluate the string expression after the EXECUTE keyword. Its result is 
     * the querystring we have to execute. 
     */ 
</span>    <a href="pl_exec.c.html#LN7276"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN260"><span class='Ref_to_Proto'>exec_eval_expr</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7269"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7270"><span class='Ref_to_Parameter'>dynquery</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7277"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7278"><span class='Ref_To_Local'>restype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7279"><span class='Ref_To_Local'>restypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7277"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"query string argument of EXECUTE is null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the C-String representation */ 
</span>    <a href="pl_exec.c.html#LN7280"><span class='Ref_To_Local'>querystr</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN287"><span class='Ref_to_Proto'>convert_value_to_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7269"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7276"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7278"><span class='Ref_To_Local'>restype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy it into the stmt_mcontext before we clean up */ 
</span>    <a href="pl_exec.c.html#LN7280"><span class='Ref_To_Local'>querystr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7281"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7280"><span class='Ref_To_Local'>querystr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN222"><span class='Ref_to_Proto'>exec_eval_cleanup</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7269"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Open an implicit cursor for the query.  We use 
     * SPI_cursor_open_with_args even when there are no params, because this 
     * avoids making and freeing one copy of the plan. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7271"><span class='Ref_to_Parameter'>params</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN7308"></a>        <a href="pl_exec.c.html#LN46"><span class='Ref_to_Typedef'>PreparedParamsData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ppd</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN7308"><span class='Ref_To_Local'>ppd</span></a> <span class='Operator'>= </span><a href="pl_exec.c.html#LN304"><span class='Ref_to_Proto'>exec_eval_using_params</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7269"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7271"><span class='Ref_to_Parameter'>params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pl_exec.c.html#LN7275"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN140"><span class='Ref_to_Proto'>SPI_cursor_open_with_args</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7272"><span class='Ref_to_Parameter'>portalname</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN7280"><span class='Ref_To_Local'>querystr</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN7308"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN48"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7308"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN49"><span class='Ref_to_Member'>types</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN7308"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN50"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7308"><span class='Ref_To_Local'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN51"><span class='Ref_to_Member'>nulls</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN7269"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN7273"><span class='Ref_to_Parameter'>cursorOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pl_exec.c.html#LN7275"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN140"><span class='Ref_to_Proto'>SPI_cursor_open_with_args</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7272"><span class='Ref_to_Parameter'>portalname</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN7280"><span class='Ref_To_Local'>querystr</span></a><span class='Delimiter'>, 
</span>                                           <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN7269"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN892"><span class='Ref_to_Member'>readonly_func</span></a><span class='Delimiter'>, 
</span>                                           <a href="pl_exec.c.html#LN7273"><span class='Ref_to_Parameter'>cursorOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7275"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not open implicit cursor for query \"%s\": %s"</span><span class='Delimiter'>, 
</span>             <a href="pl_exec.c.html#LN7280"><span class='Ref_To_Local'>querystr</span></a><span class='Delimiter'>, </span><a href="../../../include/executor/spi.h.html#LN114"><span class='Ref_to_Proto'>SPI_result_code_string</span></a><span class='Parentheses'>(</span><a href="../../../backend/executor/spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release transient data */ 
</span>    <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7281"><span class='Ref_To_Local'>stmt_mcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN7275"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exec_dynquery_with_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return a formatted string with information about an expression's parameters, 
 * or NULL if the expression does not take any parameters. 
 * The result is in the eval_mcontext. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN7344"></a><span class='Declare_Function'>format_expr_params</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN7345"></a>                   <span class='Keyword'>const </span><a href="plpgsql.h.html#LN218"><span class='Ref_to_Struct'>PLpgSQL_expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7347"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>paramno</span><span class='Delimiter'>; 
</span><a name="LN7348"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dno</span><span class='Delimiter'>; 
</span><a name="LN7349"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>paramstr</span><span class='Delimiter'>; 
</span><a name="LN7350"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN7345"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN224"><span class='Ref_to_Member'>paramnos</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN7350"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7344"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7349"><span class='Ref_To_Local'>paramstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7347"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pl_exec.c.html#LN7348"><span class='Ref_To_Local'>dno</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pl_exec.c.html#LN7348"><span class='Ref_To_Local'>dno</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7345"><span class='Ref_to_Parameter'>expr</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN224"><span class='Ref_to_Member'>paramnos</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7348"><span class='Ref_To_Local'>dno</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN7362"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>paramdatum</span><span class='Delimiter'>; 
</span><a name="LN7363"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>paramtypeid</span><span class='Delimiter'>; 
</span><a name="LN7364"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>paramisnull</span><span class='Delimiter'>; 
</span><a name="LN7365"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>paramtypmod</span><span class='Delimiter'>; 
</span><a name="LN7366"></a>        <a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Declare_Local'>curvar</span><span class='Delimiter'>; 
</span> 
        <a href="pl_exec.c.html#LN7366"><span class='Ref_To_Local'>curvar</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN253"><span class='Ref_to_Struct'>PLpgSQL_var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN7344"><span class='Ref_to_Parameter'>estate</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN907"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7348"><span class='Ref_To_Local'>dno</span></a><span class='Delimiter'>]; 
</span> 
        <a href="pl_exec.c.html#LN248"><span class='Ref_to_Proto'>exec_eval_datum</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7344"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN195"><span class='Ref_to_Struct'>PLpgSQL_datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pl_exec.c.html#LN7366"><span class='Ref_To_Local'>curvar</span></a><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN7363"><span class='Ref_To_Local'>paramtypeid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7365"><span class='Ref_To_Local'>paramtypmod</span></a><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="pl_exec.c.html#LN7362"><span class='Ref_To_Local'>paramdatum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7364"><span class='Ref_To_Local'>paramisnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7349"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='String'>"%s%s = "</span><span class='Delimiter'>, 
</span>                         <a href="pl_exec.c.html#LN7347"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><span class='String'>", "</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                         <a href="pl_exec.c.html#LN7366"><span class='Ref_To_Local'>curvar</span></a><span class='Operator'>-&GT;</span><a href="plpgsql.h.html#LN257"><span class='Ref_to_Member'>refname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7364"><span class='Ref_To_Local'>paramisnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7349"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='String'>"NULL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN7382"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>value</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN287"><span class='Ref_to_Proto'>convert_value_to_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7344"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7362"><span class='Ref_To_Local'>paramdatum</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7363"><span class='Ref_To_Local'>paramtypeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN7383"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7349"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7383"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Keyword'>value</span><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="pl_exec.c.html#LN7383"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN7383"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_exec.c.html#LN7383"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\''</span><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* double single quotes */ 
</span>                    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7349"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="pl_exec.c.html#LN7383"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7349"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="pl_exec.c.html#LN7383"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7349"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pl_exec.c.html#LN7347"><span class='Ref_To_Local'>paramno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (dno=bms_next_member(... &raquo; </span> 
 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7350"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN7349"><span class='Ref_To_Local'>paramstr</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end format_expr_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return a formatted string with information about PreparedParamsData, or NULL 
 * if there are no parameters. 
 * The result is in the eval_mcontext. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN7409"></a><span class='Declare_Function'>format_preparedparamsdata</span><span class='Parentheses'>(</span><a href="plpgsql.h.html#LN880"><span class='Ref_to_Struct'>PLpgSQL_execstate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN7410"></a>                          <span class='Keyword'>const </span><a href="pl_exec.c.html#LN46"><span class='Ref_to_Typedef'>PreparedParamsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ppd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7412"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>paramno</span><span class='Delimiter'>; 
</span><a name="LN7413"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>paramstr</span><span class='Delimiter'>; 
</span><a name="LN7414"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pl_exec.c.html#LN7410"><span class='Ref_to_Parameter'>ppd</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pl_exec.c.html#LN7414"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN113"><span class='Ref_to_Macro'>get_eval_mcontext</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7409"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7413"><span class='Ref_To_Local'>paramstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7412"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN7412"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>&LT; </span><a href="pl_exec.c.html#LN7410"><span class='Ref_to_Parameter'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN48"><span class='Ref_to_Member'>nargs</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN7412"><span class='Ref_To_Local'>paramno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7413"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='String'>"%s$%d = "</span><span class='Delimiter'>, 
</span>                         <a href="pl_exec.c.html#LN7412"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><span class='String'>", "</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                         <a href="pl_exec.c.html#LN7412"><span class='Ref_To_Local'>paramno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7410"><span class='Ref_to_Parameter'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN51"><span class='Ref_to_Member'>nulls</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7412"><span class='Ref_To_Local'>paramno</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'n'</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7413"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='String'>"NULL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN7432"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>value</span> <span class='Operator'>= </span><a href="pl_exec.c.html#LN287"><span class='Ref_to_Proto'>convert_value_to_string</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7409"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="pl_exec.c.html#LN7410"><span class='Ref_to_Parameter'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN50"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7412"><span class='Ref_To_Local'>paramno</span></a><span class='Delimiter'>], </span><a href="pl_exec.c.html#LN7410"><span class='Ref_to_Parameter'>ppd</span></a><span class='Operator'>-&GT;</span><a href="pl_exec.c.html#LN49"><span class='Ref_to_Member'>types</span></a><span class='Delimiter'>[</span><a href="pl_exec.c.html#LN7412"><span class='Ref_To_Local'>paramno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN7433"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7413"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7433"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Keyword'>value</span><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="pl_exec.c.html#LN7433"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="pl_exec.c.html#LN7433"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pl_exec.c.html#LN7433"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\''</span><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* double single quotes */ 
</span>                    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7413"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="pl_exec.c.html#LN7433"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7413"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="pl_exec.c.html#LN7433"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pl_exec.c.html#LN7413"><span class='Ref_To_Local'>paramstr</span></a><span class='Delimiter'>, </span><span class='String'>'\''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for paramno=0;paramno&LT;ppd... &raquo; </span> 
 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pl_exec.c.html#LN7414"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pl_exec.c.html#LN7413"><span class='Ref_To_Local'>paramstr</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end format_preparedparamsdata &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>