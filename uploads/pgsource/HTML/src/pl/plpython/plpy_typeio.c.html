<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\pl\plpython\plpy_typeio.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\pl\plpython\plpy_typeio.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:13 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/* 
 * transforming Datums to Python objects and vice versa 
 * 
 * src/pl/plpython/plpy_typeio.c 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/numeric.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"plpython.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"plpy_typeio.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"plpy_elog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"plpy_main.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* I/O function caching */ 
</span><a name="LN32"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PLy_input_datum_func2</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>arg_mcxt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>typeTup</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>langid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trftypes</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN33"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PLy_output_datum_func2</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>arg_mcxt</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>typeTup</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>langid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trftypes</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* conversion from Datums to Python objects */ 
</span><a name="LN36"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyBool_FromBool</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN37"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyFloat_FromFloat4</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN38"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyFloat_FromFloat8</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN39"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyDecimal_FromNumeric</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN40"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyInt_FromInt16</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN41"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyInt_FromInt32</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN42"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyLong_FromInt64</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN43"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyLong_FromOid</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN44"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyBytes_FromBytea</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN45"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyString_FromDatum</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN46"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyObject_FromTransform</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyList_FromArray</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN48"></a><span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Prototype'>PLyList_FromArray_recurse</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elm</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dims</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, 
</span><a name="LN49"></a>                          <span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>dataptr_p</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>bitmap_p</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>bitmask_p</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* conversion from Python objects to Datums */ 
</span><a name="LN52"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>PLyObject_ToBool</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN53"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>PLyObject_ToBytea</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN54"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>PLyObject_ToComposite</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN55"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>PLyObject_ToDatum</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN56"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>PLyObject_ToTransform</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN57"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>PLySequence_ToArray</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN58"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>PLySequence_ToArray_recurse</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elm</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>list</span><span class='Delimiter'>, 
</span><a name="LN59"></a>                            <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dims</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, 
</span><a name="LN60"></a>                            <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elems</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>currelem</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* conversion from Python objects to composite Datums (used by triggers and SRFs) */ 
</span><a name="LN63"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>PLyString_ToComposite</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>info</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN64"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>PLyMapping_ToComposite</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>info</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>mapping</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN65"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>PLySequence_ToComposite</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>info</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>sequence</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN66"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>PLyGenericObject_ToComposite</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>info</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>void 
</span><a name="LN69"></a><span class='Declare_Function'>PLy_typeinfo_init</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="plpy_typeio.c.html#LN69"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN69"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN35"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN69"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN35"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN69"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN69"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN69"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN94"><span class='Ref_to_Member'>typ_relid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN69"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN95"><span class='Ref_to_Member'>typrel_xmin</span></a> <span class='Operator'>= </span><a href="../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN69"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN96"><span class='Ref_to_Member'>typrel_tid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN69"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN99"><span class='Ref_to_Member'>mcxt</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN69"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Conversion functions.  Remember output from Python is input to 
 * PostgreSQL, and vice versa. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN86"></a><span class='Declare_Function'>PLy_input_datum_func</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>typeTup</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>langid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trftypes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN86"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"PLyTypeInfo struct is initialized for Tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN86"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN32"><span class='Ref_to_Proto'>PLy_input_datum_func2</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN86"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN40"><span class='Ref_to_Member'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN86"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN99"><span class='Ref_to_Member'>mcxt</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN86"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN86"><span class='Ref_to_Parameter'>typeTup</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN86"><span class='Ref_to_Parameter'>langid</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN86"><span class='Ref_to_Parameter'>trftypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN95"></a><span class='Declare_Function'>PLy_output_datum_func</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>typeTup</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>langid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trftypes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN95"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"PLyTypeInfo struct is initialized for a Tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN95"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN33"><span class='Ref_to_Proto'>PLy_output_datum_func2</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN95"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN76"><span class='Ref_to_Member'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN95"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN99"><span class='Ref_to_Member'>mcxt</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN95"><span class='Ref_to_Parameter'>typeTup</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN95"><span class='Ref_to_Parameter'>langid</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN95"><span class='Ref_to_Parameter'>trftypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN104"></a><span class='Declare_Function'>PLy_input_tuple_funcs</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN106"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN107"></a>    <a href="plpy_main.h.html#LN17"><span class='Ref_to_Struct'>PLyExecutionContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>exec_ctx</span> <span class='Operator'>= </span><a href="plpy_main.h.html#LN25"><span class='Ref_to_Proto'>PLy_current_execution_context</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN108"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN108"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN99"><span class='Ref_to_Member'>mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"PLyTypeInfo struct is initialized for a Datum"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN35"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>!= </span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN35"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Can this be an unnamed tuple? If not, then an Assert would be enough */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"received unnamed record type as input"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * RECORDOID means we got called to create input functions for a tuple 
     * fetched by plpy.execute or for an anonymous record type 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN136"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>relTup</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get the pg_class tuple corresponding to the type of the input */ 
</span>        <a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN94"><span class='Ref_to_Member'>typ_relid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN47"><span class='Ref_to_Proto'>typeidTypeRelid</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN136"><span class='Ref_To_Local'>relTup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN94"><span class='Ref_to_Member'>typ_relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN136"><span class='Ref_To_Local'>relTup</span></a><span class='Parentheses'>))</span> 
            <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN94"><span class='Ref_to_Member'>typ_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Remember XMIN and TID for later validation if cache is still OK */ 
</span>        <a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN95"><span class='Ref_to_Member'>typrel_xmin</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN136"><span class='Ref_To_Local'>relTup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN96"><span class='Ref_to_Member'>typrel_tid</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN136"><span class='Ref_To_Local'>relTup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN136"><span class='Ref_To_Local'>relTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN106"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN106"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN106"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN153"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>typeTup</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN106"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN106"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN23"><span class='Ref_to_Member'>typoid</span></a> <span class='Operator'>== </span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN106"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* already set up this entry */ 
</span> 
        <a href="plpy_typeio.c.html#LN153"><span class='Ref_To_Local'>typeTup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN106"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN153"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>))</span> 
            <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, 
</span>                 <a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN106"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN32"><span class='Ref_to_Proto'>PLy_input_datum_func2</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN106"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN99"><span class='Ref_to_Member'>mcxt</span></a><span class='Delimiter'>, 
</span>                              <a href="plpy_typeio.c.html#LN104"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN106"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                              <a href="plpy_typeio.c.html#LN153"><span class='Ref_To_Local'>typeTup</span></a><span class='Delimiter'>, 
</span>                              <a href="plpy_typeio.c.html#LN107"><span class='Ref_To_Local'>exec_ctx</span></a><span class='Operator'>-&GT;</span><a href="plpy_main.h.html#LN19"><span class='Ref_to_Member'>curr_proc</span></a><span class='Operator'>-&GT;</span><a href="plpy_procedure.h.html#LN39"><span class='Ref_to_Member'>langid</span></a><span class='Delimiter'>, 
</span>                              <a href="plpy_typeio.c.html#LN107"><span class='Ref_To_Local'>exec_ctx</span></a><span class='Operator'>-&GT;</span><a href="plpy_main.h.html#LN19"><span class='Ref_to_Member'>curr_proc</span></a><span class='Operator'>-&GT;</span><a href="plpy_procedure.h.html#LN40"><span class='Ref_to_Member'>trftypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN153"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;desc-&GT;natts;i++ &raquo; </span> 
 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN108"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLy_input_tuple_funcs &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN180"></a><span class='Declare_Function'>PLy_output_tuple_funcs</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN182"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN183"></a>    <a href="plpy_main.h.html#LN17"><span class='Ref_to_Struct'>PLyExecutionContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>exec_ctx</span> <span class='Operator'>= </span><a href="plpy_main.h.html#LN25"><span class='Ref_to_Proto'>PLy_current_execution_context</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN184"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN184"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN99"><span class='Ref_to_Member'>mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"PLyTypeInfo struct is initialized for a Datum"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN35"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>!= </span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN35"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * RECORDOID means we got called to create output functions for an 
     * anonymous record type 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN208"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>relTup</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get the pg_class tuple corresponding to the type of the output */ 
</span>        <a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN94"><span class='Ref_to_Member'>typ_relid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN47"><span class='Ref_to_Proto'>typeidTypeRelid</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN208"><span class='Ref_To_Local'>relTup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN94"><span class='Ref_to_Member'>typ_relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN208"><span class='Ref_To_Local'>relTup</span></a><span class='Parentheses'>))</span> 
            <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN94"><span class='Ref_to_Member'>typ_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Remember XMIN and TID for later validation if cache is still OK */ 
</span>        <a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN95"><span class='Ref_to_Member'>typrel_xmin</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN208"><span class='Ref_To_Local'>relTup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN96"><span class='Ref_to_Member'>typrel_tid</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN208"><span class='Ref_To_Local'>relTup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN208"><span class='Ref_To_Local'>relTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN182"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN182"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN182"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN225"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>typeTup</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN182"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN182"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN23"><span class='Ref_to_Member'>typoid</span></a> <span class='Operator'>== </span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN182"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* already set up this entry */ 
</span> 
        <a href="plpy_typeio.c.html#LN225"><span class='Ref_To_Local'>typeTup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN182"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN225"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>))</span> 
            <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, 
</span>                 <a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN182"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN33"><span class='Ref_to_Proto'>PLy_output_datum_func2</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN182"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN180"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN99"><span class='Ref_to_Member'>mcxt</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN225"><span class='Ref_To_Local'>typeTup</span></a><span class='Delimiter'>, 
</span>                               <a href="plpy_typeio.c.html#LN183"><span class='Ref_To_Local'>exec_ctx</span></a><span class='Operator'>-&GT;</span><a href="plpy_main.h.html#LN19"><span class='Ref_to_Member'>curr_proc</span></a><span class='Operator'>-&GT;</span><a href="plpy_procedure.h.html#LN39"><span class='Ref_to_Member'>langid</span></a><span class='Delimiter'>, 
</span>                               <a href="plpy_typeio.c.html#LN183"><span class='Ref_To_Local'>exec_ctx</span></a><span class='Operator'>-&GT;</span><a href="plpy_main.h.html#LN19"><span class='Ref_to_Member'>curr_proc</span></a><span class='Operator'>-&GT;</span><a href="plpy_procedure.h.html#LN40"><span class='Ref_to_Member'>trftypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN225"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;desc-&GT;natts;i++ &raquo; </span> 
 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN184"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLy_output_tuple_funcs &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN250"></a><span class='Declare_Function'>PLy_output_record_funcs</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * If the output record functions are already set, we just have to check 
     * if the record descriptor has not changed 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="plpy_typeio.c.html#LN250"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN250"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN76"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN60"><span class='Ref_to_Member'>typmod</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN250"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN76"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN60"><span class='Ref_to_Member'>typmod</span></a> <span class='Operator'>== </span><a href="plpy_typeio.c.html#LN250"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* bless the record to make it known to the typcache lookup code */ 
</span>    <a href="../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN250"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* save the freshly generated typmod */ 
</span>    <a href="plpy_typeio.c.html#LN250"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN76"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN60"><span class='Ref_to_Member'>typmod</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN250"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* proceed with normal I/O function caching */ 
</span>    <a href="plpy_typeio.h.html#LN108"><span class='Ref_to_Proto'>PLy_output_tuple_funcs</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN250"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN250"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * it should change is_rowtype to 1, so we won't go through this again 
     * unless the output record description changes 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN250"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLy_output_record_funcs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Transform a tuple into a Python dict object. 
 */ 
</span>PyObject <span class='Operator'>* 
</span><a name="LN279"></a><span class='Declare_Function'>PLyDict_FromTuple</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>info</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN281"></a>    PyObject   <span class='Operator'>*</span><span class='Keyword'>volatile </span><span class='Declare_Local'>dict</span><span class='Delimiter'>; 
</span><a name="LN282"></a>    <a href="plpy_main.h.html#LN17"><span class='Ref_to_Struct'>PLyExecutionContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>exec_ctx</span> <span class='Operator'>= </span><a href="plpy_main.h.html#LN25"><span class='Ref_to_Proto'>PLy_current_execution_context</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN283"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>scratch_context</span> <span class='Operator'>= </span><a href="plpy_main.h.html#LN28"><span class='Ref_to_Proto'>PLy_get_scratch_context</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN282"><span class='Ref_To_Local'>exec_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN284"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span> <span class='Operator'>= </span><a href="../../backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN279"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"PLyTypeInfo structure describes a datum"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN281"><span class='Ref_To_Local'>dict</span></a> <span class='Operator'>= </span>PyDict_New<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN281"><span class='Ref_To_Local'>dict</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not create new dictionary"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span><a name="LN295"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Do the work in the scratch context to avoid leaking memory from the 
         * datatype output function calls. 
         */ 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN283"><span class='Ref_To_Local'>scratch_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN295"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN295"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN279"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN35"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN295"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN304"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN305"></a>            <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>vattr</span><span class='Delimiter'>; 
</span><a name="LN306"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_null</span><span class='Delimiter'>; 
</span><a name="LN307"></a>            PyObject   <span class='Operator'>*</span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN279"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN295"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="plpy_typeio.c.html#LN304"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN279"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN295"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="plpy_typeio.c.html#LN305"><span class='Ref_To_Local'>vattr</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN279"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN295"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN279"><span class='Ref_to_Parameter'>desc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN306"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN306"><span class='Ref_To_Local'>is_null</span></a> <span class='Operator'>|| </span><a href="plpy_typeio.c.html#LN279"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN295"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                PyDict_SetItemString<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN281"><span class='Ref_To_Local'>dict</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN304"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span>Py_None<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN279"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN295"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a><span class='Parentheses'>) (</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN279"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN85"><span class='Ref_to_Member'>in</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN41"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN295"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="plpy_typeio.c.html#LN305"><span class='Ref_To_Local'>vattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                PyDict_SetItemString<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN281"><span class='Ref_To_Local'>dict</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN304"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                Py_DECREF<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;info-&GT;in.r.natt... &raquo; </span> 
        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN284"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN283"><span class='Ref_To_Local'>scratch_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN284"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        Py_DECREF<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN281"><span class='Ref_To_Local'>dict</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN281"><span class='Ref_To_Local'>dict</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLyDict_FromTuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  Convert a Python object to a composite Datum, using all supported 
 *  conversion methods: composite as a string, as a sequence, as a mapping or 
 *  as an object that has __getattr__ support. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN344"></a><span class='Declare_Function'>PLyObject_ToCompositeDatum</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>info</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN346"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpython.h.html#LN90"><span class='Ref_to_Macro'>PyString_Check</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span>PyUnicode_Check<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>))</span> 
        <a href="plpy_typeio.c.html#LN346"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN63"><span class='Ref_to_Proto'>PLyString_ToComposite</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>info</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>desc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>plrv</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>inarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>PySequence_Check<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>))</span> 
        <span class='Comment_Multi_Line'>/* composite type as sequence (tuple, list etc) */ 
</span>        <a href="plpy_typeio.c.html#LN346"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN65"><span class='Ref_to_Proto'>PLySequence_ToComposite</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>info</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>desc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>PyMapping_Check<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>))</span> 
        <span class='Comment_Multi_Line'>/* composite type as mapping (currently only dict) */ 
</span>        <a href="plpy_typeio.c.html#LN346"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN64"><span class='Ref_to_Proto'>PLyMapping_ToComposite</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>info</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>desc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Comment_Multi_Line'>/* returned as smth, must provide method __getattr__(name) */ 
</span>        <a href="plpy_typeio.c.html#LN346"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN66"><span class='Ref_to_Proto'>PLyGenericObject_ToComposite</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>info</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>desc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>plrv</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN344"><span class='Ref_to_Parameter'>inarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN346"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN364"></a><span class='Declare_Function'>PLy_output_datum_func2</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>arg_mcxt</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>typeTup</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>langid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trftypes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN366"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typeStruct</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN367"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span><span class='Delimiter'>; 
</span><a name="LN368"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>base_type</span><span class='Delimiter'>; 
</span><a name="LN369"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcid</span><span class='Delimiter'>; 
</span><a name="LN370"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN370"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN366"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typinput<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN57"><span class='Ref_to_Member'>typfunc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN60"><span class='Ref_to_Member'>typmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN61"><span class='Ref_to_Member'>typioparam</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN138"><span class='Ref_to_Proto'>getTypeIOParam</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN62"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN366"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typbyval<span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN367"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN160"><span class='Ref_to_Proto'>get_base_element_type</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN368"><span class='Ref_To_Local'>base_type</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN168"><span class='Ref_to_Proto'>getBaseType</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN367"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>? </span><a href="plpy_typeio.c.html#LN367"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>: </span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Select a conversion function to convert Python objects to PostgreSQL 
     * datums. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="plpy_typeio.c.html#LN369"><span class='Ref_To_Local'>funcid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN131"><span class='Ref_to_Proto'>get_transform_tosql</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN368"><span class='Ref_To_Local'>base_type</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>langid</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>trftypes</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN56"><span class='Ref_to_Proto'>PLyObject_ToTransform</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN369"><span class='Ref_To_Local'>funcid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN58"><span class='Ref_to_Member'>typtransform</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN366"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN54"><span class='Ref_to_Proto'>PLyObject_ToComposite</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN368"><span class='Ref_To_Local'>base_type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN52"><span class='Ref_to_Proto'>PLyObject_ToBool</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN18"><span class='Ref_to_Const'>BYTEAOID</span></a><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN53"><span class='Ref_to_Proto'>PLyObject_ToBytea</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN55"><span class='Ref_to_Proto'>PLyObject_ToDatum</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN367"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN413"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>dummy_delim</span><span class='Delimiter'>; 
</span><a name="LN414"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcid</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN150"><span class='Ref_to_Proto'>type_is_rowtype</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN367"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>))</span> 
            <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN54"><span class='Ref_to_Proto'>PLyObject_ToComposite</span></a><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN58"><span class='Ref_to_Member'>typtransform</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN58"><span class='Ref_to_Member'>typtransform</span></a><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN57"><span class='Ref_to_Proto'>PLySequence_ToArray</span></a><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN367"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN60"><span class='Ref_to_Member'>typmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/lsyscache.h.html#LN139"><span class='Ref_to_Proto'>get_type_io_data</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN367"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="../../include/utils/lsyscache.h.html#LN31"><span class='Ref_to_EnumConst'>IOFunc_input</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN63"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN62"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN64"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN413"><span class='Ref_To_Local'>dummy_delim</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN61"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN414"><span class='Ref_To_Local'>funcid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN414"><span class='Ref_To_Local'>funcid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN57"><span class='Ref_to_Member'>typfunc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN364"><span class='Ref_to_Parameter'>arg_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if element_type &raquo; </span> 
 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN370"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLy_output_datum_func2 &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN436"></a><span class='Declare_Function'>PLy_input_datum_func2</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>arg_mcxt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>typeTup</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>langid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trftypes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN438"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typeStruct</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN439"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span><span class='Delimiter'>; 
</span><a name="LN440"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>base_type</span><span class='Delimiter'>; 
</span><a name="LN441"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcid</span><span class='Delimiter'>; 
</span><a name="LN442"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN442"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the type's conversion information */ 
</span>    <a href="../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN438"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typoutput<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN21"><span class='Ref_to_Member'>typfunc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN23"><span class='Ref_to_Member'>typoid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN24"><span class='Ref_to_Member'>typmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN25"><span class='Ref_to_Member'>typioparam</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN138"><span class='Ref_to_Proto'>getTypeIOParam</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN26"><span class='Ref_to_Member'>typbyval</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN438"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typbyval<span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN27"><span class='Ref_to_Member'>typlen</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN438"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typlen<span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN28"><span class='Ref_to_Member'>typalign</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN438"><span class='Ref_To_Local'>typeStruct</span></a><span class='Operator'>-&GT;</span>typalign<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Determine which kind of Python object we will convert to */ 
</span> 
    <a href="plpy_typeio.c.html#LN439"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN160"><span class='Ref_to_Proto'>get_base_element_type</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN440"><span class='Ref_To_Local'>base_type</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN168"><span class='Ref_to_Proto'>getBaseType</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN439"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>? </span><a href="plpy_typeio.c.html#LN439"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>: </span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="plpy_typeio.c.html#LN441"><span class='Ref_To_Local'>funcid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN130"><span class='Ref_to_Proto'>get_transform_fromsql</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN440"><span class='Ref_To_Local'>base_type</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>langid</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>trftypes</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN46"><span class='Ref_to_Proto'>PLyObject_FromTransform</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN441"><span class='Ref_To_Local'>funcid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN22"><span class='Ref_to_Member'>typtransform</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN440"><span class='Ref_To_Local'>base_type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN36"><span class='Ref_to_Proto'>PLyBool_FromBool</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN38"><span class='Ref_to_Const'>FLOAT4OID</span></a><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN37"><span class='Ref_to_Proto'>PLyFloat_FromFloat4</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN39"><span class='Ref_to_Const'>FLOAT8OID</span></a><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN38"><span class='Ref_to_Proto'>PLyFloat_FromFloat8</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN58"><span class='Ref_to_Const'>NUMERICOID</span></a><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN39"><span class='Ref_to_Proto'>PLyDecimal_FromNumeric</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN40"><span class='Ref_to_Proto'>PLyInt_FromInt16</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN41"><span class='Ref_to_Proto'>PLyInt_FromInt32</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN42"><span class='Ref_to_Proto'>PLyLong_FromInt64</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN43"><span class='Ref_to_Proto'>PLyLong_FromOid</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN18"><span class='Ref_to_Const'>BYTEAOID</span></a><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN44"><span class='Ref_to_Proto'>PLyBytes_FromBytea</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN45"><span class='Ref_to_Proto'>PLyString_FromDatum</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch base_type &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN439"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN502"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>dummy_delim</span><span class='Delimiter'>; 
</span><a name="LN503"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcid</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN58"><span class='Ref_to_Member'>typtransform</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN22"><span class='Ref_to_Member'>typtransform</span></a><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN47"><span class='Ref_to_Proto'>PLyList_FromArray</span></a><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN439"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN60"><span class='Ref_to_Member'>typmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/lsyscache.h.html#LN139"><span class='Ref_to_Proto'>get_type_io_data</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN439"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="../../include/utils/lsyscache.h.html#LN32"><span class='Ref_to_EnumConst'>IOFunc_output</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN63"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN62"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN64"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN502"><span class='Ref_To_Local'>dummy_delim</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN61"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN503"><span class='Ref_To_Local'>funcid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN503"><span class='Ref_To_Local'>funcid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN57"><span class='Ref_to_Member'>typfunc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN436"><span class='Ref_to_Parameter'>arg_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN442"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLy_input_datum_func2 &raquo; </span> 
 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN521"></a><span class='Declare_Function'>PLyBool_FromBool</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN521"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>))</span> 
        Py_RETURN_TRUE<span class='Delimiter'>; 
</span>    Py_RETURN_FALSE<span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN529"></a><span class='Declare_Function'>PLyFloat_FromFloat4</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> PyFloat_FromDouble<span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN672"><span class='Ref_to_Func'>DatumGetFloat4</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN529"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN535"></a><span class='Declare_Function'>PLyFloat_FromFloat8</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> PyFloat_FromDouble<span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN535"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN541"></a><span class='Declare_Function'>PLyDecimal_FromNumeric</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN543"></a>    <span class='Keyword'>static </span>PyObject <span class='Operator'>*</span><span class='Declare_Local'>decimal_constructor</span><span class='Delimiter'>; 
</span><a name="LN544"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN545"></a>    PyObject   <span class='Operator'>*</span><span class='Declare_Local'>pyvalue</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Try to import cdecimal.  If it doesn't exist, fall back to decimal. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plpy_typeio.c.html#LN543"><span class='Ref_To_Local'>decimal_constructor</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN550"></a>        PyObject   <span class='Operator'>*</span><span class='Declare_Local'>decimal_module</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN550"><span class='Ref_To_Local'>decimal_module</span></a> <span class='Operator'>= </span>PyImport_ImportModule<span class='Parentheses'>(</span><span class='String'>"cdecimal"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plpy_typeio.c.html#LN550"><span class='Ref_To_Local'>decimal_module</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            PyErr_Clear<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="plpy_typeio.c.html#LN550"><span class='Ref_To_Local'>decimal_module</span></a> <span class='Operator'>= </span>PyImport_ImportModule<span class='Parentheses'>(</span><span class='String'>"decimal"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plpy_typeio.c.html#LN550"><span class='Ref_To_Local'>decimal_module</span></a><span class='Parentheses'>) 
</span>            <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not import a module for Decimal constructor"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN543"><span class='Ref_To_Local'>decimal_constructor</span></a> <span class='Operator'>= </span>PyObject_GetAttrString<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN550"><span class='Ref_To_Local'>decimal_module</span></a><span class='Delimiter'>, </span><span class='String'>"Decimal"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plpy_typeio.c.html#LN543"><span class='Ref_To_Local'>decimal_constructor</span></a><span class='Parentheses'>) 
</span>            <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"no Decimal attribute in module"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="plpy_typeio.c.html#LN544"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/adt/numeric.c.html#LN639"><span class='Ref_to_Func'>numeric_out</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN541"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN545"><span class='Ref_To_Local'>pyvalue</span></a> <span class='Operator'>= </span>PyObject_CallFunction<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN543"><span class='Ref_To_Local'>decimal_constructor</span></a><span class='Delimiter'>, </span><span class='String'>"s"</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN544"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plpy_typeio.c.html#LN545"><span class='Ref_To_Local'>pyvalue</span></a><span class='Parentheses'>) 
</span>        <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"conversion from numeric to Decimal failed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN545"><span class='Ref_To_Local'>pyvalue</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLyDecimal_FromNumeric &raquo; </span> 
 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN575"></a><span class='Declare_Function'>PLyInt_FromInt16</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="plpython.h.html#LN100"><span class='Ref_to_Macro'>PyInt_FromLong</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN449"><span class='Ref_to_Macro'>DatumGetInt16</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN575"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN581"></a><span class='Declare_Function'>PLyInt_FromInt32</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="plpython.h.html#LN100"><span class='Ref_to_Macro'>PyInt_FromLong</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN581"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN587"></a><span class='Declare_Function'>PLyLong_FromInt64</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* on 32 bit platforms "long" may be too small */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> PyLong_FromLongLong<span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN610"><span class='Ref_to_Macro'>DatumGetInt64</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN587"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> PyLong_FromLong<span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN610"><span class='Ref_to_Macro'>DatumGetInt64</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN587"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN597"></a><span class='Declare_Function'>PLyLong_FromOid</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> PyLong_FromUnsignedLong<span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN597"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN603"></a><span class='Declare_Function'>PLyBytes_FromBytea</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN605"></a>    <a href="../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>txt</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN603"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN606"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN605"><span class='Ref_To_Local'>txt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN607"></a>    size_t      <span class='Declare_Local'>size</span> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN605"><span class='Ref_To_Local'>txt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpython.h.html#LN93"><span class='Ref_to_Macro'>PyBytes_FromStringAndSize</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN606"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN607"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN613"></a><span class='Declare_Function'>PLyString_FromDatum</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN615"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>x</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN646"><span class='Ref_to_Proto'>OutputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN613"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN21"><span class='Ref_to_Member'>typfunc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN613"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN616"></a>    PyObject   <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="plpython.h.html#LN92"><span class='Ref_to_Macro'>PyString_FromString</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN615"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN615"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN616"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN623"></a><span class='Declare_Function'>PLyObject_FromTransform</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span>PyObject <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN601"><span class='Ref_to_Macro'>FunctionCall1</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN623"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN22"><span class='Ref_to_Member'>typtransform</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN623"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN629"></a><span class='Declare_Function'>PLyList_FromArray</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN631"></a>    <a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN629"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN632"></a>    <a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Local'>elm</span> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN629"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN29"><span class='Ref_to_Member'>elm</span></a><span class='Delimiter'>; 
</span><a name="LN633"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span><span class='Delimiter'>; 
</span><a name="LN634"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dims</span><span class='Delimiter'>; 
</span><a name="LN635"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dataptr</span><span class='Delimiter'>; 
</span><a name="LN636"></a>    <a href="../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bitmap</span><span class='Delimiter'>; 
</span><a name="LN637"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitmask</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN631"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> PyList_New<span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Array dimensions and left bounds */ 
</span>    <a href="plpy_typeio.c.html#LN633"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN631"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN634"><span class='Ref_To_Local'>dims</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN631"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN633"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT; </span><a href="../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We iterate the SQL array in the physical order it's stored in the 
     * datum. For example, for a 3-dimensional array the order of iteration 
     * would be the following: [0,0,0] elements through [0,0,k], then [0,1,0] 
     * through [0,1,k] till [0,m,k], then [1,0,0] through [1,0,k] till 
     * [1,m,k], and so on. 
     * 
     * In Python, there are no multi-dimensional lists as such, but they are 
     * represented as a list of lists. So a 3-d array of [n,m,k] elements is a 
     * list of n m-element arrays, each element of which is k-element array. 
     * PLyList_FromArray_recurse() builds the Python list for a single 
     * dimension, and recurses for the next inner dimension. 
     */ 
</span>    <a href="plpy_typeio.c.html#LN635"><span class='Ref_To_Local'>dataptr</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN631"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN636"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN631"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN637"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN48"><span class='Ref_to_Proto'>PLyList_FromArray_recurse</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN632"><span class='Ref_To_Local'>elm</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN634"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN633"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="plpy_typeio.c.html#LN635"><span class='Ref_To_Local'>dataptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN636"><span class='Ref_To_Local'>bitmap</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN637"><span class='Ref_To_Local'>bitmask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLyList_FromArray &raquo; </span> 
 
<span class='Keyword'>static </span>PyObject <span class='Operator'>* 
</span><a name="LN669"></a><span class='Declare_Function'>PLyList_FromArray_recurse</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN18"><span class='Ref_to_Struct'>PLyDatumToOb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elm</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dims</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, 
</span><a name="LN670"></a>                          <span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>dataptr_p</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>bitmap_p</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>bitmask_p</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN672"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN673"></a>    PyObject   <span class='Operator'>*</span><span class='Declare_Local'>list</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN673"><span class='Ref_To_Local'>list</span></a> <span class='Operator'>= </span>PyList_New<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>dim</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Outer dimension. Recurse for each inner slice. */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>]; </span><a href="plpy_typeio.c.html#LN672"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN682"></a>            PyObject   <span class='Operator'>*</span><span class='Declare_Local'>sublist</span><span class='Delimiter'>; 
</span> 
            <a href="plpy_typeio.c.html#LN682"><span class='Ref_To_Local'>sublist</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN48"><span class='Ref_to_Proto'>PLyList_FromArray_recurse</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>elm</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>dim</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                             <a href="plpy_typeio.c.html#LN670"><span class='Ref_to_Parameter'>dataptr_p</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN670"><span class='Ref_to_Parameter'>bitmap_p</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN670"><span class='Ref_to_Parameter'>bitmask_p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            PyList_SET_ITEM<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN673"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN672"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN682"><span class='Ref_To_Local'>sublist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Innermost dimension. Fill the list with the values from the array 
         * for this slice. 
         */ 
</span><a name="LN695"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dataptr</span> <span class='Operator'>= *</span><a href="plpy_typeio.c.html#LN670"><span class='Ref_to_Parameter'>dataptr_p</span></a><span class='Delimiter'>; 
</span><a name="LN696"></a>        <a href="../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bitmap</span> <span class='Operator'>= *</span><a href="plpy_typeio.c.html#LN670"><span class='Ref_to_Parameter'>bitmap_p</span></a><span class='Delimiter'>; 
</span><a name="LN697"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>bitmask</span> <span class='Operator'>= *</span><a href="plpy_typeio.c.html#LN670"><span class='Ref_to_Parameter'>bitmask_p</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN672"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>]; </span><a href="plpy_typeio.c.html#LN672"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* checking for NULL */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN696"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="plpy_typeio.c.html#LN696"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>& </span><a href="plpy_typeio.c.html#LN697"><span class='Ref_To_Local'>bitmask</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                Py_INCREF<span class='Parentheses'>(</span>Py_None<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                PyList_SET_ITEM<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN673"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN672"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span>Py_None<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN709"></a>                <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>itemvalue</span><span class='Delimiter'>; 
</span> 
                <a href="plpy_typeio.c.html#LN709"><span class='Ref_To_Local'>itemvalue</span></a> <span class='Operator'>= </span><a href="../../include/access/tupmacs.h.html#LN43"><span class='Ref_to_Macro'>fetch_att</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN695"><span class='Ref_To_Local'>dataptr</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN26"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN27"><span class='Ref_to_Member'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                PyList_SET_ITEM<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN673"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN672"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN20"><span class='Ref_to_Member'>func</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>elm</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN709"><span class='Ref_To_Local'>itemvalue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="plpy_typeio.c.html#LN695"><span class='Ref_To_Local'>dataptr</span></a> <span class='Operator'>= </span><a href="../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN695"><span class='Ref_To_Local'>dataptr</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN27"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN695"><span class='Ref_To_Local'>dataptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="plpy_typeio.c.html#LN695"><span class='Ref_To_Local'>dataptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN695"><span class='Ref_To_Local'>dataptr</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN669"><span class='Ref_to_Parameter'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN28"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* advance bitmap pointer if any */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN696"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plpy_typeio.c.html#LN697"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN697"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>== </span><span class='Number'>0x100</span> <span class='Comment_Multi_Line'>/* (1&LT;&LT;8) */ </span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="plpy_typeio.c.html#LN696"><span class='Ref_To_Local'>bitmap</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <a href="plpy_typeio.c.html#LN697"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;dims[dim];i++ &raquo; </span> 
 
        <span class='Operator'>*</span><a href="plpy_typeio.c.html#LN670"><span class='Ref_to_Parameter'>dataptr_p</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN695"><span class='Ref_To_Local'>dataptr</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="plpy_typeio.c.html#LN670"><span class='Ref_to_Parameter'>bitmap_p</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN696"><span class='Ref_To_Local'>bitmap</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="plpy_typeio.c.html#LN670"><span class='Ref_to_Parameter'>bitmask_p</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN697"><span class='Ref_To_Local'>bitmask</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN673"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLyList_FromArray_recurse &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert a Python object to a PostgreSQL bool datum.  This can't go 
 * through the generic conversion function, because Python attaches a 
 * Boolean value to everything, more things than the PostgreSQL bool 
 * type can parse. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN744"></a><span class='Declare_Function'>PLyObject_ToBool</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN746"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>rv</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN744"><span class='Ref_to_Parameter'>plrv</span></a> <span class='Operator'>!= </span>Py_None<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN746"><span class='Ref_To_Local'>rv</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span>PyObject_IsTrue<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN744"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN149"><span class='Ref_to_Proto'>get_typtype</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN744"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/builtins.h.html#LN26"><span class='Ref_to_Proto'>domain_check</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN746"><span class='Ref_To_Local'>rv</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN744"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN744"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN57"><span class='Ref_to_Member'>typfunc</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN744"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN57"><span class='Ref_to_Member'>typfunc</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN746"><span class='Ref_To_Local'>rv</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Convert a Python object to a PostgreSQL bytea datum.  This doesn't 
 * go through the generic conversion function to circumvent problems 
 * with embedded nulls.  And it's faster this way. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN763"></a><span class='Declare_Function'>PLyObject_ToBytea</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN765"></a>    PyObject   <span class='Operator'>*</span><span class='Keyword'>volatile </span><span class='Declare_Local'>plrv_so</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN766"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>rv</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN763"><span class='Ref_to_Parameter'>plrv</span></a> <span class='Operator'>!= </span>Py_None<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN765"><span class='Ref_To_Local'>plrv_so</span></a> <span class='Operator'>= </span><a href="plpython.h.html#LN86"><span class='Ref_to_Const'>PyObject_Bytes</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN763"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plpy_typeio.c.html#LN765"><span class='Ref_To_Local'>plrv_so</span></a><span class='Parentheses'>) 
</span>        <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not create bytes representation of Python object"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span><a name="LN776"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>plrv_sc</span> <span class='Operator'>= </span><a href="plpython.h.html#LN91"><span class='Ref_to_Macro'>PyBytes_AsString</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN765"><span class='Ref_To_Local'>plrv_so</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN777"></a>        size_t      <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="plpython.h.html#LN85"><span class='Ref_to_Const'>PyBytes_Size</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN765"><span class='Ref_To_Local'>plrv_so</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN778"></a>        size_t      <span class='Declare_Local'>size</span> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN777"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><a href="../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span><a name="LN779"></a>        <a href="../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN778"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN779"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN778"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN779"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN776"><span class='Ref_To_Local'>plrv_sc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN777"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN766"><span class='Ref_To_Local'>rv</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN779"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        Py_XDECREF<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN765"><span class='Ref_To_Local'>plrv_so</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    Py_XDECREF<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN765"><span class='Ref_To_Local'>plrv_so</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN149"><span class='Ref_to_Proto'>get_typtype</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN763"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/builtins.h.html#LN26"><span class='Ref_to_Proto'>domain_check</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN766"><span class='Ref_To_Local'>rv</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN763"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN763"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN57"><span class='Ref_to_Member'>typfunc</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN763"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN57"><span class='Ref_to_Member'>typfunc</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN766"><span class='Ref_To_Local'>rv</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLyObject_ToBytea &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Convert a Python object to a composite type. First look up the type's 
 * description, then route the Python object through the conversion function 
 * for obtaining PostgreSQL tuples. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN807"></a><span class='Declare_Function'>PLyObject_ToComposite</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN809"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>rv</span><span class='Delimiter'>; 
</span><a name="LN810"></a>    <a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Declare_Local'>info</span><span class='Delimiter'>; 
</span><a name="LN811"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>desc</span><span class='Delimiter'>; 
</span><a name="LN812"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>cxt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN807"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"received unnamed record type as input"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create a dummy PLyTypeInfo */ 
</span>    <a href="plpy_typeio.c.html#LN812"><span class='Ref_To_Local'>cxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                <span class='String'>"PL/Python temp context"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN810"><span class='Ref_To_Local'>info</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN68"><span class='Ref_to_Func'>PLy_typeinfo_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN810"><span class='Ref_To_Local'>info</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN812"><span class='Ref_To_Local'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Mark it as needing output routines lookup */ 
</span>    <a href="plpy_typeio.c.html#LN810"><span class='Ref_To_Local'>info</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN811"><span class='Ref_To_Local'>desc</span></a> <span class='Operator'>= </span><a href="../../include/utils/typcache.h.html#LN151"><span class='Ref_to_Proto'>lookup_rowtype_tupdesc</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN807"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN807"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN60"><span class='Ref_to_Member'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This will set up the dummy PLyTypeInfo's output conversion routines, 
     * since we left is_rowtype as 2. A future optimization could be caching 
     * that info instead of looking it up every time a tuple is returned from 
     * the function. 
     */ 
</span>    <a href="plpy_typeio.c.html#LN809"><span class='Ref_To_Local'>rv</span></a> <span class='Operator'>= </span><a href="plpy_typeio.h.html#LN113"><span class='Ref_to_Proto'>PLyObject_ToCompositeDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN810"><span class='Ref_To_Local'>info</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN811"><span class='Ref_To_Local'>desc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN807"><span class='Ref_to_Parameter'>plrv</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN807"><span class='Ref_to_Parameter'>inarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/tupdesc.h.html#LN106"><span class='Ref_to_Macro'>ReleaseTupleDesc</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN811"><span class='Ref_To_Local'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN812"><span class='Ref_To_Local'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN809"><span class='Ref_To_Local'>rv</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLyObject_ToComposite &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Convert Python object to C string in server encoding. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN848"></a><span class='Declare_Function'>PLyObject_AsString</span><span class='Parentheses'>(</span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN850"></a>    PyObject   <span class='Operator'>*</span><span class='Declare_Local'>plrv_bo</span><span class='Delimiter'>; 
</span><a name="LN851"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>plrv_sc</span><span class='Delimiter'>; 
</span><a name="LN852"></a>    size_t      <span class='Declare_Local'>plen</span><span class='Delimiter'>; 
</span><a name="LN853"></a>    size_t      <span class='Declare_Local'>slen</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>PyUnicode_Check<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN848"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>))</span> 
        <a href="plpy_typeio.c.html#LN850"><span class='Ref_To_Local'>plrv_bo</span></a> <span class='Operator'>= </span><a href="plpy_util.h.html#LN8"><span class='Ref_to_Proto'>PLyUnicode_Bytes</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN848"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>PyFloat_Check<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN848"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* use repr() for floats, str() is lossy */ 
</span><span class='Directive'>#if</span> PY_MAJOR_VERSION <span class='Operator'>&GT;= </span><span class='Number'>3</span> 
<a name="LN861"></a>        PyObject   <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span>PyObject_Repr<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN848"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN850"><span class='Ref_To_Local'>plrv_bo</span></a> <span class='Operator'>= </span><a href="plpy_util.h.html#LN8"><span class='Ref_to_Proto'>PLyUnicode_Bytes</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN861"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        Py_XDECREF<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN861"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="plpy_typeio.c.html#LN850"><span class='Ref_To_Local'>plrv_bo</span></a> <span class='Operator'>= </span>PyObject_Repr<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN848"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#if</span> PY_MAJOR_VERSION <span class='Operator'>&GT;= </span><span class='Number'>3</span> 
<a name="LN872"></a>        PyObject   <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span>PyObject_Str<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN848"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN850"><span class='Ref_To_Local'>plrv_bo</span></a> <span class='Operator'>= </span><a href="plpy_util.h.html#LN8"><span class='Ref_to_Proto'>PLyUnicode_Bytes</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN872"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        Py_XDECREF<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN872"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="plpy_typeio.c.html#LN850"><span class='Ref_To_Local'>plrv_bo</span></a> <span class='Operator'>= </span>PyObject_Str<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN848"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plpy_typeio.c.html#LN850"><span class='Ref_To_Local'>plrv_bo</span></a><span class='Parentheses'>) 
</span>        <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not create string representation of Python object"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN851"><span class='Ref_To_Local'>plrv_sc</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="plpython.h.html#LN91"><span class='Ref_to_Macro'>PyBytes_AsString</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN850"><span class='Ref_To_Local'>plrv_bo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN852"><span class='Ref_To_Local'>plen</span></a> <span class='Operator'>= </span><a href="plpython.h.html#LN85"><span class='Ref_to_Const'>PyBytes_Size</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN850"><span class='Ref_To_Local'>plrv_bo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN853"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN851"><span class='Ref_To_Local'>plrv_sc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    Py_XDECREF<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN850"><span class='Ref_To_Local'>plrv_bo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN853"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN852"><span class='Ref_To_Local'>plen</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not convert Python object into cstring: Python string representation appears to contain null bytes"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN853"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>&GT; </span><a href="plpy_typeio.c.html#LN852"><span class='Ref_To_Local'>plen</span></a><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not convert Python object into cstring: Python string longer than reported length"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../backend/parser/scan.l.html#LN546"><span class='Ref_to_Proto'>pg_verifymbstr</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN851"><span class='Ref_To_Local'>plrv_sc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN853"><span class='Ref_To_Local'>slen</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN851"><span class='Ref_To_Local'>plrv_sc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLyObject_AsString &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Generic conversion function: Convert PyObject to cstring and 
 * cstring into PostgreSQL type. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN906"></a><span class='Declare_Function'>PLyObject_ToDatum</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN908"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN906"><span class='Ref_to_Parameter'>plrv</span></a> <span class='Operator'>!= </span>Py_None<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN908"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="plpy_typeio.h.html#LN119"><span class='Ref_to_Proto'>PLyObject_AsString</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN906"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are parsing a composite type within an array, and the string 
     * isn't a valid record literal, there's a high chance that the function 
     * did something like: 
     * 
     * CREATE FUNCTION .. RETURNS comptype[] AS $$ return [['foo', 'bar']] $$ 
     * LANGUAGE plpython; 
     * 
     * Before PostgreSQL 10, that was interpreted as a single-dimensional 
     * array, containing record ('foo', 'bar'). PostgreSQL 10 added support 
     * for multi-dimensional arrays, and it is now interpreted as a 
     * two-dimensional array, containing two records, 'foo', and 'bar'. 
     * record_in() will throw an error, because "foo" is not a valid record 
     * literal. 
     * 
     * To make that less confusing to users who are upgrading from older 
     * versions, try to give a hint in the typical instances of that. If we 
     * are parsing an array of composite types, and we see a string literal 
     * that is not a valid record literal, give a hint. We only want to give 
     * the hint in the narrow case of a malformed string literal, not any 
     * error from record_in(), so check for that case here specifically. 
     * 
     * This check better match the one in record_in(), so that we don't forbid 
     * literals that are actually valid! 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN906"><span class='Ref_to_Parameter'>inarray</span></a> <span class='Operator'>&& </span><a href="plpy_typeio.c.html#LN906"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN57"><span class='Ref_to_Member'>typfunc</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>== </span>F_RECORD_IN<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN941"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN908"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Allow leading whitespace */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="plpy_typeio.c.html#LN941"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="plpy_typeio.c.html#LN941"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span> 
            <a href="plpy_typeio.c.html#LN941"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="plpy_typeio.c.html#LN941"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ != </span><span class='String'>'('</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed record literal: \"%s\""</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN908"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../backend/utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Missing left parenthesis."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"To return a composite type in an array, return the composite type as a Python tuple, e.g. \"[('foo')]\""</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="../../include/fmgr.h.html#LN642"><span class='Ref_to_Proto'>InputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN906"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN57"><span class='Ref_to_Member'>typfunc</span></a><span class='Delimiter'>, 
</span>                             <a href="plpy_typeio.c.html#LN908"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, 
</span>                             <a href="plpy_typeio.c.html#LN906"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN61"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>, 
</span>                             <a href="plpy_typeio.c.html#LN906"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLyObject_ToDatum &raquo; </span> 
 
 
<span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN962"></a><span class='Declare_Function'>PLyObject_ToTransform</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../include/fmgr.h.html#LN601"><span class='Ref_to_Macro'>FunctionCall1</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN962"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN58"><span class='Ref_to_Member'>typtransform</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN962"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN969"></a><span class='Declare_Function'>PLySequence_ToArray</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>plrv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN971"></a>    <a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span><a name="LN972"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN973"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elems</span><span class='Delimiter'>; 
</span><a name="LN974"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN975"></a>    <a href="../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN976"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span><span class='Delimiter'>; 
</span><a name="LN977"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dims</span><span class='Delimiter'>[</span><a href="../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN978"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lbs</span><span class='Delimiter'>[</span><a href="../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Delimiter'>]; 
</span><a name="LN979"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>currelem</span><span class='Delimiter'>; 
</span><a name="LN980"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>rv</span><span class='Delimiter'>; 
</span><a name="LN981"></a>    PyObject   <span class='Operator'>*</span><span class='Declare_Local'>pyptr</span> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>plrv</span></a><span class='Delimiter'>; 
</span><a name="LN982"></a>    PyObject   <span class='Operator'>*</span><span class='Declare_Local'>next</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>plrv</span></a> <span class='Operator'>!= </span>Py_None<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the number of dimensions, and their sizes. 
     */ 
</span>    <a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN975"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    Py_INCREF<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>PyList_Check<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN981"><span class='Ref_To_Local'>pyptr</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><a href="../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>) 
</span>            <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"number of array dimensions exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN418"><span class='Ref_to_Const'>MAXDIM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN977"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span>PySequence_Length<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN981"><span class='Ref_To_Local'>pyptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN977"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot determine sequence length for function return value"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN977"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>) 
</span>            <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"array size exceeds the maximum allowed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN975"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>*= </span><a href="plpy_typeio.c.html#LN977"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN975"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><a href="../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>) 
</span>            <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"array size exceeds the maximum allowed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN977"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* empty sequence */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN982"><span class='Ref_To_Local'>next</span></a> <span class='Operator'>= </span>PySequence_GetItem<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN981"><span class='Ref_To_Local'>pyptr</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        Py_XDECREF<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN981"><span class='Ref_To_Local'>pyptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN981"><span class='Ref_To_Local'>pyptr</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN982"><span class='Ref_To_Local'>next</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
    Py_XDECREF<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN981"><span class='Ref_To_Local'>pyptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for zero dimensions. This happens if the object is a tuple or a 
     * string, rather than a list, or is not a sequence at all. We don't map 
     * tuples or strings to arrays in general, but in the first level, be 
     * lenient, for historical reasons. So if the object is a sequence of any 
     * kind, treat it as a one-dimensional array. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>PySequence_Check<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>))</span> 
            <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"return value of function with array return type is not a Python sequence"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN975"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN977"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span>PySequence_Length<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>plrv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Traverse the Python lists, in depth-first order, and collect all the 
     * elements at the bottom level into 'elems'/'nulls' arrays. 
     */ 
</span>    <a href="plpy_typeio.c.html#LN973"><span class='Ref_To_Local'>elems</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plpy_typeio.c.html#LN975"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN974"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plpy_typeio.c.html#LN975"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN979"><span class='Ref_To_Local'>currelem</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN58"><span class='Ref_to_Proto'>PLySequence_ToArray_recurse</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>plrv</span></a><span class='Delimiter'>, 
</span>                                <a href="plpy_typeio.c.html#LN977"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                <a href="plpy_typeio.c.html#LN973"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN974"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN979"><span class='Ref_To_Local'>currelem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN972"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN972"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN972"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="plpy_typeio.c.html#LN978"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN972"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN971"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN372"><span class='Ref_to_Proto'>construct_md_array</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN973"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>, 
</span>                               <a href="plpy_typeio.c.html#LN974"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                               <a href="plpy_typeio.c.html#LN976"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, 
</span>                               <a href="plpy_typeio.c.html#LN977"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, 
</span>                               <a href="plpy_typeio.c.html#LN978"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/lsyscache.h.html#LN160"><span class='Ref_to_Proto'>get_base_element_type</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN63"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, 
</span>                               <a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN62"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                               <a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN65"><span class='Ref_to_Member'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN64"><span class='Ref_to_Member'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the result type is a domain of array, the resulting array must be 
     * checked. 
     */ 
</span>    <a href="plpy_typeio.c.html#LN980"><span class='Ref_To_Local'>rv</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN971"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN149"><span class='Ref_to_Proto'>get_typtype</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/builtins.h.html#LN26"><span class='Ref_to_Proto'>domain_check</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN980"><span class='Ref_To_Local'>rv</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN59"><span class='Ref_to_Member'>typoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN57"><span class='Ref_to_Member'>typfunc</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN969"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN57"><span class='Ref_to_Member'>typfunc</span></a><span class='Operator'>.</span><a href="../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN980"><span class='Ref_To_Local'>rv</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLySequence_ToArray &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Helper function for PLySequence_ToArray. Traverse a Python list of lists in 
 * depth-first order, storing the elements in 'elems'. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1082"></a><span class='Declare_Function'>PLySequence_ToArray_recurse</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elm</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>list</span><span class='Delimiter'>, 
</span><a name="LN1083"></a>                            <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dims</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, 
</span><a name="LN1084"></a>                            <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>elems</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>currelem</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1086"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>PySequence_Length<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1082"><span class='Ref_to_Parameter'>list</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
        <a href="plpy_elog.c.html#LN45"><span class='Ref_to_Func'>PLy_elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                 <span class='String'>"multidimensional arrays must have array expressions with matching dimensions. "</span> 
                 <span class='String'>"PL/Python function return value has sequence length %d while expected %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span>PySequence_Length<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1082"><span class='Ref_to_Parameter'>list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>dim</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1086"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN1086"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>]; </span><a href="plpy_typeio.c.html#LN1086"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1098"></a>            PyObject   <span class='Operator'>*</span><span class='Declare_Local'>sublist</span> <span class='Operator'>= </span>PySequence_GetItem<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1082"><span class='Ref_to_Parameter'>list</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1086"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="plpy_typeio.c.html#LN58"><span class='Ref_to_Proto'>PLySequence_ToArray_recurse</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1082"><span class='Ref_to_Parameter'>elm</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1098"><span class='Ref_To_Local'>sublist</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>dim</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                        <a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>elems</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>currelem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            Py_XDECREF<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1098"><span class='Ref_To_Local'>sublist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1086"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN1086"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1083"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>]; </span><a href="plpy_typeio.c.html#LN1086"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1109"></a>            PyObject   <span class='Operator'>*</span><span class='Declare_Local'>obj</span> <span class='Operator'>= </span>PySequence_GetItem<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1082"><span class='Ref_to_Parameter'>list</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1086"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1109"><span class='Ref_To_Local'>obj</span></a> <span class='Operator'>== </span>Py_None<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><span class='Operator'>*</span><a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>currelem</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>elems</span></a><span class='Delimiter'>[</span><span class='Operator'>*</span><a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>currelem</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><span class='Operator'>*</span><a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>currelem</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>elems</span></a><span class='Delimiter'>[</span><span class='Operator'>*</span><a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>currelem</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="plpy_typeio.c.html#LN1082"><span class='Ref_to_Parameter'>elm</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1082"><span class='Ref_to_Parameter'>elm</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1109"><span class='Ref_To_Local'>obj</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            Py_XDECREF<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1109"><span class='Ref_To_Local'>obj</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="plpy_typeio.c.html#LN1084"><span class='Ref_to_Parameter'>currelem</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end PLySequence_ToArray_recurse &raquo; </span> 
 
 
<span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1129"></a><span class='Declare_Function'>PLyString_ToComposite</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>info</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1131"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1132"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>typeTup</span><span class='Delimiter'>; 
</span><a name="LN1133"></a>    <a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Declare_Local'>locinfo</span><span class='Delimiter'>; 
</span><a name="LN1134"></a>    <a href="plpy_main.h.html#LN17"><span class='Ref_to_Struct'>PLyExecutionContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>exec_ctx</span> <span class='Operator'>= </span><a href="plpy_main.h.html#LN25"><span class='Ref_to_Proto'>PLy_current_execution_context</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1135"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>cxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create a dummy PLyTypeInfo */ 
</span>    <a href="plpy_typeio.c.html#LN1135"><span class='Ref_To_Local'>cxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                <span class='String'>"PL/Python temp context"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN1133"><span class='Ref_To_Local'>locinfo</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN68"><span class='Ref_to_Func'>PLy_typeinfo_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN1133"><span class='Ref_To_Local'>locinfo</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1135"><span class='Ref_To_Local'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN1132"><span class='Ref_To_Local'>typeTup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1129"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1132"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1129"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN33"><span class='Ref_to_Proto'>PLy_output_datum_func2</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN1133"><span class='Ref_To_Local'>locinfo</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN76"><span class='Ref_to_Member'>d</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1133"><span class='Ref_To_Local'>locinfo</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN99"><span class='Ref_to_Member'>mcxt</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1132"><span class='Ref_To_Local'>typeTup</span></a><span class='Delimiter'>, 
</span>                           <a href="plpy_typeio.c.html#LN1134"><span class='Ref_To_Local'>exec_ctx</span></a><span class='Operator'>-&GT;</span><a href="plpy_main.h.html#LN19"><span class='Ref_to_Member'>curr_proc</span></a><span class='Operator'>-&GT;</span><a href="plpy_procedure.h.html#LN39"><span class='Ref_to_Member'>langid</span></a><span class='Delimiter'>, 
</span>                           <a href="plpy_typeio.c.html#LN1134"><span class='Ref_To_Local'>exec_ctx</span></a><span class='Operator'>-&GT;</span><a href="plpy_main.h.html#LN19"><span class='Ref_to_Member'>curr_proc</span></a><span class='Operator'>-&GT;</span><a href="plpy_procedure.h.html#LN40"><span class='Ref_to_Member'>trftypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1132"><span class='Ref_To_Local'>typeTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="plpy_typeio.c.html#LN1131"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="plpy_typeio.c.html#LN55"><span class='Ref_to_Proto'>PLyObject_ToDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="plpy_typeio.c.html#LN1133"><span class='Ref_To_Local'>locinfo</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN76"><span class='Ref_to_Member'>d</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1129"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1129"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1129"><span class='Ref_to_Parameter'>inarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1135"><span class='Ref_To_Local'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN1131"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLyString_ToComposite &raquo; </span> 
 
 
<span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1163"></a><span class='Declare_Function'>PLyMapping_ToComposite</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>info</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>mapping</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1165"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1166"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1167"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN1168"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN1169"></a>    <span class='Keyword'>volatile int </span><span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span>PyMapping_Check<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>mapping</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="plpy_typeio.h.html#LN108"><span class='Ref_to_Proto'>PLy_output_tuple_funcs</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>info</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build tuple */ 
</span>    <a href="plpy_typeio.c.html#LN1167"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN1168"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1182"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN1183"></a>        PyObject   <span class='Operator'>*</span><span class='Keyword'>volatile </span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN1184"></a>        <a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>att</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="plpy_typeio.c.html#LN1167"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="plpy_typeio.c.html#LN1168"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="plpy_typeio.c.html#LN1182"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN1184"><span class='Ref_To_Local'>att</span></a> <span class='Operator'>= &</span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span>PyMapping_GetItemString<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>mapping</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1182"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>== </span>Py_None<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plpy_typeio.c.html#LN1167"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="plpy_typeio.c.html#LN1168"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plpy_typeio.c.html#LN1167"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1184"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a><span class='Parentheses'>) (</span><a href="plpy_typeio.c.html#LN1184"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="plpy_typeio.c.html#LN1168"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1169"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"key \"%s\" not found in mapping"</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1182"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"To return null in a column, "</span> 
                                 <span class='String'>"add the value None to the mapping with the key named after the column."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            Py_XDECREF<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            Py_XDECREF<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;desc-&GT;natts;++i &raquo; </span> 
 
    <a href="plpy_typeio.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../backend/access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>desc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1167"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1168"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN1165"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../backend/access/common/heaptuple.c.html#LN654"><span class='Ref_to_Func'>heap_copy_tuple_as_datum</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1163"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1167"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1168"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN1165"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLyMapping_ToComposite &raquo; </span> 
 
 
<span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1239"></a><span class='Declare_Function'>PLySequence_ToComposite</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>info</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>sequence</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1241"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1242"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1243"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN1244"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN1245"></a>    <span class='Keyword'>volatile int </span><span class='Declare_Local'>idx</span><span class='Delimiter'>; 
</span><a name="LN1246"></a>    <span class='Keyword'>volatile int </span><span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span>PySequence_Check<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>sequence</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that sequence length is exactly same as PG tuple's. We actually 
     * can ignore exceeding items or assume missing ones as null but to avoid 
     * plpython developer's errors we are strict here 
     */ 
</span>    <a href="plpy_typeio.c.html#LN1245"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <a href="plpy_typeio.c.html#LN1245"><span class='Ref_To_Local'>idx</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>PySequence_Length<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>sequence</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="plpy_typeio.c.html#LN1245"><span class='Ref_To_Local'>idx</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"length of returned sequence did not match number of columns in row"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="plpy_typeio.h.html#LN108"><span class='Ref_to_Proto'>PLy_output_tuple_funcs</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>info</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build tuple */ 
</span>    <a href="plpy_typeio.c.html#LN1243"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN1244"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN1245"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1276"></a>        PyObject   <span class='Operator'>*</span><span class='Keyword'>volatile </span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN1277"></a>        <a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>att</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="plpy_typeio.c.html#LN1243"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="plpy_typeio.c.html#LN1244"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN1277"><span class='Ref_To_Local'>att</span></a> <span class='Operator'>= &</span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span>PySequence_GetItem<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>sequence</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1245"><span class='Ref_To_Local'>idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>== </span>Py_None<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plpy_typeio.c.html#LN1243"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="plpy_typeio.c.html#LN1244"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plpy_typeio.c.html#LN1243"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1277"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a><span class='Parentheses'>) (</span><a href="plpy_typeio.c.html#LN1277"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="plpy_typeio.c.html#LN1244"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1246"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            Py_XDECREF<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            Py_XDECREF<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="plpy_typeio.c.html#LN1245"><span class='Ref_To_Local'>idx</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;desc-&GT;natts;++i &raquo; </span> 
 
    <a href="plpy_typeio.c.html#LN1242"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../backend/access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>desc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1243"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1244"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN1241"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../backend/access/common/heaptuple.c.html#LN654"><span class='Ref_to_Func'>heap_copy_tuple_as_datum</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1242"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1239"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1242"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1243"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1244"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN1241"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLySequence_ToComposite &raquo; </span> 
 
 
<span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1328"></a><span class='Declare_Function'>PLyGenericObject_ToComposite</span><span class='Parentheses'>(</span><a href="plpy_typeio.h.html#LN83"><span class='Ref_to_Struct'>PLyTypeInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>info</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>desc</span><span class='Delimiter'>, </span>PyObject <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>inarray</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1330"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1331"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1332"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN1333"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN1334"></a>    <span class='Keyword'>volatile int </span><span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="plpy_typeio.h.html#LN108"><span class='Ref_to_Proto'>PLy_output_tuple_funcs</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>info</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN92"><span class='Ref_to_Member'>is_rowtype</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build tuple */ 
</span>    <a href="plpy_typeio.c.html#LN1332"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN1333"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1345"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN1346"></a>        PyObject   <span class='Operator'>*</span><span class='Keyword'>volatile </span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN1347"></a>        <a href="plpy_typeio.h.html#LN54"><span class='Ref_to_Struct'>PLyObToDatum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>att</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="plpy_typeio.c.html#LN1332"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="plpy_typeio.c.html#LN1333"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="plpy_typeio.c.html#LN1345"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="plpy_typeio.c.html#LN1347"><span class='Ref_To_Local'>att</span></a> <span class='Operator'>= &</span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>info</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN86"><span class='Ref_to_Member'>out</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN77"><span class='Ref_to_Member'>r</span></a><span class='Operator'>.</span><a href="plpy_typeio.h.html#LN34"><span class='Ref_to_Member'>atts</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span>PyObject_GetAttrString<span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>object</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1345"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>== </span>Py_None<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plpy_typeio.c.html#LN1332"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="plpy_typeio.c.html#LN1333"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="plpy_typeio.c.html#LN1332"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1347"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span><a href="plpy_typeio.h.html#LN56"><span class='Ref_to_Member'>func</span></a><span class='Parentheses'>) (</span><a href="plpy_typeio.c.html#LN1347"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="plpy_typeio.c.html#LN1333"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="plpy_typeio.c.html#LN1334"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * No attribute for this column in the object. 
                 * 
                 * If we are parsing a composite type in an array, a likely 
                 * cause is that the function contained something like "[[123, 
                 * 'foo']]". Before PostgreSQL 10, that was interpreted as an 
                 * array, with a composite type (123, 'foo') in it. But now 
                 * it's interpreted as a two-dimensional array, and we try to 
                 * interpret "123" as the composite type. See also similar 
                 * heuristic in PLyObject_ToDatum(). 
                 */ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"attribute \"%s\" does not exist in Python object"</span><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1345"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>inarray</span></a> <span class='Operator'>? 
</span>                         <a href="../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"To return a composite type in an array, return the composite type as a Python tuple, e.g. \"[('foo')]\""</span><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                         <a href="../../backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"To return null in a column, let the returned object have an attribute named after column with value None."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
            Py_XDECREF<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            Py_XDECREF<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;desc-&GT;natts;++i &raquo; </span> 
 
    <a href="plpy_typeio.c.html#LN1331"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../backend/access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>desc</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1332"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1333"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="plpy_typeio.c.html#LN1330"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../backend/access/common/heaptuple.c.html#LN654"><span class='Ref_to_Func'>heap_copy_tuple_as_datum</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1331"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="plpy_typeio.c.html#LN1328"><span class='Ref_to_Parameter'>desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1331"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1332"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="plpy_typeio.c.html#LN1333"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="plpy_typeio.c.html#LN1330"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end PLyGenericObject_ToComposite &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>