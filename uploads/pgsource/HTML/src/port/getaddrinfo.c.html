<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\port\getaddrinfo.c</title>
<LINK REL=StyleSheet HREF="../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\port\getaddrinfo.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:14 2017
</td></tr>
<tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * getaddrinfo.c 
 *    Support getaddrinfo() on platforms that don't have it. 
 * 
 * We also supply getnameinfo() here, assuming that the platform will have 
 * it if and only if it has getaddrinfo().  If this proves false on some 
 * platform, we'll need to split this file and provide a separate configure 
 * test for getnameinfo(). 
 * 
 * Windows may or may not have these routines, so we handle Windows specially 
 * by dynamically checking for their existence.  If they already exist, we 
 * use the Windows native routines, but if not, we use our own. 
 * 
 * 
 * Copyright (c) 2003-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *    src/port/getaddrinfo.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* This is intended to be used in both frontend and backend, so use c.h */ 
</span><span class='Keyword'>#include </span><span class='String'>"c.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/socket.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netdb.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/in.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;arpa/inet.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"getaddrinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqcomm.h"</span>       <span class='Comment_Single_Line'>/* needed for struct sockaddr_storage */ 
</span> 
 
<span class='Directive'>#ifdef</span> <a href="../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<span class='Comment_Multi_Line'>/* 
 * The native routines may or may not exist on the Windows platform we are on, 
 * so we dynamically look up the routines, and call them via function pointers. 
 * Here we need to declare what the function pointers look like 
 */ 
</span><a name="LN41"></a><span class='Control'>typedef</span> <span class='Keyword'>int </span><span class='Parentheses'>(</span>__stdcall <span class='Operator'>* </span><span class='Declare_Typedef'>getaddrinfo_ptr_t</span><span class='Parentheses'>) (</span><span class='Keyword'>const char </span><span class='Operator'>*</span>nodename<span class='Delimiter'>, 
</span>                                                         <span class='Keyword'>const char </span><span class='Operator'>*</span>servname<span class='Delimiter'>, 
</span>                                               <span class='Keyword'>const </span><span class='Control'>struct</span> <a href="../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>* </span>hints<span class='Delimiter'>, 
</span>                                                     <span class='Control'>struct</span> <a href="../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>** </span>res<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN46"></a><span class='Control'>typedef</span> <span class='Keyword'>void </span><span class='Parentheses'>(</span>__stdcall <span class='Operator'>* </span><span class='Declare_Typedef'>freeaddrinfo_ptr_t</span><span class='Parentheses'>) (</span><span class='Control'>struct</span> <a href="../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>* </span>ai<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN48"></a><span class='Control'>typedef</span> <span class='Keyword'>int </span><span class='Parentheses'>(</span>__stdcall <span class='Operator'>* </span><span class='Declare_Typedef'>getnameinfo_ptr_t</span><span class='Parentheses'>) (</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr <span class='Operator'>* </span><a href="../interfaces/ecpg/test/expected/preproc-init.c.html#LN82"><span class='Ref_to_Struct'>sa</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Keyword'>int </span>salen<span class='Delimiter'>, 
</span>                                                     <span class='Keyword'>char </span><span class='Operator'>*</span>host<span class='Delimiter'>, </span><span class='Keyword'>int </span>hostlen<span class='Delimiter'>, 
</span>                                                     <span class='Keyword'>char </span><span class='Operator'>*</span>serv<span class='Delimiter'>, </span><span class='Keyword'>int </span>servlen<span class='Delimiter'>, 
</span>                                                         <span class='Keyword'>int </span><a href="../pl/plperl/ppport.h.html#LN4803"><span class='Ref_to_Global_Var'>flags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* static pointers to the native routines, so we only do the lookup once. */ 
</span><a name="LN55"></a><span class='Keyword'>static </span><a href="getaddrinfo.c.html#LN41"><span class='Ref_to_Typedef'>getaddrinfo_ptr_t</span></a> <span class='Declare_Var'>getaddrinfo_ptr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN56"></a><span class='Keyword'>static </span><a href="getaddrinfo.c.html#LN46"><span class='Ref_to_Typedef'>freeaddrinfo_ptr_t</span></a> <span class='Declare_Var'>freeaddrinfo_ptr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN57"></a><span class='Keyword'>static </span><a href="getaddrinfo.c.html#LN48"><span class='Ref_to_Typedef'>getnameinfo_ptr_t</span></a> <span class='Declare_Var'>getnameinfo_ptr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
 
<span class='Keyword'>static bool 
</span><a name="LN61"></a><span class='Declare_Function'>haveNativeWindowsIPv6routines</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN63"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>hLibrary</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN64"></a>    <span class='Keyword'>static bool </span><span class='Declare_Local'>alreadyLookedForIpv6routines</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN64"><span class='Ref_To_Local'>alreadyLookedForIpv6routines</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN55"><span class='Ref_to_Global_Var'>getaddrinfo_ptr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For Windows XP and Windows 2003 (and longhorn/vista), the IPv6 routines 
     * are present in the WinSock 2 library (ws2_32.dll). Try that first 
     */ 
</span> 
    <a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a> <span class='Operator'>= </span>LoadLibraryA<span class='Parentheses'>(</span><span class='String'>"ws2_32"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>GetProcAddress<span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a><span class='Delimiter'>, </span><span class='String'>"getaddrinfo"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Well, ws2_32 doesn't exist, or more likely doesn't have 
         * getaddrinfo. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            FreeLibrary<span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In Windows 2000, there was only the IPv6 Technology Preview look in 
         * the IPv6 WinSock library (wship6.dll). 
         */ 
</span> 
        <a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a> <span class='Operator'>= </span>LoadLibraryA<span class='Parentheses'>(</span><span class='String'>"wship6"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If hLibrary is null, we couldn't find a dll with functions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We found a dll, so now get the addresses of the routines */ 
</span> 
        <a href="getaddrinfo.c.html#LN55"><span class='Ref_to_Global_Var'>getaddrinfo_ptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN41"><span class='Ref_to_Typedef'>getaddrinfo_ptr_t</span></a><span class='Parentheses'>) </span>GetProcAddress<span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a><span class='Delimiter'>, 
</span>                                                             <span class='String'>"getaddrinfo"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="getaddrinfo.c.html#LN56"><span class='Ref_to_Global_Var'>freeaddrinfo_ptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN46"><span class='Ref_to_Typedef'>freeaddrinfo_ptr_t</span></a><span class='Parentheses'>) </span>GetProcAddress<span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a><span class='Delimiter'>, 
</span>                                                             <span class='String'>"freeaddrinfo"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="getaddrinfo.c.html#LN57"><span class='Ref_to_Global_Var'>getnameinfo_ptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN48"><span class='Ref_to_Typedef'>getnameinfo_ptr_t</span></a><span class='Parentheses'>) </span>GetProcAddress<span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a><span class='Delimiter'>, 
</span>                                                             <span class='String'>"getnameinfo"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If any one of the routines is missing, let's play it safe and 
         * ignore them all 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN55"><span class='Ref_to_Global_Var'>getaddrinfo_ptr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <a href="getaddrinfo.c.html#LN56"><span class='Ref_to_Global_Var'>freeaddrinfo_ptr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <a href="getaddrinfo.c.html#LN57"><span class='Ref_to_Global_Var'>getnameinfo_ptr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            FreeLibrary<span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="getaddrinfo.c.html#LN63"><span class='Ref_To_Local'>hLibrary</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="getaddrinfo.c.html#LN55"><span class='Ref_to_Global_Var'>getaddrinfo_ptr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="getaddrinfo.c.html#LN56"><span class='Ref_to_Global_Var'>freeaddrinfo_ptr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="getaddrinfo.c.html#LN57"><span class='Ref_to_Global_Var'>getnameinfo_ptr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if hLibrary!=NULL &raquo; </span> 
 
    <a href="getaddrinfo.c.html#LN64"><span class='Ref_To_Local'>alreadyLookedForIpv6routines</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN55"><span class='Ref_to_Global_Var'>getaddrinfo_ptr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end haveNativeWindowsIPv6routines &raquo; </span> 
<span class='Directive'>#endif</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * get address info for ipv4 sockets. 
 * 
 *  Bugs:   - only one addrinfo is set even though hintp is NULL or 
 *        ai_socktype is 0 
 *      - AI_CANONNAME is not supported. 
 *      - servname can only be a number, not text. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN136"></a><span class='Declare_Function'>getaddrinfo</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>service</span><span class='Delimiter'>, 
</span><a name="LN137"></a>            <span class='Keyword'>const </span><span class='Control'>struct</span> <a href="../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>hintp</span><span class='Delimiter'>, 
</span><a name="LN138"></a>            <span class='Control'>struct</span> <a href="../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>** </span><span class='Declare_Parameter'>res</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN140"></a>    <span class='Control'>struct</span> <a href="../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ai</span><span class='Delimiter'>; 
</span><a name="LN141"></a>    <span class='Control'>struct</span> sockaddr_in <span class='Declare_Local'>sin</span><span class='Delimiter'>, 
</span><a name="LN142"></a>               <span class='Operator'>*</span><span class='Declare_Local'>psin</span><span class='Delimiter'>; 
</span><a name="LN143"></a>    <span class='Control'>struct</span> <a href="../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Declare_Local'>hints</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
    <span class='Comment_Multi_Line'>/* 
     * If Windows has native IPv6 support, use the native Windows routine. 
     * Otherwise, fall through and use our own code. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN60"><span class='Ref_to_Func'>haveNativeWindowsIPv6routines</span></a><span class='Parentheses'>())</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="getaddrinfo.c.html#LN55"><span class='Ref_to_Global_Var'>getaddrinfo_ptr</span></a><span class='Parentheses'>) (</span><a href="getaddrinfo.c.html#LN136"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN136"><span class='Ref_to_Parameter'>service</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN137"><span class='Ref_to_Parameter'>hintp</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN138"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN137"><span class='Ref_to_Parameter'>hintp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a> <span class='Operator'>= </span>AF_INET<span class='Delimiter'>; 
</span>        <a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../include/getaddrinfo.h.html#LN101"><span class='Ref_to_Member'>ai_socktype</span></a> <span class='Operator'>= </span>SOCK_STREAM<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN137"><span class='Ref_to_Parameter'>hintp</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a> <span class='Operator'>!= </span>AF_INET <span class='Operator'>&& </span><a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a> <span class='Operator'>!= </span>AF_UNSPEC<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN36"><span class='Ref_to_Const'>EAI_FAMILY</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../include/getaddrinfo.h.html#LN101"><span class='Ref_to_Member'>ai_socktype</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../include/getaddrinfo.h.html#LN101"><span class='Ref_to_Member'>ai_socktype</span></a> <span class='Operator'>= </span>SOCK_STREAM<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="getaddrinfo.c.html#LN136"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>&& !</span><a href="getaddrinfo.c.html#LN136"><span class='Ref_to_Parameter'>service</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN33"><span class='Ref_to_Const'>EAI_NONAME</span></a><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Operator'>.</span>sin_family <span class='Operator'>= </span>AF_INET<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN136"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN136"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Operator'>.</span>sin_addr<span class='Operator'>.</span>s_addr <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span>INADDR_ANY<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../include/getaddrinfo.h.html#LN99"><span class='Ref_to_Member'>ai_flags</span></a> <span class='Operator'>& </span><a href="../include/getaddrinfo.h.html#LN70"><span class='Ref_to_Const'>AI_NUMERICHOST</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="inet_aton.c.html#LN52"><span class='Ref_to_Func'>inet_aton</span></a><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN136"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Operator'>.</span>sin_addr<span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN33"><span class='Ref_to_Const'>EAI_NONAME</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN188"></a>            <span class='Control'>struct</span> hostent <span class='Operator'>*</span><span class='Declare_Local'>hp</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../bin/pg_waldump/rmgrdesc.c.html#LN7"><span class='Ref_to_Const'>FRONTEND</span></a> 
<a name="LN191"></a>            <span class='Control'>struct</span> hostent <span class='Declare_Local'>hpstr</span><span class='Delimiter'>; 
</span><a name="LN192"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span>BUFSIZ<span class='Delimiter'>]; 
</span><a name="LN193"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>herrno</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <a href="thread.c.html#LN115"><span class='Ref_to_Func'>pqGethostbyname</span></a><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN136"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="getaddrinfo.c.html#LN191"><span class='Ref_To_Local'>hpstr</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN192"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN192"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="getaddrinfo.c.html#LN188"><span class='Ref_To_Local'>hp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="getaddrinfo.c.html#LN193"><span class='Ref_To_Local'>herrno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
            <a href="getaddrinfo.c.html#LN188"><span class='Ref_To_Local'>hp</span></a> <span class='Operator'>= </span>gethostbyname<span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN136"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN188"><span class='Ref_To_Local'>hp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span>h_errno<span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> HOST_NOT_FOUND<span class='Operator'>: 
</span>                    <span class='Control'>case</span> NO_DATA<span class='Operator'>: 
</span>                        <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN33"><span class='Ref_to_Const'>EAI_NONAME</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> TRY_AGAIN<span class='Operator'>: 
</span>                        <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN34"><span class='Ref_to_Const'>EAI_AGAIN</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> NO_RECOVERY<span class='Operator'>: 
</span>                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN35"><span class='Ref_to_Const'>EAI_FAIL</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN188"><span class='Ref_To_Local'>hp</span></a><span class='Operator'>-&GT;</span>h_addrtype <span class='Operator'>!= </span>AF_INET<span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN35"><span class='Ref_to_Const'>EAI_FAIL</span></a><span class='Delimiter'>; 
</span> 
            memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Operator'>.</span>sin_addr<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN188"><span class='Ref_To_Local'>hp</span></a><span class='Operator'>-&GT;</span>h_addr<span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN188"><span class='Ref_To_Local'>hp</span></a><span class='Operator'>-&GT;</span>h_length<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../include/getaddrinfo.h.html#LN99"><span class='Ref_to_Member'>ai_flags</span></a> <span class='Operator'>& </span><a href="../include/getaddrinfo.h.html#LN61"><span class='Ref_to_Const'>AI_PASSIVE</span></a><span class='Parentheses'>) 
</span>            <a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Operator'>.</span>sin_addr<span class='Operator'>.</span>s_addr <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span>INADDR_ANY<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Operator'>.</span>sin_addr<span class='Operator'>.</span>s_addr <span class='Operator'>= </span>htonl<span class='Parentheses'>(</span>INADDR_LOOPBACK<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN136"><span class='Ref_to_Parameter'>service</span></a><span class='Parentheses'>) 
</span>        <a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Operator'>.</span>sin_port <span class='Operator'>= </span>htons<span class='Parentheses'>((</span><span class='Keyword'>unsigned short</span><span class='Parentheses'>) </span>atoi<span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN136"><span class='Ref_to_Parameter'>service</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../include/libpq/pqcomm.h.html#LN37"><span class='Ref_to_Const'>HAVE_STRUCT_SOCKADDR_STORAGE_SS_LEN</span></a> 
    <a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Operator'>.</span>sin_len <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a> <span class='Operator'>= </span><a href="../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN39"><span class='Ref_to_Const'>EAI_MEMORY</span></a><span class='Delimiter'>; 
</span> 
    <a href="getaddrinfo.c.html#LN142"><span class='Ref_To_Local'>psin</span></a> <span class='Operator'>= </span><a href="../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="getaddrinfo.c.html#LN142"><span class='Ref_To_Local'>psin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="getaddrinfo.c.html#LN142"><span class='Ref_To_Local'>psin</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN39"><span class='Ref_to_Const'>EAI_MEMORY</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN142"><span class='Ref_To_Local'>psin</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="getaddrinfo.c.html#LN141"><span class='Ref_To_Local'>sin</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="getaddrinfo.c.html#LN142"><span class='Ref_To_Local'>psin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../include/getaddrinfo.h.html#LN99"><span class='Ref_to_Member'>ai_flags</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a> <span class='Operator'>= </span>AF_INET<span class='Delimiter'>; 
</span>    <a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../include/getaddrinfo.h.html#LN101"><span class='Ref_to_Member'>ai_socktype</span></a> <span class='Operator'>= </span><a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../include/getaddrinfo.h.html#LN101"><span class='Ref_to_Member'>ai_socktype</span></a><span class='Delimiter'>; 
</span>    <a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../include/getaddrinfo.h.html#LN102"><span class='Ref_to_Member'>ai_protocol</span></a> <span class='Operator'>= </span><a href="getaddrinfo.c.html#LN143"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../include/getaddrinfo.h.html#LN102"><span class='Ref_to_Member'>ai_protocol</span></a><span class='Delimiter'>; 
</span>    <a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../include/getaddrinfo.h.html#LN103"><span class='Ref_to_Member'>ai_addrlen</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="getaddrinfo.c.html#LN142"><span class='Ref_To_Local'>psin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Control'>struct</span> sockaddr <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="getaddrinfo.c.html#LN142"><span class='Ref_To_Local'>psin</span></a><span class='Delimiter'>; 
</span>    <a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../include/getaddrinfo.h.html#LN105"><span class='Ref_to_Member'>ai_canonname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Operator'>-&GT;</span><a href="../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="getaddrinfo.c.html#LN138"><span class='Ref_to_Parameter'>res</span></a> <span class='Operator'>= </span><a href="getaddrinfo.c.html#LN140"><span class='Ref_To_Local'>ai</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getaddrinfo &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN264"></a><span class='Declare_Function'>freeaddrinfo</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>res</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN264"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
        <span class='Comment_Multi_Line'>/* 
         * If Windows has native IPv6 support, use the native Windows routine. 
         * Otherwise, fall through and use our own code. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN60"><span class='Ref_to_Func'>haveNativeWindowsIPv6routines</span></a><span class='Parentheses'>())</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="getaddrinfo.c.html#LN56"><span class='Ref_to_Global_Var'>freeaddrinfo_ptr</span></a><span class='Parentheses'>) (</span><a href="getaddrinfo.c.html#LN264"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN264"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a><span class='Parentheses'>) 
</span>            <a href="../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN264"><span class='Ref_to_Parameter'>res</span></a><span class='Operator'>-&GT;</span><a href="../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN264"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end freeaddrinfo &raquo; </span> 
 
 
<span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN289"></a><span class='Declare_Function'>gai_strerror</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>errcode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> HAVE_HSTRERROR 
<a name="LN292"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>hcode</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN289"><span class='Ref_to_Parameter'>errcode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../include/getaddrinfo.h.html#LN33"><span class='Ref_to_Const'>EAI_NONAME</span></a><span class='Operator'>: 
</span>            <a href="getaddrinfo.c.html#LN292"><span class='Ref_To_Local'>hcode</span></a> <span class='Operator'>= </span>HOST_NOT_FOUND<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../include/getaddrinfo.h.html#LN34"><span class='Ref_to_Const'>EAI_AGAIN</span></a><span class='Operator'>: 
</span>            <a href="getaddrinfo.c.html#LN292"><span class='Ref_To_Local'>hcode</span></a> <span class='Operator'>= </span>TRY_AGAIN<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../include/getaddrinfo.h.html#LN35"><span class='Ref_to_Const'>EAI_FAIL</span></a><span class='Operator'>: 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="getaddrinfo.c.html#LN292"><span class='Ref_To_Local'>hcode</span></a> <span class='Operator'>= </span>NO_RECOVERY<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> hstrerror<span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN292"><span class='Ref_To_Local'>hcode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* !HAVE_HSTRERROR */ 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN289"><span class='Ref_to_Parameter'>errcode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../include/getaddrinfo.h.html#LN33"><span class='Ref_to_Const'>EAI_NONAME</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"Unknown host"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../include/getaddrinfo.h.html#LN34"><span class='Ref_to_Const'>EAI_AGAIN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"Host name lookup failure"</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Errors below are probably WIN32 only */ 
</span><span class='Directive'>#ifdef</span> <a href="../include/getaddrinfo.h.html#LN32"><span class='Ref_to_Const'>EAI_BADFLAGS</span></a> 
        <span class='Control'>case</span> <a href="../include/getaddrinfo.h.html#LN32"><span class='Ref_to_Const'>EAI_BADFLAGS</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"Invalid argument"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../include/getaddrinfo.h.html#LN36"><span class='Ref_to_Const'>EAI_FAMILY</span></a> 
        <span class='Control'>case</span> <a href="../include/getaddrinfo.h.html#LN36"><span class='Ref_to_Const'>EAI_FAMILY</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"Address family not supported"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../include/getaddrinfo.h.html#LN39"><span class='Ref_to_Const'>EAI_MEMORY</span></a> 
        <span class='Control'>case</span> <a href="../include/getaddrinfo.h.html#LN39"><span class='Ref_to_Const'>EAI_MEMORY</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"Not enough memory"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span><a href="../include/getaddrinfo.h.html#LN53"><span class='Ref_to_Const'>EAI_NODATA</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../include/getaddrinfo.h.html#LN53"><span class='Ref_to_Const'>EAI_NODATA</span></a> <span class='Operator'>!= </span><a href="../include/getaddrinfo.h.html#LN33"><span class='Ref_to_Const'>EAI_NONAME</span></a>     <span class='Comment_Single_Line'>/* MSVC/WIN64 duplicate */ 
</span>        <span class='Control'>case</span> <a href="../include/getaddrinfo.h.html#LN53"><span class='Ref_to_Const'>EAI_NODATA</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"No host data of that type was found"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../include/getaddrinfo.h.html#LN38"><span class='Ref_to_Const'>EAI_SERVICE</span></a> 
        <span class='Control'>case</span> <a href="../include/getaddrinfo.h.html#LN38"><span class='Ref_to_Const'>EAI_SERVICE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"Class type not found"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> <a href="../include/getaddrinfo.h.html#LN37"><span class='Ref_to_Const'>EAI_SOCKTYPE</span></a> 
        <span class='Control'>case</span> <a href="../include/getaddrinfo.h.html#LN37"><span class='Ref_to_Const'>EAI_SOCKTYPE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"Socket type not supported"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"Unknown server error"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch errcode &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_HSTRERROR */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end gai_strerror &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert an ipv4 address to a hostname. 
 * 
 * Bugs:    - Only supports NI_NUMERICHOST and NI_NUMERICSERV behavior. 
 *        It will never resolve a hostname. 
 *      - No IPv6 support. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN356"></a><span class='Declare_Function'>getnameinfo</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><span class='Control'>struct</span> sockaddr <span class='Operator'>* </span><span class='Declare_Parameter'>sa</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>salen</span><span class='Delimiter'>, 
</span><a name="LN357"></a>            <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nodelen</span><span class='Delimiter'>, 
</span><a name="LN358"></a>            <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>service</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>servicelen</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>flags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
    <span class='Comment_Multi_Line'>/* 
     * If Windows has native IPv6 support, use the native Windows routine. 
     * Otherwise, fall through and use our own code. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN60"><span class='Ref_to_Func'>haveNativeWindowsIPv6routines</span></a><span class='Parentheses'>())</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="getaddrinfo.c.html#LN57"><span class='Ref_to_Global_Var'>getnameinfo_ptr</span></a><span class='Parentheses'>) (</span><a href="getaddrinfo.c.html#LN356"><span class='Ref_to_Parameter'>sa</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN356"><span class='Ref_to_Parameter'>salen</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN357"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN357"><span class='Ref_to_Parameter'>nodelen</span></a><span class='Delimiter'>, 
</span>                                   <a href="getaddrinfo.c.html#LN358"><span class='Ref_to_Parameter'>service</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN358"><span class='Ref_to_Parameter'>servicelen</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN358"><span class='Ref_to_Parameter'>flags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* Invalid arguments. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN356"><span class='Ref_to_Parameter'>sa</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN357"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="getaddrinfo.c.html#LN358"><span class='Ref_to_Parameter'>service</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN35"><span class='Ref_to_Const'>EAI_FAIL</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span>  HAVE_IPV6 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN356"><span class='Ref_to_Parameter'>sa</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>== </span>AF_INET6<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN36"><span class='Ref_to_Const'>EAI_FAMILY</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* Unsupported flags. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN358"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../include/getaddrinfo.h.html#LN83"><span class='Ref_to_Const'>NI_NAMEREQD</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN34"><span class='Ref_to_Const'>EAI_AGAIN</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN357"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN356"><span class='Ref_to_Parameter'>sa</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>== </span>AF_INET<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="inet_net_ntop.c.html#LN75"><span class='Ref_to_Func'>inet_net_ntop</span></a><span class='Parentheses'>(</span>AF_INET<span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>((</span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="getaddrinfo.c.html#LN356"><span class='Ref_to_Parameter'>sa</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>sin_addr<span class='Delimiter'>, 
</span>                              <a href="getaddrinfo.c.html#LN356"><span class='Ref_to_Parameter'>sa</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>== </span>AF_INET <span class='Operator'>? </span><span class='Number'>32</span> <span class='Operator'>: </span><span class='Number'>128</span><span class='Delimiter'>, 
</span>                              <a href="getaddrinfo.c.html#LN357"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN357"><span class='Ref_to_Parameter'>nodelen</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN39"><span class='Ref_to_Const'>EAI_MEMORY</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN39"><span class='Ref_to_Const'>EAI_MEMORY</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN358"><span class='Ref_to_Parameter'>service</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN399"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN356"><span class='Ref_to_Parameter'>sa</span></a><span class='Operator'>-&GT;</span>sa_family <span class='Operator'>== </span>AF_INET<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="getaddrinfo.c.html#LN399"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN358"><span class='Ref_to_Parameter'>service</span></a><span class='Delimiter'>, </span><a href="getaddrinfo.c.html#LN358"><span class='Ref_to_Parameter'>servicelen</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, 
</span>                           ntohs<span class='Parentheses'>(((</span><span class='Control'>struct</span> sockaddr_in <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="getaddrinfo.c.html#LN356"><span class='Ref_to_Parameter'>sa</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>sin_port<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="getaddrinfo.c.html#LN399"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="getaddrinfo.c.html#LN399"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>&GT;= </span><a href="getaddrinfo.c.html#LN358"><span class='Ref_to_Parameter'>servicelen</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../include/getaddrinfo.h.html#LN39"><span class='Ref_to_Const'>EAI_MEMORY</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getnameinfo &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>