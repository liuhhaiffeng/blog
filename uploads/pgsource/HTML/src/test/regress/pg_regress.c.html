<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\test\regress\pg_regress.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\test\regress\pg_regress.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:14 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_regress --- regression test driver 
 * 
 * This is a C implementation of the previous shell script for running 
 * the regression tests, and should be mostly compatible with it. 
 * Initial author of C translation: Magnus Hagander 
 * 
 * This code is released under the terms of the PostgreSQL License. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * src/test/regress/pg_regress.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres_fe.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/wait.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;signal.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Directive'>#ifdef</span> HAVE_SYS_RESOURCE_H 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/time.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/resource.h&GT;</span> 
<span class='Directive'>#endif</span> 
 
<span class='Keyword'>#include </span><span class='String'>"pg_regress.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"common/restricted_token.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/username.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"getopt_long.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqcomm.h"</span>       <span class='Comment_Single_Line'>/* needed for UNIXSOCK_PATH() */ 
</span><span class='Keyword'>#include </span><span class='String'>"pg_config_paths.h"</span> 
 
<span class='Comment_Multi_Line'>/* for resultmap we need a list of pairs of strings */ 
</span><a name="LN40"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>_resultmap</span> 
<span class='Delimiter'>{ 
</span><a name="LN42"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>test</span><span class='Delimiter'>; 
</span><a name="LN43"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>type</span><span class='Delimiter'>; 
</span><a name="LN44"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>resultfile</span><span class='Delimiter'>; 
</span><a name="LN45"></a>    <span class='Control'>struct</span> <a href="pg_regress.c.html#LN40"><span class='Ref_to_Struct'>_resultmap</span></a> <span class='Operator'>*</span><span class='Declare_Member'>next</span><span class='Delimiter'>; 
</span><a name="LN46"></a>} <span class='Declare_Typedef'>_resultmap</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Values obtained from Makefile. 
 */ 
</span><a name="LN51"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>host_platform</span> <span class='Operator'>= </span>HOST_TUPLE<span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a>                   <span class='Comment_Single_Line'>/* not used in WIN32 case */ 
</span><a name="LN54"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>shellprog</span> <span class='Operator'>= </span>SHELLPROG<span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * On Windows we use -w in diff switches to avoid problems with inconsistent 
 * newline representation.  The actual result files will generally have 
 * Windows-style newlines, but the comparison files might or might not. 
 */ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN63"></a><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Var'>basic_diff_opts</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN64"></a><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Var'>pretty_diff_opts</span> <span class='Operator'>= </span><span class='String'>"-C3"</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN66"></a><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Var'>basic_diff_opts</span> <span class='Operator'>= </span><span class='String'>"-w"</span><span class='Delimiter'>; 
</span><a name="LN67"></a><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Var'>pretty_diff_opts</span> <span class='Operator'>= </span><span class='String'>"-w -C3"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* options settable from command line */ 
</span><a name="LN71"></a><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Var'>dblist</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>debug</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN73"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>inputdir</span> <span class='Operator'>= </span><span class='String'>"."</span><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>outputdir</span> <span class='Operator'>= </span><span class='String'>"."</span><span class='Delimiter'>; 
</span><a name="LN75"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>bindir</span> <span class='Operator'>= </span>PGBINDIR<span class='Delimiter'>; 
</span><a name="LN76"></a><span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Var'>launcher</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN77"></a><span class='Keyword'>static </span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Var'>loadlanguage</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN78"></a><span class='Keyword'>static </span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Var'>loadextension</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN79"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>max_connections</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN80"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>encoding</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN81"></a><span class='Keyword'>static </span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Var'>schedulelist</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN82"></a><span class='Keyword'>static </span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Var'>extra_tests</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN83"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>temp_instance</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN84"></a><span class='Keyword'>static </span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Var'>temp_configs</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN85"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>nolocale</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN86"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>use_existing</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN87"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>hostname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>port</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN89"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>port_specified_by_user</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN90"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>dlpath</span> <span class='Operator'>= </span>PKGLIBDIR<span class='Delimiter'>; 
</span><a name="LN91"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>user</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN92"></a><span class='Keyword'>static </span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Var'>extraroles</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN93"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>config_auth_datadir</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* internal variables */ 
</span><a name="LN96"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>progname</span><span class='Delimiter'>; 
</span><a name="LN97"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>logfilename</span><span class='Delimiter'>; 
</span><a name="LN98"></a><span class='Keyword'>static </span>FILE <span class='Operator'>*</span><span class='Declare_Var'>logfile</span><span class='Delimiter'>; 
</span><a name="LN99"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Var'>difffilename</span><span class='Delimiter'>; 
</span><a name="LN100"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>sockdir</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
<a name="LN102"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>temp_sockdir</span><span class='Delimiter'>; 
</span><a name="LN103"></a><span class='Keyword'>static char </span><span class='Declare_Var'>sockself</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN104"></a><span class='Keyword'>static char </span><span class='Declare_Var'>socklock</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><span class='Directive'>#endif</span> 
 
<a name="LN107"></a><span class='Keyword'>static </span><a href="pg_regress.c.html#LN40"><span class='Ref_to_Struct'>_resultmap</span></a> <span class='Operator'>*</span><span class='Declare_Var'>resultmap</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<a name="LN109"></a><span class='Keyword'>static </span><a href="pg_regress.h.html#LN13"><span class='Ref_to_Const'>PID_TYPE</span></a> <span class='Declare_Var'>postmaster_pid</span> <span class='Operator'>= </span><a href="pg_regress.h.html#LN14"><span class='Ref_to_Const'>INVALID_PID</span></a><span class='Delimiter'>; 
</span><a name="LN110"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>postmaster_running</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN112"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>success_count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN113"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>fail_count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN114"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>fail_ignore_count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<a name="LN116"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>directory_exists</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dir</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN117"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>make_directory</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dir</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN119"></a><span class='Keyword'>static void </span><span class='Declare_Function'>header</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) </span><a href="../../port/win32security.c.html#LN25"><span class='Ref_to_Func'>pg_attribute_printf</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><a href="pg_regress.c.html#LN119"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) </span><a href="../../port/win32security.c.html#LN25"><span class='Ref_to_Func'>pg_attribute_printf</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>static void </span><a href="pg_regress.c.html#LN1078"><span class='Ref_to_Func'>psql_command</span></a><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span>database<span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span>query<span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) </span><a href="../../port/win32security.c.html#LN25"><span class='Ref_to_Func'>pg_attribute_printf</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * allow core files if possible. 
 */ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>HAVE_GETRLIMIT<span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span>RLIMIT_CORE<span class='Parentheses'>) 
</span><span class='Keyword'>static void 
</span><a href="../../bin/pg_ctl/pg_ctl.c.html#LN154"><span class='Ref_to_Proto'>unlimit_core_size</span></a><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN130"></a>    <span class='Control'>struct</span> rlimit <span class='Declare_Local'>lim</span><span class='Delimiter'>; 
</span> 
    getrlimit<span class='Parentheses'>(</span>RLIMIT_CORE<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN130"><span class='Ref_To_Local'>lim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN130"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_max <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: could not set core size: disallowed by hard limit\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN130"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_max <span class='Operator'>== </span>RLIM_INFINITY <span class='Operator'>|| </span><a href="pg_regress.c.html#LN130"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_cur <span class='Operator'>&LT; </span><a href="pg_regress.c.html#LN130"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_max<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.c.html#LN130"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_cur <span class='Operator'>= </span><a href="pg_regress.c.html#LN130"><span class='Ref_To_Local'>lim</span></a><span class='Operator'>.</span>rlim_max<span class='Delimiter'>; 
</span>        setrlimit<span class='Parentheses'>(</span>RLIMIT_CORE<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN130"><span class='Ref_To_Local'>lim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end header &raquo; </span> 
<span class='Directive'>#endif</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Add an item at the end of a stringlist. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN153"></a><span class='Declare_Function'>add_stringlist_item</span><span class='Parentheses'>(</span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>listhead</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN155"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newentry</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN156"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oldentry</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN155"><span class='Ref_To_Local'>newentry</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN153"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN155"><span class='Ref_To_Local'>newentry</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN153"><span class='Ref_to_Parameter'>listhead</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="pg_regress.c.html#LN153"><span class='Ref_to_Parameter'>listhead</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN155"><span class='Ref_To_Local'>newentry</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN156"><span class='Ref_To_Local'>oldentry</span></a> <span class='Operator'>= *</span><a href="pg_regress.c.html#LN153"><span class='Ref_to_Parameter'>listhead</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN156"><span class='Ref_To_Local'>oldentry</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN156"><span class='Ref_To_Local'>oldentry</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN156"><span class='Ref_To_Local'>oldentry</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>             <span class='Comment_Multi_Line'>/* skip */ </span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN156"><span class='Ref_To_Local'>oldentry</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN155"><span class='Ref_To_Local'>newentry</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Free a stringlist. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN174"></a><span class='Declare_Function'>free_stringlist</span><span class='Parentheses'>(</span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>listhead</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN174"><span class='Ref_to_Parameter'>listhead</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| *</span><a href="pg_regress.c.html#LN174"><span class='Ref_to_Parameter'>listhead</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN174"><span class='Ref_to_Parameter'>listhead</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="pg_regress.c.html#LN173"><span class='Ref_to_Func'>free_stringlist</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN174"><span class='Ref_to_Parameter'>listhead</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN174"><span class='Ref_to_Parameter'>listhead</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN174"><span class='Ref_to_Parameter'>listhead</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="pg_regress.c.html#LN174"><span class='Ref_to_Parameter'>listhead</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Split a delimited string into a stringlist 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN189"></a><span class='Declare_Function'>split_to_stringlist</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>delim</span><span class='Delimiter'>, </span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>listhead</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN191"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sc</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN189"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN192"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>token</span> <span class='Operator'>= </span>strtok<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN191"><span class='Ref_To_Local'>sc</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN189"><span class='Ref_to_Parameter'>delim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN192"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.h.html#LN49"><span class='Ref_to_Proto'>add_stringlist_item</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN189"><span class='Ref_to_Parameter'>listhead</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN192"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN192"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span>strtok<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN189"><span class='Ref_to_Parameter'>delim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN191"><span class='Ref_To_Local'>sc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Print a progress banner on stdout. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN206"></a><span class='Declare_Function'>header</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN208"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tmp</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span><a name="LN209"></a>    va_list     <span class='Declare_Local'>ap</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN209"><span class='Ref_To_Local'>ap</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN206"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/plperl.h.html#LN59"><span class='Ref_to_Macro'>vsnprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN208"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN208"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN206"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN209"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN209"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stdout<span class='Delimiter'>, </span><span class='String'>"============== %-38s ==============\n"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN208"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Print "doing something ..." --- supplied text should not end with newline 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN223"></a><span class='Declare_Function'>status</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fmt</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN225"></a>    va_list     <span class='Declare_Local'>ap</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN225"><span class='Ref_To_Local'>ap</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN223"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN171"><span class='Ref_to_Macro'>vfprintf</span></a><span class='Parentheses'>(</span>stdout<span class='Delimiter'>, </span><a href="pg_regress.c.html#LN223"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN225"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN225"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN98"><span class='Ref_to_Global_Var'>logfile</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN225"><span class='Ref_To_Local'>ap</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN223"><span class='Ref_to_Parameter'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/port.h.html#LN171"><span class='Ref_to_Macro'>vfprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN98"><span class='Ref_to_Global_Var'>logfile</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN223"><span class='Ref_to_Parameter'>fmt</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN225"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN225"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Done "doing something ..." 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN244"></a><span class='Declare_Function'>status_end</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stdout<span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN98"><span class='Ref_to_Global_Var'>logfile</span></a><span class='Parentheses'>) 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN98"><span class='Ref_to_Global_Var'>logfile</span></a><span class='Delimiter'>, </span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * shut down temp postmaster 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN256"></a><span class='Declare_Function'>stop_postmaster</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN110"><span class='Ref_to_Global_Var'>postmaster_running</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We use pg_ctl to issue the kill and wait for stop */ 
</span><a name="LN261"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN262"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* On Windows, system() seems not to force fflush, so... */ 
</span>        fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        fflush<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN261"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN261"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>"\"%s%spg_ctl\" stop -D \"%s/data\" -s"</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>? </span><a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>? </span><span class='String'>"/"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN262"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN312"><span class='Ref_to_Macro'>system</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN261"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN262"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: could not stop postmaster: exit code was %d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN262"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            _exit<span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* not exit(), that could be recursive */ 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_regress.c.html#LN110"><span class='Ref_to_Global_Var'>postmaster_running</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if postmaster_running &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end stop_postmaster &raquo; </span> 
 
<span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
<span class='Comment_Multi_Line'>/* 
 * Remove the socket temporary directory.  pg_regress never waits for a 
 * postmaster exit, so it is indeterminate whether the postmaster has yet to 
 * unlink the socket and lock file.  Unlink them here so we can proceed to 
 * remove the directory.  Ignore errors; leaking a temporary directory is 
 * unimportant.  This can run from a signal handler.  The code is not 
 * acceptable in a Windows signal handler (see initdb.c:trapsig()), but 
 * Windows is not a HAVE_UNIX_SOCKETS platform. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN296"></a><span class='Declare_Function'>remove_temp</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN102"><span class='Ref_to_Global_Var'>temp_sockdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN103"><span class='Ref_to_Global_Var'>sockself</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN104"><span class='Ref_to_Global_Var'>socklock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    rmdir<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN102"><span class='Ref_to_Global_Var'>temp_sockdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Signal handler that calls remove_temp() and reraises the signal. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN308"></a><span class='Declare_Function'>signal_remove_temp</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>signum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_regress.c.html#LN295"><span class='Ref_to_Func'>remove_temp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN308"><span class='Ref_to_Parameter'>signum</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN182"><span class='Ref_to_Const'>SIG_DFL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    raise<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN308"><span class='Ref_to_Parameter'>signum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Create a temporary directory suitable for the server's Unix-domain socket. 
 * The directory will have mode 0700 or stricter, so no other OS user can open 
 * our socket to exploit our use of trust authentication.  Most systems 
 * constrain the length of socket paths well below _POSIX_PATH_MAX, so we 
 * place the directory under /tmp rather than relative to the possibly-deep 
 * current working directory. 
 * 
 * Compared to using the compiled-in DEFAULT_PGSOCKET_DIR, this also permits 
 * testing to work in builds that relocate it to a directory not writable to 
 * the build/test user. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN329"></a><span class='Declare_Function'>make_temp_sockdir</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN331"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>template</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><span class='String'>"/tmp/pg_regress-XXXXXX"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN102"><span class='Ref_to_Global_Var'>temp_sockdir</span></a> <span class='Operator'>= </span><a href="../../port/mkdtemp.c.html#LN284"><span class='Ref_to_Func'>mkdtemp</span></a><span class='Parentheses'>(</span><span class='Control'>template</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN102"><span class='Ref_to_Global_Var'>temp_sockdir</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not create directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><span class='Control'>template</span><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Stage file names for remove_temp().  Unsafe in a signal handler. */ 
</span>    <a href="../../include/libpq/pqcomm.h.html#LN69"><span class='Ref_to_Macro'>UNIXSOCK_PATH</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN103"><span class='Ref_to_Global_Var'>sockself</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN102"><span class='Ref_to_Global_Var'>temp_sockdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN104"><span class='Ref_to_Global_Var'>socklock</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN104"><span class='Ref_to_Global_Var'>socklock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s.lock"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN103"><span class='Ref_to_Global_Var'>sockself</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remove the directory during clean exit. */ 
</span>    atexit<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN295"><span class='Ref_to_Func'>remove_temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Remove the directory before dying to the usual signals.  Omit SIGQUIT, 
     * preserving it as a quick, untidy exit. 
     */ 
</span>    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN187"><span class='Ref_to_Const'>SIGHUP</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN307"><span class='Ref_to_Func'>signal_remove_temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span>SIGINT<span class='Delimiter'>, </span><a href="pg_regress.c.html#LN307"><span class='Ref_to_Func'>signal_remove_temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN192"><span class='Ref_to_Const'>SIGPIPE</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN307"><span class='Ref_to_Func'>signal_remove_temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../port/pqsignal.c.html#LN38"><span class='Ref_to_Func'>pqsignal</span></a><span class='Parentheses'>(</span>SIGTERM<span class='Delimiter'>, </span><a href="pg_regress.c.html#LN307"><span class='Ref_to_Func'>signal_remove_temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_regress.c.html#LN102"><span class='Ref_to_Global_Var'>temp_sockdir</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_temp_sockdir &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* HAVE_UNIX_SOCKETS */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Check whether string matches pattern 
 * 
 * In the original shell script, this function was implemented using expr(1), 
 * which provides basic regular expressions restricted to match starting at 
 * the string start (in conventional regex terms, there's an implicit "^" 
 * at the start of the pattern --- but no implicit "$" at the end). 
 * 
 * For now, we only support "." and ".*" as non-literal metacharacters, 
 * because that's all that anyone has found use for in resultmap.  This 
 * code could be extended if more functionality is needed. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN374"></a><span class='Declare_Function'>string_matches_pattern</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pattern</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>&& *</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a> <span class='Operator'>== </span><span class='String'>'.'</span> <span class='Operator'>&& </span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'*'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Trailing .* matches everything. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Otherwise, scan for a text position at which we can match the 
             * rest of the pattern. 
             */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Optimization to prevent most recursion: don't recurse 
                 * unless first pattern char might match this text char. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== *</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a> <span class='Operator'>|| *</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN373"><span class='Ref_to_Func'>string_matches_pattern</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * End of text with no match. 
             */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *pattern=='.'&&patter... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a> <span class='Operator'>!= </span><span class='String'>'.'</span> <span class='Operator'>&& *</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>!= *</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Not the single-character wildcard and no explicit match? Then 
             * time to quit... 
             */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *str&&*pattern &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* end of pattern, so declare match */ 
</span> 
    <span class='Comment_Multi_Line'>/* End of input string.  Do we have matching pattern remaining? */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a> <span class='Operator'>== </span><span class='String'>'.'</span> <span class='Operator'>&& </span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'*'</span><span class='Parentheses'>) 
</span>        <a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN374"><span class='Ref_to_Parameter'>pattern</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* end of pattern, so declare match */ 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end string_matches_pattern &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Replace all occurrences of a string in a string with a different string. 
 * NOTE: Assumes there is enough room in the target buffer! 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN439"></a><span class='Declare_Function'>replace_string</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>replace</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>replacement</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN441"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_regress.c.html#LN441"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span>strstr<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN439"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN439"><span class='Ref_to_Parameter'>replace</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN445"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dup</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN439"><span class='Ref_to_Parameter'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN439"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN445"><span class='Ref_To_Local'>dup</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN441"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>- </span><a href="pg_regress.c.html#LN439"><span class='Ref_to_Parameter'>string</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        strcat<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN439"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN439"><span class='Ref_to_Parameter'>replacement</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        strcat<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN439"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN445"><span class='Ref_To_Local'>dup</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN441"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>- </span><a href="pg_regress.c.html#LN439"><span class='Ref_to_Parameter'>string</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN439"><span class='Ref_to_Parameter'>replace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN445"><span class='Ref_To_Local'>dup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Convert *.source found in the "source" directory, replacing certain tokens 
 * in the file contents with their intended values, and put the resulting files 
 * in the "dest" directory, replacing the ".source" prefix in their names with 
 * the given suffix. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN461"></a><span class='Declare_Function'>convert_sourcefiles_in</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>source_subdir</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dest_dir</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dest_subdir</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>suffix</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN463"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>testtablespace</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN464"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>indir</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN465"></a>    <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>st</span><span class='Delimiter'>; 
</span><a name="LN466"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span><a name="LN467"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>name</span><span class='Delimiter'>; 
</span><a name="LN468"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>names</span><span class='Delimiter'>; 
</span><a name="LN469"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN464"><span class='Ref_To_Local'>indir</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN73"><span class='Ref_to_Global_Var'>inputdir</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN461"><span class='Ref_to_Parameter'>source_subdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that indir actually exists and is a directory */ 
</span>    <a href="pg_regress.c.html#LN466"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN464"><span class='Ref_To_Local'>indir</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN465"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN466"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| !</span><a href="../../include/port/win32.h.html#LN429"><span class='Ref_to_Macro'>S_ISDIR</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN465"><span class='Ref_To_Local'>st</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * No warning, to avoid noise in tests that do not have these 
         * directories; for example, ecpg, contrib and src/pl. 
         */ 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_regress.c.html#LN468"><span class='Ref_To_Local'>names</span></a> <span class='Operator'>= </span><a href="../../common/pgfnames.c.html#LN29"><span class='Ref_to_Func'>pgfnames</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN464"><span class='Ref_To_Local'>indir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN468"><span class='Ref_To_Local'>names</span></a><span class='Parentheses'>) 
</span>        <span class='Comment_Multi_Line'>/* Error logged in pgfnames */ 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN463"><span class='Ref_To_Local'>testtablespace</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/testtablespace"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
    <span class='Comment_Multi_Line'>/* 
     * On Windows only, clean out the test tablespace dir, or create it if it 
     * doesn't exist.  On other platforms we expect the Makefile to take care 
     * of that.  (We don't migrate that functionality in here because it'd be 
     * harder to cope with platform-specific issues such as SELinux.) 
     * 
     * XXX it would be better if pg_regress.c had nothing at all to do with 
     * testtablespace, and this were handled by a .BAT file or similar on 
     * Windows.  See pgsql-hackers discussion of 2008-01-18. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN116"><span class='Ref_to_Proto'>directory_exists</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN463"><span class='Ref_To_Local'>testtablespace</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../common/rmtree.c.html#LN34"><span class='Ref_to_Func'>rmtree</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN463"><span class='Ref_To_Local'>testtablespace</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: could not remove test tablespace \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN463"><span class='Ref_To_Local'>testtablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <a href="pg_regress.c.html#LN117"><span class='Ref_to_Proto'>make_directory</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN463"><span class='Ref_To_Local'>testtablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* finally loop on each file and do the replacement */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN467"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN468"><span class='Ref_To_Local'>names</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="pg_regress.c.html#LN467"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN467"><span class='Ref_To_Local'>name</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN516"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>srcfile</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN517"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>destfile</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN518"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>prefix</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN519"></a>        FILE       <span class='Operator'>*</span><span class='Declare_Local'>infile</span><span class='Delimiter'>, 
</span><a name="LN520"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>outfile</span><span class='Delimiter'>; 
</span><a name="LN521"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>line</span><span class='Delimiter'>[</span><span class='Number'>1024</span><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* reject filenames not finishing in ".source" */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN467"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>8</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN467"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN467"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>7</span><span class='Delimiter'>, </span><span class='String'>".source"</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="pg_regress.c.html#LN469"><span class='Ref_To_Local'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* build the full actual paths to open */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN518"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN467"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>6</span><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="pg_regress.c.html#LN467"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN516"><span class='Ref_To_Local'>srcfile</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN464"><span class='Ref_To_Local'>indir</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="pg_regress.c.html#LN467"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN517"><span class='Ref_To_Local'>destfile</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s/%s.%s"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN461"><span class='Ref_to_Parameter'>dest_dir</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN461"><span class='Ref_to_Parameter'>dest_subdir</span></a><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN518"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN461"><span class='Ref_to_Parameter'>suffix</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_regress.c.html#LN519"><span class='Ref_To_Local'>infile</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN516"><span class='Ref_To_Local'>srcfile</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN519"><span class='Ref_To_Local'>infile</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for reading: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN516"><span class='Ref_To_Local'>srcfile</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_regress.c.html#LN520"><span class='Ref_To_Local'>outfile</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN517"><span class='Ref_To_Local'>destfile</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN520"><span class='Ref_To_Local'>outfile</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for writing: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN517"><span class='Ref_To_Local'>destfile</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span>fgets<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN521"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN521"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN519"><span class='Ref_To_Local'>infile</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_regress.h.html#LN51"><span class='Ref_to_Proto'>replace_string</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN521"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><span class='String'>"@abs_srcdir@"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN73"><span class='Ref_to_Global_Var'>inputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.h.html#LN51"><span class='Ref_to_Proto'>replace_string</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN521"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><span class='String'>"@abs_builddir@"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.h.html#LN51"><span class='Ref_to_Proto'>replace_string</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN521"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><span class='String'>"@testtablespace@"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN463"><span class='Ref_To_Local'>testtablespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.h.html#LN51"><span class='Ref_to_Proto'>replace_string</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN521"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><span class='String'>"@libdir@"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN90"><span class='Ref_to_Global_Var'>dlpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.h.html#LN51"><span class='Ref_to_Proto'>replace_string</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN521"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><span class='String'>"@DLSUFFIX@"</span><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN442"><span class='Ref_to_Const'>DLSUFFIX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN521"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN520"><span class='Ref_To_Local'>outfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN519"><span class='Ref_To_Local'>infile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN520"><span class='Ref_To_Local'>outfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for name=names;*name;name... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we didn't process any files, complain because it probably means 
     * somebody neglected to pass the needed --inputdir argument. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN469"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: no *.source files found in \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN464"><span class='Ref_To_Local'>indir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/port.h.html#LN66"><span class='Ref_to_Proto'>pgfnames_cleanup</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN468"><span class='Ref_To_Local'>names</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convert_sourcefiles_in &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Create the .sql and .out files from the .source files, if any */ 
</span><span class='Keyword'>static void 
</span><a name="LN580"></a><span class='Declare_Function'>convert_sourcefiles</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_regress.c.html#LN460"><span class='Ref_to_Func'>convert_sourcefiles_in</span></a><span class='Parentheses'>(</span><span class='String'>"input"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Delimiter'>, </span><span class='String'>"sql"</span><span class='Delimiter'>, </span><span class='String'>"sql"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN460"><span class='Ref_to_Func'>convert_sourcefiles_in</span></a><span class='Parentheses'>(</span><span class='String'>"output"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Delimiter'>, </span><span class='String'>"expected"</span><span class='Delimiter'>, </span><span class='String'>"out"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Scan resultmap file to find which platform-specific expected files to use. 
 * 
 * The format of each line of the file is 
 *         testname/hostplatformpattern=substitutefile 
 * where the hostplatformpattern is evaluated per the rules of expr(1), 
 * namely, it is a standard regular expression with an implicit ^ at the start. 
 * (We currently support only a very limited subset of regular expressions, 
 * see string_matches_pattern() above.)  What hostplatformpattern will be 
 * matched against is the config.guess output.  (In the shell-script version, 
 * we also provided an indication of whether gcc or another compiler was in 
 * use, but that facility isn't used anymore.) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN600"></a><span class='Declare_Function'>load_resultmap</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN602"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN603"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>f</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* scan the file ... */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/resultmap"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN73"><span class='Ref_to_Global_Var'>inputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN603"><span class='Ref_To_Local'>f</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN603"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* OK if it doesn't exist, else complain */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for reading: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span>fgets<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN603"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN620"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>platform</span><span class='Delimiter'>; 
</span><a name="LN621"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>file_type</span><span class='Delimiter'>; 
</span><a name="LN622"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>expected</span><span class='Delimiter'>; 
</span><a name="LN623"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* strip trailing whitespace, especially the newline */ 
</span>        <a href="pg_regress.c.html#LN623"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN623"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN623"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="pg_regress.c.html#LN623"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* parse out the line fields */ 
</span>        <a href="pg_regress.c.html#LN621"><span class='Ref_To_Local'>file_type</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>':'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN621"><span class='Ref_To_Local'>file_type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"incorrectly formatted resultmap entry: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="pg_regress.c.html#LN621"><span class='Ref_To_Local'>file_type</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <a href="pg_regress.c.html#LN620"><span class='Ref_To_Local'>platform</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN621"><span class='Ref_To_Local'>file_type</span></a><span class='Delimiter'>, </span><span class='String'>':'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN620"><span class='Ref_To_Local'>platform</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"incorrectly formatted resultmap entry: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="pg_regress.c.html#LN620"><span class='Ref_To_Local'>platform</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN622"><span class='Ref_To_Local'>expected</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN620"><span class='Ref_To_Local'>platform</span></a><span class='Delimiter'>, </span><span class='String'>'='</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN622"><span class='Ref_To_Local'>expected</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"incorrectly formatted resultmap entry: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="pg_regress.c.html#LN622"><span class='Ref_To_Local'>expected</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * if it's for current platform, save it in resultmap list. Note: by 
         * adding at the front of the list, we ensure that in ambiguous cases, 
         * the last match in the resultmap file is used. This mimics the 
         * behavior of the old shell script. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN373"><span class='Ref_to_Func'>string_matches_pattern</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN51"><span class='Ref_to_Global_Var'>host_platform</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN620"><span class='Ref_To_Local'>platform</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN665"></a>            <a href="pg_regress.c.html#LN40"><span class='Ref_to_Struct'>_resultmap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN40"><span class='Ref_to_Struct'>_resultmap</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="pg_regress.c.html#LN665"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.c.html#LN42"><span class='Ref_to_Member'>test</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN602"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN665"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.c.html#LN43"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN621"><span class='Ref_To_Local'>file_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN665"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.c.html#LN44"><span class='Ref_to_Member'>resultfile</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN622"><span class='Ref_To_Local'>expected</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN665"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.c.html#LN45"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN107"><span class='Ref_to_Global_Var'>resultmap</span></a><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN107"><span class='Ref_to_Global_Var'>resultmap</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN665"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while fgets(buf,sizeof(buf)... &raquo; </span> 
    fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN603"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end load_resultmap &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check in resultmap if we should be looking at a different file 
 */ 
</span><span class='Keyword'>static 
const char </span><span class='Operator'>* 
</span><a name="LN682"></a><span class='Declare_Function'>get_expectfile</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>testname</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>file</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN684"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>file_type</span><span class='Delimiter'>; 
</span><a name="LN685"></a>    <a href="pg_regress.c.html#LN40"><span class='Ref_to_Struct'>_resultmap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rm</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the file type from the file name. This is just what is 
     * following the last dot in the file name. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN682"><span class='Ref_to_Parameter'>file</span></a> <span class='Operator'>|| !</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN684"><span class='Ref_To_Local'>file_type</span></a> <span class='Operator'>= </span>strrchr<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN682"><span class='Ref_to_Parameter'>file</span></a><span class='Delimiter'>, </span><span class='String'>'.'</span><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN684"><span class='Ref_To_Local'>file_type</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN685"><span class='Ref_To_Local'>rm</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN107"><span class='Ref_to_Global_Var'>resultmap</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN685"><span class='Ref_To_Local'>rm</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN685"><span class='Ref_To_Local'>rm</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN685"><span class='Ref_To_Local'>rm</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.c.html#LN45"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN682"><span class='Ref_to_Parameter'>testname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN685"><span class='Ref_To_Local'>rm</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.c.html#LN42"><span class='Ref_to_Member'>test</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN684"><span class='Ref_To_Local'>file_type</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN685"><span class='Ref_To_Local'>rm</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.c.html#LN43"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>return</span> <a href="pg_regress.c.html#LN685"><span class='Ref_To_Local'>rm</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.c.html#LN44"><span class='Ref_to_Member'>resultfile</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_expectfile &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Handy subroutine for setting an environment variable "var" to "val" 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN711"></a><span class='Declare_Function'>doputenv</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN713"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN713"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s=%s"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN711"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN711"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN713"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Prepare environment variables for running regression tests 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN723"></a><span class='Declare_Function'>initialize_environment</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGAPPNAME=pg_regress"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN85"><span class='Ref_to_Global_Var'>nolocale</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Clear out any non-C locale settings 
         */ 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"LC_COLLATE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"LC_CTYPE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"LC_MONETARY"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"LC_NUMERIC"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"LC_TIME"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"LANG"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Most platforms have adopted the POSIX locale as their 
         * implementation-defined default locale.  Exceptions include native 
         * Windows, macOS with --enable-nls, and Cygwin with --enable-nls. 
         * (Use of --enable-nls matters because libintl replaces setlocale().) 
         * Also, PostgreSQL does not support macOS with locale environment 
         * variables unset; see PostmasterMain(). 
         */ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span>defined<span class='Parentheses'>(</span>__CYGWIN__<span class='Parentheses'>) </span><span class='Operator'>|| </span>defined<span class='Parentheses'>(</span><a href="../../include/port/darwin.h.html#LN2"><span class='Ref_to_Const'>__darwin__</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><span class='String'>"LANG=C"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nolocale &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Set translation-related settings to English; otherwise psql will 
     * produce translated messages and produce diffs.  (XXX If we ever support 
     * translation of pg_regress, this needs to be moved elsewhere, where psql 
     * is actually called.) 
     */ 
</span>    <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"LANGUAGE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"LC_ALL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><span class='String'>"LC_MESSAGES=C"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set encoding as requested 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN80"><span class='Ref_to_Global_Var'>encoding</span></a><span class='Parentheses'>) 
</span>        <a href="pg_regress.c.html#LN710"><span class='Ref_to_Func'>doputenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGCLIENTENCODING"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN80"><span class='Ref_to_Global_Var'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGCLIENTENCODING"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set timezone and datestyle for datetime-related tests 
     */ 
</span>    <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGTZ=PST8PDT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGDATESTYLE=Postgres, MDY"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Likewise set intervalstyle to ensure consistent results.  This is a bit 
     * more painful because we must use PGOPTIONS, and we want to preserve the 
     * user's ability to set other variables through that. 
     */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN782"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>my_pgoptions</span> <span class='Operator'>= </span><span class='String'>"-c intervalstyle=postgres_verbose"</span><span class='Delimiter'>; 
</span><a name="LN783"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>old_pgoptions</span> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGOPTIONS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN784"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>new_pgoptions</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN783"><span class='Ref_To_Local'>old_pgoptions</span></a><span class='Parentheses'>) 
</span>            <a href="pg_regress.c.html#LN783"><span class='Ref_To_Local'>old_pgoptions</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN784"><span class='Ref_To_Local'>new_pgoptions</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"PGOPTIONS=%s %s"</span><span class='Delimiter'>, 
</span>                                 <a href="pg_regress.c.html#LN783"><span class='Ref_To_Local'>old_pgoptions</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN782"><span class='Ref_To_Local'>my_pgoptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN784"><span class='Ref_To_Local'>new_pgoptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Clear out any environment vars that might cause psql to connect to 
         * the wrong postmaster, or otherwise behave in nondefault ways. (Note 
         * we also use psql's -X switch consistently, so that ~/.psqlrc files 
         * won't mess things up.)  Also, set PGPORT to the temp port, and set 
         * PGHOST depending on whether we are using TCP or Unix sockets. 
         */ 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGDATABASE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGUSER"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGSERVICE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGSSLMODE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGREQUIRESSL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGCONNECT_TIMEOUT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGDATA"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> HAVE_UNIX_SOCKETS 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN87"><span class='Ref_to_Global_Var'>hostname</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pg_regress.c.html#LN710"><span class='Ref_to_Func'>doputenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGHOST"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN87"><span class='Ref_to_Global_Var'>hostname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_regress.c.html#LN100"><span class='Ref_to_Global_Var'>sockdir</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PG_REGRESS_SOCK_DIR"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN100"><span class='Ref_to_Global_Var'>sockdir</span></a><span class='Parentheses'>) 
</span>                <a href="pg_regress.c.html#LN100"><span class='Ref_to_Global_Var'>sockdir</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN328"><span class='Ref_to_Func'>make_temp_sockdir</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN710"><span class='Ref_to_Func'>doputenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGHOST"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN100"><span class='Ref_to_Global_Var'>sockdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#else</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN87"><span class='Ref_to_Global_Var'>hostname</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN710"><span class='Ref_to_Func'>doputenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGHOST"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN87"><span class='Ref_to_Global_Var'>hostname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGHOSTADDR"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN826"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>s</span><span class='Delimiter'>[</span><span class='Number'>16</span><span class='Delimiter'>]; 
</span> 
            <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN826"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN710"><span class='Ref_to_Func'>doputenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGPORT"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN826"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if temp_instance &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN834"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>pghost</span><span class='Delimiter'>; 
</span><a name="LN835"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>pgport</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * When testing an existing install, we honor existing environment 
         * variables, except if they're overridden by command line options. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN87"><span class='Ref_to_Global_Var'>hostname</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_regress.c.html#LN710"><span class='Ref_to_Func'>doputenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGHOST"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN87"><span class='Ref_to_Global_Var'>hostname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../port/unsetenv.c.html#LN18"><span class='Ref_to_Func'>unsetenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGHOSTADDR"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN848"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>s</span><span class='Delimiter'>[</span><span class='Number'>16</span><span class='Delimiter'>]; 
</span> 
            <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN848"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN710"><span class='Ref_to_Func'>doputenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGPORT"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN848"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN91"><span class='Ref_to_Global_Var'>user</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="pg_regress.c.html#LN710"><span class='Ref_to_Func'>doputenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGUSER"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN91"><span class='Ref_to_Global_Var'>user</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Report what we're connecting to 
         */ 
</span>        <a href="pg_regress.c.html#LN834"><span class='Ref_To_Local'>pghost</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGHOST"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN835"><span class='Ref_To_Local'>pgport</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGPORT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifndef</span> HAVE_UNIX_SOCKETS 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN834"><span class='Ref_To_Local'>pghost</span></a><span class='Parentheses'>) 
</span>            <a href="pg_regress.c.html#LN834"><span class='Ref_To_Local'>pghost</span></a> <span class='Operator'>= </span><span class='String'>"localhost"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN834"><span class='Ref_To_Local'>pghost</span></a> <span class='Operator'>&& </span><a href="pg_regress.c.html#LN835"><span class='Ref_To_Local'>pgport</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"(using postmaster on %s, port %s)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN834"><span class='Ref_To_Local'>pghost</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN835"><span class='Ref_To_Local'>pgport</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN834"><span class='Ref_To_Local'>pghost</span></a> <span class='Operator'>&& !</span><a href="pg_regress.c.html#LN835"><span class='Ref_To_Local'>pgport</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"(using postmaster on %s, default port)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN834"><span class='Ref_To_Local'>pghost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN834"><span class='Ref_To_Local'>pghost</span></a> <span class='Operator'>&& </span><a href="pg_regress.c.html#LN835"><span class='Ref_To_Local'>pgport</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"(using postmaster on Unix socket, port %s)\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN835"><span class='Ref_To_Local'>pgport</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN834"><span class='Ref_To_Local'>pghost</span></a> <span class='Operator'>&& !</span><a href="pg_regress.c.html#LN835"><span class='Ref_To_Local'>pgport</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"(using postmaster on Unix socket, default port)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="pg_regress.c.html#LN579"><span class='Ref_to_Func'>convert_sourcefiles</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN599"><span class='Ref_to_Func'>load_resultmap</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end initialize_environment &raquo; </span> 
 
<a name="LN880"></a><span class='Declare_Function'>pg_attribute_unused</span><span class='Parentheses'>() 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span>fmtHba<span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span>raw<span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN884"></a>    <span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span><a name="LN885"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>rp</span><span class='Delimiter'>; 
</span><a name="LN886"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>wp</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN886"><span class='Ref_To_Local'>wp</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN884"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/snowball/header.h.html#LN59"><span class='Ref_to_Macro'>realloc</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN884"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><span class='Number'>3</span> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span>raw<span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="pg_regress.c.html#LN886"><span class='Ref_To_Local'>wp</span></a><span class='Operator'>++ = </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN885"><span class='Ref_To_Local'>rp</span></a> <span class='Operator'>= </span>raw<span class='Delimiter'>; </span><span class='Operator'>*</span><a href="pg_regress.c.html#LN885"><span class='Ref_To_Local'>rp</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN885"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN885"><span class='Ref_To_Local'>rp</span></a> <span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="pg_regress.c.html#LN886"><span class='Ref_To_Local'>wp</span></a><span class='Operator'>++ = </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pg_regress.c.html#LN886"><span class='Ref_To_Local'>wp</span></a><span class='Operator'>++ = *</span><a href="pg_regress.c.html#LN885"><span class='Ref_To_Local'>rp</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="pg_regress.c.html#LN886"><span class='Ref_To_Local'>wp</span></a><span class='Operator'>++ = </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="pg_regress.c.html#LN886"><span class='Ref_To_Local'>wp</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_regress.c.html#LN884"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_attribute_unused &raquo; </span> 
 
<span class='Directive'>#ifdef</span> <a href="../../include/port/win32.h.html#LN30"><span class='Ref_to_Const'>ENABLE_SSPI</span></a> 
<span class='Comment_Multi_Line'>/* 
 * Get account and domain/realm names for the current user.  This is based on 
 * pg_SSPI_recvauth().  The returned strings use static storage. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN909"></a><span class='Declare_Function'>current_windows_user</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>acct</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>dom</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN911"></a>    <span class='Keyword'>static char </span><span class='Declare_Local'>accountname</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN912"></a>    <span class='Keyword'>static char </span><span class='Declare_Local'>domainname</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN913"></a>    HANDLE      <span class='Declare_Local'>token</span><span class='Delimiter'>; 
</span><a name="LN914"></a>    TOKEN_USER <span class='Operator'>*</span><span class='Declare_Local'>tokenuser</span><span class='Delimiter'>; 
</span><a name="LN915"></a>    <span class='Keyword'>DWORD</span>       <span class='Declare_Local'>retlen</span><span class='Delimiter'>; 
</span><a name="LN916"></a>    <span class='Keyword'>DWORD</span>       <span class='Declare_Local'>accountnamesize</span> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN911"><span class='Ref_To_Local'>accountname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN917"></a>    <span class='Keyword'>DWORD</span>       <span class='Declare_Local'>domainnamesize</span> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN912"><span class='Ref_To_Local'>domainname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN918"></a>    SID_NAME_USE <span class='Declare_Local'>accountnameuse</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>OpenProcessToken<span class='Parentheses'>(</span>GetCurrentProcess<span class='Parentheses'>()</span><span class='Delimiter'>, </span>TOKEN_READ<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN913"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: could not open process token: error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>GetTokenInformation<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN913"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span>TokenUser<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN915"><span class='Ref_To_Local'>retlen</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span>GetLastError<span class='Parentheses'>() </span><span class='Operator'>!= </span><span class='Number'>122</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: could not get token information buffer size: error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_regress.c.html#LN914"><span class='Ref_To_Local'>tokenuser</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN915"><span class='Ref_To_Local'>retlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>GetTokenInformation<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN913"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span>TokenUser<span class='Delimiter'>, </span><a href="pg_regress.c.html#LN914"><span class='Ref_To_Local'>tokenuser</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN915"><span class='Ref_To_Local'>retlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN915"><span class='Ref_To_Local'>retlen</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: could not get token information: error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>LookupAccountSid<span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN914"><span class='Ref_To_Local'>tokenuser</span></a><span class='Operator'>-&GT;</span>User<span class='Operator'>.</span>Sid<span class='Delimiter'>, </span><a href="pg_regress.c.html#LN911"><span class='Ref_To_Local'>accountname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN916"><span class='Ref_To_Local'>accountnamesize</span></a><span class='Delimiter'>, 
</span>                          <a href="pg_regress.c.html#LN912"><span class='Ref_To_Local'>domainname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN917"><span class='Ref_To_Local'>domainnamesize</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN918"><span class='Ref_To_Local'>accountnameuse</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, 
</span>                _<span class='Parentheses'>(</span><span class='String'>"%s: could not look up account SID: error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN914"><span class='Ref_To_Local'>tokenuser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="pg_regress.c.html#LN909"><span class='Ref_to_Parameter'>acct</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN911"><span class='Ref_To_Local'>accountname</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="pg_regress.c.html#LN909"><span class='Ref_to_Parameter'>dom</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN912"><span class='Ref_To_Local'>domainname</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end current_windows_user &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Rewrite pg_hba.conf and pg_ident.conf to use SSPI authentication.  Permit 
 * the current OS user to authenticate as the bootstrap superuser and as any 
 * user named in a --create-role option. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN965"></a><span class='Declare_Function'>config_sspi_auth</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pgdata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN967"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>accountname</span><span class='Delimiter'>, 
</span><a name="LN968"></a>               <span class='Operator'>*</span><span class='Declare_Local'>domainname</span><span class='Delimiter'>; 
</span><a name="LN969"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>username</span><span class='Delimiter'>; 
</span><a name="LN970"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>errstr</span><span class='Delimiter'>; 
</span><a name="LN971"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_ipv6</span><span class='Delimiter'>; 
</span><a name="LN972"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>fname</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN973"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN974"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>hba</span><span class='Delimiter'>, 
</span><a name="LN975"></a>               <span class='Operator'>*</span><span class='Declare_Local'>ident</span><span class='Delimiter'>; 
</span><a name="LN976"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sl</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * "username", the initdb-chosen bootstrap superuser name, may always 
     * match "accountname", the value SSPI authentication discovers.  The 
     * underlying system functions do not clearly guarantee that. 
     */ 
</span>    <a href="pg_regress.c.html#LN908"><span class='Ref_to_Func'>current_windows_user</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN967"><span class='Ref_To_Local'>accountname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN968"><span class='Ref_To_Local'>domainname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN969"><span class='Ref_To_Local'>username</span></a> <span class='Operator'>= </span><a href="../../include/common/username.h.html#LN11"><span class='Ref_to_Proto'>get_user_name</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN970"><span class='Ref_To_Local'>errstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN969"><span class='Ref_To_Local'>username</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span><span class='String'>"%s: %s\n"</span><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN970"><span class='Ref_To_Local'>errstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Like initdb.c:setup_config(), determine whether the platform recognizes 
     * ::1 (IPv6 loopback) as a numeric host address string. 
     */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN996"></a>        <span class='Control'>struct</span> <a href="../../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>gai_result</span><span class='Delimiter'>; 
</span><a name="LN997"></a>        <span class='Control'>struct</span> <a href="../../include/getaddrinfo.h.html#LN114"><span class='Ref_to_Struct'>addrinfo</span></a> <span class='Declare_Local'>hints</span><span class='Delimiter'>; 
</span><a name="LN998"></a>        WSADATA     <span class='Declare_Local'>wsaData</span><span class='Delimiter'>; 
</span> 
        <a href="pg_regress.c.html#LN997"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN99"><span class='Ref_to_Member'>ai_flags</span></a> <span class='Operator'>= </span><a href="../../include/getaddrinfo.h.html#LN70"><span class='Ref_to_Const'>AI_NUMERICHOST</span></a><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN997"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN100"><span class='Ref_to_Member'>ai_family</span></a> <span class='Operator'>= </span>AF_UNSPEC<span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN997"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN101"><span class='Ref_to_Member'>ai_socktype</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN997"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN102"><span class='Ref_to_Member'>ai_protocol</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN997"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN103"><span class='Ref_to_Member'>ai_addrlen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN997"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN105"><span class='Ref_to_Member'>ai_canonname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN997"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN104"><span class='Ref_to_Member'>ai_addr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN997"><span class='Ref_To_Local'>hints</span></a><span class='Operator'>.</span><a href="../../include/getaddrinfo.h.html#LN106"><span class='Ref_to_Member'>ai_next</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="pg_regress.c.html#LN971"><span class='Ref_To_Local'>have_ipv6</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span>WSAStartup<span class='Parentheses'>(</span>MAKEWORD<span class='Parentheses'>(</span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN998"><span class='Ref_To_Local'>wsaData</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                     <a href="../../port/getaddrinfo.c.html#LN135"><span class='Ref_to_Func'>getaddrinfo</span></a><span class='Parentheses'>(</span><span class='String'>"::1"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN997"><span class='Ref_To_Local'>hints</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN996"><span class='Ref_To_Local'>gai_result</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Check a Write outcome and report any error. */ 
</span><a name="LN1014"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CW</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>cond</span><span class='Parentheses'>)</span>    <span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span>cond<span class='Parentheses'>))</span> <span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not write to file \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                    <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN972"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
    <a href="pg_regress.c.html#LN973"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN972"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN972"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/pg_hba.conf"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN965"><span class='Ref_to_Parameter'>pgdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN973"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pg_regress.c.html#LN973"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT;= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN972"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Truncating this name is a fatal error, because we must not fail to 
         * overwrite an original trust-authentication pg_hba.conf. 
         */ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: directory name too long\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_regress.c.html#LN974"><span class='Ref_To_Local'>hba</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN972"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN974"><span class='Ref_To_Local'>hba</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for writing: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN972"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_regress.c.html#LN1014"><span class='Ref_to_Macro'>CW</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='String'>"# Configuration written by config_sspi_auth()\n"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN974"><span class='Ref_To_Local'>hba</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1014"><span class='Ref_to_Macro'>CW</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='String'>"host all all 127.0.0.1/32  sspi include_realm=1 map=regress\n"</span><span class='Delimiter'>, 
</span>             <a href="pg_regress.c.html#LN974"><span class='Ref_To_Local'>hba</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN971"><span class='Ref_To_Local'>have_ipv6</span></a><span class='Parentheses'>) 
</span>        <a href="pg_regress.c.html#LN1014"><span class='Ref_to_Macro'>CW</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='String'>"host all all ::1/128  sspi include_realm=1 map=regress\n"</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN974"><span class='Ref_To_Local'>hba</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1014"><span class='Ref_to_Macro'>CW</span></a><span class='Parentheses'>(</span>fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN974"><span class='Ref_To_Local'>hba</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN972"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN972"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/pg_ident.conf"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN965"><span class='Ref_to_Parameter'>pgdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN975"><span class='Ref_To_Local'>ident</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN972"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN975"><span class='Ref_To_Local'>ident</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for writing: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN972"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_regress.c.html#LN1014"><span class='Ref_to_Macro'>CW</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='String'>"# Configuration written by config_sspi_auth()\n"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN975"><span class='Ref_To_Local'>ident</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Double-quote for the benefit of account names containing whitespace or 
     * '#'.  Windows forbids the double-quote character itself, so don't 
     * bother escaping embedded double-quote characters. 
     */ 
</span>    <a href="pg_regress.c.html#LN1014"><span class='Ref_to_Macro'>CW</span></a><span class='Parentheses'>(</span><a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN975"><span class='Ref_To_Local'>ident</span></a><span class='Delimiter'>, </span><span class='String'>"regress  \"%s@%s\"  %s\n"</span><span class='Delimiter'>, 
</span>               <a href="pg_regress.c.html#LN967"><span class='Ref_To_Local'>accountname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN968"><span class='Ref_To_Local'>domainname</span></a><span class='Delimiter'>, </span>fmtHba<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN969"><span class='Ref_To_Local'>username</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN976"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN92"><span class='Ref_to_Global_Var'>extraroles</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN976"><span class='Ref_To_Local'>sl</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN976"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN976"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>        <a href="pg_regress.c.html#LN1014"><span class='Ref_to_Macro'>CW</span></a><span class='Parentheses'>(</span><a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN975"><span class='Ref_To_Local'>ident</span></a><span class='Delimiter'>, </span><span class='String'>"regress  \"%s@%s\"  %s\n"</span><span class='Delimiter'>, 
</span>                   <a href="pg_regress.c.html#LN967"><span class='Ref_To_Local'>accountname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN968"><span class='Ref_To_Local'>domainname</span></a><span class='Delimiter'>, </span>fmtHba<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN976"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1014"><span class='Ref_to_Macro'>CW</span></a><span class='Parentheses'>(</span>fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN975"><span class='Ref_To_Local'>ident</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end config_sspi_auth &raquo; </span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Issue a command via psql, connecting to the specified database 
 * 
 * Since we use system(), this doesn't return until the operation finishes 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1079"></a><span class='Declare_Function'>psql_command</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>database</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>,</span><span class='Operator'>...</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1081"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>query_formatted</span><span class='Delimiter'>[</span><span class='Number'>1024</span><span class='Delimiter'>]; 
</span><a name="LN1082"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>query_escaped</span><span class='Delimiter'>[</span><span class='Number'>2048</span><span class='Delimiter'>]; 
</span><a name="LN1083"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>psql_cmd</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>+ </span><span class='Number'>2048</span><span class='Delimiter'>]; 
</span><a name="LN1084"></a>    va_list     <span class='Declare_Local'>args</span><span class='Delimiter'>; 
</span><a name="LN1085"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span><a name="LN1086"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>d</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Generate the query with insertion of sprintf arguments */ 
</span>    <a href="../../pl/plperl/ppport.h.html#LN5587"><span class='Ref_to_Proto'>va_start</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1084"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1079"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/plperl.h.html#LN59"><span class='Ref_to_Macro'>vsnprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1081"><span class='Ref_To_Local'>query_formatted</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1081"><span class='Ref_To_Local'>query_formatted</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1079"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1084"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/ppport.h.html#LN5589"><span class='Ref_to_Proto'>va_end</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1084"><span class='Ref_To_Local'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now escape any shell double-quote metacharacters */ 
</span>    <a href="pg_regress.c.html#LN1086"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1082"><span class='Ref_To_Local'>query_escaped</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1085"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1081"><span class='Ref_To_Local'>query_formatted</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="pg_regress.c.html#LN1085"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1085"><span class='Ref_To_Local'>s</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><span class='String'>"\\\"$`"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="pg_regress.c.html#LN1085"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>))</span> 
            <span class='Operator'>*</span><a href="pg_regress.c.html#LN1086"><span class='Ref_To_Local'>d</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pg_regress.c.html#LN1086"><span class='Ref_To_Local'>d</span></a><span class='Operator'>++ = *</span><a href="pg_regress.c.html#LN1085"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="pg_regress.c.html#LN1086"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And now we can build and execute the shell command */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1083"><span class='Ref_To_Local'>psql_cmd</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1083"><span class='Ref_To_Local'>psql_cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='String'>"\"%s%spsql\" -X -c \"%s\" \"%s\""</span><span class='Delimiter'>, 
</span>             <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>? </span><a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>             <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>? </span><span class='String'>"/"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>             <a href="pg_regress.c.html#LN1082"><span class='Ref_To_Local'>query_escaped</span></a><span class='Delimiter'>, 
</span>             <a href="pg_regress.c.html#LN1079"><span class='Ref_to_Parameter'>database</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN312"><span class='Ref_to_Macro'>system</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1083"><span class='Ref_To_Local'>psql_cmd</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* psql probably already reported the error */ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"command failed: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1083"><span class='Ref_To_Local'>psql_cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end psql_command &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Spawn a process to execute the given shell command; don't wait for it 
 * 
 * Returns the process ID (or HANDLE) so we can wait for it later 
 */ 
</span><a href="pg_regress.h.html#LN13"><span class='Ref_to_Const'>PID_TYPE</span></a> 
<a name="LN1125"></a><span class='Declare_Function'>spawn_process</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cmdline</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN1128"></a>    <a href="../../include/port/win32.h.html#LN255"><span class='Ref_to_Typedef'>pid_t</span></a>       <span class='Declare_Local'>pid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must flush I/O buffers before fork.  Ideally we'd use fflush(NULL) here 
     * ... does anyone still care about systems where that doesn't work? 
     */ 
</span>    fflush<span class='Parentheses'>(</span>stdout<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fflush<span class='Parentheses'>(</span>stderr<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN98"><span class='Ref_to_Global_Var'>logfile</span></a><span class='Parentheses'>) 
</span>        fflush<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN98"><span class='Ref_to_Global_Var'>logfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN1128"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= </span>fork<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1128"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not fork: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1128"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * In child 
         * 
         * Instead of using system(), exec the shell directly, and tell it to 
         * "exec" the command too.  This saves two useless processes per 
         * parallel test case. 
         */ 
</span><a name="LN1155"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cmdline2</span><span class='Delimiter'>; 
</span> 
        <a href="pg_regress.c.html#LN1155"><span class='Ref_To_Local'>cmdline2</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"exec %s"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1125"><span class='Ref_to_Parameter'>cmdline</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        execl<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN54"><span class='Ref_to_Global_Var'>shellprog</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN54"><span class='Ref_to_Global_Var'>shellprog</span></a><span class='Delimiter'>, </span><span class='String'>"-c"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1155"><span class='Ref_To_Local'>cmdline2</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not exec \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN54"><span class='Ref_to_Global_Var'>shellprog</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        _exit<span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* not exit() here... */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* in parent */ 
</span>    <span class='Control'>return</span> <a href="pg_regress.c.html#LN1128"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN1166"></a>    PROCESS_INFORMATION <span class='Declare_Local'>pi</span><span class='Delimiter'>; 
</span><a name="LN1167"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cmdline2</span><span class='Delimiter'>; 
</span><a name="LN1168"></a>    HANDLE      <span class='Declare_Local'>restrictedToken</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1166"><span class='Ref_To_Local'>pi</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1166"><span class='Ref_To_Local'>pi</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1167"><span class='Ref_To_Local'>cmdline2</span></a> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"cmd /c \"%s\""</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1125"><span class='Ref_to_Parameter'>cmdline</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="pg_regress.c.html#LN1168"><span class='Ref_To_Local'>restrictedToken</span></a> <span class='Operator'>= 
</span>         <a href="../../include/common/restricted_token.h.html#LN20"><span class='Ref_to_Proto'>CreateRestrictedProcess</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1167"><span class='Ref_To_Local'>cmdline2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1166"><span class='Ref_To_Local'>pi</span></a><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    CloseHandle<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1166"><span class='Ref_To_Local'>pi</span></a><span class='Operator'>.</span>hThread<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_regress.c.html#LN1166"><span class='Ref_To_Local'>pi</span></a><span class='Operator'>.</span>hProcess<span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end spawn_process &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Count bytes in file 
 */ 
</span><span class='Keyword'>static long 
</span><a name="LN1186"></a><span class='Declare_Function'>file_size</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>file</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1188"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span><a name="LN1189"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1186"><span class='Ref_to_Parameter'>file</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN1189"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for reading: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1186"><span class='Ref_to_Parameter'>file</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    fseek<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1189"><span class='Ref_To_Local'>f</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span>SEEK_END<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1188"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span>ftell<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1189"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1189"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_regress.c.html#LN1188"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Count lines in file 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1207"></a><span class='Declare_Function'>file_line_count</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>file</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1209"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span><a name="LN1210"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>l</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1211"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1207"><span class='Ref_to_Parameter'>file</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN1211"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for reading: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1207"><span class='Ref_to_Parameter'>file</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_regress.c.html#LN1209"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span>fgetc<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1211"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span>EOF<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1209"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>            <a href="pg_regress.c.html#LN1210"><span class='Ref_To_Local'>l</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1211"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_regress.c.html#LN1210"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end file_line_count &raquo; </span> 
 
<span class='Keyword'>bool 
</span><a name="LN1229"></a><span class='Declare_Function'>file_exists</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>file</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1231"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>f</span> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1229"><span class='Ref_to_Parameter'>file</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN1231"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1231"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN1240"></a><span class='Declare_Function'>directory_exists</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dir</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1242"></a>    <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>st</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1240"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1242"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN429"><span class='Ref_to_Macro'>S_ISDIR</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1242"><span class='Ref_To_Local'>st</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Create a directory */ 
</span><span class='Keyword'>static void 
</span><a name="LN1253"></a><span class='Declare_Function'>make_directory</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dir</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN56"><span class='Ref_to_Macro'>mkdir</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1253"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN427"><span class='Ref_to_Const'>S_IRWXU</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN450"><span class='Ref_to_Const'>S_IRWXG</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN454"><span class='Ref_to_Const'>S_IRWXO</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not create directory \"%s\": %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1253"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * In: filename.ext, Return: filename_i.ext, where 0 &LT; i &LT;= 9 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN1267"></a><span class='Declare_Function'>get_alternative_expectfile</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>expectfile</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>i</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1269"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>last_dot</span><span class='Delimiter'>; 
</span><a name="LN1270"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ssize</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1267"><span class='Ref_to_Parameter'>expectfile</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN1271"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span><a name="LN1272"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1271"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1270"><span class='Ref_To_Local'>ssize</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1272"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1270"><span class='Ref_To_Local'>ssize</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1271"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1271"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1267"><span class='Ref_to_Parameter'>expectfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1269"><span class='Ref_To_Local'>last_dot</span></a> <span class='Operator'>= </span>strrchr<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1271"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='String'>'.'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN1269"><span class='Ref_To_Local'>last_dot</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1271"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1272"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="pg_regress.c.html#LN1269"><span class='Ref_To_Local'>last_dot</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1272"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1270"><span class='Ref_To_Local'>ssize</span></a><span class='Delimiter'>, </span><span class='String'>"%s_%d.%s"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1271"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1267"><span class='Ref_to_Parameter'>i</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1269"><span class='Ref_To_Local'>last_dot</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1271"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_regress.c.html#LN1272"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_alternative_expectfile &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Run a "diff" command and also check that it didn't crash 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1301"></a><span class='Declare_Function'>run_diff</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cmd</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1303"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN1303"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN312"><span class='Ref_to_Macro'>system</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1301"><span class='Ref_to_Parameter'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../timezone/private.h.html#LN41"><span class='Ref_to_Macro'>WIFEXITED</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1303"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../timezone/private.h.html#LN44"><span class='Ref_to_Macro'>WEXITSTATUS</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1303"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"diff command failed with status %d: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1303"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1301"><span class='Ref_to_Parameter'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
 
    <span class='Comment_Multi_Line'>/* 
     * On WIN32, if the 'diff' command cannot be found, system() returns 1, 
     * but produces nothing to stdout, so we check for that here. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../timezone/private.h.html#LN44"><span class='Ref_to_Macro'>WEXITSTATUS</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1303"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="pg_regress.c.html#LN1185"><span class='Ref_to_Func'>file_size</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1301"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"diff command not found: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1301"><span class='Ref_to_Parameter'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <a href="../../timezone/private.h.html#LN44"><span class='Ref_to_Macro'>WEXITSTATUS</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1303"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end run_diff &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check the actual result file for the given test against expected results 
 * 
 * Returns true if different (failure), false if correct match found. 
 * In the true case, the diff is appended to the diffs file. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1334"></a><span class='Declare_Function'>results_differ</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>testname</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>resultsfile</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>default_expectfile</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1336"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>expectfile</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN1337"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>diff</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN1338"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>cmd</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>* </span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN1339"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>best_expect_file</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN1340"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>difffile</span><span class='Delimiter'>; 
</span><a name="LN1341"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>best_line_count</span><span class='Delimiter'>; 
</span><a name="LN1342"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1343"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span><a name="LN1344"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>platform_expectfile</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can pass either the resultsfile or the expectfile, they should have 
     * the same type (filename.type) anyway. 
     */ 
</span>    <a href="pg_regress.c.html#LN1344"><span class='Ref_To_Local'>platform_expectfile</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN681"><span class='Ref_to_Func'>get_expectfile</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1334"><span class='Ref_to_Parameter'>testname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1334"><span class='Ref_to_Parameter'>resultsfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1336"><span class='Ref_To_Local'>expectfile</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1334"><span class='Ref_to_Parameter'>default_expectfile</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1336"><span class='Ref_To_Local'>expectfile</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1344"><span class='Ref_To_Local'>platform_expectfile</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Replace everything after the last slash in expectfile with what the 
         * platform_expectfile contains. 
         */ 
</span><a name="LN1359"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span>strrchr<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1336"><span class='Ref_To_Local'>expectfile</span></a><span class='Delimiter'>, </span><span class='String'>'/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1359"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>++</span><a href="pg_regress.c.html#LN1359"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1344"><span class='Ref_To_Local'>platform_expectfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Name to use for temporary diff file */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s.diff"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1334"><span class='Ref_to_Parameter'>resultsfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* OK, run the diff */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='String'>"diff %s \"%s\" \"%s\" &GT; \"%s\""</span><span class='Delimiter'>, 
</span>             <a href="pg_regress.c.html#LN63"><span class='Ref_to_Global_Var'>basic_diff_opts</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1336"><span class='Ref_To_Local'>expectfile</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1334"><span class='Ref_to_Parameter'>resultsfile</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Is the diff file empty? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1300"><span class='Ref_to_Func'>run_diff</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* There may be secondary comparison files that match better */ 
</span>    <a href="pg_regress.c.html#LN1341"><span class='Ref_To_Local'>best_line_count</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1206"><span class='Ref_to_Func'>file_line_count</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1339"><span class='Ref_To_Local'>best_expect_file</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1336"><span class='Ref_To_Local'>expectfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1342"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1342"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><span class='Number'>9</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1342"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1386"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>alt_expectfile</span><span class='Delimiter'>; 
</span> 
        <a href="pg_regress.c.html#LN1386"><span class='Ref_To_Local'>alt_expectfile</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1266"><span class='Ref_to_Func'>get_alternative_expectfile</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1336"><span class='Ref_To_Local'>expectfile</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1342"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN1386"><span class='Ref_To_Local'>alt_expectfile</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Unable to check secondary comparison files: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.h.html#LN52"><span class='Ref_to_Proto'>file_exists</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1386"><span class='Ref_To_Local'>alt_expectfile</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1386"><span class='Ref_To_Local'>alt_expectfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>"diff %s \"%s\" \"%s\" &GT; \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN63"><span class='Ref_to_Global_Var'>basic_diff_opts</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1386"><span class='Ref_To_Local'>alt_expectfile</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1334"><span class='Ref_to_Parameter'>resultsfile</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1300"><span class='Ref_to_Func'>run_diff</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1386"><span class='Ref_To_Local'>alt_expectfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_regress.c.html#LN1343"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1206"><span class='Ref_to_Func'>file_line_count</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1343"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>&LT; </span><a href="pg_regress.c.html#LN1341"><span class='Ref_To_Local'>best_line_count</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* This diff was a better match than the last one */ 
</span>            <a href="pg_regress.c.html#LN1341"><span class='Ref_To_Local'>best_line_count</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1343"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>; 
</span>            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1339"><span class='Ref_To_Local'>best_expect_file</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1386"><span class='Ref_To_Local'>alt_expectfile</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1339"><span class='Ref_To_Local'>best_expect_file</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1386"><span class='Ref_To_Local'>alt_expectfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;=9;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * fall back on the canonical results file if we haven't tried it yet and 
     * haven't found a complete match yet. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1344"><span class='Ref_To_Local'>platform_expectfile</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>"diff %s \"%s\" \"%s\" &GT; \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN63"><span class='Ref_to_Global_Var'>basic_diff_opts</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1334"><span class='Ref_to_Parameter'>default_expectfile</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1334"><span class='Ref_to_Parameter'>resultsfile</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1300"><span class='Ref_to_Func'>run_diff</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No diff = no changes = good */ 
</span>            <a href="../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_regress.c.html#LN1343"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1206"><span class='Ref_to_Func'>file_line_count</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1343"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>&LT; </span><a href="pg_regress.c.html#LN1341"><span class='Ref_To_Local'>best_line_count</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* This diff was a better match than the last one */ 
</span>            <a href="pg_regress.c.html#LN1341"><span class='Ref_To_Local'>best_line_count</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1343"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>; 
</span>            <a href="../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1339"><span class='Ref_To_Local'>best_expect_file</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1334"><span class='Ref_to_Parameter'>default_expectfile</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1339"><span class='Ref_To_Local'>best_expect_file</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if platform_expectfile &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Use the best comparison file to generate the "pretty" diff, which we 
     * append to the diffs summary file. 
     */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <span class='String'>"diff %s \"%s\" \"%s\" &GT;&GT; \"%s\""</span><span class='Delimiter'>, 
</span>             <a href="pg_regress.c.html#LN64"><span class='Ref_to_Global_Var'>pretty_diff_opts</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1339"><span class='Ref_To_Local'>best_expect_file</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1334"><span class='Ref_to_Parameter'>resultsfile</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN99"><span class='Ref_to_Global_Var'>difffilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1300"><span class='Ref_to_Func'>run_diff</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1338"><span class='Ref_To_Local'>cmd</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN99"><span class='Ref_to_Global_Var'>difffilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And append a separator */ 
</span>    <a href="pg_regress.c.html#LN1340"><span class='Ref_To_Local'>difffile</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN99"><span class='Ref_to_Global_Var'>difffilename</span></a><span class='Delimiter'>, </span><span class='String'>"a"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1340"><span class='Ref_To_Local'>difffile</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1340"><span class='Ref_To_Local'>difffile</span></a><span class='Delimiter'>, 
</span>                <span class='String'>"\n======================================================================\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1340"><span class='Ref_To_Local'>difffile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1337"><span class='Ref_To_Local'>diff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end results_differ &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Wait for specified subprocesses to finish, and return their exit 
 * statuses into statuses[] 
 * 
 * If names isn't NULL, print each subprocess's name as it finishes 
 * 
 * Note: it's OK to scribble on the pids array, but not on the names array 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1481"></a><span class='Declare_Function'>wait_for_tests</span><span class='Parentheses'>(</span><a href="pg_regress.h.html#LN13"><span class='Ref_to_Const'>PID_TYPE</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>pids</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>statuses</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>names</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>num_tests</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1483"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tests_left</span><span class='Delimiter'>; 
</span><a name="LN1484"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN1487"></a>    <a href="pg_regress.h.html#LN13"><span class='Ref_to_Const'>PID_TYPE</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>active_pids</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN25"><span class='Ref_to_Proto'>pg_malloc</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>num_tests</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.h.html#LN13"><span class='Ref_to_Const'>PID_TYPE</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1487"><span class='Ref_To_Local'>active_pids</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>pids</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>num_tests</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.h.html#LN13"><span class='Ref_to_Const'>PID_TYPE</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="pg_regress.c.html#LN1483"><span class='Ref_To_Local'>tests_left</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>num_tests</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1483"><span class='Ref_To_Local'>tests_left</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1495"></a>        <a href="pg_regress.h.html#LN13"><span class='Ref_to_Const'>PID_TYPE</span></a>    <span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
<a name="LN1498"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>exit_status</span><span class='Delimiter'>; 
</span> 
        <a href="pg_regress.c.html#LN1495"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span>wait<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1498"><span class='Ref_To_Local'>exit_status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1495"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><a href="pg_regress.h.html#LN14"><span class='Ref_to_Const'>INVALID_PID</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"failed to wait for subprocesses: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#else</span> 
<a name="LN1509"></a>        <span class='Keyword'>DWORD</span>       <span class='Declare_Local'>exit_status</span><span class='Delimiter'>; 
</span><a name="LN1510"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
        <a href="pg_regress.c.html#LN1510"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span>WaitForMultipleObjects<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1483"><span class='Ref_To_Local'>tests_left</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1487"><span class='Ref_To_Local'>active_pids</span></a><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Delimiter'>, </span>INFINITE<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1510"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span>WAIT_OBJECT_0 <span class='Operator'>|| </span><a href="pg_regress.c.html#LN1510"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&GT;= </span>WAIT_OBJECT_0 <span class='Operator'>+ </span><a href="pg_regress.c.html#LN1483"><span class='Ref_To_Local'>tests_left</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"failed to wait for subprocesses: error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_regress.c.html#LN1495"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1487"><span class='Ref_To_Local'>active_pids</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1510"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>- </span>WAIT_OBJECT_0<span class='Delimiter'>]; 
</span>        <span class='Comment_Multi_Line'>/* compact the active_pids array */ 
</span>        <a href="pg_regress.c.html#LN1487"><span class='Ref_To_Local'>active_pids</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1510"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>- </span>WAIT_OBJECT_0<span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_regress.c.html#LN1487"><span class='Ref_To_Local'>active_pids</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1483"><span class='Ref_To_Local'>tests_left</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1484"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1484"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>num_tests</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1484"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1495"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>pids</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1484"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
                GetExitCodeProcess<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>pids</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1484"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1498"><span class='Ref_To_Local'>exit_status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                CloseHandle<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>pids</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1484"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
                <a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>pids</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1484"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_regress.h.html#LN14"><span class='Ref_to_Const'>INVALID_PID</span></a><span class='Delimiter'>; 
</span>                <a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>statuses</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1484"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pg_regress.c.html#LN1498"><span class='Ref_To_Local'>exit_status</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>names</span></a><span class='Parentheses'>) 
</span>                    <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span><span class='String'>" %s"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1481"><span class='Ref_to_Parameter'>names</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1484"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_regress.c.html#LN1483"><span class='Ref_To_Local'>tests_left</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while tests_left&GT;0 &raquo; </span> 
 
<span class='Directive'>#ifdef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <a href="../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1487"><span class='Ref_To_Local'>active_pids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end wait_for_tests &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * report nonzero exit code from a test process 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1551"></a><span class='Declare_Function'>log_child_failure</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>exitstatus</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../timezone/private.h.html#LN41"><span class='Ref_to_Macro'>WIFEXITED</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1551"><span class='Ref_to_Parameter'>exitstatus</span></a><span class='Parentheses'>))</span> 
        <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" (test process exited with exit code %d)"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../../timezone/private.h.html#LN44"><span class='Ref_to_Macro'>WEXITSTATUS</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1551"><span class='Ref_to_Parameter'>exitstatus</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN172"><span class='Ref_to_Macro'>WIFSIGNALED</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1551"><span class='Ref_to_Parameter'>exitstatus</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#if</span> defined<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a><span class='Parentheses'>) 
</span>        <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" (test process was terminated by exception 0x%X)"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../../include/port/win32.h.html#LN174"><span class='Ref_to_Macro'>WTERMSIG</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1551"><span class='Ref_to_Parameter'>exitstatus</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#elif</span> defined<span class='Parentheses'>(</span>HAVE_DECL_SYS_SIGLIST<span class='Parentheses'>) </span><span class='Operator'>&& </span>HAVE_DECL_SYS_SIGLIST 
        <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" (test process was terminated by signal %d: %s)"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../../include/port/win32.h.html#LN174"><span class='Ref_to_Macro'>WTERMSIG</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1551"><span class='Ref_to_Parameter'>exitstatus</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../../include/port/win32.h.html#LN174"><span class='Ref_to_Macro'>WTERMSIG</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1551"><span class='Ref_to_Parameter'>exitstatus</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span>NSIG <span class='Operator'>? 
</span>               sys_siglist<span class='Delimiter'>[</span><a href="../../include/port/win32.h.html#LN174"><span class='Ref_to_Macro'>WTERMSIG</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1551"><span class='Ref_to_Parameter'>exitstatus</span></a><span class='Parentheses'>)</span><span class='Delimiter'>] </span><span class='Operator'>: </span><span class='String'>"(unknown))"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" (test process was terminated by signal %d)"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../../include/port/win32.h.html#LN174"><span class='Ref_to_Macro'>WTERMSIG</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1551"><span class='Ref_to_Parameter'>exitstatus</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>" (test process exited with unrecognized status %d)"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="pg_regress.c.html#LN1551"><span class='Ref_to_Parameter'>exitstatus</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end log_child_failure &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Run all the tests specified in one schedule file 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1580"></a><span class='Declare_Function'>run_schedule</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>schedule</span><span class='Delimiter'>, </span><a href="pg_regress.h.html#LN27"><span class='Ref_to_Typedef'>test_function</span></a> <span class='Declare_Parameter'>tfunc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1582"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_PARALLEL_TESTS</span> <span class='Number'>100</span> 
<a name="LN1583"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tests</span><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1582"><span class='Ref_to_Const'>MAX_PARALLEL_TESTS</span></a><span class='Delimiter'>]; 
</span><a name="LN1584"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultfiles</span><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1582"><span class='Ref_to_Const'>MAX_PARALLEL_TESTS</span></a><span class='Delimiter'>]; 
</span><a name="LN1585"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expectfiles</span><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1582"><span class='Ref_to_Const'>MAX_PARALLEL_TESTS</span></a><span class='Delimiter'>]; 
</span><a name="LN1586"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tags</span><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1582"><span class='Ref_to_Const'>MAX_PARALLEL_TESTS</span></a><span class='Delimiter'>]; 
</span><a name="LN1587"></a>    <a href="pg_regress.h.html#LN13"><span class='Ref_to_Const'>PID_TYPE</span></a>    <span class='Declare_Local'>pids</span><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1582"><span class='Ref_to_Const'>MAX_PARALLEL_TESTS</span></a><span class='Delimiter'>]; 
</span><a name="LN1588"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>statuses</span><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1582"><span class='Ref_to_Const'>MAX_PARALLEL_TESTS</span></a><span class='Delimiter'>]; 
</span><a name="LN1589"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ignorelist</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1590"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>scbuf</span><span class='Delimiter'>[</span><span class='Number'>1024</span><span class='Delimiter'>]; 
</span><a name="LN1591"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>scf</span><span class='Delimiter'>; 
</span><a name="LN1592"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>line_num</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1584"><span class='Ref_To_Local'>resultfiles</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pg_regress.c.html#LN1582"><span class='Ref_to_Const'>MAX_PARALLEL_TESTS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1585"><span class='Ref_To_Local'>expectfiles</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pg_regress.c.html#LN1582"><span class='Ref_to_Const'>MAX_PARALLEL_TESTS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1586"><span class='Ref_To_Local'>tags</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pg_regress.c.html#LN1582"><span class='Ref_to_Const'>MAX_PARALLEL_TESTS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN1591"><span class='Ref_To_Local'>scf</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1580"><span class='Ref_to_Parameter'>schedule</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN1591"><span class='Ref_To_Local'>scf</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for reading: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1580"><span class='Ref_to_Parameter'>schedule</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span>fgets<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1591"><span class='Ref_To_Local'>scf</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1608"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>test</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1609"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span><a name="LN1610"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>num_tests</span><span class='Delimiter'>; 
</span><a name="LN1611"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>inword</span><span class='Delimiter'>; 
</span><a name="LN1612"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="pg_regress.c.html#LN1592"><span class='Ref_To_Local'>line_num</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_regress.c.html#LN1582"><span class='Ref_to_Const'>MAX_PARALLEL_TESTS</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1584"><span class='Ref_To_Local'>resultfiles</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN173"><span class='Ref_to_Func'>free_stringlist</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1584"><span class='Ref_To_Local'>resultfiles</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN173"><span class='Ref_to_Func'>free_stringlist</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1585"><span class='Ref_To_Local'>expectfiles</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN173"><span class='Ref_to_Func'>free_stringlist</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1586"><span class='Ref_To_Local'>tags</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* strip trailing whitespace, especially the newline */ 
</span>        <a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| </span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'#'</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a><span class='Delimiter'>, </span><span class='String'>"test: "</span><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_regress.c.html#LN1608"><span class='Ref_To_Local'>test</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a> <span class='Operator'>+ </span><span class='Number'>6</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a><span class='Delimiter'>, </span><span class='String'>"ignore: "</span><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_regress.c.html#LN1609"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a> <span class='Operator'>+ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pg_regress.c.html#LN1609"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>&& </span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pg_regress.c.html#LN1609"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>))</span> 
                <a href="pg_regress.c.html#LN1609"><span class='Ref_To_Local'>c</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.h.html#LN49"><span class='Ref_to_Proto'>add_stringlist_item</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1589"><span class='Ref_To_Local'>ignorelist</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1609"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Note: ignore: lines do not run the test, they just say that 
             * failure of this test when run later on is to be ignored. A bit 
             * odd but that's how the shell-script version did it. 
             */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"syntax error in schedule file \"%s\" line %d: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="pg_regress.c.html#LN1580"><span class='Ref_to_Parameter'>schedule</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1592"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN1611"><span class='Ref_To_Local'>inword</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1609"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1608"><span class='Ref_To_Local'>test</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="pg_regress.c.html#LN1609"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1609"><span class='Ref_To_Local'>c</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="pg_regress.c.html#LN1609"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="pg_regress.c.html#LN1609"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <a href="pg_regress.c.html#LN1611"><span class='Ref_To_Local'>inword</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN1611"><span class='Ref_To_Local'>inword</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a> <span class='Operator'>&GT;= </span><a href="pg_regress.c.html#LN1582"><span class='Ref_to_Const'>MAX_PARALLEL_TESTS</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* can't print scbuf here, it's already been trashed */ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"too many parallel tests in schedule file \"%s\", line %d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="pg_regress.c.html#LN1580"><span class='Ref_to_Parameter'>schedule</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1592"><span class='Ref_To_Local'>line_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pg_regress.c.html#LN1583"><span class='Ref_To_Local'>tests</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_regress.c.html#LN1609"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span>                <a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="pg_regress.c.html#LN1611"><span class='Ref_To_Local'>inword</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for c=test;*c;c++ &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"syntax error in schedule file \"%s\" line %d: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="pg_regress.c.html#LN1580"><span class='Ref_to_Parameter'>schedule</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1592"><span class='Ref_To_Local'>line_num</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1590"><span class='Ref_To_Local'>scbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"test %-24s ... "</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1583"><span class='Ref_To_Local'>tests</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN1587"><span class='Ref_To_Local'>pids</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1580"><span class='Ref_to_Parameter'>tfunc</span></a><span class='Parentheses'>) (</span><a href="pg_regress.c.html#LN1583"><span class='Ref_To_Local'>tests</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1584"><span class='Ref_To_Local'>resultfiles</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1585"><span class='Ref_To_Local'>expectfiles</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1586"><span class='Ref_To_Local'>tags</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN1480"><span class='Ref_to_Func'>wait_for_tests</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1587"><span class='Ref_To_Local'>pids</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1588"><span class='Ref_To_Local'>statuses</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* status line is finished below */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN79"><span class='Ref_to_Global_Var'>max_connections</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_regress.c.html#LN79"><span class='Ref_to_Global_Var'>max_connections</span></a> <span class='Operator'>&LT; </span><a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1695"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>oldest</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"parallel group (%d tests, in groups of %d): "</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN79"><span class='Ref_to_Global_Var'>max_connections</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="pg_regress.c.html#LN1695"><span class='Ref_To_Local'>oldest</span></a> <span class='Operator'>&GT;= </span><a href="pg_regress.c.html#LN79"><span class='Ref_to_Global_Var'>max_connections</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pg_regress.c.html#LN1480"><span class='Ref_to_Func'>wait_for_tests</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1587"><span class='Ref_To_Local'>pids</span></a> <span class='Operator'>+ </span><a href="pg_regress.c.html#LN1695"><span class='Ref_To_Local'>oldest</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1588"><span class='Ref_To_Local'>statuses</span></a> <span class='Operator'>+ </span><a href="pg_regress.c.html#LN1695"><span class='Ref_To_Local'>oldest</span></a><span class='Delimiter'>, 
</span>                                   <a href="pg_regress.c.html#LN1583"><span class='Ref_To_Local'>tests</span></a> <span class='Operator'>+ </span><a href="pg_regress.c.html#LN1695"><span class='Ref_To_Local'>oldest</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="pg_regress.c.html#LN1695"><span class='Ref_To_Local'>oldest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pg_regress.c.html#LN1695"><span class='Ref_To_Local'>oldest</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pg_regress.c.html#LN1587"><span class='Ref_To_Local'>pids</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1580"><span class='Ref_to_Parameter'>tfunc</span></a><span class='Parentheses'>) (</span><a href="pg_regress.c.html#LN1583"><span class='Ref_To_Local'>tests</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1584"><span class='Ref_To_Local'>resultfiles</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1585"><span class='Ref_To_Local'>expectfiles</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1586"><span class='Ref_To_Local'>tags</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="pg_regress.c.html#LN1480"><span class='Ref_to_Func'>wait_for_tests</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1587"><span class='Ref_To_Local'>pids</span></a> <span class='Operator'>+ </span><a href="pg_regress.c.html#LN1695"><span class='Ref_To_Local'>oldest</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1588"><span class='Ref_To_Local'>statuses</span></a> <span class='Operator'>+ </span><a href="pg_regress.c.html#LN1695"><span class='Ref_To_Local'>oldest</span></a><span class='Delimiter'>, 
</span>                           <a href="pg_regress.c.html#LN1583"><span class='Ref_To_Local'>tests</span></a> <span class='Operator'>+ </span><a href="pg_regress.c.html#LN1695"><span class='Ref_To_Local'>oldest</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="pg_regress.c.html#LN1695"><span class='Ref_To_Local'>oldest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN243"><span class='Ref_to_Func'>status_end</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if max_connections&GT;0&&ma... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"parallel group (%d tests): "</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_regress.c.html#LN1587"><span class='Ref_To_Local'>pids</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1580"><span class='Ref_to_Parameter'>tfunc</span></a><span class='Parentheses'>) (</span><a href="pg_regress.c.html#LN1583"><span class='Ref_To_Local'>tests</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1584"><span class='Ref_To_Local'>resultfiles</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1585"><span class='Ref_To_Local'>expectfiles</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1586"><span class='Ref_To_Local'>tags</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="pg_regress.c.html#LN1480"><span class='Ref_to_Func'>wait_for_tests</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1587"><span class='Ref_To_Local'>pids</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1588"><span class='Ref_To_Local'>statuses</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1583"><span class='Ref_To_Local'>tests</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_regress.c.html#LN243"><span class='Ref_to_Func'>status_end</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Check results for all tests */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1727"></a>            <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rl</span><span class='Delimiter'>, 
</span><a name="LN1728"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>el</span><span class='Delimiter'>, 
</span><a name="LN1729"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>tl</span><span class='Delimiter'>; 
</span><a name="LN1730"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>differ</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1610"><span class='Ref_To_Local'>num_tests</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"     %-24s ... "</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1583"><span class='Ref_To_Local'>tests</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Advance over all three lists simultaneously. 
             * 
             * Compare resultfiles[j] with expectfiles[j] always. Tags are 
             * optional but if there are tags, the tag list has the same 
             * length as the other two lists. 
             */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1727"><span class='Ref_To_Local'>rl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1584"><span class='Ref_To_Local'>resultfiles</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="pg_regress.c.html#LN1728"><span class='Ref_To_Local'>el</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1585"><span class='Ref_To_Local'>expectfiles</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="pg_regress.c.html#LN1729"><span class='Ref_To_Local'>tl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1586"><span class='Ref_To_Local'>tags</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                 <a href="pg_regress.c.html#LN1727"><span class='Ref_To_Local'>rl</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* rl and el have the same length */ 
</span>                 <a href="pg_regress.c.html#LN1727"><span class='Ref_To_Local'>rl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1727"><span class='Ref_To_Local'>rl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1728"><span class='Ref_To_Local'>el</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1728"><span class='Ref_To_Local'>el</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1746"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>newdiff</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1729"><span class='Ref_To_Local'>tl</span></a><span class='Parentheses'>) 
</span>                    <a href="pg_regress.c.html#LN1729"><span class='Ref_To_Local'>tl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1729"><span class='Ref_To_Local'>tl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>;</span>      <span class='Comment_Multi_Line'>/* tl has the same length as rl and el 
                                         * if it exists */ 
</span> 
                <a href="pg_regress.c.html#LN1746"><span class='Ref_To_Local'>newdiff</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1333"><span class='Ref_to_Func'>results_differ</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1583"><span class='Ref_To_Local'>tests</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="pg_regress.c.html#LN1727"><span class='Ref_To_Local'>rl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1728"><span class='Ref_To_Local'>el</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1746"><span class='Ref_To_Local'>newdiff</span></a> <span class='Operator'>&& </span><a href="pg_regress.c.html#LN1729"><span class='Ref_To_Local'>tl</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%s "</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1729"><span class='Ref_To_Local'>tl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pg_regress.c.html#LN1730"><span class='Ref_To_Local'>differ</span></a> <span class='Operator'>|= </span><a href="pg_regress.c.html#LN1746"><span class='Ref_To_Local'>newdiff</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1730"><span class='Ref_To_Local'>differ</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1762"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>ignore</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1763"></a>                <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sl</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1763"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1589"><span class='Ref_To_Local'>ignorelist</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1763"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1763"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1763"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1583"><span class='Ref_To_Local'>tests</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="pg_regress.c.html#LN1763"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="pg_regress.c.html#LN1762"><span class='Ref_To_Local'>ignore</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1762"><span class='Ref_To_Local'>ignore</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"failed (ignored)"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="pg_regress.c.html#LN114"><span class='Ref_to_Global_Var'>fail_ignore_count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"FAILED"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="pg_regress.c.html#LN113"><span class='Ref_to_Global_Var'>fail_count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if differ &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"ok"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="pg_regress.c.html#LN112"><span class='Ref_to_Global_Var'>success_count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1588"><span class='Ref_To_Local'>statuses</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="pg_regress.c.html#LN1550"><span class='Ref_to_Func'>log_child_failure</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1588"><span class='Ref_To_Local'>statuses</span></a><span class='Delimiter'>[</span><a href="pg_regress.c.html#LN1612"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pg_regress.c.html#LN243"><span class='Ref_to_Func'>status_end</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;num_tests;i++ &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while fgets(scbuf,sizeof(sc... &raquo; </span> 
 
    <a href="pg_regress.c.html#LN173"><span class='Ref_to_Func'>free_stringlist</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1589"><span class='Ref_To_Local'>ignorelist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1591"><span class='Ref_To_Local'>scf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end run_schedule &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Run a single test 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1806"></a><span class='Declare_Function'>run_single_test</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>test</span><span class='Delimiter'>, </span><a href="pg_regress.h.html#LN27"><span class='Ref_to_Typedef'>test_function</span></a> <span class='Declare_Parameter'>tfunc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1808"></a>    <a href="pg_regress.h.html#LN13"><span class='Ref_to_Const'>PID_TYPE</span></a>    <span class='Declare_Local'>pid</span><span class='Delimiter'>; 
</span><a name="LN1809"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>exit_status</span><span class='Delimiter'>; 
</span><a name="LN1810"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultfiles</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1811"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expectfiles</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1812"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tags</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1813"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rl</span><span class='Delimiter'>, 
</span><a name="LN1814"></a>               <span class='Operator'>*</span><span class='Declare_Local'>el</span><span class='Delimiter'>, 
</span><a name="LN1815"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tl</span><span class='Delimiter'>; 
</span><a name="LN1816"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>differ</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"test %-24s ... "</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1806"><span class='Ref_to_Parameter'>test</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1808"><span class='Ref_To_Local'>pid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1806"><span class='Ref_to_Parameter'>tfunc</span></a><span class='Parentheses'>) (</span><a href="pg_regress.c.html#LN1806"><span class='Ref_to_Parameter'>test</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1810"><span class='Ref_To_Local'>resultfiles</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1811"><span class='Ref_To_Local'>expectfiles</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1812"><span class='Ref_To_Local'>tags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1480"><span class='Ref_to_Func'>wait_for_tests</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1808"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN1809"><span class='Ref_To_Local'>exit_status</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Advance over all three lists simultaneously. 
     * 
     * Compare resultfiles[j] with expectfiles[j] always. Tags are optional 
     * but if there are tags, the tag list has the same length as the other 
     * two lists. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1813"><span class='Ref_To_Local'>rl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1810"><span class='Ref_To_Local'>resultfiles</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1814"><span class='Ref_To_Local'>el</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1811"><span class='Ref_To_Local'>expectfiles</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1815"><span class='Ref_To_Local'>tl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1812"><span class='Ref_To_Local'>tags</span></a><span class='Delimiter'>; 
</span>         <a href="pg_regress.c.html#LN1813"><span class='Ref_To_Local'>rl</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* rl and el have the same length */ 
</span>         <a href="pg_regress.c.html#LN1813"><span class='Ref_To_Local'>rl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1813"><span class='Ref_To_Local'>rl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1814"><span class='Ref_To_Local'>el</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1814"><span class='Ref_To_Local'>el</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1833"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>newdiff</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1815"><span class='Ref_To_Local'>tl</span></a><span class='Parentheses'>) 
</span>            <a href="pg_regress.c.html#LN1815"><span class='Ref_To_Local'>tl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1815"><span class='Ref_To_Local'>tl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Delimiter'>;</span>      <span class='Comment_Multi_Line'>/* tl has the same length as rl and el if it 
                                 * exists */ 
</span> 
        <a href="pg_regress.c.html#LN1833"><span class='Ref_To_Local'>newdiff</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1333"><span class='Ref_to_Func'>results_differ</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1806"><span class='Ref_to_Parameter'>test</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1813"><span class='Ref_To_Local'>rl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1814"><span class='Ref_To_Local'>el</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1833"><span class='Ref_To_Local'>newdiff</span></a> <span class='Operator'>&& </span><a href="pg_regress.c.html#LN1815"><span class='Ref_To_Local'>tl</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%s "</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1815"><span class='Ref_To_Local'>tl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_regress.c.html#LN1816"><span class='Ref_To_Local'>differ</span></a> <span class='Operator'>|= </span><a href="pg_regress.c.html#LN1833"><span class='Ref_To_Local'>newdiff</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1816"><span class='Ref_To_Local'>differ</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"FAILED"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN113"><span class='Ref_to_Global_Var'>fail_count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.c.html#LN222"><span class='Ref_to_Func'>status</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"ok"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN112"><span class='Ref_to_Global_Var'>success_count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1809"><span class='Ref_To_Local'>exit_status</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_regress.c.html#LN1550"><span class='Ref_to_Func'>log_child_failure</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1809"><span class='Ref_To_Local'>exit_status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN243"><span class='Ref_to_Func'>status_end</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end run_single_test &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create the summary-output files (making them empty if already existing) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1868"></a><span class='Declare_Function'>open_result_files</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1870"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>file</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN1871"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>difffile</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* create outputdir directory if not present */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN116"><span class='Ref_to_Proto'>directory_exists</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>))</span> 
        <a href="pg_regress.c.html#LN117"><span class='Ref_to_Proto'>make_directory</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* create the log file (copy of running status output) */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1870"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1870"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/regression.out"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN97"><span class='Ref_to_Global_Var'>logfilename</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1870"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN98"><span class='Ref_to_Global_Var'>logfile</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN97"><span class='Ref_to_Global_Var'>logfilename</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN98"><span class='Ref_to_Global_Var'>logfile</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for writing: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN97"><span class='Ref_to_Global_Var'>logfilename</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* create the diffs file as empty */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1870"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1870"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/regression.diffs"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN99"><span class='Ref_to_Global_Var'>difffilename</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1870"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1871"><span class='Ref_To_Local'>difffile</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN99"><span class='Ref_to_Global_Var'>difffilename</span></a><span class='Delimiter'>, </span><span class='String'>"w"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN1871"><span class='Ref_To_Local'>difffile</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not open file \"%s\" for writing: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN99"><span class='Ref_to_Global_Var'>difffilename</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* we don't keep the diffs file open continuously */ 
</span>    fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1871"><span class='Ref_To_Local'>difffile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* also create the results directory if not present */ 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1870"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1870"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/results"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN116"><span class='Ref_to_Proto'>directory_exists</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1870"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>))</span> 
        <a href="pg_regress.c.html#LN117"><span class='Ref_to_Proto'>make_directory</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1870"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end open_result_files &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1908"></a><span class='Declare_Function'>drop_database_if_exists</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"dropping database \"%s\""</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1908"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1078"><span class='Ref_to_Func'>psql_command</span></a><span class='Parentheses'>(</span><span class='String'>"postgres"</span><span class='Delimiter'>, </span><span class='String'>"DROP DATABASE IF EXISTS \"%s\""</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1908"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1915"></a><span class='Declare_Function'>create_database</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dbname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1917"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sl</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We use template0 so that any installation-local cruft in template1 will 
     * not mess up the tests. 
     */ 
</span>    <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"creating database \"%s\""</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN80"><span class='Ref_to_Global_Var'>encoding</span></a><span class='Parentheses'>) 
</span>        <a href="pg_regress.c.html#LN1078"><span class='Ref_to_Func'>psql_command</span></a><span class='Parentheses'>(</span><span class='String'>"postgres"</span><span class='Delimiter'>, </span><span class='String'>"CREATE DATABASE \"%s\" TEMPLATE=template0 ENCODING='%s'%s"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN80"><span class='Ref_to_Global_Var'>encoding</span></a><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN85"><span class='Ref_to_Global_Var'>nolocale</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>" LC_COLLATE='C' LC_CTYPE='C'"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_regress.c.html#LN1078"><span class='Ref_to_Func'>psql_command</span></a><span class='Parentheses'>(</span><span class='String'>"postgres"</span><span class='Delimiter'>, </span><span class='String'>"CREATE DATABASE \"%s\" TEMPLATE=template0%s"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN85"><span class='Ref_to_Global_Var'>nolocale</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>" LC_COLLATE='C' LC_CTYPE='C'"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1078"><span class='Ref_to_Func'>psql_command</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, 
</span>                 <span class='String'>"ALTER DATABASE \"%s\" SET lc_messages TO 'C';"</span> 
                 <span class='String'>"ALTER DATABASE \"%s\" SET lc_monetary TO 'C';"</span> 
                 <span class='String'>"ALTER DATABASE \"%s\" SET lc_numeric TO 'C';"</span> 
                 <span class='String'>"ALTER DATABASE \"%s\" SET lc_time TO 'C';"</span> 
                 <span class='String'>"ALTER DATABASE \"%s\" SET bytea_output TO 'hex';"</span> 
            <span class='String'>"ALTER DATABASE \"%s\" SET timezone_abbreviations TO 'Default';"</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Install any requested procedural languages.  We use CREATE OR REPLACE 
     * so that this will work whether or not the language is preinstalled. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN77"><span class='Ref_to_Global_Var'>loadlanguage</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"installing %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN1078"><span class='Ref_to_Func'>psql_command</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE OR REPLACE LANGUAGE \"%s\""</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Install any requested extensions.  We use CREATE IF NOT EXISTS so that 
     * this will work whether or not the extension is preinstalled. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN78"><span class='Ref_to_Global_Var'>loadextension</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"installing %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN1078"><span class='Ref_to_Func'>psql_command</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1915"><span class='Ref_to_Parameter'>dbname</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE EXTENSION IF NOT EXISTS \"%s\""</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1917"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end create_database &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1961"></a><span class='Declare_Function'>drop_role_if_exists</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rolename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"dropping role \"%s\""</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1961"><span class='Ref_to_Parameter'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1078"><span class='Ref_to_Func'>psql_command</span></a><span class='Parentheses'>(</span><span class='String'>"postgres"</span><span class='Delimiter'>, </span><span class='String'>"DROP ROLE IF EXISTS \"%s\""</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1961"><span class='Ref_to_Parameter'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1968"></a><span class='Declare_Function'>create_role</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rolename</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>granted_dbs</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"creating role \"%s\""</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1968"><span class='Ref_to_Parameter'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN1078"><span class='Ref_to_Func'>psql_command</span></a><span class='Parentheses'>(</span><span class='String'>"postgres"</span><span class='Delimiter'>, </span><span class='String'>"CREATE ROLE \"%s\" WITH LOGIN"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1968"><span class='Ref_to_Parameter'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1968"><span class='Ref_to_Parameter'>granted_dbs</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN1968"><span class='Ref_to_Parameter'>granted_dbs</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN1968"><span class='Ref_to_Parameter'>granted_dbs</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.c.html#LN1078"><span class='Ref_to_Func'>psql_command</span></a><span class='Parentheses'>(</span><span class='String'>"postgres"</span><span class='Delimiter'>, </span><span class='String'>"GRANT ALL ON DATABASE \"%s\" TO \"%s\""</span><span class='Delimiter'>, 
</span>                     <a href="pg_regress.c.html#LN1968"><span class='Ref_to_Parameter'>granted_dbs</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN1968"><span class='Ref_to_Parameter'>rolename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1980"></a><span class='Declare_Function'>help</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"PostgreSQL regression test driver\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Usage:\n  %s [OPTION]... [EXTRA-TEST]...\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Options:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --config-auth=DATADIR     update authentication settings for DATADIR\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --create-role=ROLE        create the specified role before testing\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --dbname=DB               use database DB (default \"regression\")\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --debug                   turn on debug mode in programs that are run\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --dlpath=DIR              look for dynamic libraries in DIR\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --encoding=ENCODING       use ENCODING as the encoding\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --inputdir=DIR            take input files from DIR (default \".\")\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --launcher=CMD            use CMD as launcher of psql\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --load-extension=EXT      load the named extension before running the\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"                            tests; can appear multiple times\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --load-language=LANG      load the named language before running the\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"                            tests; can appear multiple times\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --max-connections=N       maximum number of concurrent connections\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"                            (default is 0, meaning unlimited)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --outputdir=DIR           place output files in DIR (default \".\")\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --schedule=FILE           use test ordering schedule from FILE\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"                            (can be used multiple times to concatenate)\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --temp-instance=DIR       create a temporary instance in DIR\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --use-existing            use an existing installation\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Options for \"temp-instance\" mode:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --no-locale               use C locale\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --port=PORT               start postmaster on PORT\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --temp-config=FILE        append contents of FILE to temporary config\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Options for using an existing installation:\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --host=HOST               use postmaster running on HOST\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --port=PORT               use postmaster running at PORT\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"  --user=USER               connect as USER\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"The exit status is 0 if all tests passed, 1 if some tests failed, and 2\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"if the tests could not be run for some reason.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"Report bugs to &LT;pgsql-bugs@postgresql.org&GT;.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end help &raquo; </span> 
 
<span class='Keyword'>int 
</span><a name="LN2024"></a><span class='Declare_Function'>regression_main</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>argc</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>argv</span><span class='Delimiter'>[], </span><a href="pg_regress.h.html#LN31"><span class='Ref_to_Typedef'>init_function</span></a> <span class='Declare_Parameter'>ifunc</span><span class='Delimiter'>, </span><a href="pg_regress.h.html#LN27"><span class='Ref_to_Typedef'>test_function</span></a> <span class='Declare_Parameter'>tfunc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2026"></a>    <span class='Keyword'>static </span><span class='Control'>struct</span> <a href="../../include/getopt_long.h.html#LN15"><span class='Ref_to_Struct'>option</span></a> <span class='Declare_Local'>long_options</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"help"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'h'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"version"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='String'>'V'</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"dbname"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"debug"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"inputdir"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"load-language"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"max-connections"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"encoding"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"outputdir"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"schedule"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"temp-instance"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>9</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"no-locale"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"host"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>13</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"port"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>14</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"user"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>15</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"bindir"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>16</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"dlpath"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>17</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"create-role"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>18</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"temp-config"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>19</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"use-existing"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN23"><span class='Ref_to_Const'>no_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"launcher"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>21</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"load-extension"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>22</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"config-auth"</span><span class='Delimiter'>, </span><a href="../../include/getopt_long.h.html#LN24"><span class='Ref_to_Const'>required_argument</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>24</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
<a name="LN2053"></a>    <a href="pg_regress.h.html#LN21"><span class='Ref_to_Struct'>_stringlist</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sl</span><span class='Delimiter'>; 
</span><a name="LN2054"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span><a name="LN2055"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2056"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>option_index</span><span class='Delimiter'>; 
</span><a name="LN2057"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>* </span><span class='Number'>4</span><span class='Delimiter'>]; 
</span><a name="LN2058"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf2</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>* </span><span class='Number'>4</span><span class='Delimiter'>]; 
</span> 
    <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN49"><span class='Ref_to_Proto'>get_progname</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2024"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN93"><span class='Ref_to_Proto'>set_pglocale_pgservice</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2024"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="../../include/c.h.html#LN1009"><span class='Ref_to_Macro'>PG_TEXTDOMAIN</span></a><span class='Parentheses'>(</span><span class='String'>"pg_regress"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    atexit<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN255"><span class='Ref_to_Func'>stop_postmaster</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifndef</span> HAVE_UNIX_SOCKETS 
    <span class='Comment_Multi_Line'>/* no unix domain sockets available, so change default */ 
</span>    <a href="pg_regress.c.html#LN87"><span class='Ref_to_Global_Var'>hostname</span></a> <span class='Operator'>= </span><span class='String'>"localhost"</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * We call the initialization function here because that way we can set 
     * default parameters and let them be overwritten by the commandline. 
     */ 
</span>    <a href="pg_regress.c.html#LN2024"><span class='Ref_to_Parameter'>ifunc</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2024"><span class='Ref_to_Parameter'>argc</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2024"><span class='Ref_to_Parameter'>argv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>getenv<span class='Parentheses'>(</span><span class='String'>"PG_REGRESS_DIFF_OPTS"</span><span class='Parentheses'>))</span> 
        <a href="pg_regress.c.html#LN64"><span class='Ref_to_Global_Var'>pretty_diff_opts</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PG_REGRESS_DIFF_OPTS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_regress.c.html#LN2054"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="../../include/getopt_long.h.html#LN30"><span class='Ref_to_Proto'>getopt_long</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2024"><span class='Ref_to_Parameter'>argc</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2024"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>, </span><span class='String'>"hV"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2026"><span class='Ref_To_Local'>long_options</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN2056"><span class='Ref_To_Local'>option_index</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2054"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'h'</span><span class='Operator'>: 
</span>                <a href="../../bin/scripts/pg_isready.c.html#LN16"><span class='Ref_to_Proto'>help</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'V'</span><span class='Operator'>: 
</span>                puts<span class='Parentheses'>(</span><span class='String'>"pg_regress (PostgreSQL) "</span> PG_VERSION<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If a default database was specified, we need to remove it 
                 * before we add the specified one. 
                 */ 
</span>                <a href="pg_regress.c.html#LN173"><span class='Ref_to_Func'>free_stringlist</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN71"><span class='Ref_to_Global_Var'>dblist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_regress.c.html#LN188"><span class='Ref_to_Func'>split_to_stringlist</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>","</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN71"><span class='Ref_to_Global_Var'>dblist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>                <a href="../../bin/pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN73"><span class='Ref_to_Global_Var'>inputdir</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>: 
</span>                <a href="pg_regress.h.html#LN49"><span class='Ref_to_Proto'>add_stringlist_item</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN77"><span class='Ref_to_Global_Var'>loadlanguage</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>5</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN79"><span class='Ref_to_Global_Var'>max_connections</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>6</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN80"><span class='Ref_to_Global_Var'>encoding</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>7</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>8</span><span class='Operator'>: 
</span>                <a href="pg_regress.h.html#LN49"><span class='Ref_to_Proto'>add_stringlist_item</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN81"><span class='Ref_to_Global_Var'>schedulelist</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>9</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN48"><span class='Ref_to_Proto'>make_absolute_path</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>10</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN85"><span class='Ref_to_Global_Var'>nolocale</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>13</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN87"><span class='Ref_to_Global_Var'>hostname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>14</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_regress.c.html#LN89"><span class='Ref_to_Global_Var'>port_specified_by_user</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>15</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN91"><span class='Ref_to_Global_Var'>user</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>16</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* "--bindir=" means to use PATH */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>))</span> 
                    <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>17</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN90"><span class='Ref_to_Global_Var'>dlpath</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>18</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN188"><span class='Ref_to_Func'>split_to_stringlist</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Delimiter'>, </span><span class='String'>","</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_regress.c.html#LN92"><span class='Ref_to_Global_Var'>extraroles</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>19</span><span class='Operator'>: 
</span>                <a href="pg_regress.h.html#LN49"><span class='Ref_to_Proto'>add_stringlist_item</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN84"><span class='Ref_to_Global_Var'>temp_configs</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>20</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN86"><span class='Ref_to_Global_Var'>use_existing</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>21</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN76"><span class='Ref_to_Global_Var'>launcher</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>22</span><span class='Operator'>: 
</span>                <a href="pg_regress.h.html#LN49"><span class='Ref_to_Proto'>add_stringlist_item</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN78"><span class='Ref_to_Global_Var'>loadextension</span></a><span class='Delimiter'>, </span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='Number'>24</span><span class='Operator'>: 
</span>                <a href="pg_regress.c.html#LN93"><span class='Ref_to_Global_Var'>config_auth_datadir</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN24"><span class='Ref_to_Proto'>pg_strdup</span></a><span class='Parentheses'>(</span><a href="../../port/getopt.c.html#LN52"><span class='Ref_to_Global_Var'>optarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* getopt_long already emitted a complaint */ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\nTry \"%s -h\" for more information.\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch c &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (c=getopt_long(argc,a... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * if we still have arguments, they are extra tests to run 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2024"><span class='Ref_to_Parameter'>argc</span></a> <span class='Operator'>- </span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.h.html#LN49"><span class='Ref_to_Proto'>add_stringlist_item</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_regress.c.html#LN82"><span class='Ref_to_Global_Var'>extra_tests</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2024"><span class='Ref_to_Parameter'>argv</span></a><span class='Delimiter'>[</span><a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../port/getopt.c.html#LN50"><span class='Ref_to_Global_Var'>optind</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN93"><span class='Ref_to_Global_Var'>config_auth_datadir</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../include/port/win32.h.html#LN30"><span class='Ref_to_Const'>ENABLE_SSPI</span></a> 
        <a href="pg_regress.c.html#LN964"><span class='Ref_to_Func'>config_sspi_auth</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN93"><span class='Ref_to_Global_Var'>config_auth_datadir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a> <span class='Operator'>&& !</span><a href="pg_regress.c.html#LN89"><span class='Ref_to_Global_Var'>port_specified_by_user</span></a><span class='Parentheses'>) 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * To reduce chances of interference with parallel installations, use 
         * a port number starting in the private range (49152-65535) 
         * calculated from the version number.  This aids !HAVE_UNIX_SOCKETS 
         * systems; elsewhere, the use of a private socket directory already 
         * prevents interference. 
         */ 
</span>        <a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a> <span class='Operator'>= </span><span class='Number'>0xC000</span> <span class='Operator'>| </span><span class='Parentheses'>(</span>PG_VERSION_NUM <span class='Operator'>& </span><span class='Number'>0x3FFF</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN73"><span class='Ref_to_Global_Var'>inputdir</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN48"><span class='Ref_to_Proto'>make_absolute_path</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN73"><span class='Ref_to_Global_Var'>inputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN48"><span class='Ref_to_Proto'>make_absolute_path</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_regress.c.html#LN90"><span class='Ref_to_Global_Var'>dlpath</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN48"><span class='Ref_to_Proto'>make_absolute_path</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN90"><span class='Ref_to_Global_Var'>dlpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialization 
     */ 
</span>    <a href="pg_regress.c.html#LN1867"><span class='Ref_to_Func'>open_result_files</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="pg_regress.c.html#LN722"><span class='Ref_to_Func'>initialize_environment</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>HAVE_GETRLIMIT<span class='Parentheses'>) </span><span class='Operator'>&& </span>defined<span class='Parentheses'>(</span>RLIMIT_CORE<span class='Parentheses'>) 
</span>    <a href="../../bin/pg_ctl/pg_ctl.c.html#LN154"><span class='Ref_to_Proto'>unlimit_core_size</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2216"></a>        FILE       <span class='Operator'>*</span><span class='Declare_Local'>pg_conf</span><span class='Delimiter'>; 
</span><a name="LN2217"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>env_wait</span><span class='Delimiter'>; 
</span><a name="LN2218"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>wait_seconds</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Prepare the temp instance 
         */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN116"><span class='Ref_to_Proto'>directory_exists</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"removing existing temp instance"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../common/rmtree.c.html#LN34"><span class='Ref_to_Func'>rmtree</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: could not remove temp instance \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"creating temporary instance"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* make the temp instance top directory */ 
</span>        <a href="pg_regress.c.html#LN117"><span class='Ref_to_Proto'>make_directory</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* and a directory for log files */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/log"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN116"><span class='Ref_to_Proto'>directory_exists</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> 
            <a href="pg_regress.c.html#LN117"><span class='Ref_to_Proto'>make_directory</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* initdb */ 
</span>        <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"initializing database system"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>"\"%s%sinitdb\" -D \"%s/data\" --no-clean --no-sync%s%s &GT; \"%s/log/initdb.log\" 2&GT;&1"</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>? </span><a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>? </span><span class='String'>"/"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Delimiter'>, 
</span>                 <a href="../../bin/pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a> <span class='Operator'>? </span><span class='String'>" --debug"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN85"><span class='Ref_to_Global_Var'>nolocale</span></a> <span class='Operator'>? </span><span class='String'>" --no-locale"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN312"><span class='Ref_to_Macro'>system</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: initdb failed\nExamine %s/log/initdb.log for the reason.\nCommand was: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Adjust the default postgresql.conf for regression testing. The user 
         * can specify a file to be appended; in any case we expand logging 
         * and set max_prepared_transactions to enable testing of prepared 
         * xacts.  (Note: to reduce the probability of unexpected shmmax 
         * failures, don't set max_prepared_transactions any higher than 
         * actually needed by the prepared_xacts regression test.) 
         */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/data/postgresql.conf"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN2216"><span class='Ref_To_Local'>pg_conf</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"a"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2216"><span class='Ref_To_Local'>pg_conf</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: could not open \"%s\" for adding extra config: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='String'>"\n# Configuration added by pg_regress\n\n"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2216"><span class='Ref_To_Local'>pg_conf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='String'>"log_autovacuum_min_duration = 0\n"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2216"><span class='Ref_To_Local'>pg_conf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='String'>"log_checkpoints = on\n"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2216"><span class='Ref_To_Local'>pg_conf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='String'>"log_line_prefix = '%m [%p] %q%a '\n"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2216"><span class='Ref_To_Local'>pg_conf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='String'>"log_lock_waits = on\n"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2216"><span class='Ref_To_Local'>pg_conf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='String'>"log_temp_files = 128kB\n"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2216"><span class='Ref_To_Local'>pg_conf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><span class='String'>"max_prepared_transactions = 2\n"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2216"><span class='Ref_To_Local'>pg_conf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN84"><span class='Ref_to_Global_Var'>temp_configs</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2286"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>temp_config</span> <span class='Operator'>= </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>; 
</span><a name="LN2287"></a>            FILE       <span class='Operator'>*</span><span class='Declare_Local'>extra_conf</span><span class='Delimiter'>; 
</span><a name="LN2288"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>line_buf</span><span class='Delimiter'>[</span><span class='Number'>1024</span><span class='Delimiter'>]; 
</span> 
            <a href="pg_regress.c.html#LN2287"><span class='Ref_To_Local'>extra_conf</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN290"><span class='Ref_to_Macro'>fopen</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2286"><span class='Ref_To_Local'>temp_config</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2287"><span class='Ref_To_Local'>extra_conf</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: could not open \"%s\" to read extra config: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2286"><span class='Ref_To_Local'>temp_config</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span>fgets<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2288"><span class='Ref_To_Local'>line_buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2288"><span class='Ref_To_Local'>line_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2287"><span class='Ref_To_Local'>extra_conf</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                <a href="../../interfaces/ecpg/preproc/pgc.l.html#LN390"><span class='Ref_to_Proto'>fputs</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2288"><span class='Ref_To_Local'>line_buf</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2216"><span class='Ref_To_Local'>pg_conf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2287"><span class='Ref_To_Local'>extra_conf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2216"><span class='Ref_To_Local'>pg_conf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/port/win32.h.html#LN30"><span class='Ref_to_Const'>ENABLE_SSPI</span></a> 
 
        <span class='Comment_Multi_Line'>/* 
         * Since we successfully used the same buffer for the much-longer 
         * "initdb" command, this can't truncate. 
         */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/data"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN964"><span class='Ref_to_Func'>config_sspi_auth</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#elif</span> <span class='Operator'>!</span>defined<span class='Parentheses'>(</span>HAVE_UNIX_SOCKETS<span class='Parentheses'>) 
</span>#error Platform has no means to secure the <a href="../../interfaces/ecpg/test/expected/preproc-autoprep.c.html#LN25"><span class='Ref_to_Func'>test</span></a> installation<span class='Operator'>. 
</span><span class='Directive'>#endif</span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Check if there is a postmaster running already. 
         */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2058"><span class='Ref_To_Local'>buf2</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2058"><span class='Ref_To_Local'>buf2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>"\"%s%spsql\" -X postgres &LT;%s 2&GT;%s"</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>? </span><a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>? </span><span class='String'>"/"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Delimiter'>, </span><a href="../../include/port.h.html#LN113"><span class='Ref_to_Const'>DEVNULL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>16</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN312"><span class='Ref_to_Macro'>system</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2058"><span class='Ref_To_Local'>buf2</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><a name="LN2328"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>s</span><span class='Delimiter'>[</span><span class='Number'>16</span><span class='Delimiter'>]; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN89"><span class='Ref_to_Global_Var'>port_specified_by_user</span></a> <span class='Operator'>|| </span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>15</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"port %d apparently in use\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN89"><span class='Ref_to_Global_Var'>port_specified_by_user</span></a><span class='Parentheses'>) 
</span>                        <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"%s: could not determine an available port\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"Specify an unused port using the --port option or shut down any conflicting PostgreSQL servers.\n"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"port %d apparently in use, trying %d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2328"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_regress.c.html#LN710"><span class='Ref_to_Func'>doputenv</span></a><span class='Parentheses'>(</span><span class='String'>"PGPORT"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2328"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;16;i++ &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Start the temp postmaster 
         */ 
</span>        <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"starting postmaster"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='String'>"\"%s%spostgres\" -D \"%s/data\" -F%s "</span> 
                 <span class='String'>"-c \"listen_addresses=%s\" -k \"%s\" "</span> 
                 <span class='String'>"&GT; \"%s/log/postmaster.log\" 2&GT;&1"</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>? </span><a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN75"><span class='Ref_to_Global_Var'>bindir</span></a> <span class='Operator'>? </span><span class='String'>"/"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Delimiter'>, </span><a href="../../bin/pg_archivecleanup/pg_archivecleanup.c.html#LN28"><span class='Ref_to_Global_Var'>debug</span></a> <span class='Operator'>? </span><span class='String'>" -d 5"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN87"><span class='Ref_to_Global_Var'>hostname</span></a> <span class='Operator'>? </span><a href="pg_regress.c.html#LN87"><span class='Ref_to_Global_Var'>hostname</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN100"><span class='Ref_to_Global_Var'>sockdir</span></a> <span class='Operator'>? </span><a href="pg_regress.c.html#LN100"><span class='Ref_to_Global_Var'>sockdir</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN109"><span class='Ref_to_Global_Var'>postmaster_pid</span></a> <span class='Operator'>= </span><a href="pg_regress.h.html#LN50"><span class='Ref_to_Proto'>spawn_process</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN109"><span class='Ref_to_Global_Var'>postmaster_pid</span></a> <span class='Operator'>== </span><a href="pg_regress.h.html#LN14"><span class='Ref_to_Const'>INVALID_PID</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: could not spawn postmaster: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Wait till postmaster is able to accept connections; normally this 
         * is only a second or so, but Cygwin is reportedly *much* slower, and 
         * test builds using Valgrind or similar tools might be too.  Hence, 
         * allow the default timeout of 60 seconds to be overridden from the 
         * PGCTLTIMEOUT environment variable. 
         */ 
</span>        <a href="pg_regress.c.html#LN2217"><span class='Ref_To_Local'>env_wait</span></a> <span class='Operator'>= </span>getenv<span class='Parentheses'>(</span><span class='String'>"PGCTLTIMEOUT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2217"><span class='Ref_To_Local'>env_wait</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_regress.c.html#LN2218"><span class='Ref_To_Local'>wait_seconds</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2217"><span class='Ref_To_Local'>env_wait</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2218"><span class='Ref_To_Local'>wait_seconds</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="pg_regress.c.html#LN2218"><span class='Ref_To_Local'>wait_seconds</span></a> <span class='Operator'>= </span><span class='Number'>60</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="pg_regress.c.html#LN2218"><span class='Ref_To_Local'>wait_seconds</span></a> <span class='Operator'>= </span><span class='Number'>60</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_regress.c.html#LN2218"><span class='Ref_To_Local'>wait_seconds</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Done if psql succeeds */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN312"><span class='Ref_to_Macro'>system</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2058"><span class='Ref_To_Local'>buf2</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Fail immediately if postmaster has exited 
             */ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN109"><span class='Ref_to_Global_Var'>postmaster_pid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<span class='Directive'>#else</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>WaitForSingleObject<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN109"><span class='Ref_to_Global_Var'>postmaster_pid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>== </span>WAIT_OBJECT_0<span class='Parentheses'>)</span> 
<span class='Directive'>#endif</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: postmaster failed\nExamine %s/log/postmaster.log for the reason\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../port/pgsleep.c.html#LN45"><span class='Ref_to_Func'>pg_usleep</span></a><span class='Parentheses'>(</span><span class='Number'>1000000L</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;wait_seconds;i+... &raquo; </span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="pg_regress.c.html#LN2218"><span class='Ref_To_Local'>wait_seconds</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: postmaster did not respond within %d seconds\nExamine %s/log/postmaster.log for the reason\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2218"><span class='Ref_To_Local'>wait_seconds</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN74"><span class='Ref_to_Global_Var'>outputdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If we get here, the postmaster is probably wedged somewhere in 
             * startup.  Try to kill it ungracefully rather than leaving a 
             * stuck postmaster that might interfere with subsequent test 
             * attempts. 
             */ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN109"><span class='Ref_to_Global_Var'>postmaster_pid</span></a><span class='Delimiter'>, </span><a href="../../include/port/win32.h.html#LN191"><span class='Ref_to_Const'>SIGKILL</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                errno <span class='Operator'>!= </span>ESRCH<span class='Parentheses'>)</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: could not kill failed postmaster: %s\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="../../port/strerror.c.html#LN17"><span class='Ref_to_Func'>strerror</span></a><span class='Parentheses'>(</span>errno<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>TerminateProcess<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN109"><span class='Ref_to_Global_Var'>postmaster_pid</span></a><span class='Delimiter'>, </span><span class='Number'>255</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: could not kill failed postmaster: error code %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span>GetLastError<span class='Parentheses'>())</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
            <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if i&GT;=wait_seconds &raquo; </span> 
 
        <a href="pg_regress.c.html#LN110"><span class='Ref_to_Global_Var'>postmaster_running</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> _WIN64 
<span class='Comment_Multi_Line'>/* need a series of two casts to convert HANDLE without compiler warning */ 
</span><a name="LN2436"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ULONGPID</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>) (</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) (</span><span class='Keyword'>unsigned long long</span><span class='Parentheses'>) (</span><a href="../../bin/psql/psqlscanslash.l.html#LN108"><span class='Ref_to_Global_Var'>x</span></a><span class='Parentheses'>) 
</span><span class='Directive'>#else</span> 
<a name="LN2438"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ULONGPID</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>) (</span><span class='Keyword'>unsigned long</span><span class='Parentheses'>) (</span><a href="../../bin/psql/psqlscanslash.l.html#LN108"><span class='Ref_to_Global_Var'>x</span></a><span class='Parentheses'>) 
</span><span class='Directive'>#endif</span> 
        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"running on port %d with PID %lu\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="pg_regress.c.html#LN88"><span class='Ref_to_Global_Var'>port</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2436"><span class='Ref_to_Macro'>ULONGPID</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN109"><span class='Ref_to_Global_Var'>postmaster_pid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if temp_instance &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Using an existing installation, so may need to get rid of 
         * pre-existing database(s) and role(s) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN86"><span class='Ref_to_Global_Var'>use_existing</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN71"><span class='Ref_to_Global_Var'>dblist</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>                <a href="pg_regress.c.html#LN1907"><span class='Ref_to_Func'>drop_database_if_exists</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN92"><span class='Ref_to_Global_Var'>extraroles</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>                <a href="pg_regress.c.html#LN1960"><span class='Ref_to_Func'>drop_role_if_exists</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the test database(s) and role(s) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_regress.c.html#LN86"><span class='Ref_to_Global_Var'>use_existing</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN71"><span class='Ref_to_Global_Var'>dblist</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>            <a href="pg_regress.c.html#LN1914"><span class='Ref_to_Func'>create_database</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN92"><span class='Ref_to_Global_Var'>extraroles</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>            <a href="pg_regress.c.html#LN1967"><span class='Ref_to_Func'>create_role</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN71"><span class='Ref_to_Global_Var'>dblist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ready to run the tests 
     */ 
</span>    <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"running regression test queries"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN81"><span class='Ref_to_Global_Var'>schedulelist</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.c.html#LN1579"><span class='Ref_to_Func'>run_schedule</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2024"><span class='Ref_to_Parameter'>tfunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN82"><span class='Ref_to_Global_Var'>extra_tests</span></a><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN24"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.c.html#LN1805"><span class='Ref_to_Func'>run_single_test</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2053"><span class='Ref_To_Local'>sl</span></a><span class='Operator'>-&GT;</span><a href="pg_regress.h.html#LN23"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2024"><span class='Ref_to_Parameter'>tfunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Shut down temp installation's postmaster 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"shutting down postmaster"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_regress.c.html#LN255"><span class='Ref_to_Func'>stop_postmaster</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there were no errors, remove the temp instance immediately to 
     * conserve disk space.  (If there were errors, we leave the instance in 
     * place for possible manual investigation.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a> <span class='Operator'>&& </span><a href="pg_regress.c.html#LN113"><span class='Ref_to_Global_Var'>fail_count</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_regress.c.html#LN114"><span class='Ref_to_Global_Var'>fail_ignore_count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_regress.c.html#LN119"><span class='Ref_to_Func'>header</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"removing temporary instance"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../common/rmtree.c.html#LN34"><span class='Ref_to_Func'>rmtree</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> 
            <a href="../../../contrib/seg/segscan.l.html#LN10"><span class='Ref_to_Macro'>fprintf</span></a><span class='Parentheses'>(</span>stderr<span class='Delimiter'>, </span>_<span class='Parentheses'>(</span><span class='String'>"\n%s: could not remove temp instance \"%s\"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../../bin/pg_test_timing/pg_test_timing.c.html#LN11"><span class='Ref_to_Global_Var'>progname</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN83"><span class='Ref_to_Global_Var'>temp_instance</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    fclose<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN98"><span class='Ref_to_Global_Var'>logfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Emit nice-looking summary message 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN113"><span class='Ref_to_Global_Var'>fail_count</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_regress.c.html#LN114"><span class='Ref_to_Global_Var'>fail_ignore_count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 _<span class='Parentheses'>(</span><span class='String'>" All %d tests passed. "</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN112"><span class='Ref_to_Global_Var'>success_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN113"><span class='Ref_to_Global_Var'>fail_count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* fail_count=0, fail_ignore_count&GT;0 */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 _<span class='Parentheses'>(</span><span class='String'>" %d of %d tests passed, %d failed test(s) ignored. "</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN112"><span class='Ref_to_Global_Var'>success_count</span></a><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN112"><span class='Ref_to_Global_Var'>success_count</span></a> <span class='Operator'>+ </span><a href="pg_regress.c.html#LN114"><span class='Ref_to_Global_Var'>fail_ignore_count</span></a><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN114"><span class='Ref_to_Global_Var'>fail_ignore_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN114"><span class='Ref_to_Global_Var'>fail_ignore_count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* fail_count&GT;0 && fail_ignore_count=0 */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 _<span class='Parentheses'>(</span><span class='String'>" %d of %d tests failed. "</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN113"><span class='Ref_to_Global_Var'>fail_count</span></a><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN112"><span class='Ref_to_Global_Var'>success_count</span></a> <span class='Operator'>+ </span><a href="pg_regress.c.html#LN113"><span class='Ref_to_Global_Var'>fail_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Comment_Multi_Line'>/* fail_count&GT;0 && fail_ignore_count&GT;0 */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 _<span class='Parentheses'>(</span><span class='String'>" %d of %d tests failed, %d of these failures ignored. "</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN113"><span class='Ref_to_Global_Var'>fail_count</span></a> <span class='Operator'>+ </span><a href="pg_regress.c.html#LN114"><span class='Ref_to_Global_Var'>fail_ignore_count</span></a><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN112"><span class='Ref_to_Global_Var'>success_count</span></a> <span class='Operator'>+ </span><a href="pg_regress.c.html#LN113"><span class='Ref_to_Global_Var'>fail_count</span></a> <span class='Operator'>+ </span><a href="pg_regress.c.html#LN114"><span class='Ref_to_Global_Var'>fail_ignore_count</span></a><span class='Delimiter'>, 
</span>                 <a href="pg_regress.c.html#LN114"><span class='Ref_to_Global_Var'>fail_ignore_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    putchar<span class='Parentheses'>(</span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>)</span> 
        putchar<span class='Parentheses'>(</span><span class='String'>'='</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"\n%s\n"</span><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_regress.c.html#LN2057"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_regress.c.html#LN2055"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>)</span> 
        putchar<span class='Parentheses'>(</span><span class='String'>'='</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    putchar<span class='Parentheses'>(</span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    putchar<span class='Parentheses'>(</span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN1185"><span class='Ref_to_Func'>file_size</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN99"><span class='Ref_to_Global_Var'>difffilename</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span>_<span class='Parentheses'>(</span><span class='String'>"The differences that caused some tests to fail can be viewed in the\n"</span> 
                 <span class='String'>"file \"%s\".  A copy of the test summary that you see\n"</span> 
                 <span class='String'>"above is saved in the file \"%s\".\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="pg_regress.c.html#LN99"><span class='Ref_to_Global_Var'>difffilename</span></a><span class='Delimiter'>, </span><a href="pg_regress.c.html#LN97"><span class='Ref_to_Global_Var'>logfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN99"><span class='Ref_to_Global_Var'>difffilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_regress.c.html#LN97"><span class='Ref_to_Global_Var'>logfilename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_regress.c.html#LN113"><span class='Ref_to_Global_Var'>fail_count</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../isolation/specscanner.l.html#LN91"><span class='Ref_to_Proto'>exit</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end regression_main &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>