<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\test\regress\regress.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\test\regress\regress.c</b></p></td>
<td align='right'>
Wed Jun 14 08:26:15 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------ 
 * 
 * regress.c 
 *   Code for various C-language functions defined as part of the 
 *   regression tests. 
 * 
 * This code is released under the terms of the PostgreSQL License. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * src/test/regress/regress.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;float.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;signal.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/tuptoaster.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/sequence.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/spi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"port/atomics.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/geo_decls.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
 
 
<a name="LN40"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>P_MAXDIG</span> <span class='Number'>12</span> 
<a name="LN41"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>LDELIM</span>          <span class='String'>'('</span> 
<a name="LN42"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>RDELIM</span>          <span class='String'>')'</span> 
<a name="LN43"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DELIM</span>           <span class='String'>','</span> 
 
<a name="LN45"></a><span class='Keyword'>extern </span><a href="../../include/utils/geo_decls.h.html#LN76"><span class='Ref_to_Typedef'>PATH</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>poly2path</span><span class='Parentheses'>(</span><a href="../../include/utils/geo_decls.h.html#LN112"><span class='Ref_to_Typedef'>POLYGON</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>poly</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN46"></a><span class='Keyword'>extern void </span><span class='Declare_Prototype'>regress_lseg_construct</span><span class='Parentheses'>(</span><a href="../../include/utils/geo_decls.h.html#LN67"><span class='Ref_to_Typedef'>LSEG</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lseg</span><span class='Delimiter'>, </span><a href="../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pt1</span><span class='Delimiter'>, </span><a href="../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pt2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../include/fmgr.h.html#LN442"><span class='Ref_to_Const'>PG_MODULE_MAGIC</span></a> 
<a href="../../include/fmgr.h.html#LN442">PG_MODULE_MAGIC</a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Distance from a point to a path 
 */ 
</span><a name="LN56"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN58"><span class='Ref_to_Func'>regress_dist_ptpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN59"></a><span class='Declare_Function'>regress_dist_ptpath</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN61"></a>    <a href="../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>pt</span> <span class='Operator'>= </span><a href="../../include/utils/geo_decls.h.html#LN138"><span class='Ref_to_Macro'>PG_GETARG_POINT_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN62"></a>    <a href="../../include/utils/geo_decls.h.html#LN76"><span class='Ref_to_Typedef'>PATH</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path</span> <span class='Operator'>= </span><a href="../../include/utils/geo_decls.h.html#LN149"><span class='Ref_to_Macro'>PG_GETARG_PATH_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN63"></a>    <a href="../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><a name="LN64"></a>    <a href="../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span><a name="LN65"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN66"></a>    <a href="../../include/utils/geo_decls.h.html#LN67"><span class='Ref_to_Typedef'>LSEG</span></a>        <span class='Declare_Local'>lseg</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN62"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN79"><span class='Ref_to_Member'>npts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>            <a href="../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <a href="regress.c.html#LN63"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/geo_decls.h.html#LN181"><span class='Ref_to_Proto'>point_dt</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN61"><span class='Ref_To_Local'>pt</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN62"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN82"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * the distance from a point to a path is the smallest distance 
             * from the point to any of its constituent segments. 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="regress.c.html#LN62"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN79"><span class='Ref_to_Member'>npts</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN65"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN65"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN62"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN79"><span class='Ref_to_Member'>npts</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="regress.c.html#LN65"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="regress.c.html#LN46"><span class='Ref_to_Proto'>regress_lseg_construct</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN66"><span class='Ref_To_Local'>lseg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN62"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN82"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN65"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="regress.c.html#LN62"><span class='Ref_To_Local'>path</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN82"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN65"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="regress.c.html#LN64"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/adt/geo_ops.c.html#LN2356"><span class='Ref_to_Func'>dist_ps</span></a><span class='Delimiter'>, 
</span>                                                         <a href="../../include/utils/geo_decls.h.html#LN137"><span class='Ref_to_Macro'>PointPGetDatum</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN61"><span class='Ref_To_Local'>pt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <a href="../../include/utils/geo_decls.h.html#LN142"><span class='Ref_to_Macro'>LsegPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN66"><span class='Ref_To_Local'>lseg</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN65"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="regress.c.html#LN64"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN63"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>                    <a href="regress.c.html#LN63"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN64"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch path-&GT;npts &raquo; </span> 
    <a href="../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN63"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end regress_dist_ptpath &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * this essentially does a cartesian product of the lsegs in the 
 * two paths, and finds the min distance between any two lsegs 
 */ 
</span><a name="LN100"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN102"><span class='Ref_to_Func'>regress_path_dist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN103"></a><span class='Declare_Function'>regress_path_dist</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN105"></a>    <a href="../../include/utils/geo_decls.h.html#LN76"><span class='Ref_to_Typedef'>PATH</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p1</span> <span class='Operator'>= </span><a href="../../include/utils/geo_decls.h.html#LN149"><span class='Ref_to_Macro'>PG_GETARG_PATH_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a>    <a href="../../include/utils/geo_decls.h.html#LN76"><span class='Ref_to_Typedef'>PATH</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p2</span> <span class='Operator'>= </span><a href="../../include/utils/geo_decls.h.html#LN149"><span class='Ref_to_Macro'>PG_GETARG_PATH_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_min</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN108"></a>    <a href="../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>min</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* initialize to keep compiler quiet */ 
</span><a name="LN109"></a>    <a href="../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span><a name="LN110"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN111"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN112"></a>    <a href="../../include/utils/geo_decls.h.html#LN67"><span class='Ref_to_Typedef'>LSEG</span></a>        <span class='Declare_Local'>seg1</span><span class='Delimiter'>, 
</span><a name="LN113"></a>                <span class='Declare_Local'>seg2</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN110"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN110"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN105"><span class='Ref_To_Local'>p1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN79"><span class='Ref_to_Member'>npts</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="regress.c.html#LN110"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN111"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN111"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN106"><span class='Ref_To_Local'>p2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN79"><span class='Ref_to_Member'>npts</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="regress.c.html#LN111"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="regress.c.html#LN46"><span class='Ref_to_Proto'>regress_lseg_construct</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN112"><span class='Ref_To_Local'>seg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN105"><span class='Ref_To_Local'>p1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN82"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN110"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="regress.c.html#LN105"><span class='Ref_To_Local'>p1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN82"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN110"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="regress.c.html#LN46"><span class='Ref_to_Proto'>regress_lseg_construct</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN113"><span class='Ref_To_Local'>seg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN106"><span class='Ref_To_Local'>p2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN82"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN111"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="regress.c.html#LN106"><span class='Ref_To_Local'>p2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN82"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN111"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="regress.c.html#LN109"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/adt/geo_ops.c.html#LN2207"><span class='Ref_to_Func'>lseg_distance</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../include/utils/geo_decls.h.html#LN142"><span class='Ref_to_Macro'>LsegPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN112"><span class='Ref_To_Local'>seg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                     <a href="../../include/utils/geo_decls.h.html#LN142"><span class='Ref_to_Macro'>LsegPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN113"><span class='Ref_To_Local'>seg2</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="regress.c.html#LN107"><span class='Ref_To_Local'>have_min</span></a> <span class='Operator'>|| </span><a href="regress.c.html#LN109"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN108"><span class='Ref_To_Local'>min</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="regress.c.html#LN108"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN109"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>; 
</span>                <a href="regress.c.html#LN107"><span class='Ref_To_Local'>have_min</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="regress.c.html#LN107"><span class='Ref_To_Local'>have_min</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN108"><span class='Ref_To_Local'>min</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end regress_path_dist &raquo; </span> 
 
<a href="../../include/utils/geo_decls.h.html#LN76"><span class='Ref_to_Typedef'>PATH</span></a> <span class='Operator'>* 
</span><a name="LN140"></a><span class='Declare_Function'>poly2path</span><span class='Parentheses'>(</span><a href="../../include/utils/geo_decls.h.html#LN112"><span class='Ref_to_Typedef'>POLYGON</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>poly</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN142"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN143"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>output</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>2</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="regress.c.html#LN40"><span class='Ref_to_Const'>P_MAXDIG</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="regress.c.html#LN140"><span class='Ref_to_Parameter'>poly</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN115"><span class='Ref_to_Member'>npts</span></a> <span class='Operator'>+ </span><span class='Number'>64</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN144"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>2</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="regress.c.html#LN40"><span class='Ref_to_Const'>P_MAXDIG</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>20</span><span class='Delimiter'>]; 
</span> 
    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN143"><span class='Ref_To_Local'>output</span></a><span class='Delimiter'>, </span><span class='String'>"(1, %*d"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN40"><span class='Ref_to_Const'>P_MAXDIG</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN140"><span class='Ref_to_Parameter'>poly</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN115"><span class='Ref_to_Member'>npts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN142"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN142"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN140"><span class='Ref_to_Parameter'>poly</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN115"><span class='Ref_to_Member'>npts</span></a><span class='Delimiter'>; </span><a href="regress.c.html#LN142"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN144"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="regress.c.html#LN144"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>",%*g,%*g"</span><span class='Delimiter'>, 
</span>                 <a href="regress.c.html#LN40"><span class='Ref_to_Const'>P_MAXDIG</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN140"><span class='Ref_to_Parameter'>poly</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN117"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN142"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN40"><span class='Ref_to_Const'>P_MAXDIG</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN140"><span class='Ref_to_Parameter'>poly</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN117"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN142"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        strcat<span class='Parentheses'>(</span><a href="regress.c.html#LN143"><span class='Ref_To_Local'>output</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN144"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN144"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="regress.c.html#LN144"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%c"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN42"><span class='Ref_to_Const'>RDELIM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    strcat<span class='Parentheses'>(</span><a href="regress.c.html#LN143"><span class='Ref_To_Local'>output</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN144"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../include/utils/geo_decls.h.html#LN146"><span class='Ref_to_Macro'>DatumGetPathP</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/adt/geo_ops.c.html#LN1305"><span class='Ref_to_Func'>path_in</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN143"><span class='Ref_To_Local'>output</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end poly2path &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* return the point where two paths intersect, or NULL if no intersection. */ 
</span><a name="LN162"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN164"><span class='Ref_to_Func'>interpt_pp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN165"></a><span class='Declare_Function'>interpt_pp</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN167"></a>    <a href="../../include/utils/geo_decls.h.html#LN76"><span class='Ref_to_Typedef'>PATH</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p1</span> <span class='Operator'>= </span><a href="../../include/utils/geo_decls.h.html#LN149"><span class='Ref_to_Macro'>PG_GETARG_PATH_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN168"></a>    <a href="../../include/utils/geo_decls.h.html#LN76"><span class='Ref_to_Typedef'>PATH</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p2</span> <span class='Operator'>= </span><a href="../../include/utils/geo_decls.h.html#LN149"><span class='Ref_to_Macro'>PG_GETARG_PATH_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN169"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN170"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN171"></a>    <a href="../../include/utils/geo_decls.h.html#LN67"><span class='Ref_to_Typedef'>LSEG</span></a>        <span class='Declare_Local'>seg1</span><span class='Delimiter'>, 
</span><a name="LN172"></a>                <span class='Declare_Local'>seg2</span><span class='Delimiter'>; 
</span><a name="LN173"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* We've found the intersection */ 
</span> 
    <a href="regress.c.html#LN173"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* Haven't found it yet */ 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN169"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN169"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN167"><span class='Ref_To_Local'>p1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN79"><span class='Ref_to_Member'>npts</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>&& !</span><a href="regress.c.html#LN173"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>; </span><a href="regress.c.html#LN169"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regress.c.html#LN46"><span class='Ref_to_Proto'>regress_lseg_construct</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN171"><span class='Ref_To_Local'>seg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN167"><span class='Ref_To_Local'>p1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN82"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN169"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="regress.c.html#LN167"><span class='Ref_To_Local'>p1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN82"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN169"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN170"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN170"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN168"><span class='Ref_To_Local'>p2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN79"><span class='Ref_to_Member'>npts</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>&& !</span><a href="regress.c.html#LN173"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>; </span><a href="regress.c.html#LN170"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="regress.c.html#LN46"><span class='Ref_to_Proto'>regress_lseg_construct</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN172"><span class='Ref_To_Local'>seg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN168"><span class='Ref_To_Local'>p2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN82"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN170"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="regress.c.html#LN168"><span class='Ref_To_Local'>p2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN82"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN170"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/adt/geo_ops.c.html#LN2049"><span class='Ref_to_Func'>lseg_intersect</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../include/utils/geo_decls.h.html#LN142"><span class='Ref_to_Macro'>LsegPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN171"><span class='Ref_To_Local'>seg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../include/utils/geo_decls.h.html#LN142"><span class='Ref_to_Macro'>LsegPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN172"><span class='Ref_To_Local'>seg2</span></a><span class='Parentheses'>))))</span> 
                <a href="regress.c.html#LN173"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="regress.c.html#LN173"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: DirectFunctionCall2 will kick out an error if lseg_interpt() 
     * returns NULL, but that should be impossible since we know the two 
     * segments intersect. 
     */ 
</span>    <a href="../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/adt/geo_ops.c.html#LN2308"><span class='Ref_to_Func'>lseg_interpt</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/geo_decls.h.html#LN142"><span class='Ref_to_Macro'>LsegPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN171"><span class='Ref_To_Local'>seg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/geo_decls.h.html#LN142"><span class='Ref_to_Macro'>LsegPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN172"><span class='Ref_To_Local'>seg2</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interpt_pp &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* like lseg_construct, but assume space already allocated */ 
</span><span class='Keyword'>void 
</span><a name="LN206"></a><span class='Declare_Function'>regress_lseg_construct</span><span class='Parentheses'>(</span><a href="../../include/utils/geo_decls.h.html#LN67"><span class='Ref_to_Typedef'>LSEG</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lseg</span><span class='Delimiter'>, </span><a href="../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pt1</span><span class='Delimiter'>, </span><a href="../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pt2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="regress.c.html#LN206"><span class='Ref_to_Parameter'>lseg</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN69"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN206"><span class='Ref_to_Parameter'>pt1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN206"><span class='Ref_to_Parameter'>lseg</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN69"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN206"><span class='Ref_to_Parameter'>pt1</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN206"><span class='Ref_to_Parameter'>lseg</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN69"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN206"><span class='Ref_to_Parameter'>pt2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN206"><span class='Ref_to_Parameter'>lseg</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN69"><span class='Ref_to_Member'>p</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN206"><span class='Ref_to_Parameter'>pt2</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
} 
</span> 
<a name="LN214"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN216"><span class='Ref_to_Func'>overpaid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN217"></a><span class='Declare_Function'>overpaid</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN219"></a>    <a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN275"><span class='Ref_to_Macro'>PG_GETARG_HEAPTUPLEHEADER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN220"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN221"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>salary</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN221"><span class='Ref_To_Local'>salary</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN496"><span class='Ref_to_Proto'>GetAttributeByName</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN219"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><span class='String'>"salary"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN220"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN220"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN221"><span class='Ref_To_Local'>salary</span></a> <span class='Operator'>&GT; </span><span class='Number'>699</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* New type "widget" 
 * This used to be "circle", but I added circle to builtins, 
 *  so needed to make sure the names do not collide. - tgl 97/04/21 
 */ 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN236"></a>    <a href="../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a>       <span class='Declare_Member'>center</span><span class='Delimiter'>; 
</span><a name="LN237"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>radius</span><span class='Delimiter'>; 
</span><a name="LN238"></a>} <span class='Declare_Typedef'>WIDGET</span><span class='Delimiter'>; 
</span> 
<a name="LN240"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN245"><span class='Ref_to_Func'>widget_in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN241"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN274"><span class='Ref_to_Func'>widget_out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN243"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NARGS</span>   <span class='Number'>3</span> 
 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN246"></a><span class='Declare_Function'>widget_in</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN248"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN249"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>, 
</span><a name="LN250"></a>               <span class='Operator'>*</span><span class='Declare_Local'>coord</span><span class='Delimiter'>[</span><a href="regress.c.html#LN243"><span class='Ref_to_Const'>NARGS</span></a><span class='Delimiter'>]; 
</span><a name="LN251"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN252"></a>    <a href="regress.c.html#LN234"><span class='Ref_to_Typedef'>WIDGET</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN251"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="regress.c.html#LN249"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN248"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="regress.c.html#LN249"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&& </span><a href="regress.c.html#LN251"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN243"><span class='Ref_to_Const'>NARGS</span></a> <span class='Operator'>&& *</span><a href="regress.c.html#LN249"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><a href="regress.c.html#LN42"><span class='Ref_to_Const'>RDELIM</span></a><span class='Delimiter'>; </span><a href="regress.c.html#LN249"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regress.c.html#LN249"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><a href="regress.c.html#LN43"><span class='Ref_to_Const'>DELIM</span></a> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regress.c.html#LN249"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><a href="regress.c.html#LN41"><span class='Ref_to_Const'>LDELIM</span></a> <span class='Operator'>&& </span><a href="regress.c.html#LN251"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <a href="regress.c.html#LN250"><span class='Ref_To_Local'>coord</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN251"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regress.c.html#LN249"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN251"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN243"><span class='Ref_to_Const'>NARGS</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type widget: \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="regress.c.html#LN248"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN252"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="regress.c.html#LN234"><span class='Ref_to_Typedef'>WIDGET</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="regress.c.html#LN234"><span class='Ref_to_Typedef'>WIDGET</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN252"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="regress.c.html#LN236"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span>atof<span class='Parentheses'>(</span><a href="regress.c.html#LN250"><span class='Ref_To_Local'>coord</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN252"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="regress.c.html#LN236"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span>atof<span class='Parentheses'>(</span><a href="regress.c.html#LN250"><span class='Ref_To_Local'>coord</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN252"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="regress.c.html#LN237"><span class='Ref_to_Member'>radius</span></a> <span class='Operator'>= </span>atof<span class='Parentheses'>(</span><a href="regress.c.html#LN250"><span class='Ref_To_Local'>coord</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN252"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end widget_in &raquo; </span> 
 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN275"></a><span class='Declare_Function'>widget_out</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN277"></a>    <a href="regress.c.html#LN234"><span class='Ref_to_Typedef'>WIDGET</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>widget</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="regress.c.html#LN234"><span class='Ref_to_Typedef'>WIDGET</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN278"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"(%g,%g,%g)"</span><span class='Delimiter'>, 
</span>                         <a href="regress.c.html#LN277"><span class='Ref_To_Local'>widget</span></a><span class='Operator'>-&GT;</span><a href="regress.c.html#LN236"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN277"><span class='Ref_To_Local'>widget</span></a><span class='Operator'>-&GT;</span><a href="regress.c.html#LN236"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN277"><span class='Ref_To_Local'>widget</span></a><span class='Operator'>-&GT;</span><a href="regress.c.html#LN237"><span class='Ref_to_Member'>radius</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN278"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN284"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN286"><span class='Ref_to_Func'>pt_in_widget</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN287"></a><span class='Declare_Function'>pt_in_widget</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN289"></a>    <a href="../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>point</span> <span class='Operator'>= </span><a href="../../include/utils/geo_decls.h.html#LN138"><span class='Ref_to_Macro'>PG_GETARG_POINT_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN290"></a>    <a href="regress.c.html#LN234"><span class='Ref_to_Typedef'>WIDGET</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>widget</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="regress.c.html#LN234"><span class='Ref_to_Typedef'>WIDGET</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../include/utils/geo_decls.h.html#LN181"><span class='Ref_to_Proto'>point_dt</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN289"><span class='Ref_To_Local'>point</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN290"><span class='Ref_To_Local'>widget</span></a><span class='Operator'>-&GT;</span><a href="regress.c.html#LN236"><span class='Ref_to_Member'>center</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="regress.c.html#LN290"><span class='Ref_To_Local'>widget</span></a><span class='Operator'>-&GT;</span><a href="regress.c.html#LN237"><span class='Ref_to_Member'>radius</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN295"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN297"><span class='Ref_to_Func'>boxarea</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN298"></a><span class='Declare_Function'>boxarea</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN300"></a>    <a href="../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>box</span> <span class='Operator'>= </span><a href="../../include/utils/geo_decls.h.html#LN160"><span class='Ref_to_Macro'>PG_GETARG_BOX_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN301"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>width</span><span class='Delimiter'>, 
</span><a name="LN302"></a>                <span class='Declare_Local'>height</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN301"><span class='Ref_To_Local'>width</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN300"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>- </span><a href="regress.c.html#LN300"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN302"><span class='Ref_To_Local'>height</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN300"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>- </span><a href="regress.c.html#LN300"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN301"><span class='Ref_To_Local'>width</span></a> <span class='Operator'>* </span><a href="regress.c.html#LN302"><span class='Ref_To_Local'>height</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN309"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN311"><span class='Ref_to_Func'>reverse_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN312"></a><span class='Declare_Function'>reverse_name</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN314"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>string</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN315"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN316"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN317"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>new_string</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN317"><span class='Ref_To_Local'>new_string</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a> <span class='Operator'>&& </span><a href="regress.c.html#LN314"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; </span><span class='Operator'>++</span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a> <span class='Operator'>|| !</span><a href="regress.c.html#LN314"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Operator'>--</span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN316"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><span class='Operator'>--</span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>        <a href="regress.c.html#LN317"><span class='Ref_To_Local'>new_string</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN316"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regress.c.html#LN314"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN315"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>    <a href="../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN317"><span class='Ref_To_Local'>new_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a name="LN331"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Var'>fd17b_xid</span> <span class='Operator'>= </span><a href="../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Delimiter'>; 
</span><a name="LN332"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Declare_Var'>fd17a_xid</span> <span class='Operator'>= </span><a href="../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Delimiter'>; 
</span><a name="LN333"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>fd17b_level</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN334"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>fd17a_level</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN335"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>fd17b_recursion</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN336"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>fd17a_recursion</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<a name="LN338"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN340"><span class='Ref_to_Func'>funny_dup17</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN341"></a><span class='Declare_Function'>funny_dup17</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN343"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>context<span class='Delimiter'>; 
</span><a name="LN344"></a>    <a href="../../include/c.h.html#LN396"><span class='Ref_to_Typedef'>TransactionId</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xid</span><span class='Delimiter'>; 
</span><a name="LN345"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>level</span><span class='Delimiter'>; 
</span><a name="LN346"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>recursion</span><span class='Delimiter'>; 
</span><a name="LN347"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN348"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN349"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN350"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>, 
</span><a name="LN351"></a>               <span class='Operator'>*</span><span class='Declare_Local'>fieldval</span><span class='Delimiter'>, 
</span><a name="LN352"></a>               <span class='Operator'>*</span><span class='Declare_Local'>fieldtype</span><span class='Delimiter'>; 
</span><a name="LN353"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>when</span><span class='Delimiter'>; 
</span><a name="LN354"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>inserted</span><span class='Delimiter'>; 
</span><a name="LN355"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>selected</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN356"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/trigger.h.html#LN24"><span class='Ref_to_Macro'>CALLED_AS_TRIGGER</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"funny_dup17: not fired by trigger manager"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN349"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN343"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN347"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN343"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN348"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN347"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN87"><span class='Ref_to_Macro'>TRIGGER_FIRED_BEFORE</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN343"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="regress.c.html#LN344"><span class='Ref_To_Local'>xid</span></a> <span class='Operator'>= &</span><a href="regress.c.html#LN331"><span class='Ref_to_Global_Var'>fd17b_xid</span></a><span class='Delimiter'>; 
</span>        <a href="regress.c.html#LN345"><span class='Ref_To_Local'>level</span></a> <span class='Operator'>= &</span><a href="regress.c.html#LN333"><span class='Ref_to_Global_Var'>fd17b_level</span></a><span class='Delimiter'>; 
</span>        <a href="regress.c.html#LN346"><span class='Ref_To_Local'>recursion</span></a> <span class='Operator'>= &</span><a href="regress.c.html#LN335"><span class='Ref_to_Global_Var'>fd17b_recursion</span></a><span class='Delimiter'>; 
</span>        <a href="regress.c.html#LN353"><span class='Ref_To_Local'>when</span></a> <span class='Operator'>= </span><span class='String'>"BEFORE"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="regress.c.html#LN344"><span class='Ref_To_Local'>xid</span></a> <span class='Operator'>= &</span><a href="regress.c.html#LN332"><span class='Ref_to_Global_Var'>fd17a_xid</span></a><span class='Delimiter'>; 
</span>        <a href="regress.c.html#LN345"><span class='Ref_To_Local'>level</span></a> <span class='Operator'>= &</span><a href="regress.c.html#LN334"><span class='Ref_to_Global_Var'>fd17a_level</span></a><span class='Delimiter'>; 
</span>        <a href="regress.c.html#LN346"><span class='Ref_To_Local'>recursion</span></a> <span class='Operator'>= &</span><a href="regress.c.html#LN336"><span class='Ref_to_Global_Var'>fd17a_recursion</span></a><span class='Delimiter'>; 
</span>        <a href="regress.c.html#LN353"><span class='Ref_To_Local'>when</span></a> <span class='Operator'>= </span><span class='String'>"AFTER "</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xact.h.html#LN345"><span class='Ref_to_Proto'>TransactionIdIsCurrentTransactionId</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regress.c.html#LN344"><span class='Ref_To_Local'>xid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="regress.c.html#LN344"><span class='Ref_To_Local'>xid</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN333"><span class='Ref_to_Proto'>GetCurrentTransactionId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="regress.c.html#LN345"><span class='Ref_To_Local'>level</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="regress.c.html#LN346"><span class='Ref_To_Local'>recursion</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regress.c.html#LN345"><span class='Ref_To_Local'>level</span></a> <span class='Operator'>== </span><span class='Number'>17</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="regress.c.html#LN346"><span class='Ref_To_Local'>recursion</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN349"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regress.c.html#LN346"><span class='Ref_To_Local'>recursion</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN349"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regress.c.html#LN345"><span class='Ref_To_Local'>level</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN351"><span class='Ref_To_Local'>fieldval</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN125"><span class='Ref_to_Proto'>SPI_getvalue</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN349"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN348"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN352"><span class='Ref_To_Local'>fieldtype</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN127"><span class='Ref_to_Proto'>SPI_gettype</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN348"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN350"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>100</span> <span class='Operator'>+ </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a> <span class='Operator'>* </span><span class='Number'>3</span> <span class='Operator'>+ 
</span>                            strlen<span class='Parentheses'>(</span><a href="regress.c.html#LN351"><span class='Ref_To_Local'>fieldval</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="regress.c.html#LN352"><span class='Ref_To_Local'>fieldtype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN350"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"insert into %s select * from %s where %s = '%s'::%s"</span><span class='Delimiter'>, 
</span>            <a href="../../include/executor/spi.h.html#LN129"><span class='Ref_to_Proto'>SPI_getrelname</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN347"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/executor/spi.h.html#LN129"><span class='Ref_to_Proto'>SPI_getrelname</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN347"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../../include/executor/spi.h.html#LN124"><span class='Ref_to_Proto'>SPI_fname</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN348"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="regress.c.html#LN351"><span class='Ref_To_Local'>fieldval</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN352"><span class='Ref_To_Local'>fieldtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="regress.c.html#LN356"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN87"><span class='Ref_to_Proto'>SPI_exec</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN350"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"funny_dup17 (fired %s) on level %3d: SPI_exec (insert ...) returned %d"</span><span class='Delimiter'>, 
</span>             <a href="regress.c.html#LN353"><span class='Ref_To_Local'>when</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="regress.c.html#LN345"><span class='Ref_To_Local'>level</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN356"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN354"><span class='Ref_To_Local'>inserted</span></a> <span class='Operator'>= </span><a href="../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN350"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"select count (*) from %s where %s = '%s'::%s"</span><span class='Delimiter'>, 
</span>            <a href="../../include/executor/spi.h.html#LN129"><span class='Ref_to_Proto'>SPI_getrelname</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN347"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../../include/executor/spi.h.html#LN124"><span class='Ref_to_Proto'>SPI_fname</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN348"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="regress.c.html#LN351"><span class='Ref_To_Local'>fieldval</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN352"><span class='Ref_To_Local'>fieldtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="regress.c.html#LN356"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN87"><span class='Ref_to_Proto'>SPI_exec</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN350"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"funny_dup17 (fired %s) on level %3d: SPI_exec (select ...) returned %d"</span><span class='Delimiter'>, 
</span>             <a href="regress.c.html#LN353"><span class='Ref_To_Local'>when</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="regress.c.html#LN345"><span class='Ref_To_Local'>level</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN356"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../backend/executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regress.c.html#LN355"><span class='Ref_To_Local'>selected</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/adt/int.c.html#LN264"><span class='Ref_to_Func'>int4in</span></a><span class='Delimiter'>, 
</span>                                                <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN125"><span class='Ref_to_Proto'>SPI_getvalue</span></a><span class='Parentheses'>( 
</span>                                                       <a href="../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                                       <a href="../../backend/executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                                                             <span class='Number'>1</span> 
                                                                        <span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN21"><span class='Ref_to_Const'>DEBUG4</span></a><span class='Delimiter'>, </span><span class='String'>"funny_dup17 (fired %s) on level %3d: "</span> <a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a> <span class='String'>"/%d tuples inserted/selected"</span><span class='Delimiter'>, 
</span>         <a href="regress.c.html#LN353"><span class='Ref_To_Local'>when</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="regress.c.html#LN345"><span class='Ref_To_Local'>level</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN354"><span class='Ref_To_Local'>inserted</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN355"><span class='Ref_To_Local'>selected</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regress.c.html#LN345"><span class='Ref_To_Local'>level</span></a><span class='Parentheses'>)</span><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regress.c.html#LN345"><span class='Ref_To_Local'>level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="regress.c.html#LN344"><span class='Ref_To_Local'>xid</span></a> <span class='Operator'>= </span><a href="../../include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN349"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end funny_dup17 &raquo; </span> 
 
<a name="LN448"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TTDUMMY_INFINITY</span>    <span class='Number'>999999</span> 
 
<a name="LN450"></a><span class='Keyword'>static </span><a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a> <span class='Declare_Var'>splan</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN451"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>ttoff</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN453"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN455"><span class='Ref_to_Func'>ttdummy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN456"></a><span class='Declare_Function'>ttdummy</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN458"></a>    <a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>context<span class='Delimiter'>; 
</span><a name="LN459"></a>    <a href="../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* to get trigger name */ 
</span><a name="LN460"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>args</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* arguments */ 
</span><a name="LN461"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>];</span>      <span class='Comment_Single_Line'>/* fnumbers of start/stop columns */ 
</span><a name="LN462"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>oldon</span><span class='Delimiter'>, 
</span><a name="LN463"></a>                <span class='Declare_Local'>oldoff</span><span class='Delimiter'>; 
</span><a name="LN464"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>newon</span><span class='Delimiter'>, 
</span><a name="LN465"></a>                <span class='Declare_Local'>newoff</span><span class='Delimiter'>; 
</span><a name="LN466"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>cvals</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* column values */ 
</span><a name="LN467"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cnulls</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* column nulls */ 
</span><a name="LN468"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>relname</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* triggered relation name */ 
</span><a name="LN469"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* triggered relation */ 
</span><a name="LN470"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>trigtuple</span><span class='Delimiter'>; 
</span><a name="LN471"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN472"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>rettuple</span><span class='Delimiter'>; 
</span><a name="LN473"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* tuple description */ 
</span><a name="LN474"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* # of attributes */ 
</span><a name="LN475"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* to know is some column NULL or not */ 
</span><a name="LN476"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span><a name="LN477"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/trigger.h.html#LN24"><span class='Ref_to_Macro'>CALLED_AS_TRIGGER</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy: not fired by trigger manager"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/trigger.h.html#LN81"><span class='Ref_to_Macro'>TRIGGER_FIRED_FOR_ROW</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN458"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy: must be fired for row"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/trigger.h.html#LN87"><span class='Ref_to_Macro'>TRIGGER_FIRED_BEFORE</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN458"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy: must be fired before event"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN69"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_INSERT</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN458"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy: cannot process INSERT event"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN75"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_UPDATE</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN458"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="regress.c.html#LN471"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN458"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN470"><span class='Ref_To_Local'>trigtuple</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN458"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN469"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN458"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN129"><span class='Ref_to_Proto'>SPI_getrelname</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN469"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check if TT is OFF for this relation */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN451"><span class='Ref_to_Global_Var'>ttoff</span></a><span class='Parentheses'>)</span>                  <span class='Comment_Single_Line'>/* OFF - nothing to do */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>((</span><a href="regress.c.html#LN471"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="regress.c.html#LN471"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>: </span><a href="regress.c.html#LN470"><span class='Ref_To_Local'>trigtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="regress.c.html#LN459"><span class='Ref_To_Local'>trigger</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN458"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN459"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a> <span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy (%s): invalid (!= 2) number of arguments %d"</span><span class='Delimiter'>, 
</span>             <a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN459"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN460"><span class='Ref_To_Local'>args</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN459"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN473"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN469"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN474"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN473"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>2</span><span class='Delimiter'>; </span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN123"><span class='Ref_to_Proto'>SPI_fnumber</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN473"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN460"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy (%s): there is no attribute %s"</span><span class='Delimiter'>, 
</span>                 <a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN460"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN473"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Parentheses'>)</span> 
            <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy (%s): attribute %s must be of integer type"</span><span class='Delimiter'>, 
</span>                 <a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN460"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="regress.c.html#LN462"><span class='Ref_To_Local'>oldon</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN470"><span class='Ref_To_Local'>trigtuple</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN473"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="regress.c.html#LN475"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN475"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy (%s): %s must be NOT NULL"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN460"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN463"><span class='Ref_To_Local'>oldoff</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN470"><span class='Ref_To_Local'>trigtuple</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN473"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="regress.c.html#LN475"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN475"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy (%s): %s must be NOT NULL"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN460"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN471"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* UPDATE */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regress.c.html#LN464"><span class='Ref_To_Local'>newon</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN471"><span class='Ref_To_Local'>newtuple</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN473"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="regress.c.html#LN475"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN475"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy (%s): %s must be NOT NULL"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN460"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="regress.c.html#LN465"><span class='Ref_To_Local'>newoff</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN471"><span class='Ref_To_Local'>newtuple</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN473"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="regress.c.html#LN475"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN475"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy (%s): %s must be NOT NULL"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN460"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN462"><span class='Ref_To_Local'>oldon</span></a> <span class='Operator'>!= </span><a href="regress.c.html#LN464"><span class='Ref_To_Local'>newon</span></a> <span class='Operator'>|| </span><a href="regress.c.html#LN463"><span class='Ref_To_Local'>oldoff</span></a> <span class='Operator'>!= </span><a href="regress.c.html#LN465"><span class='Ref_To_Local'>newoff</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ttdummy (%s): you cannot change %s and/or %s columns (use set_ttdummy)"</span><span class='Delimiter'>, 
</span>                            <a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN460"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="regress.c.html#LN460"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN465"><span class='Ref_To_Local'>newoff</span></a> <span class='Operator'>!= </span><a href="regress.c.html#LN448"><span class='Ref_to_Const'>TTDUMMY_INFINITY</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* allocated in upper executor context */ 
</span>            <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if newtuple!=NULL &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN463"><span class='Ref_To_Local'>oldoff</span></a> <span class='Operator'>!= </span><a href="regress.c.html#LN448"><span class='Ref_to_Const'>TTDUMMY_INFINITY</span></a><span class='Parentheses'>)</span>        <span class='Comment_Single_Line'>/* DELETE */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="regress.c.html#LN465"><span class='Ref_To_Local'>newoff</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../include/commands/sequence.h.html#LN54"><span class='Ref_to_Proto'>nextval</span></a><span class='Delimiter'>, </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>"ttdummy_seq"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* nextval now returns int64; coerce down to int32 */ 
</span>    <a href="regress.c.html#LN465"><span class='Ref_To_Local'>newoff</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>((</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="../../include/postgres.h.html#LN610"><span class='Ref_to_Macro'>DatumGetInt64</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN465"><span class='Ref_To_Local'>newoff</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Connect to SPI manager */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="regress.c.html#LN476"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>())</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy (%s): SPI_connect returned %d"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN476"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch tuple values and nulls */ 
</span>    <a href="regress.c.html#LN466"><span class='Ref_To_Local'>cvals</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN474"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN467"><span class='Ref_To_Local'>cnulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN474"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN474"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regress.c.html#LN466"><span class='Ref_To_Local'>cvals</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>((</span><a href="regress.c.html#LN471"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="regress.c.html#LN471"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>: </span><a href="regress.c.html#LN470"><span class='Ref_To_Local'>trigtuple</span></a><span class='Delimiter'>, 
</span>                                 <a href="regress.c.html#LN473"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN475"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="regress.c.html#LN467"><span class='Ref_To_Local'>cnulls</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="regress.c.html#LN475"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>'n'</span> <span class='Operator'>: </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* change date column(s) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN471"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* UPDATE */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regress.c.html#LN466"><span class='Ref_To_Local'>cvals</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regress.c.html#LN465"><span class='Ref_To_Local'>newoff</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* start_date eq current date */ 
</span>        <a href="regress.c.html#LN467"><span class='Ref_To_Local'>cnulls</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>        <a href="regress.c.html#LN466"><span class='Ref_To_Local'>cvals</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regress.c.html#LN448"><span class='Ref_to_Const'>TTDUMMY_INFINITY</span></a><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* stop_date eq INFINITY */ 
</span>        <a href="regress.c.html#LN467"><span class='Ref_To_Local'>cnulls</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Comment_Multi_Line'>/* DELETE */ 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regress.c.html#LN466"><span class='Ref_To_Local'>cvals</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regress.c.html#LN465"><span class='Ref_To_Local'>newoff</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* stop_date eq current date */ 
</span>        <a href="regress.c.html#LN467"><span class='Ref_To_Local'>cnulls</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* if there is no plan ... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN450"><span class='Ref_to_Global_Var'>splan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN594"></a>        <a href="../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a>  <span class='Declare_Local'>pplan</span><span class='Delimiter'>; 
</span><a name="LN595"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>ctypes</span><span class='Delimiter'>; 
</span><a name="LN596"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* allocate space in preparation */ 
</span>        <a href="regress.c.html#LN595"><span class='Ref_To_Local'>ctypes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN474"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="regress.c.html#LN596"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>100</span> <span class='Operator'>+ </span><span class='Number'>16</span> <span class='Operator'>* </span><a href="regress.c.html#LN474"><span class='Ref_To_Local'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Construct query: INSERT INTO _relation_ VALUES ($1, ...) 
         */ 
</span>        <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN596"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"INSERT INTO %s VALUES ("</span><span class='Delimiter'>, </span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="regress.c.html#LN474"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN596"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="regress.c.html#LN596"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"$%d%s"</span><span class='Delimiter'>, 
</span>                    <a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN474"><span class='Ref_To_Local'>natts</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>", "</span> <span class='Operator'>: </span><span class='String'>")"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="regress.c.html#LN595"><span class='Ref_To_Local'>ctypes</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN473"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Prepare plan for query */ 
</span>        <a href="regress.c.html#LN594"><span class='Ref_To_Local'>pplan</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN99"><span class='Ref_to_Proto'>SPI_prepare</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN596"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN474"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN595"><span class='Ref_To_Local'>ctypes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN594"><span class='Ref_To_Local'>pplan</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy (%s): SPI_prepare returned %d"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="../../backend/executor/spi.c.html#LN41"><span class='Ref_to_Global_Var'>SPI_result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/executor/spi.h.html#LN106"><span class='Ref_to_Proto'>SPI_keepplan</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN594"><span class='Ref_To_Local'>pplan</span></a><span class='Parentheses'>))</span> 
            <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy (%s): SPI_keepplan failed"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="regress.c.html#LN450"><span class='Ref_to_Global_Var'>splan</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN594"><span class='Ref_To_Local'>pplan</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if splan==NULL &raquo; </span> 
 
    <a href="regress.c.html#LN476"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN88"><span class='Ref_to_Proto'>SPI_execp</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN450"><span class='Ref_to_Global_Var'>splan</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN466"><span class='Ref_To_Local'>cvals</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN467"><span class='Ref_To_Local'>cnulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN476"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ttdummy (%s): SPI_execp returned %d"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN476"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Tuple to return to upper Executor ... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN471"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span>               <span class='Comment_Single_Line'>/* UPDATE */ 
</span>        <a href="regress.c.html#LN472"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/spi.h.html#LN121"><span class='Ref_to_Proto'>SPI_modifytuple</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN469"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN470"><span class='Ref_To_Local'>trigtuple</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="regress.c.html#LN461"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN465"><span class='Ref_To_Local'>newoff</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* DELETE */ 
</span>        <a href="regress.c.html#LN472"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN470"><span class='Ref_To_Local'>trigtuple</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* don't forget say Bye to SPI mgr */ 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN468"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN472"><span class='Ref_To_Local'>rettuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ttdummy &raquo; </span> 
 
<a name="LN642"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN644"><span class='Ref_to_Func'>set_ttdummy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN645"></a><span class='Declare_Function'>set_ttdummy</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN647"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>on</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN451"><span class='Ref_to_Global_Var'>ttoff</span></a><span class='Parentheses'>)</span>                  <span class='Comment_Single_Line'>/* OFF currently */ 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN647"><span class='Ref_To_Local'>on</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* turn ON */ 
</span>        <a href="regress.c.html#LN451"><span class='Ref_to_Global_Var'>ttoff</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* ON currently */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN647"><span class='Ref_To_Local'>on</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* turn OFF */ 
</span>    <a href="regress.c.html#LN451"><span class='Ref_to_Global_Var'>ttoff</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_ttdummy &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Type int44 has no real-world use, but the regression tests use it. 
 * It's a four-element vector of int4's. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      int44in         - converts "num num ..." to internal form 
 * 
 *      Note: Fills any missing positions with zeroes. 
 */ 
</span><a name="LN680"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN682"><span class='Ref_to_Func'>int44in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN683"></a><span class='Declare_Function'>int44in</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN685"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>input_string</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN686"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>4</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN687"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN687"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span>sscanf<span class='Parentheses'>(</span><a href="regress.c.html#LN685"><span class='Ref_To_Local'>input_string</span></a><span class='Delimiter'>, 
</span>               <span class='String'>"%d, %d, %d, %d"</span><span class='Delimiter'>, 
</span>               <span class='Operator'>&</span><a href="regress.c.html#LN686"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>               <span class='Operator'>&</span><a href="regress.c.html#LN686"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>               <span class='Operator'>&</span><a href="regress.c.html#LN686"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>               <span class='Operator'>&</span><a href="regress.c.html#LN686"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN687"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>        <a href="regress.c.html#LN686"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN687"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN686"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      int44out        - converts internal form to "num num ..." 
 */ 
</span><a name="LN704"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN706"><span class='Ref_to_Func'>int44out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN707"></a><span class='Declare_Function'>int44out</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN709"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>an_array</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN710"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>16</span> <span class='Operator'>* </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Multi_Line'>/* Allow 14 digits + 
                                                         * sign */ 
</span><a name="LN712"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN713"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>walk</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN713"><span class='Ref_To_Local'>walk</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN710"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN712"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN712"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Delimiter'>; </span><a href="regress.c.html#LN712"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/builtins.h.html#LN46"><span class='Ref_to_Proto'>pg_ltoa</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN709"><span class='Ref_To_Local'>an_array</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN712"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="regress.c.html#LN713"><span class='Ref_To_Local'>walk</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*++</span><a href="regress.c.html#LN713"><span class='Ref_To_Local'>walk</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="regress.c.html#LN713"><span class='Ref_To_Local'>walk</span></a><span class='Operator'>++ = </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*--</span><a href="regress.c.html#LN713"><span class='Ref_To_Local'>walk</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN710"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int44out &raquo; </span> 
 
<a name="LN727"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN728"><span class='Ref_to_Func'>make_tuple_indirect</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN729"></a><span class='Declare_Function'>make_tuple_indirect</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN731"></a>    <a href="../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>rec</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN275"><span class='Ref_to_Macro'>PG_GETARG_HEAPTUPLEHEADER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN732"></a>    <a href="../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN733"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ncolumns</span><span class='Delimiter'>; 
</span><a name="LN734"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN735"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span> 
<a name="LN737"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tupType</span><span class='Delimiter'>; 
</span><a name="LN738"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tupTypmod</span><span class='Delimiter'>; 
</span><a name="LN739"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span> 
<a name="LN741"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtup</span><span class='Delimiter'>; 
</span> 
<a name="LN743"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
<a name="LN745"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_context</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract type info from the tuple itself */ 
</span>    <a href="regress.c.html#LN737"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN444"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypeId</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN731"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN738"><span class='Ref_To_Local'>tupTypmod</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN454"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypMod</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN731"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN739"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/typcache.h.html#LN151"><span class='Ref_to_Proto'>lookup_rowtype_tupdesc</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN737"><span class='Ref_To_Local'>tupType</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN738"><span class='Ref_To_Local'>tupTypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN733"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN739"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a temporary HeapTuple control structure */ 
</span>    <a href="regress.c.html#LN732"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN731"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="regress.c.html#LN732"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN732"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN732"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN731"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN734"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN733"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN735"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN733"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN813"><span class='Ref_to_Proto'>heap_deform_tuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN732"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN739"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN734"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN735"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN745"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/mmgr/mcxt.c.html#LN47"><span class='Ref_to_Global_Var'>TopTransactionContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN743"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN743"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regress.c.html#LN733"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; </span><a href="regress.c.html#LN743"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN768"></a>        <span class='Control'>struct</span> <a href="../../include/c.h.html#LN438"><span class='Ref_to_Struct'>varlena</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span><a name="LN769"></a>        <span class='Control'>struct</span> <a href="../../include/c.h.html#LN438"><span class='Ref_to_Struct'>varlena</span></a> <span class='Operator'>*</span><span class='Declare_Local'>new_attr</span><span class='Delimiter'>; 
</span><a name="LN770"></a>        <span class='Control'>struct</span> <a href="../../include/postgres.h.html#LN84"><span class='Ref_to_Struct'>varatt_indirect</span></a> <span class='Declare_Local'>redirect_pointer</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* only work on existing, not-null varlenas */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN739"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN743"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped <span class='Operator'>|| 
</span>            <a href="regress.c.html#LN735"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN743"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| 
</span>            <a href="regress.c.html#LN739"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN743"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="regress.c.html#LN768"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../include/c.h.html#LN438"><span class='Ref_to_Struct'>varlena</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN734"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN743"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* don't recursively indirect */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN316"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_INDIRECT</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN768"><span class='Ref_To_Local'>attr</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* copy datum, so it still lives later */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN314"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_ONDISK</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN768"><span class='Ref_To_Local'>attr</span></a><span class='Parentheses'>))</span> 
            <a href="regress.c.html#LN768"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="../../backend/access/heap/tuptoaster.c.html#LN99"><span class='Ref_to_Func'>heap_tuple_fetch_attr</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN768"><span class='Ref_To_Local'>attr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN789"></a>            <span class='Control'>struct</span> <a href="../../include/c.h.html#LN438"><span class='Ref_to_Struct'>varlena</span></a> <span class='Operator'>*</span><span class='Declare_Local'>oldattr</span> <span class='Operator'>= </span><a href="regress.c.html#LN768"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>; 
</span> 
            <a href="regress.c.html#LN768"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN333"><span class='Ref_to_Macro'>VARSIZE_ANY</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN789"><span class='Ref_To_Local'>oldattr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="regress.c.html#LN768"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN789"><span class='Ref_To_Local'>oldattr</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN333"><span class='Ref_to_Macro'>VARSIZE_ANY</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN789"><span class='Ref_To_Local'>oldattr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* build indirection Datum */ 
</span>        <a href="regress.c.html#LN769"><span class='Ref_To_Local'>new_attr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../include/c.h.html#LN438"><span class='Ref_to_Struct'>varlena</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../include/access/tuptoaster.h.html#LN101"><span class='Ref_to_Const'>INDIRECT_POINTER_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="regress.c.html#LN770"><span class='Ref_To_Local'>redirect_pointer</span></a><span class='Operator'>.</span><a href="../../include/postgres.h.html#LN86"><span class='Ref_to_Member'>pointer</span></a> <span class='Operator'>= </span><a href="regress.c.html#LN768"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/postgres.h.html#LN331"><span class='Ref_to_Macro'>SET_VARTAG_EXTERNAL</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN769"><span class='Ref_To_Local'>new_attr</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN113"><span class='Ref_to_EnumConst'>VARTAG_INDIRECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN310"><span class='Ref_to_Macro'>VARDATA_EXTERNAL</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN769"><span class='Ref_To_Local'>new_attr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN770"><span class='Ref_To_Local'>redirect_pointer</span></a><span class='Delimiter'>, 
</span>               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="regress.c.html#LN770"><span class='Ref_To_Local'>redirect_pointer</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="regress.c.html#LN734"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="regress.c.html#LN743"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN769"><span class='Ref_To_Local'>new_attr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;ncolumns;i++ &raquo; </span> 
 
    <a href="regress.c.html#LN741"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>= </span><a href="../../backend/access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN739"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN734"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="regress.c.html#LN735"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN734"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN735"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/tupdesc.h.html#LN106"><span class='Ref_to_Macro'>ReleaseTupleDesc</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN739"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN745"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We intentionally don't use PG_RETURN_HEAPTUPLEHEADER here, because that 
     * would cause the indirect toast pointers to be flattened out of the 
     * tuple immediately, rendering subsequent testing irrelevant.  So just 
     * return the HeapTupleHeader pointer as-is.  This violates the general 
     * rule that composite Datums shouldn't contain toast pointers, but so 
     * long as the regression test scripts don't insert the result of this 
     * function into a container type (record, array, etc) it should be OK. 
     */ 
</span>    <a href="../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN741"><span class='Ref_To_Local'>newtup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_tuple_indirect &raquo; </span> 
 
<a name="LN824"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN826"><span class='Ref_to_Func'>regress_putenv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN827"></a><span class='Declare_Function'>regress_putenv</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN829"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN830"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>envbuf</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../backend/utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"must be superuser to change environment variables"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN829"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../backend/utils/mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regress.c.html#LN830"><span class='Ref_To_Local'>envbuf</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>((</span><a href="../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN829"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN410"><span class='Ref_to_Macro'>putenv</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN830"><span class='Ref_To_Local'>envbuf</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not set environment variable: %m"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Sleep until no process has a given PID. */ 
</span><a name="LN846"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN848"><span class='Ref_to_Func'>wait_pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN849"></a><span class='Declare_Function'>wait_pid</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN851"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>pid</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../backend/utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"must be superuser to check PID liveness"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN210"><span class='Ref_to_Macro'>kill</span></a><span class='Parentheses'>(</span><a href="regress.c.html#LN851"><span class='Ref_To_Local'>pid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../port/pgsleep.c.html#LN45"><span class='Ref_to_Func'>pg_usleep</span></a><span class='Parentheses'>(</span><span class='Number'>50000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>!= </span>ESRCH<span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not check PID %d liveness: %m"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN851"><span class='Ref_To_Local'>pid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<span class='Directive'>#ifndef</span> <a href="../../include/port/atomics/fallback.h.html#LN66"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FLAG_SIMULATION</span></a> 
<span class='Keyword'>static void 
</span><a name="LN870"></a><span class='Declare_Function'>test_atomic_flag</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN872"></a>    <a href="../../include/port/atomics/generic-gcc.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_flag</span></a> <span class='Declare_Local'>flag</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port/atomics.h.html#LN173"><span class='Ref_to_Func'>pg_atomic_init_flag</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN872"><span class='Ref_To_Local'>flag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port/atomics.h.html#LN203"><span class='Ref_to_Func'>pg_atomic_unlocked_test_flag</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN872"><span class='Ref_To_Local'>flag</span></a><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"flag: unexpectedly set"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port/atomics.h.html#LN188"><span class='Ref_to_Func'>pg_atomic_test_set_flag</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN872"><span class='Ref_To_Local'>flag</span></a><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"flag: couldn't set"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN203"><span class='Ref_to_Func'>pg_atomic_unlocked_test_flag</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN872"><span class='Ref_To_Local'>flag</span></a><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"flag: unexpectedly unset"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN188"><span class='Ref_to_Func'>pg_atomic_test_set_flag</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN872"><span class='Ref_To_Local'>flag</span></a><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"flag: set spuriously #2"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port/atomics.h.html#LN216"><span class='Ref_to_Func'>pg_atomic_clear_flag</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN872"><span class='Ref_To_Local'>flag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port/atomics.h.html#LN203"><span class='Ref_to_Func'>pg_atomic_unlocked_test_flag</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN872"><span class='Ref_To_Local'>flag</span></a><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"flag: unexpectedly set #2"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port/atomics.h.html#LN188"><span class='Ref_to_Func'>pg_atomic_test_set_flag</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN872"><span class='Ref_To_Local'>flag</span></a><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"flag: couldn't set"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port/atomics.h.html#LN216"><span class='Ref_to_Func'>pg_atomic_clear_flag</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN872"><span class='Ref_To_Local'>flag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end test_atomic_flag &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* PG_HAVE_ATOMIC_FLAG_SIMULATION */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN901"></a><span class='Declare_Function'>test_atomic_uint32</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN903"></a>    <a href="../../include/port/atomics/arch-x86.h.html#LN62"><span class='Ref_to_Struct'>pg_atomic_uint32</span></a> <span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN904"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>expected</span><span class='Delimiter'>; 
</span><a name="LN905"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port/atomics.h.html#LN232"><span class='Ref_to_Func'>pg_atomic_init_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN250"><span class='Ref_to_Func'>pg_atomic_read_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_read_u32() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port/atomics.h.html#LN267"><span class='Ref_to_Func'>pg_atomic_write_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN250"><span class='Ref_to_Func'>pg_atomic_read_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_read_u32() #2 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN337"><span class='Ref_to_Func'>pg_atomic_fetch_add_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_fetch_add_u32() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN352"><span class='Ref_to_Func'>pg_atomic_fetch_sub_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>4</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_fetch_sub_u32() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN410"><span class='Ref_to_Func'>pg_atomic_sub_fetch_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_sub_fetch_u32() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN395"><span class='Ref_to_Func'>pg_atomic_add_fetch_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>10</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_add_fetch_u32() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN301"><span class='Ref_to_Func'>pg_atomic_exchange_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>10</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_exchange_u32() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN301"><span class='Ref_to_Func'>pg_atomic_exchange_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>5</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_exchange_u32() #0 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* test around numerical limits */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN337"><span class='Ref_to_Func'>pg_atomic_fetch_add_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span>INT_MAX<span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_add_u32() #2 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN337"><span class='Ref_to_Func'>pg_atomic_fetch_add_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span>INT_MAX<span class='Parentheses'>) </span><span class='Operator'>!= </span>INT_MAX<span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_add_fetch_u32() #3 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port/atomics.h.html#LN337"><span class='Ref_to_Func'>pg_atomic_fetch_add_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* top up to UINT_MAX */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN250"><span class='Ref_to_Func'>pg_atomic_read_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span>UINT_MAX<span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_read_u32() #2 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN352"><span class='Ref_to_Func'>pg_atomic_fetch_sub_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span>INT_MAX<span class='Parentheses'>) </span><span class='Operator'>!= </span>UINT_MAX<span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_sub_u32() #2 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN250"><span class='Ref_to_Func'>pg_atomic_read_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span>INT_MAX <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_read_u32() #3 wrong: %u"</span><span class='Delimiter'>, </span><a href="../../include/port/atomics.h.html#LN250"><span class='Ref_to_Func'>pg_atomic_read_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN904"><span class='Ref_To_Local'>expected</span></a> <span class='Operator'>= </span><a href="../../include/port/atomics.h.html#LN410"><span class='Ref_to_Func'>pg_atomic_sub_fetch_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span>INT_MAX<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN904"><span class='Ref_To_Local'>expected</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_sub_fetch_u32() #3 wrong: %u"</span><span class='Delimiter'>, </span><a href="regress.c.html#LN904"><span class='Ref_To_Local'>expected</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port/atomics.h.html#LN410"><span class='Ref_to_Func'>pg_atomic_sub_fetch_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fail exchange because of old expected */ 
</span>    <a href="regress.c.html#LN904"><span class='Ref_To_Local'>expected</span></a> <span class='Operator'>= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN320"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN904"><span class='Ref_To_Local'>expected</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_compare_exchange_u32() changed value spuriously"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* CAS is allowed to fail due to interrupts, try a couple of times */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN905"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN905"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>1000</span><span class='Delimiter'>; </span><a href="regress.c.html#LN905"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regress.c.html#LN904"><span class='Ref_To_Local'>expected</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port/atomics.h.html#LN320"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN904"><span class='Ref_To_Local'>expected</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN905"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>1000</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_compare_exchange_u32() never succeeded"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN250"><span class='Ref_to_Func'>pg_atomic_read_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_compare_exchange_u32() didn't set value properly"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port/atomics.h.html#LN267"><span class='Ref_to_Func'>pg_atomic_write_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* try setting flagbits */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN381"><span class='Ref_to_Func'>pg_atomic_fetch_or_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_or_u32() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN381"><span class='Ref_to_Func'>pg_atomic_fetch_or_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_or_u32() #2 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN250"><span class='Ref_to_Func'>pg_atomic_read_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid result after pg_atomic_fetch_or_u32()"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* try clearing flagbits */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../include/port/atomics.h.html#LN367"><span class='Ref_to_Func'>pg_atomic_fetch_and_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>~</span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>3</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_and_u32() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN367"><span class='Ref_to_Func'>pg_atomic_fetch_and_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>~</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_and_u32() #2 wrong: is %u"</span><span class='Delimiter'>, 
</span>             <a href="../../include/port/atomics.h.html#LN250"><span class='Ref_to_Func'>pg_atomic_read_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* no bits set anymore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN367"><span class='Ref_to_Func'>pg_atomic_fetch_and_u32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN903"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>~</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_and_u32() #3 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end test_atomic_uint32 &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1001"></a><span class='Declare_Function'>test_atomic_uint64</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1003"></a>    <a href="../../include/port/atomics/arch-x86.h.html#LN73"><span class='Ref_to_Struct'>pg_atomic_uint64</span></a> <span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN1004"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>expected</span><span class='Delimiter'>; 
</span><a name="LN1005"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port/atomics.h.html#LN424"><span class='Ref_to_Func'>pg_atomic_init_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN438"><span class='Ref_to_Func'>pg_atomic_read_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_read_u64() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port/atomics.h.html#LN447"><span class='Ref_to_Func'>pg_atomic_write_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN438"><span class='Ref_to_Func'>pg_atomic_read_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_read_u64() #2 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN476"><span class='Ref_to_Func'>pg_atomic_fetch_add_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_fetch_add_u64() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN485"><span class='Ref_to_Func'>pg_atomic_fetch_sub_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>4</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_fetch_sub_u64() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN522"><span class='Ref_to_Func'>pg_atomic_sub_fetch_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_sub_fetch_u64() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN513"><span class='Ref_to_Func'>pg_atomic_add_fetch_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>10</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_add_fetch_u64() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN456"><span class='Ref_to_Func'>pg_atomic_exchange_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>10</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_exchange_u64() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN456"><span class='Ref_to_Func'>pg_atomic_exchange_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>5</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_exchange_u64() #0 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fail exchange because of old expected */ 
</span>    <a href="regress.c.html#LN1004"><span class='Ref_To_Local'>expected</span></a> <span class='Operator'>= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN465"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN1004"><span class='Ref_To_Local'>expected</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_compare_exchange_u64() changed value spuriously"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* CAS is allowed to fail due to interrupts, try a couple of times */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN1005"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regress.c.html#LN1005"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>100</span><span class='Delimiter'>; </span><a href="regress.c.html#LN1005"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regress.c.html#LN1004"><span class='Ref_To_Local'>expected</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port/atomics.h.html#LN465"><span class='Ref_to_Func'>pg_atomic_compare_exchange_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regress.c.html#LN1004"><span class='Ref_To_Local'>expected</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regress.c.html#LN1005"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>100</span><span class='Parentheses'>) 
</span>        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_compare_exchange_u64() never succeeded"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN438"><span class='Ref_to_Func'>pg_atomic_read_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"atomic_compare_exchange_u64() didn't set value properly"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port/atomics.h.html#LN447"><span class='Ref_to_Func'>pg_atomic_write_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* try setting flagbits */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN504"><span class='Ref_to_Func'>pg_atomic_fetch_or_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_or_u64() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN504"><span class='Ref_to_Func'>pg_atomic_fetch_or_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_or_u64() #2 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN438"><span class='Ref_to_Func'>pg_atomic_read_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid result after pg_atomic_fetch_or_u64()"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* try clearing flagbits */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../include/port/atomics.h.html#LN495"><span class='Ref_to_Func'>pg_atomic_fetch_and_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>~</span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>3</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_and_u64() #1 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN495"><span class='Ref_to_Func'>pg_atomic_fetch_and_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>~</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_and_u64() #2 wrong: is "</span> <a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a><span class='Delimiter'>, 
</span>             <a href="../../include/port/atomics.h.html#LN438"><span class='Ref_to_Func'>pg_atomic_read_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* no bits set anymore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/atomics.h.html#LN495"><span class='Ref_to_Func'>pg_atomic_fetch_and_u64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regress.c.html#LN1003"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>~</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"pg_atomic_fetch_and_u64() #3 wrong"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end test_atomic_uint64 &raquo; </span> 
 
 
<a name="LN1077"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="regress.c.html#LN1078"><span class='Ref_to_Func'>test_atomic_ops</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1079"></a><span class='Declare_Function'>test_atomic_ops</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* --- 
     * Can't run the test under the semaphore emulation, it doesn't handle 
     * checking two edge cases well: 
     * - pg_atomic_unlocked_test_flag() always returns true 
     * - locking a already locked flag blocks 
     * it seems better to not test the semaphore fallback here, than weaken 
     * the checks for the other cases. The semaphore code will be the same 
     * everywhere, whereas the efficient implementations wont. 
     * --- 
     */ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/port/atomics/fallback.h.html#LN66"><span class='Ref_to_Const'>PG_HAVE_ATOMIC_FLAG_SIMULATION</span></a> 
    <a href="regress.c.html#LN869"><span class='Ref_to_Func'>test_atomic_flag</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="regress.c.html#LN900"><span class='Ref_to_Func'>test_atomic_uint32</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="regress.c.html#LN1000"><span class='Ref_to_Func'>test_atomic_uint64</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end test_atomic_ops &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>