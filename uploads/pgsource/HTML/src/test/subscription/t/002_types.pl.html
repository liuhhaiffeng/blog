<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\test\subscription\t\002_types.pl</title>
<LINK REL=StyleSheet HREF="../../../../Perl_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\test\subscription\t\002_types.pl</b></p></td>
<td align='right'>
Wed Jun 14 08:26:15 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Single_Line'># This tests that more complex datatypes are replicated correctly 
# by logical replication 
</span><span class='Control'>use</span> strict<span class='Delimiter'>; 
</span><span class='Control'>use</span> warnings<span class='Delimiter'>; 
</span><span class='Control'>use</span> PostgresNode<span class='Delimiter'>; 
</span><span class='Control'>use</span> TestLib<span class='Delimiter'>; 
</span><span class='Control'>use</span> Test<span class='Operator'>::</span>More tests <span class='Operator'>=&GT; </span>3<span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Initialize publisher node 
</span><span class='Keyword'>my </span>$node_publisher <span class='Operator'>= </span><a href="../../perl/PostgresNode.pm.html#LN867"><span class='Ref_to_Func'>get_new_node</span></a><span class='Parentheses'>(</span><span class='String'>'publisher'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN393"><span class='Ref_to_Func'>init</span></a><span class='Parentheses'>(</span>allows_streaming <span class='Operator'>=&GT; </span><span class='String'>'logical'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN650"><span class='Ref_to_Func'>start</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Create subscriber node 
</span><span class='Keyword'>my </span>$node_subscriber <span class='Operator'>= </span><a href="../../perl/PostgresNode.pm.html#LN867"><span class='Ref_to_Func'>get_new_node</span></a><span class='Parentheses'>(</span><span class='String'>'subscriber'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>$node_subscriber<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN393"><span class='Ref_to_Func'>init</span></a><span class='Parentheses'>(</span>allows_streaming <span class='Operator'>=&GT; </span><span class='String'>'logical'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>$node_subscriber<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN650"><span class='Ref_to_Func'>start</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Create some preexisting content on publisher 
</span><span class='Keyword'>my </span>$ddl <span class='Operator'>= qq</span><span class='String'>( 
</span>    CREATE EXTENSION hstore WITH SCHEMA public<span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_one_array <span class='Parentheses'>( 
</span>        a INTEGER PRIMARY KEY<span class='Delimiter'>, 
</span>        b INTEGER<span class='Delimiter'>[] 
</span>        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_arrays <span class='Parentheses'>( 
</span>        a INTEGER<span class='Delimiter'>[] </span>PRIMARY KEY<span class='Delimiter'>, 
</span>        b TEXT<span class='Delimiter'>[], 
</span>        c FLOAT<span class='Delimiter'>[], 
</span>        d INTERVAL<span class='Delimiter'>[] 
</span>        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    CREATE TYPE public<span class='Operator'>.</span>tst_enum_t AS ENUM <span class='Parentheses'>(</span><span class='String'>'a'</span><span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, </span><span class='String'>'e'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_one_enum <span class='Parentheses'>( 
</span>        a INTEGER PRIMARY KEY<span class='Delimiter'>, 
</span>        b public<span class='Operator'>.</span>tst_enum_t 
        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_enums <span class='Parentheses'>( 
</span>        a public<span class='Operator'>.</span>tst_enum_t PRIMARY KEY<span class='Delimiter'>, 
</span>        b public<span class='Operator'>.</span>tst_enum_t<span class='Delimiter'>[] 
</span>        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    CREATE TYPE public<span class='Operator'>.</span>tst_comp_basic_t AS <span class='Parentheses'>(</span>a FLOAT<span class='Delimiter'>, </span>b TEXT<span class='Delimiter'>, </span>c INTEGER<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TYPE public<span class='Operator'>.</span>tst_comp_enum_t AS <span class='Parentheses'>(</span>a FLOAT<span class='Delimiter'>, </span>b public<span class='Operator'>.</span>tst_enum_t<span class='Delimiter'>, </span>c INTEGER<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TYPE public<span class='Operator'>.</span>tst_comp_enum_array_t AS <span class='Parentheses'>(</span>a FLOAT<span class='Delimiter'>, </span>b public<span class='Operator'>.</span>tst_enum_t<span class='Delimiter'>[], </span>c INTEGER<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_one_comp <span class='Parentheses'>( 
</span>        a INTEGER PRIMARY KEY<span class='Delimiter'>, 
</span>        b public<span class='Operator'>.</span>tst_comp_basic_t 
        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_comps <span class='Parentheses'>( 
</span>        a public<span class='Operator'>.</span>tst_comp_basic_t PRIMARY KEY<span class='Delimiter'>, 
</span>        b public<span class='Operator'>.</span>tst_comp_basic_t<span class='Delimiter'>[] 
</span>        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_comp_enum <span class='Parentheses'>( 
</span>        a INTEGER PRIMARY KEY<span class='Delimiter'>, 
</span>        b public<span class='Operator'>.</span>tst_comp_enum_t 
        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_comp_enum_array <span class='Parentheses'>( 
</span>        a public<span class='Operator'>.</span>tst_comp_enum_t PRIMARY KEY<span class='Delimiter'>, 
</span>        b public<span class='Operator'>.</span>tst_comp_enum_t<span class='Delimiter'>[] 
</span>        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_comp_one_enum_array <span class='Parentheses'>( 
</span>        a INTEGER PRIMARY KEY<span class='Delimiter'>, 
</span>        b public<span class='Operator'>.</span>tst_comp_enum_array_t 
        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_comp_enum_what <span class='Parentheses'>( 
</span>        a public<span class='Operator'>.</span>tst_comp_enum_array_t PRIMARY KEY<span class='Delimiter'>, 
</span>        b public<span class='Operator'>.</span>tst_comp_enum_array_t<span class='Delimiter'>[] 
</span>        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    CREATE TYPE public<span class='Operator'>.</span>tst_comp_mix_t AS <span class='Parentheses'>( 
</span>        a public<span class='Operator'>.</span>tst_comp_basic_t<span class='Delimiter'>, 
</span>        b public<span class='Operator'>.</span>tst_comp_basic_t<span class='Delimiter'>[], 
</span>        c public<span class='Operator'>.</span>tst_enum_t<span class='Delimiter'>, 
</span>        d public<span class='Operator'>.</span>tst_enum_t<span class='Delimiter'>[] 
</span>        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_comp_mix_array <span class='Parentheses'>( 
</span>        a public<span class='Operator'>.</span>tst_comp_mix_t PRIMARY KEY<span class='Delimiter'>, 
</span>        b public<span class='Operator'>.</span>tst_comp_mix_t<span class='Delimiter'>[] 
</span>        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_range <span class='Parentheses'>( 
</span>        a INTEGER PRIMARY KEY<span class='Delimiter'>, 
</span>        b int4range 
    <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_range_array <span class='Parentheses'>( 
</span>        a INTEGER PRIMARY KEY<span class='Delimiter'>, 
</span>        b TSTZRANGE<span class='Delimiter'>, 
</span>        c int8range<span class='Delimiter'>[] 
</span>    <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CREATE TABLE public<span class='Operator'>.</span>tst_hstore <span class='Parentheses'>( 
</span>        a INTEGER PRIMARY KEY<span class='Delimiter'>, 
</span>        b public<span class='Operator'>.</span>hstore 
    <span class='Parentheses'>)</span><span class='Delimiter'>;</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Setup structure on both nodes 
</span>$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN969"><span class='Ref_to_Func'>safe_psql</span></a><span class='Parentheses'>(</span><span class='String'>'postgres'</span><span class='Delimiter'>, </span>$ddl<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>$node_subscriber<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN969"><span class='Ref_to_Func'>safe_psql</span></a><span class='Parentheses'>(</span><span class='String'>'postgres'</span><span class='Delimiter'>, </span>$ddl<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Setup logical replication 
</span><span class='Keyword'>my </span>$publisher_connstr <span class='Operator'>= </span>$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN245"><span class='Ref_to_Func'>connstr</span></a> <span class='Operator'>. </span><span class='String'>' dbname=postgres'</span><span class='Delimiter'>; 
</span>$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN969"><span class='Ref_to_Func'>safe_psql</span></a><span class='Parentheses'>(</span><span class='String'>'postgres'</span><span class='Delimiter'>, 
</span>    <span class='String'>"CREATE PUBLICATION tap_pub FOR ALL TABLES"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>my </span>$appname <span class='Operator'>= </span><span class='String'>'tap_sub'</span><span class='Delimiter'>; 
</span>$node_subscriber<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN969"><span class='Ref_to_Func'>safe_psql</span></a><span class='Parentheses'>(</span><span class='String'>'postgres'</span><span class='Delimiter'>, 
</span><span class='String'>"CREATE SUBSCRIPTION tap_sub CONNECTION '$publisher_connstr application_name=$appname' PUBLICATION tap_pub WITH (slot_name = tap_sub_slot)"</span> 
<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Wait for subscriber to finish initialization 
</span><span class='Keyword'>my </span>$caughtup_query <span class='Operator'>= 
</span><span class='String'>"SELECT pg_current_wal_lsn() &LT;= replay_lsn FROM pg_stat_replication WHERE application_name = '$appname';"</span><span class='Delimiter'>; 
</span>$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN1221"><span class='Ref_to_Func'>poll_query_until</span></a><span class='Parentheses'>(</span><span class='String'>'postgres'</span><span class='Delimiter'>, </span>$caughtup_query<span class='Parentheses'>) 
</span>  or <span class='Control'>die</span> <span class='String'>"Timed out while waiting for subscriber to catch up"</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Wait for initial sync to finish as well 
</span><span class='Keyword'>my </span>$synced_query <span class='Operator'>= 
</span><span class='String'>"SELECT count(1) = 0 FROM pg_subscription_rel WHERE srsubstate NOT IN ('s', 'r');"</span><span class='Delimiter'>; 
</span>$node_subscriber<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN1221"><span class='Ref_to_Func'>poll_query_until</span></a><span class='Parentheses'>(</span><span class='String'>'postgres'</span><span class='Delimiter'>, </span>$synced_query<span class='Parentheses'>) 
</span>  or <span class='Control'>die</span> <span class='String'>"Timed out while waiting for subscriber to synchronize data"</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Insert initial test data 
</span>$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN969"><span class='Ref_to_Func'>safe_psql</span></a><span class='Parentheses'>(</span> 
    <span class='String'>'postgres'</span><span class='Delimiter'>, </span><span class='Operator'>qq</span><span class='String'>( 
</span>    <span class='Operator'>-- </span>test_tbl_one_array_col 
    INSERT INTO tst_one_array <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>1<span class='Delimiter'>, </span><span class='String'>'{1, 2, 3}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>2<span class='Delimiter'>, </span><span class='String'>'{2, 3, 1}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'{3, 2, 1}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>4<span class='Delimiter'>, </span><span class='String'>'{4, 3, 2}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>5<span class='Delimiter'>, </span><span class='String'>'{5, NULL, 3}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_arrays 
    INSERT INTO tst_arrays <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Delimiter'>, </span>c<span class='Delimiter'>, </span>d<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span><span class='String'>'{1, 2, 3}'</span><span class='Delimiter'>, </span><span class='String'>'{"a", "b", "c"}'</span><span class='Delimiter'>, </span><span class='String'>'{1.1, 2.2, 3.3}'</span><span class='Delimiter'>, </span><span class='String'>'{"1 day", "2 days", "3 days"}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><span class='String'>'{2, 3, 1}'</span><span class='Delimiter'>, </span><span class='String'>'{"b", "c", "a"}'</span><span class='Delimiter'>, </span><span class='String'>'{2.2, 3.3, 1.1}'</span><span class='Delimiter'>, </span><span class='String'>'{"2 minutes", "3 minutes", "1 minute"}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><span class='String'>'{3, 1, 2}'</span><span class='Delimiter'>, </span><span class='String'>'{"c", "a", "b"}'</span><span class='Delimiter'>, </span><span class='String'>'{3.3, 1.1, 2.2}'</span><span class='Delimiter'>, </span><span class='String'>'{"3 years", "1 year", "2 years"}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><span class='String'>'{4, 1, 2}'</span><span class='Delimiter'>, </span><span class='String'>'{"d", "a", "b"}'</span><span class='Delimiter'>, </span><span class='String'>'{4.4, 1.1, 2.2}'</span><span class='Delimiter'>, </span><span class='String'>'{"4 years", "1 year", "2 years"}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><span class='String'>'{5, NULL, NULL}'</span><span class='Delimiter'>, </span><span class='String'>'{"e", NULL, "b"}'</span><span class='Delimiter'>, </span><span class='String'>'{5.5, 1.1, NULL}'</span><span class='Delimiter'>, </span><span class='String'>'{"5 years", NULL, NULL}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_single_enum 
    INSERT INTO tst_one_enum <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>1<span class='Delimiter'>, </span><span class='String'>'a'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>2<span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>4<span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>5<span class='Delimiter'>, </span>NULL<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_enums 
    INSERT INTO tst_enums <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span><span class='String'>'a'</span><span class='Delimiter'>, </span><span class='String'>'{b, c}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><span class='String'>'b'</span><span class='Delimiter'>, </span><span class='String'>'{c, a}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><span class='String'>'c'</span><span class='Delimiter'>, </span><span class='String'>'{b, a}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><span class='String'>'d'</span><span class='Delimiter'>, </span><span class='String'>'{c, b}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span><span class='String'>'e'</span><span class='Delimiter'>, </span><span class='String'>'{d, NULL}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_single_composites 
    INSERT INTO tst_one_comp <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>1<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>1<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'a'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>2<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>2<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>, </span>2<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>3<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>3<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>4<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>4<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, </span>4<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>5<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>NULL<span class='Delimiter'>, </span>NULL<span class='Delimiter'>, </span>5<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_composites 
    INSERT INTO tst_comps <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>1<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'a'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>1<span class='Delimiter'>, </span><span class='String'>'a'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>2<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>, </span>2<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>2<span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>, </span>2<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>3<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>4<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, </span>4<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>4<span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>5<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'e'</span><span class='Delimiter'>, </span>NULL<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>NULL<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>5<span class='Delimiter'>, </span>NULL<span class='Delimiter'>, </span>5<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_composite_with_enums 
    INSERT INTO tst_comp_enum <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>1<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>1<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'a'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>2<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>2<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>, </span>2<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>3<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>3<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>4<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>4<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, </span>4<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>5<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>NULL<span class='Delimiter'>, </span><span class='String'>'e'</span><span class='Delimiter'>, </span>NULL<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_composite_with_enums_array 
    INSERT INTO tst_comp_enum_array <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>1<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'a'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>1<span class='Delimiter'>, </span><span class='String'>'a'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>2<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>, </span>2<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>2<span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>, </span>2<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>3<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>4<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>5<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'e'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'e'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_t<span class='Delimiter'>, </span>NULL<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_composite_with_single_enums_array_in_composite 
    INSERT INTO tst_comp_one_enum_array <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>1<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>1<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{a, b, c}'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>2<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>2<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{a, b, c}'</span><span class='Delimiter'>, </span>2<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>3<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>3<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{a, b, c}'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>4<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>4<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{c, b, d}'</span><span class='Delimiter'>, </span>4<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>5<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>5<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{NULL, e, NULL}'</span><span class='Delimiter'>, </span>5<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_composite_with_enums_array_in_composite 
    INSERT INTO tst_comp_enum_what <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>1<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{a, b, c}'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>1<span class='Delimiter'>, </span><span class='String'>'{a, b, c}'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_array_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>2<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{b, c, a}'</span><span class='Delimiter'>, </span>2<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>2<span class='Delimiter'>, </span><span class='String'>'{b, c, a}'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_array_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>3<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{c, a, b}'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'{c, a, b}'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_array_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>4<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{c, b, d}'</span><span class='Delimiter'>, </span>4<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>4<span class='Delimiter'>, </span><span class='String'>'{c, b, d}'</span><span class='Delimiter'>, </span>4<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_array_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>(</span>5<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{c, NULL, b}'</span><span class='Delimiter'>, </span>NULL<span class='Parentheses'>)</span><span class='Delimiter'>, </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>5<span class='Delimiter'>, </span><span class='String'>'{c, e, b}'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_array_t<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_mixed_composites 
    INSERT INTO tst_comp_mix_array <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>ROW<span class='Parentheses'>( 
</span>            ROW<span class='Parentheses'>(</span>1<span class='Delimiter'>,</span><span class='String'>'a'</span><span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>1<span class='Delimiter'>,</span><span class='String'>'a'</span><span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>2<span class='Delimiter'>,</span><span class='String'>'b'</span><span class='Delimiter'>,</span>2<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t<span class='Delimiter'>], 
</span>            <span class='String'>'a'</span><span class='Delimiter'>, 
</span>            <span class='String'>'{a,b,NULL,c}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        ARRAY<span class='Delimiter'>[ 
</span>            ROW<span class='Parentheses'>( 
</span>                ROW<span class='Parentheses'>(</span>1<span class='Delimiter'>,</span><span class='String'>'a'</span><span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                ARRAY<span class='Delimiter'>[ 
</span>                    ROW<span class='Parentheses'>(</span>1<span class='Delimiter'>,</span><span class='String'>'a'</span><span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t<span class='Delimiter'>, 
</span>                    ROW<span class='Parentheses'>(</span>2<span class='Delimiter'>,</span><span class='String'>'b'</span><span class='Delimiter'>,</span>2<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t<span class='Delimiter'>, 
</span>                    NULL 
                    <span class='Delimiter'>], 
</span>                <span class='String'>'a'</span><span class='Delimiter'>, 
</span>                <span class='String'>'{a,b,c}'</span> 
                <span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_mix_t 
            <span class='Delimiter'>] 
</span>        <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_range 
    INSERT INTO tst_range <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>1<span class='Delimiter'>, </span><span class='String'>'[1, 10]'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>2<span class='Delimiter'>, </span><span class='String'>'[2, 20]'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'[3, 30]'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>4<span class='Delimiter'>, </span><span class='String'>'[4, 40]'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>5<span class='Delimiter'>, </span><span class='String'>'[5, 50]'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>test_tbl_range_array 
    INSERT INTO tst_range_array <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Delimiter'>, </span>c<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>1<span class='Delimiter'>, </span>tstzrange<span class='Parentheses'>(</span><span class='String'>'Mon Aug 04 00:00:00 2014 CEST'</span><span class='Operator'>::</span>timestamptz<span class='Delimiter'>, </span><span class='String'>'infinity'</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>'{"[1,2]", "[10,20]"}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>2<span class='Delimiter'>, </span>tstzrange<span class='Parentheses'>(</span><span class='String'>'Mon Aug 04 00:00:00 2014 CEST'</span><span class='Operator'>::</span>timestamptz <span class='Operator'>- </span>interval <span class='String'>'2 days'</span><span class='Delimiter'>, </span><span class='String'>'Mon Aug 04 00:00:00 2014 CEST'</span><span class='Operator'>::</span>timestamptz<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>'{"[2,3]", "[20,30]"}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>3<span class='Delimiter'>, </span>tstzrange<span class='Parentheses'>(</span><span class='String'>'Mon Aug 04 00:00:00 2014 CEST'</span><span class='Operator'>::</span>timestamptz <span class='Operator'>- </span>interval <span class='String'>'3 days'</span><span class='Delimiter'>, </span><span class='String'>'Mon Aug 04 00:00:00 2014 CEST'</span><span class='Operator'>::</span>timestamptz<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>'{"[3,4]"}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>4<span class='Delimiter'>, </span>tstzrange<span class='Parentheses'>(</span><span class='String'>'Mon Aug 04 00:00:00 2014 CEST'</span><span class='Operator'>::</span>timestamptz <span class='Operator'>- </span>interval <span class='String'>'4 days'</span><span class='Delimiter'>, </span><span class='String'>'Mon Aug 04 00:00:00 2014 CEST'</span><span class='Operator'>::</span>timestamptz<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>'{"[4,5]", NULL, "[40,50]"}'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>5<span class='Delimiter'>, </span>NULL<span class='Delimiter'>, </span>NULL<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>-- </span>tst_hstore 
    INSERT INTO tst_hstore <span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>) </span>VALUES 
        <span class='Parentheses'>(</span>1<span class='Delimiter'>, </span><span class='String'>'"a"=&GT;"1"'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>2<span class='Delimiter'>, </span><span class='String'>'"zzz"=&GT;"foo"'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'"123"=&GT;"321"'</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <span class='Parentheses'>(</span>4<span class='Delimiter'>, </span><span class='String'>'"yellow horse"=&GT;"moaned"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN1221"><span class='Ref_to_Func'>poll_query_until</span></a><span class='Parentheses'>(</span><span class='String'>'postgres'</span><span class='Delimiter'>, </span>$caughtup_query<span class='Parentheses'>) 
</span>  or <span class='Control'>die</span> <span class='String'>"Timed out while waiting for subscriber to catch up"</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Check the data on subscriber 
</span><span class='Keyword'>my </span>$result <span class='Operator'>= </span>$node_subscriber<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN969"><span class='Ref_to_Func'>safe_psql</span></a><span class='Parentheses'>( 
</span>    <span class='String'>'postgres'</span><span class='Delimiter'>, </span><span class='Operator'>qq</span><span class='String'>( 
</span>    SET timezone <span class='Operator'>= </span><span class='String'>'+2'</span><span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_one_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b<span class='Delimiter'>, </span>c<span class='Delimiter'>, </span>d FROM tst_arrays ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_one_enum ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_enums ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_one_comp ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comps ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_enum ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_enum_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_one_enum_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_enum_what ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_mix_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_range ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b<span class='Delimiter'>, </span>c FROM tst_range_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_hstore ORDER BY a<span class='Delimiter'>; 
</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
is<span class='Parentheses'>( </span>$result<span class='Delimiter'>, </span><span class='String'>'1|{1,2,3} 
</span>2<span class='Operator'>|</span><span class='Delimiter'>{</span>2<span class='Delimiter'>,</span>3<span class='Delimiter'>,</span>1<span class='Delimiter'>} 
</span>3<span class='Operator'>|</span><span class='Delimiter'>{</span>3<span class='Delimiter'>,</span>2<span class='Delimiter'>,</span>1<span class='Delimiter'>} 
</span>4<span class='Operator'>|</span><span class='Delimiter'>{</span>4<span class='Delimiter'>,</span>3<span class='Delimiter'>,</span>2<span class='Delimiter'>} 
</span>5<span class='Operator'>|</span><span class='Delimiter'>{</span>5<span class='Delimiter'>,</span>NULL<span class='Delimiter'>,</span>3<span class='Delimiter'>} 
{</span>1<span class='Delimiter'>,</span>2<span class='Delimiter'>,</span>3<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>a<span class='Delimiter'>,</span>b<span class='Delimiter'>,</span>c<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>1<span class='Operator'>.</span>1<span class='Delimiter'>,</span>2<span class='Operator'>.</span>2<span class='Delimiter'>,</span>3<span class='Operator'>.</span>3<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"1 day"</span><span class='Delimiter'>,</span><span class='String'>"2 days"</span><span class='Delimiter'>,</span><span class='String'>"3 days"</span><span class='Delimiter'>} 
{</span>2<span class='Delimiter'>,</span>3<span class='Delimiter'>,</span>1<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>b<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>a<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>2<span class='Operator'>.</span>2<span class='Delimiter'>,</span>3<span class='Operator'>.</span>3<span class='Delimiter'>,</span>1<span class='Operator'>.</span>1<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>00<span class='Operator'>:</span>02<span class='Operator'>:</span>00<span class='Delimiter'>,</span>00<span class='Operator'>:</span>03<span class='Operator'>:</span>00<span class='Delimiter'>,</span>00<span class='Operator'>:</span>01<span class='Operator'>:</span>00<span class='Delimiter'>} 
{</span>3<span class='Delimiter'>,</span>1<span class='Delimiter'>,</span>2<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>c<span class='Delimiter'>,</span>a<span class='Delimiter'>,</span>b<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>3<span class='Operator'>.</span>3<span class='Delimiter'>,</span>1<span class='Operator'>.</span>1<span class='Delimiter'>,</span>2<span class='Operator'>.</span>2<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"3 years"</span><span class='Delimiter'>,</span><span class='String'>"1 year"</span><span class='Delimiter'>,</span><span class='String'>"2 years"</span><span class='Delimiter'>} 
{</span>4<span class='Delimiter'>,</span>1<span class='Delimiter'>,</span>2<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>d<span class='Delimiter'>,</span>a<span class='Delimiter'>,</span>b<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>4<span class='Operator'>.</span>4<span class='Delimiter'>,</span>1<span class='Operator'>.</span>1<span class='Delimiter'>,</span>2<span class='Operator'>.</span>2<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"4 years"</span><span class='Delimiter'>,</span><span class='String'>"1 year"</span><span class='Delimiter'>,</span><span class='String'>"2 years"</span><span class='Delimiter'>} 
{</span>5<span class='Delimiter'>,</span>NULL<span class='Delimiter'>,</span>NULL<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>e<span class='Delimiter'>,</span>NULL<span class='Delimiter'>,</span>b<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>5<span class='Operator'>.</span>5<span class='Delimiter'>,</span>1<span class='Operator'>.</span>1<span class='Delimiter'>,</span>NULL<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"5 years"</span><span class='Delimiter'>,</span>NULL<span class='Delimiter'>,</span>NULL<span class='Delimiter'>} 
</span>1<span class='Operator'>|</span>a 
2<span class='Operator'>|</span>b 
3<span class='Operator'>|</span>c 
4<span class='Operator'>|</span>d 
5<span class='Operator'>| 
</span>a<span class='Operator'>|</span><span class='Delimiter'>{</span>b<span class='Delimiter'>,</span>c<span class='Delimiter'>} 
</span>b<span class='Operator'>|</span><span class='Delimiter'>{</span>c<span class='Delimiter'>,</span>a<span class='Delimiter'>} 
</span>c<span class='Operator'>|</span><span class='Delimiter'>{</span>b<span class='Delimiter'>,</span>a<span class='Delimiter'>} 
</span>d<span class='Operator'>|</span><span class='Delimiter'>{</span>c<span class='Delimiter'>,</span>b<span class='Delimiter'>} 
</span>e<span class='Operator'>|</span><span class='Delimiter'>{</span>d<span class='Delimiter'>,</span>NULL<span class='Delimiter'>} 
</span>1<span class='Operator'>|</span><span class='Parentheses'>(</span>1<span class='Delimiter'>,</span>a<span class='Delimiter'>,</span>1<span class='Parentheses'>) 
</span>2<span class='Operator'>|</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span>b<span class='Delimiter'>,</span>2<span class='Parentheses'>) 
</span>3<span class='Operator'>|</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>3<span class='Parentheses'>) 
</span>4<span class='Operator'>|</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>4<span class='Parentheses'>) 
</span>5<span class='Operator'>|</span><span class='Parentheses'>(</span><span class='Delimiter'>,,</span>5<span class='Parentheses'>) 
(</span>1<span class='Delimiter'>,</span>a<span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(1,a,1)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span>b<span class='Delimiter'>,</span>2<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(2,b,2)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>3<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(3,c,3)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>4<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(4,d,3)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>5<span class='Delimiter'>,</span>e<span class='Delimiter'>,</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span>NULL<span class='Delimiter'>,</span><span class='String'>"(5,,5)"</span><span class='Delimiter'>} 
</span>1<span class='Operator'>|</span><span class='Parentheses'>(</span>1<span class='Delimiter'>,</span>a<span class='Delimiter'>,</span>1<span class='Parentheses'>) 
</span>2<span class='Operator'>|</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span>b<span class='Delimiter'>,</span>2<span class='Parentheses'>) 
</span>3<span class='Operator'>|</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>3<span class='Parentheses'>) 
</span>4<span class='Operator'>|</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>4<span class='Parentheses'>) 
</span>5<span class='Operator'>|</span><span class='Parentheses'>(</span><span class='Delimiter'>,</span>e<span class='Delimiter'>,</span><span class='Parentheses'>) 
(</span>1<span class='Delimiter'>,</span>a<span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(1,a,1)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span>b<span class='Delimiter'>,</span>2<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(2,b,2)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>3<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(3,c,3)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>3<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(3,d,3)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>5<span class='Delimiter'>,</span>e<span class='Delimiter'>,</span>3<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(3,e,3)"</span><span class='Delimiter'>,</span>NULL<span class='Delimiter'>} 
</span>1<span class='Operator'>|</span><span class='Parentheses'>(</span>1<span class='Delimiter'>,</span><span class='String'>"{a,b,c}"</span><span class='Delimiter'>,</span>1<span class='Parentheses'>) 
</span>2<span class='Operator'>|</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span><span class='String'>"{a,b,c}"</span><span class='Delimiter'>,</span>2<span class='Parentheses'>) 
</span>3<span class='Operator'>|</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span><span class='String'>"{a,b,c}"</span><span class='Delimiter'>,</span>3<span class='Parentheses'>) 
</span>4<span class='Operator'>|</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span><span class='String'>"{c,b,d}"</span><span class='Delimiter'>,</span>4<span class='Parentheses'>) 
</span>5<span class='Operator'>|</span><span class='Parentheses'>(</span>5<span class='Delimiter'>,</span><span class='String'>"{NULL,e,NULL}"</span><span class='Delimiter'>,</span>5<span class='Parentheses'>) 
(</span>1<span class='Delimiter'>,</span><span class='String'>"{a,b,c}"</span><span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(1,\"{a,b,c}\",1)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span><span class='String'>"{b,c,a}"</span><span class='Delimiter'>,</span>2<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(2,\"{b,c,a}\",1)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span><span class='String'>"{c,a,b}"</span><span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(3,\"{c,a,b}\",1)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span><span class='String'>"{c,b,d}"</span><span class='Delimiter'>,</span>4<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(4,\"{c,b,d}\",4)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>5<span class='Delimiter'>,</span><span class='String'>"{c,NULL,b}"</span><span class='Delimiter'>,</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(5,\"{c,e,b}\",1)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span><span class='String'>"(1,a,1)"</span><span class='Delimiter'>,</span><span class='String'>"{""(1,a,1)"",""(2,b,2)""}"</span><span class='Delimiter'>,</span>a<span class='Delimiter'>,</span><span class='String'>"{a,b,NULL,c}"</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(\"(1,a,1)\",\"{\"\"(1,a,1)\"\",\"\"(2,b,2)\"\",NULL}\",a,\"{a,b,c}\")"</span><span class='Delimiter'>} 
</span>1<span class='Operator'>|</span><span class='Delimiter'>[</span>1<span class='Delimiter'>,</span>11<span class='Parentheses'>) 
</span>2<span class='Operator'>|</span><span class='Delimiter'>[</span>2<span class='Delimiter'>,</span>21<span class='Parentheses'>) 
</span>3<span class='Operator'>|</span><span class='Delimiter'>[</span>3<span class='Delimiter'>,</span>31<span class='Parentheses'>) 
</span>4<span class='Operator'>|</span><span class='Delimiter'>[</span>4<span class='Delimiter'>,</span>41<span class='Parentheses'>) 
</span>5<span class='Operator'>|</span><span class='Delimiter'>[</span>5<span class='Delimiter'>,</span>51<span class='Parentheses'>) 
</span>1<span class='Operator'>|</span><span class='Delimiter'>[</span><span class='String'>"2014-08-04 00:00:00+02"</span><span class='Delimiter'>,</span>infinity<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"[1,3)"</span><span class='Delimiter'>,</span><span class='String'>"[10,21)"</span><span class='Delimiter'>} 
</span>2<span class='Operator'>|</span><span class='Delimiter'>[</span><span class='String'>"2014-08-02 00:00:00+02"</span><span class='Delimiter'>,</span><span class='String'>"2014-08-04 00:00:00+02"</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"[2,4)"</span><span class='Delimiter'>,</span><span class='String'>"[20,31)"</span><span class='Delimiter'>} 
</span>3<span class='Operator'>|</span><span class='Delimiter'>[</span><span class='String'>"2014-08-01 00:00:00+02"</span><span class='Delimiter'>,</span><span class='String'>"2014-08-04 00:00:00+02"</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"[3,5)"</span><span class='Delimiter'>} 
</span>4<span class='Operator'>|</span><span class='Delimiter'>[</span><span class='String'>"2014-07-31 00:00:00+02"</span><span class='Delimiter'>,</span><span class='String'>"2014-08-04 00:00:00+02"</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"[4,6)"</span><span class='Delimiter'>,</span>NULL<span class='Delimiter'>,</span><span class='String'>"[40,51)"</span><span class='Delimiter'>} 
</span>5<span class='Operator'>|| 
</span>1<span class='Operator'>|</span><span class='String'>"a"</span><span class='Operator'>=&GT;</span><span class='String'>"1"</span> 
2<span class='Operator'>|</span><span class='String'>"zzz"</span><span class='Operator'>=&GT;</span><span class='String'>"foo"</span> 
3<span class='Operator'>|</span><span class='String'>"123"</span><span class='Operator'>=&GT;</span><span class='String'>"321"</span> 
4<span class='Operator'>|</span><span class='String'>"yellow horse"</span><span class='Operator'>=&GT;</span><span class='String'>"moaned"', 
</span>    <span class='String'>'check replicated inserts on subscriber'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Run batch of updates 
</span>$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN969"><span class='Ref_to_Func'>safe_psql</span></a><span class='Parentheses'>(</span> 
    <span class='String'>'postgres'</span><span class='Delimiter'>, </span><span class='Operator'>qq</span><span class='String'>( 
</span>    UPDATE tst_one_array SET b <span class='Operator'>= </span><span class='String'>'{4, 5, 6}'</span> WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    UPDATE tst_one_array SET b <span class='Operator'>= </span><span class='String'>'{4, 5, 6, 1}'</span> WHERE a <span class='Operator'>&GT; </span>3<span class='Delimiter'>; 
</span>    UPDATE tst_arrays SET b <span class='Operator'>= </span><span class='String'>'{"1a", "2b", "3c"}'</span><span class='Delimiter'>, </span>c <span class='Operator'>= </span><span class='String'>'{1.0, 2.0, 3.0}'</span><span class='Delimiter'>, </span>d <span class='Operator'>= </span><span class='String'>'{"1 day 1 second", "2 days 2 seconds", "3 days 3 second"}'</span> WHERE a <span class='Operator'>= </span><span class='String'>'{1, 2, 3}'</span><span class='Delimiter'>; 
</span>    UPDATE tst_arrays SET b <span class='Operator'>= </span><span class='String'>'{"c", "d", "e"}'</span><span class='Delimiter'>, </span>c <span class='Operator'>= </span><span class='String'>'{3.0, 4.0, 5.0}'</span><span class='Delimiter'>, </span>d <span class='Operator'>= </span><span class='String'>'{"3 day 1 second", "4 days 2 seconds", "5 days 3 second"}'</span> WHERE a<span class='Delimiter'>[</span>1<span class='Delimiter'>] </span><span class='Operator'>&GT; </span>3<span class='Delimiter'>; 
</span>    UPDATE tst_one_enum SET b <span class='Operator'>= </span><span class='String'>'c'</span> WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    UPDATE tst_one_enum SET b <span class='Operator'>= </span>NULL WHERE a <span class='Operator'>&GT; </span>3<span class='Delimiter'>; 
</span>    UPDATE tst_enums SET b <span class='Operator'>= </span><span class='String'>'{e, NULL}'</span> WHERE a <span class='Operator'>= </span><span class='String'>'a'</span><span class='Delimiter'>; 
</span>    UPDATE tst_enums SET b <span class='Operator'>= </span><span class='String'>'{e, d}'</span> WHERE a <span class='Operator'>&GT; </span><span class='String'>'c'</span><span class='Delimiter'>; 
</span>    UPDATE tst_one_comp SET b <span class='Operator'>= </span>ROW<span class='Parentheses'>(</span>1<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'A'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>) </span>WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    UPDATE tst_one_comp SET b <span class='Operator'>= </span>ROW<span class='Parentheses'>(</span>NULL<span class='Delimiter'>, </span><span class='String'>'x'</span><span class='Delimiter'>, </span><span class='Operator'>-</span>1<span class='Parentheses'>) </span>WHERE a <span class='Operator'>&GT; </span>3<span class='Delimiter'>; 
</span>    UPDATE tst_comps SET b <span class='Operator'>= </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>9<span class='Delimiter'>, </span><span class='String'>'x'</span><span class='Delimiter'>, </span><span class='Operator'>-</span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t<span class='Delimiter'>] </span>WHERE <span class='Parentheses'>(</span>a<span class='Parentheses'>)</span><span class='Operator'>.</span>a <span class='Operator'>= </span>1<span class='Operator'>.</span>0<span class='Delimiter'>; 
</span>    UPDATE tst_comps SET b <span class='Operator'>= </span>ARRAY<span class='Delimiter'>[</span>NULL<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>9<span class='Delimiter'>, </span><span class='String'>'x'</span><span class='Delimiter'>, </span>NULL<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t<span class='Delimiter'>] </span>WHERE <span class='Parentheses'>(</span>a<span class='Parentheses'>)</span><span class='Operator'>.</span>a <span class='Operator'>&GT; </span>3<span class='Operator'>.</span>9<span class='Delimiter'>; 
</span>    UPDATE tst_comp_enum SET b <span class='Operator'>= </span>ROW<span class='Parentheses'>(</span>1<span class='Operator'>.</span>0<span class='Delimiter'>, </span>NULL<span class='Delimiter'>, </span>NULL<span class='Parentheses'>) </span>WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    UPDATE tst_comp_enum SET b <span class='Operator'>= </span>ROW<span class='Parentheses'>(</span>4<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, </span>44<span class='Parentheses'>) </span>WHERE a <span class='Operator'>&GT; </span>3<span class='Delimiter'>; 
</span>    UPDATE tst_comp_enum_array SET b <span class='Operator'>= </span>ARRAY<span class='Delimiter'>[</span>NULL<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_t<span class='Delimiter'>] </span>WHERE a <span class='Operator'>= </span>ROW<span class='Parentheses'>(</span>1<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'a'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_t<span class='Delimiter'>; 
</span>    UPDATE tst_comp_enum_array SET b <span class='Operator'>= </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>1<span class='Delimiter'>, </span><span class='String'>'a'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_t<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>2<span class='Delimiter'>, </span><span class='String'>'b'</span><span class='Delimiter'>, </span>2<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_t<span class='Delimiter'>] </span>WHERE <span class='Parentheses'>(</span>a<span class='Parentheses'>)</span><span class='Operator'>.</span>a <span class='Operator'>&GT; </span>3<span class='Delimiter'>; 
</span>    UPDATE tst_comp_one_enum_array SET b <span class='Operator'>= </span>ROW<span class='Parentheses'>(</span>1<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{a, e, c}'</span><span class='Delimiter'>, </span>NULL<span class='Parentheses'>) </span>WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    UPDATE tst_comp_one_enum_array SET b <span class='Operator'>= </span>ROW<span class='Parentheses'>(</span>4<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'{c, b, d}'</span><span class='Delimiter'>, </span>4<span class='Parentheses'>) </span>WHERE a <span class='Operator'>&GT; </span>3<span class='Delimiter'>; 
</span>    UPDATE tst_comp_enum_what SET b <span class='Operator'>= </span>ARRAY<span class='Delimiter'>[</span>NULL<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>1<span class='Delimiter'>, </span><span class='String'>'{a, b, c}'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_array_t<span class='Delimiter'>, </span>ROW<span class='Parentheses'>(</span>NULL<span class='Delimiter'>, </span><span class='String'>'{a, e, c}'</span><span class='Delimiter'>, </span>2<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_array_t<span class='Delimiter'>] </span>WHERE <span class='Parentheses'>(</span>a<span class='Parentheses'>)</span><span class='Operator'>.</span>a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    UPDATE tst_comp_enum_what SET b <span class='Operator'>= </span>ARRAY<span class='Delimiter'>[</span>ROW<span class='Parentheses'>(</span>5<span class='Delimiter'>, </span><span class='String'>'{a, b, c}'</span><span class='Delimiter'>, </span>5<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_array_t<span class='Delimiter'>] </span>WHERE <span class='Parentheses'>(</span>a<span class='Parentheses'>)</span><span class='Operator'>.</span>a <span class='Operator'>&GT; </span>3<span class='Delimiter'>; 
</span>    UPDATE tst_comp_mix_array SET b<span class='Delimiter'>[</span>2<span class='Delimiter'>] </span><span class='Operator'>= </span>NULL WHERE <span class='Parentheses'>((</span>a<span class='Parentheses'>)</span><span class='Operator'>.</span>a<span class='Parentheses'>)</span><span class='Operator'>.</span>a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    UPDATE tst_range SET b <span class='Operator'>= </span><span class='String'>'[100, 1000]'</span> WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    UPDATE tst_range SET b <span class='Operator'>= </span><span class='String'>'(1, 90)'</span> WHERE a <span class='Operator'>&GT; </span>3<span class='Delimiter'>; 
</span>    UPDATE tst_range_array SET c <span class='Operator'>= </span><span class='String'>'{"[100, 1000]"}'</span> WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    UPDATE tst_range_array SET b <span class='Operator'>= </span>tstzrange<span class='Parentheses'>(</span><span class='String'>'Mon Aug 04 00:00:00 2014 CEST'</span><span class='Operator'>::</span>timestamptz<span class='Delimiter'>, </span><span class='String'>'infinity'</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span>c <span class='Operator'>= </span><span class='String'>'{NULL, "[11,9999999]"}'</span> WHERE a <span class='Operator'>&GT; </span>3<span class='Delimiter'>; 
</span>    UPDATE tst_hstore SET b <span class='Operator'>= </span><span class='String'>'"updated"=&GT;"value"'</span> WHERE a <span class='Operator'>&LT; </span>3<span class='Delimiter'>; 
</span>    UPDATE tst_hstore SET b <span class='Operator'>= </span><span class='String'>'"also"=&GT;"updated"'</span> WHERE a <span class='Operator'>= </span>3<span class='Delimiter'>; 
</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN1221"><span class='Ref_to_Func'>poll_query_until</span></a><span class='Parentheses'>(</span><span class='String'>'postgres'</span><span class='Delimiter'>, </span>$caughtup_query<span class='Parentheses'>) 
</span>  or <span class='Control'>die</span> <span class='String'>"Timed out while waiting for subscriber to catch up"</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Check the data on subscriber 
</span>$result <span class='Operator'>= </span>$node_subscriber<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN969"><span class='Ref_to_Func'>safe_psql</span></a><span class='Parentheses'>( 
</span>    <span class='String'>'postgres'</span><span class='Delimiter'>, </span><span class='Operator'>qq</span><span class='String'>( 
</span>    SET timezone <span class='Operator'>= </span><span class='String'>'+2'</span><span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_one_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b<span class='Delimiter'>, </span>c<span class='Delimiter'>, </span>d FROM tst_arrays ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_one_enum ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_enums ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_one_comp ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comps ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_enum ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_enum_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_one_enum_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_enum_what ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_mix_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_range ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b<span class='Delimiter'>, </span>c FROM tst_range_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_hstore ORDER BY a<span class='Delimiter'>; 
</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
is<span class='Parentheses'>( </span>$result<span class='Delimiter'>, </span><span class='String'>'1|{4,5,6} 
</span>2<span class='Operator'>|</span><span class='Delimiter'>{</span>2<span class='Delimiter'>,</span>3<span class='Delimiter'>,</span>1<span class='Delimiter'>} 
</span>3<span class='Operator'>|</span><span class='Delimiter'>{</span>3<span class='Delimiter'>,</span>2<span class='Delimiter'>,</span>1<span class='Delimiter'>} 
</span>4<span class='Operator'>|</span><span class='Delimiter'>{</span>4<span class='Delimiter'>,</span>5<span class='Delimiter'>,</span>6<span class='Delimiter'>,</span>1<span class='Delimiter'>} 
</span>5<span class='Operator'>|</span><span class='Delimiter'>{</span>4<span class='Delimiter'>,</span>5<span class='Delimiter'>,</span>6<span class='Delimiter'>,</span>1<span class='Delimiter'>} 
{</span>1<span class='Delimiter'>,</span>2<span class='Delimiter'>,</span>3<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>1a<span class='Delimiter'>,</span>2b<span class='Delimiter'>,</span>3c<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>1<span class='Delimiter'>,</span>2<span class='Delimiter'>,</span>3<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"1 day 00:00:01"</span><span class='Delimiter'>,</span><span class='String'>"2 days 00:00:02"</span><span class='Delimiter'>,</span><span class='String'>"3 days 00:00:03"</span><span class='Delimiter'>} 
{</span>2<span class='Delimiter'>,</span>3<span class='Delimiter'>,</span>1<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>b<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>a<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>2<span class='Operator'>.</span>2<span class='Delimiter'>,</span>3<span class='Operator'>.</span>3<span class='Delimiter'>,</span>1<span class='Operator'>.</span>1<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>00<span class='Operator'>:</span>02<span class='Operator'>:</span>00<span class='Delimiter'>,</span>00<span class='Operator'>:</span>03<span class='Operator'>:</span>00<span class='Delimiter'>,</span>00<span class='Operator'>:</span>01<span class='Operator'>:</span>00<span class='Delimiter'>} 
{</span>3<span class='Delimiter'>,</span>1<span class='Delimiter'>,</span>2<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>c<span class='Delimiter'>,</span>a<span class='Delimiter'>,</span>b<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>3<span class='Operator'>.</span>3<span class='Delimiter'>,</span>1<span class='Operator'>.</span>1<span class='Delimiter'>,</span>2<span class='Operator'>.</span>2<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"3 years"</span><span class='Delimiter'>,</span><span class='String'>"1 year"</span><span class='Delimiter'>,</span><span class='String'>"2 years"</span><span class='Delimiter'>} 
{</span>4<span class='Delimiter'>,</span>1<span class='Delimiter'>,</span>2<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>c<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>e<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>3<span class='Delimiter'>,</span>4<span class='Delimiter'>,</span>5<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"3 days 00:00:01"</span><span class='Delimiter'>,</span><span class='String'>"4 days 00:00:02"</span><span class='Delimiter'>,</span><span class='String'>"5 days 00:00:03"</span><span class='Delimiter'>} 
{</span>5<span class='Delimiter'>,</span>NULL<span class='Delimiter'>,</span>NULL<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>c<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>e<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>3<span class='Delimiter'>,</span>4<span class='Delimiter'>,</span>5<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"3 days 00:00:01"</span><span class='Delimiter'>,</span><span class='String'>"4 days 00:00:02"</span><span class='Delimiter'>,</span><span class='String'>"5 days 00:00:03"</span><span class='Delimiter'>} 
</span>1<span class='Operator'>|</span>c 
2<span class='Operator'>|</span>b 
3<span class='Operator'>|</span>c 
4<span class='Operator'>| 
</span>5<span class='Operator'>| 
</span>a<span class='Operator'>|</span><span class='Delimiter'>{</span>e<span class='Delimiter'>,</span>NULL<span class='Delimiter'>} 
</span>b<span class='Operator'>|</span><span class='Delimiter'>{</span>c<span class='Delimiter'>,</span>a<span class='Delimiter'>} 
</span>c<span class='Operator'>|</span><span class='Delimiter'>{</span>b<span class='Delimiter'>,</span>a<span class='Delimiter'>} 
</span>d<span class='Operator'>|</span><span class='Delimiter'>{</span>e<span class='Delimiter'>,</span>d<span class='Delimiter'>} 
</span>e<span class='Operator'>|</span><span class='Delimiter'>{</span>e<span class='Delimiter'>,</span>d<span class='Delimiter'>} 
</span>1<span class='Operator'>|</span><span class='Parentheses'>(</span>1<span class='Delimiter'>,</span>A<span class='Delimiter'>,</span>1<span class='Parentheses'>) 
</span>2<span class='Operator'>|</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span>b<span class='Delimiter'>,</span>2<span class='Parentheses'>) 
</span>3<span class='Operator'>|</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>3<span class='Parentheses'>) 
</span>4<span class='Operator'>|</span><span class='Parentheses'>(</span><span class='Delimiter'>,</span>x<span class='Delimiter'>,</span><span class='Operator'>-</span>1<span class='Parentheses'>) 
</span>5<span class='Operator'>|</span><span class='Parentheses'>(</span><span class='Delimiter'>,</span>x<span class='Delimiter'>,</span><span class='Operator'>-</span>1<span class='Parentheses'>) 
(</span>1<span class='Delimiter'>,</span>a<span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(9,x,-1)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span>b<span class='Delimiter'>,</span>2<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(2,b,2)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>3<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(3,c,3)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>4<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span>NULL<span class='Delimiter'>,</span><span class='String'>"(9,x,)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>5<span class='Delimiter'>,</span>e<span class='Delimiter'>,</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span>NULL<span class='Delimiter'>,</span><span class='String'>"(9,x,)"</span><span class='Delimiter'>} 
</span>1<span class='Operator'>|</span><span class='Parentheses'>(</span>1<span class='Delimiter'>,,</span><span class='Parentheses'>) 
</span>2<span class='Operator'>|</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span>b<span class='Delimiter'>,</span>2<span class='Parentheses'>) 
</span>3<span class='Operator'>|</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>3<span class='Parentheses'>) 
</span>4<span class='Operator'>|</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>44<span class='Parentheses'>) 
</span>5<span class='Operator'>|</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>44<span class='Parentheses'>) 
(</span>1<span class='Delimiter'>,</span>a<span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span>NULL<span class='Delimiter'>,</span><span class='String'>"(3,d,3)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span>b<span class='Delimiter'>,</span>2<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(2,b,2)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>3<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(3,c,3)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>3<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(1,a,1)"</span><span class='Delimiter'>,</span><span class='String'>"(2,b,2)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>5<span class='Delimiter'>,</span>e<span class='Delimiter'>,</span>3<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(1,a,1)"</span><span class='Delimiter'>,</span><span class='String'>"(2,b,2)"</span><span class='Delimiter'>} 
</span>1<span class='Operator'>|</span><span class='Parentheses'>(</span>1<span class='Delimiter'>,</span><span class='String'>"{a,e,c}"</span><span class='Delimiter'>,</span><span class='Parentheses'>) 
</span>2<span class='Operator'>|</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span><span class='String'>"{a,b,c}"</span><span class='Delimiter'>,</span>2<span class='Parentheses'>) 
</span>3<span class='Operator'>|</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span><span class='String'>"{a,b,c}"</span><span class='Delimiter'>,</span>3<span class='Parentheses'>) 
</span>4<span class='Operator'>|</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span><span class='String'>"{c,b,d}"</span><span class='Delimiter'>,</span>4<span class='Parentheses'>) 
</span>5<span class='Operator'>|</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span><span class='String'>"{c,b,d}"</span><span class='Delimiter'>,</span>4<span class='Parentheses'>) 
(</span>1<span class='Delimiter'>,</span><span class='String'>"{a,b,c}"</span><span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span>NULL<span class='Delimiter'>,</span><span class='String'>"(1,\"{a,b,c}\",1)"</span><span class='Delimiter'>,</span><span class='String'>"(,\"{a,e,c}\",2)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>2<span class='Delimiter'>,</span><span class='String'>"{b,c,a}"</span><span class='Delimiter'>,</span>2<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(2,\"{b,c,a}\",1)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span><span class='String'>"{c,a,b}"</span><span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(3,\"{c,a,b}\",1)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span><span class='String'>"{c,b,d}"</span><span class='Delimiter'>,</span>4<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(5,\"{a,b,c}\",5)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>5<span class='Delimiter'>,</span><span class='String'>"{c,NULL,b}"</span><span class='Delimiter'>,</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(5,\"{a,b,c}\",5)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span><span class='String'>"(1,a,1)"</span><span class='Delimiter'>,</span><span class='String'>"{""(1,a,1)"",""(2,b,2)""}"</span><span class='Delimiter'>,</span>a<span class='Delimiter'>,</span><span class='String'>"{a,b,NULL,c}"</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(\"(1,a,1)\",\"{\"\"(1,a,1)\"\",\"\"(2,b,2)\"\",NULL}\",a,\"{a,b,c}\")"</span><span class='Delimiter'>,</span>NULL<span class='Delimiter'>} 
</span>1<span class='Operator'>|</span><span class='Delimiter'>[</span>100<span class='Delimiter'>,</span>1001<span class='Parentheses'>) 
</span>2<span class='Operator'>|</span><span class='Delimiter'>[</span>2<span class='Delimiter'>,</span>21<span class='Parentheses'>) 
</span>3<span class='Operator'>|</span><span class='Delimiter'>[</span>3<span class='Delimiter'>,</span>31<span class='Parentheses'>) 
</span>4<span class='Operator'>|</span><span class='Delimiter'>[</span>2<span class='Delimiter'>,</span>90<span class='Parentheses'>) 
</span>5<span class='Operator'>|</span><span class='Delimiter'>[</span>2<span class='Delimiter'>,</span>90<span class='Parentheses'>) 
</span>1<span class='Operator'>|</span><span class='Delimiter'>[</span><span class='String'>"2014-08-04 00:00:00+02"</span><span class='Delimiter'>,</span>infinity<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"[100,1001)"</span><span class='Delimiter'>} 
</span>2<span class='Operator'>|</span><span class='Delimiter'>[</span><span class='String'>"2014-08-02 00:00:00+02"</span><span class='Delimiter'>,</span><span class='String'>"2014-08-04 00:00:00+02"</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"[2,4)"</span><span class='Delimiter'>,</span><span class='String'>"[20,31)"</span><span class='Delimiter'>} 
</span>3<span class='Operator'>|</span><span class='Delimiter'>[</span><span class='String'>"2014-08-01 00:00:00+02"</span><span class='Delimiter'>,</span><span class='String'>"2014-08-04 00:00:00+02"</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"[3,5)"</span><span class='Delimiter'>} 
</span>4<span class='Operator'>|</span><span class='Delimiter'>[</span><span class='String'>"2014-08-04 00:00:00+02"</span><span class='Delimiter'>,</span>infinity<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span>NULL<span class='Delimiter'>,</span><span class='String'>"[11,10000000)"</span><span class='Delimiter'>} 
</span>5<span class='Operator'>|</span><span class='Delimiter'>[</span><span class='String'>"2014-08-04 00:00:00+02"</span><span class='Delimiter'>,</span>infinity<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span>NULL<span class='Delimiter'>,</span><span class='String'>"[11,10000000)"</span><span class='Delimiter'>} 
</span>1<span class='Operator'>|</span><span class='String'>"updated"</span><span class='Operator'>=&GT;</span><span class='String'>"value"</span> 
2<span class='Operator'>|</span><span class='String'>"updated"</span><span class='Operator'>=&GT;</span><span class='String'>"value"</span> 
3<span class='Operator'>|</span><span class='String'>"also"</span><span class='Operator'>=&GT;</span><span class='String'>"updated"</span> 
4<span class='Operator'>|</span><span class='String'>"yellow horse"</span><span class='Operator'>=&GT;</span><span class='String'>"moaned"', 
</span>    <span class='String'>'check replicated updates on subscriber'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Run batch of deletes 
</span>$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN969"><span class='Ref_to_Func'>safe_psql</span></a><span class='Parentheses'>(</span> 
    <span class='String'>'postgres'</span><span class='Delimiter'>, </span><span class='Operator'>qq</span><span class='String'>( 
</span>    DELETE FROM tst_one_array WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    DELETE FROM tst_one_array WHERE b <span class='Operator'>= </span><span class='String'>'{2, 3, 1}'</span><span class='Delimiter'>; 
</span>    DELETE FROM tst_arrays WHERE a <span class='Operator'>= </span><span class='String'>'{1, 2, 3}'</span><span class='Delimiter'>; 
</span>    DELETE FROM tst_arrays WHERE a<span class='Delimiter'>[</span>1<span class='Delimiter'>] </span><span class='Operator'>= </span>2<span class='Delimiter'>; 
</span>    DELETE FROM tst_one_enum WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    DELETE FROM tst_one_enum WHERE b <span class='Operator'>= </span><span class='String'>'b'</span><span class='Delimiter'>; 
</span>    DELETE FROM tst_enums WHERE a <span class='Operator'>= </span><span class='String'>'a'</span><span class='Delimiter'>; 
</span>    DELETE FROM tst_enums WHERE b<span class='Delimiter'>[</span>1<span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'b'</span><span class='Delimiter'>; 
</span>    DELETE FROM tst_one_comp WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    DELETE FROM tst_one_comp WHERE <span class='Parentheses'>(</span>b<span class='Parentheses'>)</span><span class='Operator'>.</span>a <span class='Operator'>= </span>2<span class='Operator'>.</span>0<span class='Delimiter'>; 
</span>    DELETE FROM tst_comps WHERE <span class='Parentheses'>(</span>a<span class='Parentheses'>)</span><span class='Operator'>.</span>b <span class='Operator'>= </span><span class='String'>'a'</span><span class='Delimiter'>; 
</span>    DELETE FROM tst_comps WHERE ROW<span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_basic_t <span class='Operator'>= </span>ANY<span class='Parentheses'>(</span>b<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    DELETE FROM tst_comp_enum WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    DELETE FROM tst_comp_enum WHERE <span class='Parentheses'>(</span>b<span class='Parentheses'>)</span><span class='Operator'>.</span>a <span class='Operator'>= </span>2<span class='Operator'>.</span>0<span class='Delimiter'>; 
</span>    DELETE FROM tst_comp_enum_array WHERE a <span class='Operator'>= </span>ROW<span class='Parentheses'>(</span>1<span class='Operator'>.</span>0<span class='Delimiter'>, </span><span class='String'>'a'</span><span class='Delimiter'>, </span>1<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_t<span class='Delimiter'>; 
</span>    DELETE FROM tst_comp_enum_array WHERE ROW<span class='Parentheses'>(</span>3<span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>, </span>3<span class='Parentheses'>)</span><span class='Operator'>::</span>tst_comp_enum_t <span class='Operator'>= </span>ANY<span class='Parentheses'>(</span>b<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    DELETE FROM tst_comp_one_enum_array WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    DELETE FROM tst_comp_one_enum_array WHERE <span class='String'>'a'</span> <span class='Operator'>= </span>ANY<span class='Parentheses'>((</span>b<span class='Parentheses'>)</span><span class='Operator'>.</span>b<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    DELETE FROM tst_comp_enum_what WHERE <span class='Parentheses'>(</span>a<span class='Parentheses'>)</span><span class='Operator'>.</span>a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    DELETE FROM tst_comp_enum_what WHERE <span class='Parentheses'>(</span>b<span class='Delimiter'>[</span>1<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Operator'>.</span>b <span class='Operator'>= </span><span class='String'>'{c, a, b}'</span><span class='Delimiter'>; 
</span>    DELETE FROM tst_comp_mix_array WHERE <span class='Parentheses'>((</span>a<span class='Parentheses'>)</span><span class='Operator'>.</span>a<span class='Parentheses'>)</span><span class='Operator'>.</span>a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    DELETE FROM tst_range WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    DELETE FROM tst_range WHERE <span class='String'>'[10,20]'</span> <span class='Operator'>&& </span>b<span class='Delimiter'>; 
</span>    DELETE FROM tst_range_array WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    DELETE FROM tst_range_array WHERE tstzrange<span class='Parentheses'>(</span><span class='String'>'Mon Aug 04 00:00:00 2014 CEST'</span><span class='Operator'>::</span>timestamptz<span class='Delimiter'>, </span><span class='String'>'Mon Aug 05 00:00:00 2014 CEST'</span><span class='Operator'>::</span>timestamptz<span class='Parentheses'>)</span> <span class='Operator'>&& </span>b<span class='Delimiter'>; 
</span>    DELETE FROM tst_hstore WHERE a <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN1221"><span class='Ref_to_Func'>poll_query_until</span></a><span class='Parentheses'>(</span><span class='String'>'postgres'</span><span class='Delimiter'>, </span>$caughtup_query<span class='Parentheses'>) 
</span>  or <span class='Control'>die</span> <span class='String'>"Timed out while waiting for subscriber to catch up"</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># Check the data on subscriber 
</span>$result <span class='Operator'>= </span>$node_subscriber<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN969"><span class='Ref_to_Func'>safe_psql</span></a><span class='Parentheses'>( 
</span>    <span class='String'>'postgres'</span><span class='Delimiter'>, </span><span class='Operator'>qq</span><span class='String'>( 
</span>    SET timezone <span class='Operator'>= </span><span class='String'>'+2'</span><span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_one_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b<span class='Delimiter'>, </span>c<span class='Delimiter'>, </span>d FROM tst_arrays ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_one_enum ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_enums ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_one_comp ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comps ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_enum ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_enum_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_one_enum_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_enum_what ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_comp_mix_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_range ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b<span class='Delimiter'>, </span>c FROM tst_range_array ORDER BY a<span class='Delimiter'>; 
</span>    SELECT a<span class='Delimiter'>, </span>b FROM tst_hstore ORDER BY a<span class='Delimiter'>; 
</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
is<span class='Parentheses'>(</span> $result<span class='Delimiter'>, </span><span class='String'>'3|{3,2,1} 
</span>4<span class='Operator'>|</span><span class='Delimiter'>{</span>4<span class='Delimiter'>,</span>5<span class='Delimiter'>,</span>6<span class='Delimiter'>,</span>1<span class='Delimiter'>} 
</span>5<span class='Operator'>|</span><span class='Delimiter'>{</span>4<span class='Delimiter'>,</span>5<span class='Delimiter'>,</span>6<span class='Delimiter'>,</span>1<span class='Delimiter'>} 
{</span>3<span class='Delimiter'>,</span>1<span class='Delimiter'>,</span>2<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>c<span class='Delimiter'>,</span>a<span class='Delimiter'>,</span>b<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>3<span class='Operator'>.</span>3<span class='Delimiter'>,</span>1<span class='Operator'>.</span>1<span class='Delimiter'>,</span>2<span class='Operator'>.</span>2<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"3 years"</span><span class='Delimiter'>,</span><span class='String'>"1 year"</span><span class='Delimiter'>,</span><span class='String'>"2 years"</span><span class='Delimiter'>} 
{</span>4<span class='Delimiter'>,</span>1<span class='Delimiter'>,</span>2<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>c<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>e<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>3<span class='Delimiter'>,</span>4<span class='Delimiter'>,</span>5<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"3 days 00:00:01"</span><span class='Delimiter'>,</span><span class='String'>"4 days 00:00:02"</span><span class='Delimiter'>,</span><span class='String'>"5 days 00:00:03"</span><span class='Delimiter'>} 
{</span>5<span class='Delimiter'>,</span>NULL<span class='Delimiter'>,</span>NULL<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>c<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>e<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span>3<span class='Delimiter'>,</span>4<span class='Delimiter'>,</span>5<span class='Delimiter'>}</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"3 days 00:00:01"</span><span class='Delimiter'>,</span><span class='String'>"4 days 00:00:02"</span><span class='Delimiter'>,</span><span class='String'>"5 days 00:00:03"</span><span class='Delimiter'>} 
</span>3<span class='Operator'>|</span>c 
4<span class='Operator'>| 
</span>5<span class='Operator'>| 
</span>b<span class='Operator'>|</span><span class='Delimiter'>{</span>c<span class='Delimiter'>,</span>a<span class='Delimiter'>} 
</span>d<span class='Operator'>|</span><span class='Delimiter'>{</span>e<span class='Delimiter'>,</span>d<span class='Delimiter'>} 
</span>e<span class='Operator'>|</span><span class='Delimiter'>{</span>e<span class='Delimiter'>,</span>d<span class='Delimiter'>} 
</span>3<span class='Operator'>|</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>3<span class='Parentheses'>) 
</span>4<span class='Operator'>|</span><span class='Parentheses'>(</span><span class='Delimiter'>,</span>x<span class='Delimiter'>,</span><span class='Operator'>-</span>1<span class='Parentheses'>) 
</span>5<span class='Operator'>|</span><span class='Parentheses'>(</span><span class='Delimiter'>,</span>x<span class='Delimiter'>,</span><span class='Operator'>-</span>1<span class='Parentheses'>) 
(</span>2<span class='Delimiter'>,</span>b<span class='Delimiter'>,</span>2<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(2,b,2)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>4<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span>NULL<span class='Delimiter'>,</span><span class='String'>"(9,x,)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>5<span class='Delimiter'>,</span>e<span class='Delimiter'>,</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span>NULL<span class='Delimiter'>,</span><span class='String'>"(9,x,)"</span><span class='Delimiter'>} 
</span>3<span class='Operator'>|</span><span class='Parentheses'>(</span>3<span class='Delimiter'>,</span>c<span class='Delimiter'>,</span>3<span class='Parentheses'>) 
</span>4<span class='Operator'>|</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>44<span class='Parentheses'>) 
</span>5<span class='Operator'>|</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>44<span class='Parentheses'>) 
(</span>2<span class='Delimiter'>,</span>b<span class='Delimiter'>,</span>2<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(2,b,2)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span>d<span class='Delimiter'>,</span>3<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(1,a,1)"</span><span class='Delimiter'>,</span><span class='String'>"(2,b,2)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>5<span class='Delimiter'>,</span>e<span class='Delimiter'>,</span>3<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(1,a,1)"</span><span class='Delimiter'>,</span><span class='String'>"(2,b,2)"</span><span class='Delimiter'>} 
</span>4<span class='Operator'>|</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span><span class='String'>"{c,b,d}"</span><span class='Delimiter'>,</span>4<span class='Parentheses'>) 
</span>5<span class='Operator'>|</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span><span class='String'>"{c,b,d}"</span><span class='Delimiter'>,</span>4<span class='Parentheses'>) 
(</span>2<span class='Delimiter'>,</span><span class='String'>"{b,c,a}"</span><span class='Delimiter'>,</span>2<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(2,\"{b,c,a}\",1)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>4<span class='Delimiter'>,</span><span class='String'>"{c,b,d}"</span><span class='Delimiter'>,</span>4<span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(5,\"{a,b,c}\",5)"</span><span class='Delimiter'>} 
</span><span class='Parentheses'>(</span>5<span class='Delimiter'>,</span><span class='String'>"{c,NULL,b}"</span><span class='Delimiter'>,</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"(5,\"{a,b,c}\",5)"</span><span class='Delimiter'>} 
</span>2<span class='Operator'>|</span><span class='Delimiter'>[</span><span class='String'>"2014-08-02 00:00:00+02"</span><span class='Delimiter'>,</span><span class='String'>"2014-08-04 00:00:00+02"</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"[2,4)"</span><span class='Delimiter'>,</span><span class='String'>"[20,31)"</span><span class='Delimiter'>} 
</span>3<span class='Operator'>|</span><span class='Delimiter'>[</span><span class='String'>"2014-08-01 00:00:00+02"</span><span class='Delimiter'>,</span><span class='String'>"2014-08-04 00:00:00+02"</span><span class='Parentheses'>)</span><span class='Operator'>|</span><span class='Delimiter'>{</span><span class='String'>"[3,5)"</span><span class='Delimiter'>} 
</span>2<span class='Operator'>|</span><span class='String'>"updated"</span><span class='Operator'>=&GT;</span><span class='String'>"value"</span> 
3<span class='Operator'>|</span><span class='String'>"also"</span><span class='Operator'>=&GT;</span><span class='String'>"updated"</span> 
4<span class='Operator'>|</span><span class='String'>"yellow horse"</span><span class='Operator'>=&GT;</span><span class='String'>"moaned"', 
</span>    <span class='String'>'check replicated deletes on subscriber'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
$node_subscriber<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN683"><span class='Ref_to_Func'>stop</span></a><span class='Parentheses'>(</span><span class='String'>'fast'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>$node_publisher<span class='Operator'>-&GT;</span><a href="../../perl/PostgresNode.pm.html#LN683"><span class='Ref_to_Func'>stop</span></a><span class='Parentheses'>(</span><span class='String'>'fast'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>