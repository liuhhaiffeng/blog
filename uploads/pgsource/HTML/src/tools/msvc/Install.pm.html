<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\tools\msvc\Install.pm</title>
<LINK REL=StyleSheet HREF="../../../Perl_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\tools\msvc\Install.pm</b></p></td>
<td align='right'>
Wed Jun 14 08:26:15 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Keyword'>package </span><a href="Install.pm.html#LN44"><span class='Ref_to_Func'>Install</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># 
# Package that provides 'make install' functionality for msvc builds 
# 
# src/tools/msvc/Install.pm 
# 
</span><span class='Control'>use</span> strict<span class='Delimiter'>; 
</span><span class='Control'>use</span> warnings<span class='Delimiter'>; 
</span><span class='Control'>use</span> Carp<span class='Delimiter'>; 
</span><span class='Control'>use</span> File<span class='Operator'>::</span>Basename<span class='Delimiter'>; 
</span><span class='Control'>use</span> File<span class='Operator'>::</span>Copy<span class='Delimiter'>; 
</span><span class='Control'>use</span> File<span class='Operator'>::</span>Find <span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
<span class='Control'>use</span> Exporter<span class='Delimiter'>; 
</span><span class='Keyword'>our </span><span class='Parentheses'>(</span>@ISA<span class='Delimiter'>, </span>@EXPORT_OK<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>@ISA       <span class='Operator'>= </span><span class='Keyword'>qw</span><span class='String'>(Exporter)</span><span class='Delimiter'>; 
</span>@EXPORT_OK <span class='Operator'>= </span><span class='Keyword'>qw</span><span class='String'>(Install)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>my </span>$insttype<span class='Delimiter'>; 
</span><span class='Keyword'>my </span>@client_contribs <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>'oid2name'</span><span class='Delimiter'>, </span><span class='String'>'pgbench'</span><span class='Delimiter'>, </span><span class='String'>'vacuumlo'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Keyword'>my </span>@client_program_files <span class='Operator'>= </span><span class='Parentheses'>( 
</span>    <span class='String'>'clusterdb'</span><span class='Delimiter'>,</span>      <span class='String'>'createdb'</span><span class='Delimiter'>,</span>   <span class='String'>'createuser'</span><span class='Delimiter'>,</span>    <span class='String'>'dropdb'</span><span class='Delimiter'>, 
</span>    <span class='String'>'dropuser'</span><span class='Delimiter'>,</span>       <span class='String'>'ecpg'</span><span class='Delimiter'>,</span>       <span class='String'>'libecpg'</span><span class='Delimiter'>,</span>       <span class='String'>'libecpg_compat'</span><span class='Delimiter'>, 
</span>    <span class='String'>'libpgtypes'</span><span class='Delimiter'>,</span>     <span class='String'>'libpq'</span><span class='Delimiter'>,</span>      <span class='String'>'pg_basebackup'</span><span class='Delimiter'>, </span><span class='String'>'pg_config'</span><span class='Delimiter'>, 
</span>    <span class='String'>'pg_dump'</span><span class='Delimiter'>,</span>        <span class='String'>'pg_dumpall'</span><span class='Delimiter'>, </span><span class='String'>'pg_isready'</span><span class='Delimiter'>,</span>    <span class='String'>'pg_receivewal'</span><span class='Delimiter'>, 
</span>    <span class='String'>'pg_recvlogical'</span><span class='Delimiter'>, </span><span class='String'>'pg_restore'</span><span class='Delimiter'>, </span><span class='String'>'psql'</span><span class='Delimiter'>,</span>          <span class='String'>'reindexdb'</span><span class='Delimiter'>, 
</span>    <span class='String'>'vacuumdb'</span><span class='Delimiter'>,</span>       @client_contribs<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN29"></a><span class='Control'>sub</span> <span class='Declare_Function'>lcopy</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$src    <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$target <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>f $target<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>unlink </span>$target <span class='Operator'>|| </span>confess <span class='String'>"Could not delete $target\n"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    copy<span class='Parentheses'>(</span>$src<span class='Delimiter'>, </span>$target<span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span>confess <span class='String'>"Could not copy $src to $target\n"</span><span class='Delimiter'>; 
</span> 
<span class='Delimiter'>} 
</span> 
<a name="LN44"></a><span class='Control'>sub</span> <span class='Declare_Function'>Install</span> 
<span class='Delimiter'>{ 
</span>    $<span class='Operator'>| = </span>1<span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>$target <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    $insttype <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    $insttype <span class='Operator'>= </span><span class='String'>"all"</span> <span class='Control'>unless</span> <span class='Parentheses'>(</span>$insttype<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># if called from vcregress, the config will be passed to us 
</span>    <span class='Comment_Single_Line'># so no need to re-include these 
</span>    <span class='Keyword'>our </span>$config <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Control'>unless</span> <span class='Parentheses'>(</span>$config<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span> 
        <span class='Comment_Single_Line'># suppress warning about harmless redeclaration of $config 
</span>        <span class='Keyword'>no </span>warnings <span class='String'>'misc'</span><span class='Delimiter'>; 
</span>        <span class='Control'>do</span> <span class='String'>"config_default.pl"</span><span class='Delimiter'>; 
</span>        <span class='Control'>do</span> <span class='String'>"config.pl"</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>f <span class='String'>"config.pl"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Keyword'>chdir</span><span class='Parentheses'>(</span><span class='String'>"../../.."</span><span class='Parentheses'>)</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>f <span class='String'>"../../../configure"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>chdir</span><span class='Parentheses'>(</span><span class='String'>"../../../.."</span><span class='Parentheses'>) </span><span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>f <span class='String'>"../../../../configure"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$conf <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>d <span class='String'>"debug"</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $conf <span class='Operator'>= </span><span class='String'>"debug"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>d <span class='String'>"release"</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $conf <span class='Operator'>= </span><span class='String'>"release"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>die</span> <span class='String'>"Could not find debug or release binaries"</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$conf <span class='Operator'>eq </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$majorver <span class='Operator'>= </span>DetermineMajorVersion<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"Installing version $majorver for $conf in $target\n"</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>@client_dirs <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>'bin'</span><span class='Delimiter'>, </span><span class='String'>'lib'</span><span class='Delimiter'>, </span><span class='String'>'share'</span><span class='Delimiter'>, </span><span class='String'>'symbols'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@all_dirs <span class='Operator'>= </span><span class='Parentheses'>( 
</span>        @client_dirs<span class='Delimiter'>, </span><span class='String'>'doc'</span><span class='Delimiter'>, </span><span class='String'>'doc/contrib'</span><span class='Delimiter'>, </span><span class='String'>'doc/extension'</span><span class='Delimiter'>, </span><span class='String'>'share/contrib'</span><span class='Delimiter'>, 
</span>        <span class='String'>'share/extension'</span><span class='Delimiter'>, </span><span class='String'>'share/timezonesets'</span><span class='Delimiter'>, </span><span class='String'>'share/tsearch_data'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$insttype <span class='Operator'>eq </span><span class='String'>"client"</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="Install.pm.html#LN172"><span class='Ref_to_Func'>EnsureDirectories</span></a><span class='Parentheses'>(</span>$target<span class='Delimiter'>, </span>@client_dirs<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="Install.pm.html#LN172"><span class='Ref_to_Func'>EnsureDirectories</span></a><span class='Parentheses'>(</span>$target<span class='Delimiter'>, </span>@all_dirs<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="Install.pm.html#LN214"><span class='Ref_to_Func'>CopySolutionOutput</span></a><span class='Parentheses'>(</span>$conf<span class='Delimiter'>, </span>$target<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$sample_files <span class='Operator'>= </span><span class='Delimiter'>[]; 
</span>    <span class='Keyword'>my </span>@top_dir      <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>"src"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    @top_dir <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>"src\\bin"</span><span class='Delimiter'>, </span><span class='String'>"src\\interfaces"</span><span class='Parentheses'>) </span><span class='Control'>if</span> <span class='Parentheses'>(</span>$insttype <span class='Operator'>eq </span><span class='String'>"client"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    File<span class='Operator'>::</span>Find<span class='Operator'>::</span>find<span class='Parentheses'>(</span> 
        <span class='Delimiter'>{</span>   <a href="../copyright.pl.html#LN29"><span class='Ref_to_Func'>wanted</span></a> <span class='Operator'>=&GT; </span><span class='Control'>sub</span> <span class='Delimiter'>{ 
</span>                <span class='Operator'>/^.*\.sample\z/</span>s 
                  <span class='Operator'>&& </span><span class='Keyword'>push</span><span class='Parentheses'>(</span>@$sample_files<span class='Delimiter'>, </span>$File<span class='Operator'>::</span>Find<span class='Operator'>::</span><a href="../../test/perl/PostgresNode.pm.html#LN216"><span class='Ref_to_Func'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Single_Line'># Don't find files of in-tree temporary installations. 
</span>                $_ <span class='Operator'>eq </span><span class='String'>'share'</span> and $File<span class='Operator'>::</span>Find<span class='Operator'>::</span>prune <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>              <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}, 
</span>        @top_dir<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN199"><span class='Ref_to_Func'>CopySetOfFiles</span></a><span class='Parentheses'>(</span><span class='String'>'config files'</span><span class='Delimiter'>, </span>$sample_files<span class='Delimiter'>, </span>$target <span class='Operator'>. </span><span class='String'>'/share/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>        <span class='String'>'Import libraries'</span><span class='Delimiter'>, 
</span>        $target <span class='Operator'>. </span><span class='String'>'/lib/'</span><span class='Delimiter'>, 
</span>        <span class='String'>"$conf\\"</span><span class='Delimiter'>, </span><span class='String'>"postgres\\postgres.lib"</span><span class='Delimiter'>, </span><span class='String'>"libpgcommon\\libpgcommon.lib"</span><span class='Delimiter'>, 
</span>        <span class='String'>"libpgport\\libpgport.lib"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CopyContribFiles<span class='Parentheses'>(</span>$config<span class='Delimiter'>, </span>$target<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    CopyIncludeFiles<span class='Parentheses'>(</span>$target<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>$insttype <span class='Operator'>ne </span><span class='String'>"client"</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="Install.pm.html#LN199"><span class='Ref_to_Func'>CopySetOfFiles</span></a><span class='Parentheses'>(</span> 
            <span class='String'>'timezone names'</span><span class='Delimiter'>, 
</span>            <span class='Delimiter'>[ </span><span class='Keyword'>glob</span><span class='Parentheses'>(</span><span class='String'>'src\timezone\tznames\*.txt'</span><span class='Parentheses'>) </span><span class='Delimiter'>], 
</span>            $target <span class='Operator'>. </span><span class='String'>'/share/timezonesets/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>            <span class='String'>'timezone sets'</span><span class='Delimiter'>, 
</span>            $target <span class='Operator'>. </span><span class='String'>'/share/timezonesets/'</span><span class='Delimiter'>, 
</span>            <span class='String'>'src/timezone/tznames/'</span><span class='Delimiter'>, </span><span class='String'>'Default'</span><span class='Delimiter'>, </span><span class='String'>'Australia'</span><span class='Delimiter'>, </span><span class='String'>'India'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="Install.pm.html#LN199"><span class='Ref_to_Func'>CopySetOfFiles</span></a><span class='Parentheses'>(</span> 
            <span class='String'>'BKI files'</span><span class='Delimiter'>, 
</span>            <span class='Delimiter'>[ </span><span class='Keyword'>glob</span><span class='Parentheses'>(</span><span class='String'>"src\\backend\\catalog\\postgres.*"</span><span class='Parentheses'>) </span><span class='Delimiter'>], 
</span>            $target <span class='Operator'>. </span><span class='String'>'/share/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="Install.pm.html#LN199"><span class='Ref_to_Func'>CopySetOfFiles</span></a><span class='Parentheses'>(</span> 
            <span class='String'>'SQL files'</span><span class='Delimiter'>, 
</span>            <span class='Delimiter'>[ </span><span class='Keyword'>glob</span><span class='Parentheses'>(</span><span class='String'>"src\\backend\\catalog\\*.sql"</span><span class='Parentheses'>) </span><span class='Delimiter'>], 
</span>            $target <span class='Operator'>. </span><span class='String'>'/share/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>            <span class='String'>'Information schema data'</span><span class='Delimiter'>, </span>$target <span class='Operator'>. </span><span class='String'>'/share/'</span><span class='Delimiter'>, 
</span>            <span class='String'>'src/backend/catalog/'</span><span class='Delimiter'>,</span>    <span class='String'>'sql_features.txt'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        GenerateConversionScript<span class='Parentheses'>(</span>$target<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        GenerateTimezoneFiles<span class='Parentheses'>(</span>$target<span class='Delimiter'>, </span>$conf<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        GenerateTsearchFiles<span class='Parentheses'>(</span>$target<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="Install.pm.html#LN199"><span class='Ref_to_Func'>CopySetOfFiles</span></a><span class='Parentheses'>(</span> 
            <span class='String'>'Stopword files'</span><span class='Delimiter'>, 
</span>            <span class='Delimiter'>[ </span><span class='Keyword'>glob</span><span class='Parentheses'>(</span><span class='String'>"src\\backend\\snowball\\stopwords\\*.stop"</span><span class='Parentheses'>) </span><span class='Delimiter'>], 
</span>            $target <span class='Operator'>. </span><span class='String'>'/share/tsearch_data/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="Install.pm.html#LN199"><span class='Ref_to_Func'>CopySetOfFiles</span></a><span class='Parentheses'>(</span> 
            <span class='String'>'Dictionaries sample files'</span><span class='Delimiter'>, 
</span>            <span class='Delimiter'>[ </span><span class='Keyword'>glob</span><span class='Parentheses'>(</span><span class='String'>"src\\backend\\tsearch\\dicts\\*_sample*"</span><span class='Parentheses'>) </span><span class='Delimiter'>], 
</span>            $target <span class='Operator'>. </span><span class='String'>'/share/tsearch_data/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Keyword'>my </span>$pl_extension_files <span class='Operator'>= </span><span class='Delimiter'>[]; 
</span>        <span class='Keyword'>my </span>@pldirs             <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>'src/pl/plpgsql/src'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>push </span>@pldirs<span class='Delimiter'>, </span><span class='String'>"src/pl/plperl"</span>   <span class='Control'>if</span> $config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>perl<span class='Delimiter'>}; 
</span>        <span class='Keyword'>push </span>@pldirs<span class='Delimiter'>, </span><span class='String'>"src/pl/plpython"</span> <span class='Control'>if</span> $config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>python<span class='Delimiter'>}; 
</span>        <span class='Keyword'>push </span>@pldirs<span class='Delimiter'>, </span><span class='String'>"src/pl/tcl"</span>      <span class='Control'>if</span> $config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>tcl<span class='Delimiter'>}; 
</span>        File<span class='Operator'>::</span>Find<span class='Operator'>::</span>find<span class='Parentheses'>(</span> 
            <span class='Delimiter'>{</span>   <a href="../copyright.pl.html#LN29"><span class='Ref_to_Func'>wanted</span></a> <span class='Operator'>=&GT; </span><span class='Control'>sub</span> <span class='Delimiter'>{ 
</span>                    <span class='Operator'>/^(.*--.*\.sql|.*\.control)\z/</span>s 
                      <span class='Operator'>&& </span><span class='Keyword'>push</span><span class='Parentheses'>(</span>@$pl_extension_files<span class='Delimiter'>, </span>$File<span class='Operator'>::</span>Find<span class='Operator'>::</span><a href="../../test/perl/PostgresNode.pm.html#LN216"><span class='Ref_to_Func'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Single_Line'># Don't find files of in-tree temporary installations. 
</span>                    $_ <span class='Operator'>eq </span><span class='String'>'share'</span> and $File<span class='Operator'>::</span>Find<span class='Operator'>::</span>prune <span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>                  <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}, 
</span>            @pldirs<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="Install.pm.html#LN199"><span class='Ref_to_Func'>CopySetOfFiles</span></a><span class='Parentheses'>(</span><span class='String'>'PL Extension files'</span><span class='Delimiter'>, 
</span>            $pl_extension_files<span class='Delimiter'>, </span>$target <span class='Operator'>. </span><span class='String'>'/share/extension/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    GenerateNLSFiles<span class='Parentheses'>(</span>$target<span class='Delimiter'>, </span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>nls<span class='Delimiter'>}, </span>$majorver<span class='Parentheses'>) </span><span class='Control'>if</span> <span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>nls<span class='Delimiter'>}</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>print </span><span class='String'>"Installation complete.\n"</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN172"></a><span class='Control'>sub</span> <span class='Declare_Function'>EnsureDirectories</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$target <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>mkdir </span>$target <span class='Control'>unless</span> <span class='Operator'>-</span>d <span class='Parentheses'>(</span>$target<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Keyword'>my </span>$d <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>mkdir </span>$target <span class='Operator'>. </span><span class='String'>'/'</span> <span class='Operator'>. </span>$d <span class='Control'>unless</span> <span class='Operator'>-</span>d <span class='Parentheses'>(</span>$target <span class='Operator'>. </span><span class='String'>'/'</span> <span class='Operator'>. </span>$d<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<a name="LN182"></a><span class='Control'>sub</span> <span class='Declare_Function'>CopyFiles</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$what    <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$target  <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$basedir <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>print </span><span class='String'>"Copying $what"</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Keyword'>my </span>$f <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>print </span><span class='String'>"."</span><span class='Delimiter'>; 
</span>        $f <span class='Operator'>= </span>$basedir <span class='Operator'>. </span>$f<span class='Delimiter'>; 
</span>        <span class='Control'>die</span> <span class='String'>"No file $f\n"</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!-</span>f $f<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="Install.pm.html#LN29"><span class='Ref_to_Func'>lcopy</span></a><span class='Parentheses'>(</span>$f<span class='Delimiter'>, </span>$target <span class='Operator'>. </span>basename<span class='Parentheses'>(</span>$f<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Keyword'>print </span><span class='String'>"\n"</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN199"></a><span class='Control'>sub</span> <span class='Declare_Function'>CopySetOfFiles</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$what   <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$flist  <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$target <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"Copying $what"</span> <span class='Control'>if</span> $what<span class='Delimiter'>; 
</span>    <span class='Control'>foreach</span> <span class='Parentheses'>(</span>@$flist<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$tgt <span class='Operator'>= </span>$target <span class='Operator'>. </span>basename<span class='Parentheses'>(</span>$_<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>print </span><span class='String'>"."</span><span class='Delimiter'>; 
</span>        <a href="Install.pm.html#LN29"><span class='Ref_to_Func'>lcopy</span></a><span class='Parentheses'>(</span>$_<span class='Delimiter'>, </span>$tgt<span class='Parentheses'>) </span><span class='Operator'>|| </span>croak <span class='String'>"Could not copy $_: $!\n"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Keyword'>print </span><span class='String'>"\n"</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN214"></a><span class='Control'>sub</span> <span class='Declare_Function'>CopySolutionOutput</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$conf   <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$target <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$rem <span class='Operator'>= 
</span>      qr<span class='Delimiter'>{</span>Project<span class='Operator'>\</span><span class='Parentheses'>(</span><span class='String'>"\{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942\}"</span><span class='Operator'>\</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>"([^"</span><span class='Delimiter'>]</span><span class='Operator'>+</span><span class='Parentheses'>)</span><span class='String'>"}; 
</span> 
    <span class='Keyword'>my </span>$sln <span class='Operator'>= </span><a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span><span class='String'>"pgsql.sln"</span><span class='Parentheses'>) </span><span class='Operator'>|| </span>croak <span class='String'>"Could not open pgsql.sln\n"</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>$vcproj <span class='Operator'>= </span><span class='String'>'vcproj'</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$sln <span class='Operator'>=~ 
</span>        <span class='Operator'>/Microsoft Visual Studio Solution File, Format Version (\d+)\.\d+/ 
</span>        <span class='Operator'>&& </span>$1 <span class='Operator'>&GT;= </span>11<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $vcproj <span class='Operator'>= </span><span class='String'>'vcxproj'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Keyword'>print </span><span class='String'>"Copying build output files..."</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span>$sln <span class='Operator'>=~ </span>$rem<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$pf <span class='Operator'>= </span>$1<span class='Delimiter'>; 
</span> 
        <span class='Comment_Single_Line'># Hash-of-arrays listing where to install things.  For each 
</span>        <span class='Comment_Single_Line'># subdirectory there's a hash key, and the value is an array 
</span>        <span class='Comment_Single_Line'># of file extensions to install in that subdirectory.  Example: 
</span>        <span class='Comment_Single_Line'># { 'bin' =&GT; [ 'dll', 'lib' ], 
</span>        <span class='Comment_Single_Line'>#   'lib' =&GT; [ 'lib' ] } 
</span>        <span class='Keyword'>my </span>%install_list<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$is_sharedlib <span class='Operator'>= </span>0<span class='Delimiter'>; 
</span> 
        $sln <span class='Operator'>=~ s</span><span class='String'>/$rem//</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>next</span> 
          <span class='Control'>if</span> <span class='Parentheses'>(</span>$insttype <span class='Operator'>eq </span><span class='String'>"client"</span> <span class='Operator'>&& !</span><span class='Keyword'>grep </span><span class='Delimiter'>{ </span>$_ <span class='Operator'>eq </span>$pf <span class='Delimiter'>} 
</span>            @client_program_files<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Keyword'>my </span>$proj <span class='Operator'>= </span><a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span><span class='String'>"$pf.$vcproj"</span><span class='Parentheses'>) 
</span>          <span class='Operator'>|| </span>croak <span class='String'>"Could not open $pf.$vcproj\n"</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Single_Line'># Check if this project uses a shared library by looking if 
</span>        <span class='Comment_Single_Line'># SO_MAJOR_VERSION is defined in its Makefile, whose path 
</span>        <span class='Comment_Single_Line'># can be found using the resource file of this project. 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span>      $vcproj <span class='Operator'>eq </span><span class='String'>'vcxproj'</span> 
                <span class='Operator'>&& </span>$proj <span class='Operator'>=~ </span>qr<span class='Delimiter'>{</span>ResourceCompile<span class='Operator'>\s</span><span class='String'>*Include="([^"]+)"}) 
</span>            <span class='Operator'>|| </span><span class='Parentheses'>(</span>   $vcproj <span class='Operator'>eq </span><span class='String'>'vcproj'</span> 
                <span class='Operator'>&& </span>$proj <span class='Operator'>=~ </span>qr<span class='Delimiter'>{</span>File<span class='Operator'>\s</span><span class='String'>*RelativePath="([^\"]+)\.rc"})) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>my </span>$projpath <span class='Operator'>= </span>dirname<span class='Parentheses'>(</span>$1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>my </span>$mfname <span class='Operator'>= 
</span>              <span class='Operator'>-</span>e <span class='String'>"$projpath/GNUmakefile"</span> 
              <span class='Operator'>? </span><span class='String'>"$projpath/GNUmakefile"</span> 
              <span class='Operator'>: </span><span class='String'>"$projpath/Makefile"</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>my </span>$mf <span class='Operator'>= </span><a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span>$mfname<span class='Parentheses'>) </span><span class='Operator'>|| </span>croak <span class='String'>"Could not open $mfname\n"</span><span class='Delimiter'>; 
</span> 
            $is_sharedlib <span class='Operator'>= </span>1 <span class='Control'>if</span> <span class='Parentheses'>(</span>$mf <span class='Operator'>=~ /^SO_MAJOR_VERSION\s*=\s*(.*)$/</span>mg<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>$vcproj <span class='Operator'>eq </span><span class='String'>'vcproj'</span> <span class='Operator'>&& </span>$proj <span class='Operator'>=~ </span>qr<span class='Delimiter'>{</span>ConfigurationType<span class='Operator'>=</span><span class='String'>"([^"</span><span class='Delimiter'>]</span><span class='Operator'>+</span><span class='Parentheses'>)</span><span class='String'>"}) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>$1 <span class='Operator'>== </span>1<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>push</span><span class='Parentheses'>(</span>@<span class='Delimiter'>{ </span>$install_list<span class='Delimiter'>{</span><span class='String'>'bin'</span><span class='Delimiter'>} }, </span><span class='String'>"exe"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>elsif</span> <span class='Parentheses'>(</span>$1 <span class='Operator'>== </span>2<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>push</span><span class='Parentheses'>(</span>@<span class='Delimiter'>{ </span>$install_list<span class='Delimiter'>{</span><span class='String'>'lib'</span><span class='Delimiter'>} }, </span><span class='String'>"dll"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>$is_sharedlib<span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Keyword'>push</span><span class='Parentheses'>(</span>@<span class='Delimiter'>{ </span>$install_list<span class='Delimiter'>{</span><span class='String'>'bin'</span><span class='Delimiter'>} }, </span><span class='String'>"dll"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Keyword'>push</span><span class='Parentheses'>(</span>@<span class='Delimiter'>{ </span>$install_list<span class='Delimiter'>{</span><span class='String'>'lib'</span><span class='Delimiter'>} }, </span><span class='String'>"lib"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span> 
                <span class='Comment_Single_Line'># Static libraries, such as libpgport, only used internally 
</span>                <span class='Comment_Single_Line'># during build, don't install. 
</span>                <span class='Control'>next</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>elsif</span> <span class='Parentheses'>(</span>$vcproj <span class='Operator'>eq </span><span class='String'>'vcxproj'</span> 
            <span class='Operator'>&& </span>$proj <span class='Operator'>=~ </span>qr<span class='Delimiter'>{</span><span class='Operator'>&LT;</span>ConfigurationType<span class='Operator'>&GT;</span><span class='Parentheses'>(</span><span class='Operator'>\</span>w<span class='Operator'>+</span><span class='Parentheses'>)</span><span class='Operator'>&LT;/</span>ConfigurationType<span class='Operator'>&GT;</span><span class='Delimiter'>}</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>$1 <span class='Operator'>eq </span><span class='String'>'Application'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>push</span><span class='Parentheses'>(</span>@<span class='Delimiter'>{ </span>$install_list<span class='Delimiter'>{</span><span class='String'>'bin'</span><span class='Delimiter'>} }, </span><span class='String'>"exe"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>elsif</span> <span class='Parentheses'>(</span>$1 <span class='Operator'>eq </span><span class='String'>'DynamicLibrary'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>push</span><span class='Parentheses'>(</span>@<span class='Delimiter'>{ </span>$install_list<span class='Delimiter'>{</span><span class='String'>'lib'</span><span class='Delimiter'>} }, </span><span class='String'>"dll"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>$is_sharedlib<span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Keyword'>push</span><span class='Parentheses'>(</span>@<span class='Delimiter'>{ </span>$install_list<span class='Delimiter'>{</span><span class='String'>'bin'</span><span class='Delimiter'>} }, </span><span class='String'>"dll"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Keyword'>push</span><span class='Parentheses'>(</span>@<span class='Delimiter'>{ </span>$install_list<span class='Delimiter'>{</span><span class='String'>'lib'</span><span class='Delimiter'>} }, </span><span class='String'>"lib"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span>    <span class='Comment_Single_Line'># 'StaticLibrary' 
</span>            <span class='Delimiter'>{ 
</span> 
                <span class='Comment_Single_Line'># Static lib, such as libpgport, only used internally 
</span>                <span class='Comment_Single_Line'># during build, don't install. 
</span>                <span class='Control'>next</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            croak <span class='String'>"Could not parse $pf.$vcproj\n"</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Single_Line'># Install each element 
</span>        <span class='Control'>foreach</span> <span class='Keyword'>my </span>$dir <span class='Parentheses'>(</span><span class='Keyword'>keys </span>%install_list<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>foreach</span> <span class='Keyword'>my </span>$ext <span class='Parentheses'>(</span>@<span class='Delimiter'>{ </span>$install_list<span class='Delimiter'>{</span>$dir<span class='Delimiter'>} }</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="Install.pm.html#LN29"><span class='Ref_to_Func'>lcopy</span></a><span class='Parentheses'>(</span><span class='String'>"$conf\\$pf\\$pf.$ext"</span><span class='Delimiter'>, </span><span class='String'>"$target\\$dir\\$pf.$ext"</span><span class='Parentheses'>) 
</span>                  <span class='Operator'>|| </span>croak <span class='String'>"Could not copy $pf.$ext\n"</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="Install.pm.html#LN29"><span class='Ref_to_Func'>lcopy</span></a><span class='Parentheses'>(</span><span class='String'>"$conf\\$pf\\$pf.pdb"</span><span class='Delimiter'>, </span><span class='String'>"$target\\symbols\\$pf.pdb"</span><span class='Parentheses'>) 
</span>          <span class='Operator'>|| </span>croak <span class='String'>"Could not copy $pf.pdb\n"</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>print </span><span class='String'>"."</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Keyword'>print </span><span class='String'>"\n"</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN339"></a><span class='Control'>sub</span> <span class='Declare_Function'>GenerateConversionScript</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$target <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$sql    <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$F<span class='Delimiter'>; 
</span> 
    <span class='Keyword'>print </span><span class='String'>"Generating conversion proc script..."</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$mf <span class='Operator'>= </span><a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span><span class='String'>'src/backend/utils/mb/conversion_procs/Makefile'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $mf <span class='Operator'>=~ s</span><span class='String'>{\\\r?\n}{}g; 
</span>    $mf <span class='Operator'>=~ /^CONVERSIONS\s*=\s*(.*)$/</span>m 
      <span class='Operator'>|| </span><span class='Control'>die</span> <span class='String'>"Could not find CONVERSIONS line in conversions Makefile\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@pieces <span class='Operator'>= </span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$1<span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>$#</span>pieces <span class='Operator'>&GT; </span>0<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$name <span class='Operator'>= </span><span class='Keyword'>shift </span>@pieces<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$se   <span class='Operator'>= </span><span class='Keyword'>shift </span>@pieces<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$de   <span class='Operator'>= </span><span class='Keyword'>shift </span>@pieces<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$func <span class='Operator'>= </span><span class='Keyword'>shift </span>@pieces<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$obj  <span class='Operator'>= </span><span class='Keyword'>shift </span>@pieces<span class='Delimiter'>; 
</span>        $sql <span class='Operator'>.= </span><span class='String'>"-- $se --&GT; $de\n"</span><span class='Delimiter'>; 
</span>        $sql <span class='Operator'>.= 
</span><span class='String'>"CREATE OR REPLACE FUNCTION $func (INTEGER, INTEGER, CSTRING, INTERNAL, INTEGER) RETURNS VOID AS '\$libdir/$obj', '$func' LANGUAGE C STRICT;\n"</span><span class='Delimiter'>; 
</span>        $sql <span class='Operator'>.= 
</span><span class='String'>"COMMENT ON FUNCTION $func(INTEGER, INTEGER, CSTRING, INTERNAL, INTEGER) IS 'internal conversion function for $se to $de';\n"</span><span class='Delimiter'>; 
</span>        $sql <span class='Operator'>.= </span><span class='String'>"DROP CONVERSION pg_catalog.$name;\n"</span><span class='Delimiter'>; 
</span>        $sql <span class='Operator'>.= 
</span><span class='String'>"CREATE DEFAULT CONVERSION pg_catalog.$name FOR '$se' TO '$de' FROM $func;\n"</span><span class='Delimiter'>; 
</span>        $sql <span class='Operator'>.= 
</span><span class='String'>"COMMENT ON CONVERSION pg_catalog.$name IS 'conversion for $se to $de';\n\n"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Keyword'>open</span><span class='Parentheses'>(</span>$F<span class='Delimiter'>, </span><span class='String'>'&GT;'</span><span class='Delimiter'>, </span><span class='String'>"$target/share/conversion_create.sql"</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span><span class='Control'>die</span> <span class='String'>"Could not write to conversion_create.sql\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span>$F $sql<span class='Delimiter'>; 
</span>    <span class='Keyword'>close</span><span class='Parentheses'>(</span>$F<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\n"</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN376"></a><span class='Control'>sub</span> <span class='Declare_Function'>GenerateTimezoneFiles</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$target <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$conf   <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$mf     <span class='Operator'>= </span><a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span><span class='String'>"src/timezone/Makefile"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $mf <span class='Operator'>=~ s</span><span class='String'>{\\\r?\n}{}g; 
</span> 
    $mf <span class='Operator'>=~ /^TZDATA\s*:?=\s*(.*)$/</span>m 
      <span class='Operator'>|| </span><span class='Control'>die</span> <span class='String'>"Could not find TZDATA line in timezone makefile\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@tzfiles <span class='Operator'>= </span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$1<span class='Delimiter'>; 
</span> 
    $mf <span class='Operator'>=~ /^POSIXRULES\s*:?=\s*(.*)$/</span>m 
      <span class='Operator'>|| </span><span class='Control'>die</span> <span class='String'>"Could not find POSIXRULES line in timezone makefile\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$posixrules <span class='Operator'>= </span>$1<span class='Delimiter'>; 
</span>    $posixrules <span class='Operator'>=~ s</span><span class='String'>/\s+//</span>g<span class='Delimiter'>; 
</span> 
    <span class='Keyword'>print </span><span class='String'>"Generating timezone files..."</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>@args <span class='Operator'>= 
</span>      <span class='Parentheses'>(</span><span class='String'>"$conf/zic/zic"</span><span class='Delimiter'>, </span><span class='String'>'-d'</span><span class='Delimiter'>, </span><span class='String'>"$target/share/timezone"</span><span class='Delimiter'>, </span><span class='String'>'-p'</span><span class='Delimiter'>, </span><span class='String'>"$posixrules"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>foreach</span> <span class='Parentheses'>(</span>@tzfiles<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$tzfile <span class='Operator'>= </span>$_<span class='Delimiter'>; 
</span>        <span class='Keyword'>push</span><span class='Parentheses'>(</span>@args<span class='Delimiter'>, </span><span class='String'>"src/timezone/data/$tzfile"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\n"</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN406"></a><span class='Control'>sub</span> <span class='Declare_Function'>GenerateTsearchFiles</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$target <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>print </span><span class='String'>"Generating tsearch script..."</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$F<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$tmpl <span class='Operator'>= </span><a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span><span class='String'>'src/backend/snowball/snowball.sql.in'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$mf   <span class='Operator'>= </span><a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span><span class='String'>'src/backend/snowball/Makefile'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $mf <span class='Operator'>=~ s</span><span class='String'>{\\\r?\n}{}g; 
</span>    $mf <span class='Operator'>=~ /^LANGUAGES\s*=\s*(.*)$/</span>m 
      <span class='Operator'>|| </span><span class='Control'>die</span> <span class='String'>"Could not find LANGUAGES line in snowball Makefile\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@pieces <span class='Operator'>= </span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$1<span class='Delimiter'>; 
</span>    <span class='Keyword'>open</span><span class='Parentheses'>(</span>$F<span class='Delimiter'>, </span><span class='String'>'&GT;'</span><span class='Delimiter'>, </span><span class='String'>"$target/share/snowball_create.sql"</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span><span class='Control'>die</span> <span class='String'>"Could not write snowball_create.sql"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span>$F <a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span><span class='String'>'src/backend/snowball/snowball_func.sql.in'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>$#</span>pieces <span class='Operator'>&GT; </span>0<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$lang    <span class='Operator'>= </span><span class='Keyword'>shift </span>@pieces <span class='Operator'>|| </span><span class='Control'>last</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$asclang <span class='Operator'>= </span><span class='Keyword'>shift </span>@pieces <span class='Operator'>|| </span><span class='Control'>last</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$txt     <span class='Operator'>= </span>$tmpl<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$stop    <span class='Operator'>= </span><span class='String'>''</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>s <span class='String'>"src/backend/snowball/stopwords/$lang.stop"</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            $stop <span class='Operator'>= </span><span class='String'>", StopWords=$lang"</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        $txt <span class='Operator'>=~ s</span><span class='String'>#_LANGNAME_#${lang}#</span>gs<span class='Delimiter'>; 
</span>        $txt <span class='Operator'>=~ s</span><span class='String'>#_DICTNAME_#${lang}_stem#</span>gs<span class='Delimiter'>; 
</span>        $txt <span class='Operator'>=~ s</span><span class='String'>#_CFGNAME_#${lang}#</span>gs<span class='Delimiter'>; 
</span>        $txt <span class='Operator'>=~ s</span><span class='String'>#_ASCDICTNAME_#${asclang}_stem#</span>gs<span class='Delimiter'>; 
</span>        $txt <span class='Operator'>=~ s</span><span class='String'>#_NONASCDICTNAME_#${lang}_stem#</span>gs<span class='Delimiter'>; 
</span>        $txt <span class='Operator'>=~ s</span><span class='String'>#_STOPWORDS_#$stop#</span>gs<span class='Delimiter'>; 
</span>        <span class='Keyword'>print </span>$F $txt<span class='Delimiter'>; 
</span>        <span class='Keyword'>print </span><span class='String'>"."</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Keyword'>close</span><span class='Parentheses'>(</span>$F<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\n"</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN447"></a><span class='Control'>sub</span> <span class='Declare_Function'>CopyContribFiles</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$config <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$target <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>print </span><span class='String'>"Copying contrib data files..."</span><span class='Delimiter'>; 
</span>    <span class='Control'>foreach</span> <span class='Keyword'>my </span>$subdir <span class='Parentheses'>(</span><span class='String'>'contrib'</span><span class='Delimiter'>, </span><span class='String'>'src/test/modules'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$D<span class='Delimiter'>; 
</span>        <span class='Keyword'>opendir</span><span class='Parentheses'>(</span>$D<span class='Delimiter'>, </span>$subdir<span class='Parentheses'>) </span><span class='Operator'>|| </span>croak <span class='String'>"Could not opendir on $subdir!\n"</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Keyword'>my </span>$d <span class='Operator'>= </span><span class='Keyword'>readdir</span><span class='Parentheses'>(</span>$D<span class='Parentheses'>)) 
</span>        <span class='Delimiter'>{ 
</span> 
            <span class='Comment_Single_Line'># These configuration-based exclusions must match vcregress.pl 
</span>            <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$d <span class='Operator'>eq </span><span class='String'>"uuid-ossp"</span>       <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>uuid<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$d <span class='Operator'>eq </span><span class='String'>"sslinfo"</span>         <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>openssl<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$d <span class='Operator'>eq </span><span class='String'>"xml2"</span>            <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>xml<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$d <span class='Operator'>eq </span><span class='String'>"hstore_plperl"</span>   <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>perl<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$d <span class='Operator'>eq </span><span class='String'>"hstore_plpython"</span> <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>python<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$d <span class='Operator'>eq </span><span class='String'>"ltree_plpython"</span>  <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>python<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$d <span class='Operator'>eq </span><span class='String'>"sepgsql"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="Install.pm.html#LN475"><span class='Ref_to_Func'>CopySubdirFiles</span></a><span class='Parentheses'>(</span>$subdir<span class='Delimiter'>, </span>$d<span class='Delimiter'>, </span>$config<span class='Delimiter'>, </span>$target<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Keyword'>print </span><span class='String'>"\n"</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN475"></a><span class='Control'>sub</span> <span class='Declare_Function'>CopySubdirFiles</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$subdir <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$module <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$config <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$target <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$module <span class='Operator'>=~ /^\./</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Control'>unless</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>f <span class='String'>"$subdir/$module/Makefile"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> 
      <span class='Control'>if</span> <span class='Parentheses'>(</span>$insttype <span class='Operator'>eq </span><span class='String'>"client"</span> <span class='Operator'>&& !</span><span class='Keyword'>grep </span><span class='Delimiter'>{ </span>$_ <span class='Operator'>eq </span>$module <span class='Delimiter'>} </span>@client_contribs<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>$mf <span class='Operator'>= </span><a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span><span class='String'>"$subdir/$module/Makefile"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $mf <span class='Operator'>=~ s</span><span class='String'>{\\\r?\n}{}g; 
</span> 
    <span class='Comment_Single_Line'># Note: we currently don't support setting MODULEDIR in the makefile 
</span>    <span class='Keyword'>my </span>$moduledir <span class='Operator'>= </span><span class='String'>'contrib'</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>$flist <span class='Operator'>= </span><span class='String'>''</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$mf <span class='Operator'>=~ /^EXTENSION\s*=\s*(.*)$/m</span><span class='String'>) { $flist .= $1 } 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$flist <span class='Operator'>ne </span><span class='String'>''</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $moduledir <span class='Operator'>= </span><span class='String'>'extension'</span><span class='Delimiter'>; 
</span>        $flist <span class='Operator'>= </span><a href="Install.pm.html#LN561"><span class='Ref_to_Func'>ParseAndCleanRule</span></a><span class='Parentheses'>(</span>$flist<span class='Delimiter'>, </span>$mf<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>foreach</span> <span class='Keyword'>my </span>$f <span class='Parentheses'>(</span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$flist<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="Install.pm.html#LN29"><span class='Ref_to_Func'>lcopy</span></a><span class='Parentheses'>(</span><span class='String'>"$subdir/$module/$f.control"</span><span class='Delimiter'>, 
</span>                <span class='String'>"$target/share/extension/$f.control"</span><span class='Parentheses'>) 
</span>              <span class='Operator'>|| </span>croak<span class='Parentheses'>(</span><span class='String'>"Could not copy file $f.control in contrib $module"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>print </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    $flist <span class='Operator'>= </span><span class='String'>''</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$mf <span class='Operator'>=~ /^DATA_built\s*=\s*(.*)$/m</span><span class='String'>) { $flist .= $1 } 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$mf <span class='Operator'>=~ /^DATA\s*=\s*(.*)$/m</span><span class='String'>)       { $flist .= " $1" } 
</span>    $flist <span class='Operator'>=~ s</span><span class='String'>/^\s*//</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'># Remove leading spaces if we had only DATA_built 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>$flist <span class='Operator'>ne </span><span class='String'>''</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $flist <span class='Operator'>= </span><a href="Install.pm.html#LN561"><span class='Ref_to_Func'>ParseAndCleanRule</span></a><span class='Parentheses'>(</span>$flist<span class='Delimiter'>, </span>$mf<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>foreach</span> <span class='Keyword'>my </span>$f <span class='Parentheses'>(</span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$flist<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="Install.pm.html#LN29"><span class='Ref_to_Func'>lcopy</span></a><span class='Parentheses'>(</span><span class='String'>"$subdir/$module/$f"</span><span class='Delimiter'>, 
</span>                <span class='String'>"$target/share/$moduledir/"</span> <span class='Operator'>. </span>basename<span class='Parentheses'>(</span>$f<span class='Parentheses'>)) 
</span>              <span class='Operator'>|| </span>croak<span class='Parentheses'>(</span><span class='String'>"Could not copy file $f in contrib $module"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>print </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    $flist <span class='Operator'>= </span><span class='String'>''</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$mf <span class='Operator'>=~ /^DATA_TSEARCH\s*=\s*(.*)$/m</span><span class='String'>) { $flist .= $1 } 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$flist <span class='Operator'>ne </span><span class='String'>''</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $flist <span class='Operator'>= </span><a href="Install.pm.html#LN561"><span class='Ref_to_Func'>ParseAndCleanRule</span></a><span class='Parentheses'>(</span>$flist<span class='Delimiter'>, </span>$mf<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>foreach</span> <span class='Keyword'>my </span>$f <span class='Parentheses'>(</span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$flist<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="Install.pm.html#LN29"><span class='Ref_to_Func'>lcopy</span></a><span class='Parentheses'>(</span><span class='String'>"$subdir/$module/$f"</span><span class='Delimiter'>, 
</span>                <span class='String'>"$target/share/tsearch_data/"</span> <span class='Operator'>. </span>basename<span class='Parentheses'>(</span>$f<span class='Parentheses'>)) 
</span>              <span class='Operator'>|| </span>croak<span class='Parentheses'>(</span><span class='String'>"Could not copy file $f in $subdir $module"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>print </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    $flist <span class='Operator'>= </span><span class='String'>''</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$mf <span class='Operator'>=~ /^DOCS\s*=\s*(.*)$/</span>mg<span class='Parentheses'>) </span><span class='Delimiter'>{ </span>$flist <span class='Operator'>.= </span>$1 <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$flist <span class='Operator'>ne </span><span class='String'>''</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $flist <span class='Operator'>= </span><a href="Install.pm.html#LN561"><span class='Ref_to_Func'>ParseAndCleanRule</span></a><span class='Parentheses'>(</span>$flist<span class='Delimiter'>, </span>$mf<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Single_Line'># Special case for contrib/spi 
</span>        $flist <span class='Operator'>= 
</span><span class='String'>"autoinc.example insert_username.example moddatetime.example refint.example timetravel.example"</span> 
          <span class='Control'>if</span> <span class='Parentheses'>(</span>$module <span class='Operator'>eq </span><span class='String'>'spi'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>foreach</span> <span class='Keyword'>my </span>$f <span class='Parentheses'>(</span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$flist<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="Install.pm.html#LN29"><span class='Ref_to_Func'>lcopy</span></a><span class='Parentheses'>(</span><span class='String'>"$subdir/$module/$f"</span><span class='Delimiter'>, </span><span class='String'>"$target/doc/$moduledir/$f"</span><span class='Parentheses'>) 
</span>              <span class='Operator'>|| </span>croak<span class='Parentheses'>(</span><span class='String'>"Could not copy file $f in contrib $module"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>print </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
} 
</span> 
<a name="LN561"></a><span class='Control'>sub</span> <span class='Declare_Function'>ParseAndCleanRule</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$flist <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$mf    <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># Strip out $(addsuffix) rules 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>index<span class='Parentheses'>(</span>$flist<span class='Delimiter'>, </span><span class='String'>'$(addsuffix '</span><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span>0<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$pcount <span class='Operator'>= </span>0<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$i<span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>( 
</span>            $i <span class='Operator'>= </span>index<span class='Parentheses'>(</span>$flist<span class='Delimiter'>, </span><span class='String'>'$(addsuffix '</span><span class='Parentheses'>) </span><span class='Operator'>+ </span>12<span class='Delimiter'>; 
</span>            $i <span class='Operator'>&LT; </span><span class='Keyword'>length</span><span class='Parentheses'>(</span>$flist<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            $i<span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            $pcount<span class='Operator'>++ </span><span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>substr</span><span class='Parentheses'>(</span>$flist<span class='Delimiter'>, </span>$i<span class='Delimiter'>, </span>1<span class='Parentheses'>) </span><span class='Operator'>eq </span><span class='String'>'('</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            $pcount<span class='Operator'>-- </span><span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>substr</span><span class='Parentheses'>(</span>$flist<span class='Delimiter'>, </span>$i<span class='Delimiter'>, </span>1<span class='Parentheses'>) </span><span class='Operator'>eq </span><span class='String'>')'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>last</span>      <span class='Control'>if</span> <span class='Parentheses'>(</span>$pcount <span class='Operator'>&LT; </span>0<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        $flist <span class='Operator'>= 
</span>            <span class='Keyword'>substr</span><span class='Parentheses'>(</span>$flist<span class='Delimiter'>, </span>0<span class='Delimiter'>, </span>index<span class='Parentheses'>(</span>$flist<span class='Delimiter'>, </span><span class='String'>'$(addsuffix '</span><span class='Parentheses'>)) 
</span>          <span class='Operator'>. </span><span class='Keyword'>substr</span><span class='Parentheses'>(</span>$flist<span class='Delimiter'>, </span>$i <span class='Operator'>+ </span>1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> $flist<span class='Delimiter'>; 
} 
</span> 
<a name="LN587"></a><span class='Control'>sub</span> <span class='Declare_Function'>CopyIncludeFiles</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$target <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <a href="Install.pm.html#LN172"><span class='Ref_to_Func'>EnsureDirectories</span></a><span class='Parentheses'>(</span>$target<span class='Delimiter'>, </span><span class='String'>'include'</span><span class='Delimiter'>, </span><span class='String'>'include/libpq'</span><span class='Delimiter'>, </span><span class='String'>'include/internal'</span><span class='Delimiter'>, 
</span>        <span class='String'>'include/internal/libpq'</span><span class='Delimiter'>, </span><span class='String'>'include/server'</span><span class='Delimiter'>, </span><span class='String'>'include/server/parser'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>        <span class='String'>'Public headers'</span><span class='Delimiter'>, </span>$target <span class='Operator'>. </span><span class='String'>'/include/'</span><span class='Delimiter'>, 
</span>        <span class='String'>'src/include/'</span><span class='Delimiter'>,</span>   <span class='String'>'postgres_ext.h'</span><span class='Delimiter'>, 
</span>        <span class='String'>'pg_config.h'</span><span class='Delimiter'>,</span>    <span class='String'>'pg_config_ext.h'</span><span class='Delimiter'>, 
</span>        <span class='String'>'pg_config_os.h'</span><span class='Delimiter'>, </span><span class='String'>'dynloader.h'</span><span class='Delimiter'>, 
</span>        <span class='String'>'pg_config_manual.h'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN29"><span class='Ref_to_Func'>lcopy</span></a><span class='Parentheses'>(</span><span class='String'>'src/include/libpq/libpq-fs.h'</span><span class='Delimiter'>, </span>$target <span class='Operator'>. </span><span class='String'>'/include/libpq/'</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span>croak <span class='String'>'Could not copy libpq-fs.h'</span><span class='Delimiter'>; 
</span> 
    <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>        <span class='String'>'Libpq headers'</span><span class='Delimiter'>, 
</span>        $target <span class='Operator'>. </span><span class='String'>'/include/'</span><span class='Delimiter'>, 
</span>        <span class='String'>'src/interfaces/libpq/'</span><span class='Delimiter'>, </span><span class='String'>'libpq-fe.h'</span><span class='Delimiter'>, </span><span class='String'>'libpq-events.h'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>        <span class='String'>'Libpq internal headers'</span><span class='Delimiter'>, 
</span>        $target <span class='Operator'>. </span><span class='String'>'/include/internal/'</span><span class='Delimiter'>, 
</span>        <span class='String'>'src/interfaces/libpq/'</span><span class='Delimiter'>, </span><span class='String'>'libpq-int.h'</span><span class='Delimiter'>, </span><span class='String'>'pqexpbuffer.h'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>        <span class='String'>'Internal headers'</span><span class='Delimiter'>, 
</span>        $target <span class='Operator'>. </span><span class='String'>'/include/internal/'</span><span class='Delimiter'>, 
</span>        <span class='String'>'src/include/'</span><span class='Delimiter'>, </span><span class='String'>'c.h'</span><span class='Delimiter'>, </span><span class='String'>'port.h'</span><span class='Delimiter'>, </span><span class='String'>'postgres_fe.h'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN29"><span class='Ref_to_Func'>lcopy</span></a><span class='Parentheses'>(</span><span class='String'>'src/include/libpq/pqcomm.h'</span><span class='Delimiter'>, </span>$target <span class='Operator'>. </span><span class='String'>'/include/internal/libpq/'</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span>croak <span class='String'>'Could not copy pqcomm.h'</span><span class='Delimiter'>; 
</span> 
    <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>        <span class='String'>'Server headers'</span><span class='Delimiter'>, 
</span>        $target <span class='Operator'>. </span><span class='String'>'/include/server/'</span><span class='Delimiter'>, 
</span>        <span class='String'>'src/include/'</span><span class='Delimiter'>, </span><span class='String'>'pg_config.h'</span><span class='Delimiter'>, </span><span class='String'>'pg_config_ext.h'</span><span class='Delimiter'>, </span><span class='String'>'pg_config_os.h'</span><span class='Delimiter'>, 
</span>        <span class='String'>'dynloader.h'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>        <span class='String'>'Grammar header'</span><span class='Delimiter'>, 
</span>        $target <span class='Operator'>. </span><span class='String'>'/include/server/parser/'</span><span class='Delimiter'>, 
</span>        <span class='String'>'src/backend/parser/'</span><span class='Delimiter'>, </span><span class='String'>'gram.h'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN199"><span class='Ref_to_Func'>CopySetOfFiles</span></a><span class='Parentheses'>( 
</span>        <span class='String'>''</span><span class='Delimiter'>, 
</span>        <span class='Delimiter'>[ </span><span class='Keyword'>glob</span><span class='Parentheses'>(</span><span class='String'>"src\\include\\*.h"</span><span class='Parentheses'>) </span><span class='Delimiter'>], 
</span>        $target <span class='Operator'>. </span><span class='String'>'/include/server/'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$D<span class='Delimiter'>; 
</span>    <span class='Keyword'>opendir</span><span class='Parentheses'>(</span>$D<span class='Delimiter'>, </span><span class='String'>'src/include'</span><span class='Parentheses'>) </span><span class='Operator'>|| </span>croak <span class='String'>"Could not opendir on src/include!\n"</span><span class='Delimiter'>; 
</span> 
    <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>        <span class='String'>'PL/pgSQL header'</span><span class='Delimiter'>, 
</span>        $target <span class='Operator'>. </span><span class='String'>'/include/server/'</span><span class='Delimiter'>, 
</span>        <span class='String'>'src/pl/plpgsql/src/'</span><span class='Delimiter'>, </span><span class='String'>'plpgsql.h'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># some xcopy progs don't like mixed slash style paths 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>my </span>$ctarget <span class='Operator'>= </span>$target<span class='Parentheses'>) </span><span class='Operator'>=~ s</span><span class='String'>!/!\\!</span>g<span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Keyword'>my </span>$d <span class='Operator'>= </span><span class='Keyword'>readdir</span><span class='Parentheses'>(</span>$D<span class='Parentheses'>)) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$d <span class='Operator'>=~ /^\./</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$d <span class='Operator'>eq </span><span class='String'>'.git'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$d <span class='Operator'>eq </span><span class='String'>'CVS'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>next</span> <span class='Control'>unless</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>d <span class='String'>"src/include/$d"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="Install.pm.html#LN172"><span class='Ref_to_Func'>EnsureDirectories</span></a><span class='Parentheses'>(</span><span class='String'>"$target/include/server/$d"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>@args <span class='Operator'>= </span><span class='Parentheses'>( 
</span>            <span class='String'>'xcopy'</span><span class='Delimiter'>, </span><span class='String'>'/s'</span><span class='Delimiter'>, </span><span class='String'>'/i'</span><span class='Delimiter'>, </span><span class='String'>'/q'</span><span class='Delimiter'>, </span><span class='String'>'/r'</span><span class='Delimiter'>, </span><span class='String'>'/y'</span><span class='Delimiter'>, </span><span class='String'>"src\\include\\$d\\*.h"</span><span class='Delimiter'>, 
</span>            <span class='String'>"$ctarget\\include\\server\\$d\\"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>) </span><span class='Operator'>&& </span>croak<span class='Parentheses'>(</span><span class='String'>"Failed to copy include directory $d\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Keyword'>closedir</span><span class='Parentheses'>(</span>$D<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>$mf <span class='Operator'>= </span><a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span><span class='String'>'src/interfaces/ecpg/include/Makefile'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $mf <span class='Operator'>=~ s</span><span class='String'>{\\\r?\n}{}g; 
</span>    $mf <span class='Operator'>=~ /^ecpg_headers\s*=\s*(.*)$/</span>m 
      <span class='Operator'>|| </span>croak <span class='String'>"Could not find ecpg_headers line\n"</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>        <span class='String'>'ECPG headers'</span><span class='Delimiter'>, 
</span>        $target <span class='Operator'>. </span><span class='String'>'/include/'</span><span class='Delimiter'>, 
</span>        <span class='String'>'src/interfaces/ecpg/include/'</span><span class='Delimiter'>, 
</span>        <span class='String'>'ecpg_config.h'</span><span class='Delimiter'>, </span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $mf <span class='Operator'>=~ /^informix_headers\s*=\s*(.*)$/</span>m 
      <span class='Operator'>|| </span>croak <span class='String'>"Could not find informix_headers line\n"</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN172"><span class='Ref_to_Func'>EnsureDirectories</span></a><span class='Parentheses'>(</span>$target <span class='Operator'>. </span><span class='String'>'/include'</span><span class='Delimiter'>, </span><span class='String'>'informix'</span><span class='Delimiter'>, </span><span class='String'>'informix/esql'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN182"><span class='Ref_to_Func'>CopyFiles</span></a><span class='Parentheses'>( 
</span>        <span class='String'>'ECPG informix headers'</span><span class='Delimiter'>, 
</span>        $target <span class='Operator'>. </span><span class='String'>'/include/informix/esql/'</span><span class='Delimiter'>, 
</span>        <span class='String'>'src/interfaces/ecpg/include/'</span><span class='Delimiter'>, 
</span>        <span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$1<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN676"></a><span class='Control'>sub</span> <span class='Declare_Function'>GenerateNLSFiles</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$target   <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$nlspath  <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$majorver <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>print </span><span class='String'>"Installing NLS files..."</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN172"><span class='Ref_to_Func'>EnsureDirectories</span></a><span class='Parentheses'>(</span>$target<span class='Delimiter'>, </span><span class='String'>"share/locale"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@flist<span class='Delimiter'>; 
</span>    File<span class='Operator'>::</span>Find<span class='Operator'>::</span>find<span class='Parentheses'>( 
</span>        <span class='Delimiter'>{</span>   <a href="../copyright.pl.html#LN29"><span class='Ref_to_Func'>wanted</span></a> <span class='Operator'>=&GT; </span><span class='Control'>sub</span> <span class='Delimiter'>{ 
</span>                <span class='Operator'>/^nls\.mk\z/</span>s 
                  <span class='Operator'>&& !</span><span class='Keyword'>push</span><span class='Parentheses'>(</span>@flist<span class='Delimiter'>, </span>$File<span class='Operator'>::</span>Find<span class='Operator'>::</span><a href="../../test/perl/PostgresNode.pm.html#LN216"><span class='Ref_to_Func'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>              <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}, 
</span>        <span class='String'>"src"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>foreach</span> <span class='Parentheses'>(</span>@flist<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$prgm <span class='Operator'>= </span><a href="Install.pm.html#LN727"><span class='Ref_to_Func'>DetermineCatalogName</span></a><span class='Parentheses'>(</span>$_<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>s</span><span class='String'>/nls.mk/po/</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$dir <span class='Operator'>= </span>$_<span class='Delimiter'>; 
</span>        <span class='Control'>next</span> <span class='Control'>unless</span> <span class='Parentheses'>(</span>$dir <span class='Operator'>=~ /([^\/]+)\/po$/</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>foreach</span> <span class='Parentheses'>(</span><span class='Keyword'>glob</span><span class='Parentheses'>(</span><span class='String'>"$dir/*.po"</span><span class='Parentheses'>)) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>my </span>$lang<span class='Delimiter'>; 
</span>            <span class='Control'>next</span> <span class='Control'>unless</span> <span class='Operator'>/([^\/]+)\.po/</span><span class='Delimiter'>; 
</span>            $lang <span class='Operator'>= </span>$1<span class='Delimiter'>; 
</span> 
            <a href="Install.pm.html#LN172"><span class='Ref_to_Func'>EnsureDirectories</span></a><span class='Parentheses'>(</span>$target<span class='Delimiter'>, </span><span class='String'>"share/locale/$lang"</span><span class='Delimiter'>, 
</span>                <span class='String'>"share/locale/$lang/LC_MESSAGES"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>my </span>@args <span class='Operator'>= </span><span class='Parentheses'>( 
</span>                <span class='String'>"$nlspath\\bin\\msgfmt"</span><span class='Delimiter'>, 
</span>                <span class='String'>'-o'</span><span class='Delimiter'>, 
</span><span class='String'>"$target\\share\\locale\\$lang\\LC_MESSAGES\\$prgm-$majorver.mo"</span><span class='Delimiter'>, 
</span>                $_<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>) </span><span class='Operator'>&& </span>croak<span class='Parentheses'>(</span><span class='String'>"Could not run msgfmt on $dir\\$_"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>print </span><span class='String'>"."</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Keyword'>print </span><span class='String'>"\n"</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN718"></a><span class='Control'>sub</span> <span class='Declare_Function'>DetermineMajorVersion</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$f <span class='Operator'>= </span><a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span><span class='String'>'src/include/pg_config.h'</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span>croak <span class='String'>'Could not open pg_config.h'</span><span class='Delimiter'>; 
</span>    $f <span class='Operator'>=~ /^#define\s+PG_MAJORVERSION\s+"([^"]+)"/</span>m 
      <span class='Operator'>|| </span>croak <span class='String'>'Could not determine major version'</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> $1<span class='Delimiter'>; 
} 
</span> 
<a name="LN727"></a><span class='Control'>sub</span> <span class='Declare_Function'>DetermineCatalogName</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$filename <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>$f <span class='Operator'>= </span><a href="Install.pm.html#LN737"><span class='Ref_to_Func'>read_file</span></a><span class='Parentheses'>(</span>$filename<span class='Parentheses'>) </span><span class='Operator'>|| </span>croak <span class='String'>"Could not open $filename"</span><span class='Delimiter'>; 
</span>    $f <span class='Operator'>=~ /CATALOG_NAME\s*\:?=\s*(\S+)/</span>m 
      <span class='Operator'>|| </span>croak <span class='String'>"Could not determine catalog name in $filename"</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> $1<span class='Delimiter'>; 
} 
</span> 
<a name="LN737"></a><span class='Control'>sub</span> <span class='Declare_Function'>read_file</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$filename <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$F<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$t <span class='Operator'>= </span>$<span class='Operator'>/</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>undef </span>$<span class='Operator'>/</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>open</span><span class='Parentheses'>(</span>$F<span class='Delimiter'>, </span><span class='String'>'&LT;'</span><span class='Delimiter'>, </span>$filename<span class='Parentheses'>) </span><span class='Operator'>|| </span><span class='Control'>die</span> <span class='String'>"Could not open file $filename\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$txt <span class='Operator'>= &LT;</span>$F<span class='Operator'>&GT;</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>close</span><span class='Parentheses'>(</span>$F<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $<span class='Operator'>/ = </span>$t<span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> $txt<span class='Delimiter'>; 
} 
</span> 
1<span class='Delimiter'>; 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>