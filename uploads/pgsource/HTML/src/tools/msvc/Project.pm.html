<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\tools\msvc\Project.pm</title>
<LINK REL=StyleSheet HREF="../../../Perl_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\tools\msvc\Project.pm</b></p></td>
<td align='right'>
Wed Jun 14 08:26:15 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Keyword'>package </span>Project<span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># 
# Package that encapsulates a Visual C++ project file generation 
# 
# src/tools/msvc/Project.pm 
# 
</span><span class='Control'>use</span> Carp<span class='Delimiter'>; 
</span><span class='Control'>use</span> strict<span class='Delimiter'>; 
</span><span class='Control'>use</span> warnings<span class='Delimiter'>; 
</span><span class='Control'>use</span> File<span class='Operator'>::</span>Basename<span class='Delimiter'>; 
</span> 
<a name="LN12"></a><span class='Control'>sub</span> <span class='Declare_Function'>_new</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$classname<span class='Delimiter'>, </span>$name<span class='Delimiter'>, </span>$type<span class='Delimiter'>, </span>$solution<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$good_types <span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        lib <span class='Operator'>=&GT; </span>1<span class='Delimiter'>, 
</span>        exe <span class='Operator'>=&GT; </span>1<span class='Delimiter'>, 
</span>        dll <span class='Operator'>=&GT; </span>1<span class='Delimiter'>, }; 
</span>    confess<span class='Parentheses'>(</span><span class='String'>"Bad project type: $type\n"</span><span class='Parentheses'>) </span><span class='Control'>unless</span> <span class='Keyword'>exists </span>$good_types<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>$type<span class='Delimiter'>}; 
</span>    <span class='Keyword'>my </span>$self <span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <a href="../../test/perl/PostgresNode.pm.html#LN216"><span class='Ref_to_Func'>name</span></a>                  <span class='Operator'>=&GT; </span>$name<span class='Delimiter'>, 
</span>        type                  <span class='Operator'>=&GT; </span>$type<span class='Delimiter'>, 
</span>        guid                  <span class='Operator'>=&GT; </span>Win32<span class='Operator'>::</span>GuidGen<span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>        files                 <span class='Operator'>=&GT; </span><span class='Delimiter'>{}, 
</span>        references            <span class='Operator'>=&GT; </span><span class='Delimiter'>[], 
</span>        libraries             <span class='Operator'>=&GT; </span><span class='Delimiter'>[], 
</span>        suffixlib             <span class='Operator'>=&GT; </span><span class='Delimiter'>[], 
</span>        includes              <span class='Operator'>=&GT; </span><span class='String'>''</span><span class='Delimiter'>, 
</span>        prefixincludes        <span class='Operator'>=&GT; </span><span class='String'>''</span><span class='Delimiter'>, 
</span>        defines               <span class='Operator'>=&GT; </span><span class='String'>';'</span><span class='Delimiter'>, 
</span>        solution              <span class='Operator'>=&GT; </span>$solution<span class='Delimiter'>, 
</span>        disablewarnings       <span class='Operator'>=&GT; </span><span class='String'>'4018;4244;4273;4102;4090;4267'</span><span class='Delimiter'>, 
</span>        disablelinkerwarnings <span class='Operator'>=&GT; </span><span class='String'>''</span><span class='Delimiter'>, 
</span>        platform              <span class='Operator'>=&GT; </span>$solution<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>platform<span class='Delimiter'>}, }; 
</span> 
    <span class='Keyword'>bless</span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$classname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> $self<span class='Delimiter'>; 
} 
</span> 
<a name="LN40"></a><span class='Control'>sub</span> <span class='Declare_Function'>AddFile</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$filename<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span> 
    $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>}</span><span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>$filename<span class='Delimiter'>} </span><span class='Operator'>= </span>1<span class='Delimiter'>; 
} 
</span> 
<a name="LN47"></a><span class='Control'>sub</span> <span class='Declare_Function'>AddFiles</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$self <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$dir  <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Keyword'>my </span>$f <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>}</span><span class='Operator'>-&GT;</span><span class='Delimiter'>{ </span>$dir <span class='Operator'>. </span><span class='String'>"/"</span> <span class='Operator'>. </span>$f <span class='Delimiter'>} </span><span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<a name="LN58"></a><span class='Control'>sub</span> <span class='Declare_Function'>ReplaceFile</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$filename<span class='Delimiter'>, </span>$newname<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$re <span class='Operator'>= </span><span class='String'>"\\/$filename\$"</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>foreach</span> <span class='Keyword'>my </span>$file <span class='Parentheses'>(</span><span class='Keyword'>keys </span>%<span class='Delimiter'>{ </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>} }</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span> 
        <span class='Comment_Single_Line'># Match complete filename 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>$filename <span class='Operator'>=~ m</span><span class='String'>!/!</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>$file <span class='Operator'>eq </span>$filename<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>delete </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>}{</span>$file<span class='Delimiter'>}; 
</span>                $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>}{</span>$newname<span class='Delimiter'>} </span><span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>elsif</span> <span class='Parentheses'>(</span>$file <span class='Operator'>=~ m</span><span class='String'>/($re)/</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>delete </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>}{</span>$file<span class='Delimiter'>}; 
</span>            $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>}{</span><span class='String'>"$newname/$filename"</span><span class='Delimiter'>} </span><span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    confess<span class='Parentheses'>(</span><span class='String'>"Could not find file $filename to replace\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN86"></a><span class='Control'>sub</span> <span class='Declare_Function'>RemoveFile</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$filename<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$orig <span class='Operator'>= </span><span class='Keyword'>scalar keys </span>%<span class='Delimiter'>{ </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>} }; 
</span>    <span class='Keyword'>delete </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>}</span><span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>$filename<span class='Delimiter'>}; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$orig <span class='Operator'>&GT; </span><span class='Keyword'>scalar keys </span>%<span class='Delimiter'>{ </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>} }</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    confess<span class='Parentheses'>(</span><span class='String'>"Could not find file $filename to remove\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN98"></a><span class='Control'>sub</span> <span class='Declare_Function'>RelocateFiles</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$targetdir<span class='Delimiter'>, </span>$proc<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span>    <span class='Control'>foreach</span> <span class='Keyword'>my </span>$f <span class='Parentheses'>(</span><span class='Keyword'>keys </span>%<span class='Delimiter'>{ </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>} }</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$r <span class='Operator'>= &</span>$proc<span class='Parentheses'>(</span>$f<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>$r<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            $self<span class='Operator'>-&GT;</span><a href="Project.pm.html#LN86"><span class='Ref_to_Func'>RemoveFile</span></a><span class='Parentheses'>(</span>$f<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            $self<span class='Operator'>-&GT;</span><a href="Project.pm.html#LN40"><span class='Ref_to_Func'>AddFile</span></a><span class='Parentheses'>(</span>$targetdir <span class='Operator'>. </span><span class='String'>'/'</span> <span class='Operator'>. </span>basename<span class='Parentheses'>(</span>$f<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
} 
</span> 
<a name="LN112"></a><span class='Control'>sub</span> <span class='Declare_Function'>AddReference</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$self <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Keyword'>my </span>$ref <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>push </span>@<span class='Delimiter'>{ </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>references<span class='Delimiter'>} }, </span>$ref<span class='Delimiter'>; 
</span>        $self<span class='Operator'>-&GT;</span><a href="Project.pm.html#LN124"><span class='Ref_to_Func'>AddLibrary</span></a><span class='Parentheses'>( 
</span>            <span class='String'>"__CFGNAME__/"</span> <span class='Operator'>. </span>$ref<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span><a href="../../test/perl/PostgresNode.pm.html#LN216"><span class='Ref_to_Func'>name</span></a><span class='Delimiter'>} </span><span class='Operator'>. </span><span class='String'>"/"</span> <span class='Operator'>. </span>$ref<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span><a href="../../test/perl/PostgresNode.pm.html#LN216"><span class='Ref_to_Func'>name</span></a><span class='Delimiter'>} </span><span class='Operator'>. </span><span class='String'>".lib"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<a name="LN124"></a><span class='Control'>sub</span> <span class='Declare_Function'>AddLibrary</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$lib<span class='Delimiter'>, </span>$dbgsuffix<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>$lib <span class='Operator'>=~ m</span><span class='String'>/\s/</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $lib <span class='Operator'>= </span><span class='String'>'&quot;'</span> <span class='Operator'>. </span>$lib <span class='Operator'>. </span><span class='String'>"&quot;"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Keyword'>push </span>@<span class='Delimiter'>{ </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>libraries<span class='Delimiter'>} }, </span>$lib<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$dbgsuffix<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>push </span>@<span class='Delimiter'>{ </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>suffixlib<span class='Delimiter'>} }, </span>$lib<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<a name="LN140"></a><span class='Control'>sub</span> <span class='Declare_Function'>AddIncludeDir</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$inc<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>includes<span class='Delimiter'>} </span><span class='Operator'>ne </span><span class='String'>''</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>includes<span class='Delimiter'>} </span><span class='Operator'>.= </span><span class='String'>';'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>includes<span class='Delimiter'>} </span><span class='Operator'>.= </span>$inc<span class='Delimiter'>; 
} 
</span> 
<a name="LN151"></a><span class='Control'>sub</span> <span class='Declare_Function'>AddPrefixInclude</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$inc<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span> 
    $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>prefixincludes<span class='Delimiter'>} </span><span class='Operator'>= </span>$inc <span class='Operator'>. </span><span class='String'>';'</span> <span class='Operator'>. </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>prefixincludes<span class='Delimiter'>}; 
} 
</span> 
<a name="LN158"></a><span class='Control'>sub</span> <span class='Declare_Function'>AddDefine</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$def<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span> 
    $def <span class='Operator'>=~ s</span><span class='String'>/"/&quot;&quot;/</span>g<span class='Delimiter'>; 
</span>    $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>defines<span class='Delimiter'>} </span><span class='Operator'>.= </span>$def <span class='Operator'>. </span><span class='String'>';'</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN166"></a><span class='Control'>sub</span> <span class='Declare_Function'>FullExportDLL</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$libname<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span> 
    $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>builddef<span class='Delimiter'>} </span><span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>    $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>def<span class='Delimiter'>}</span>      <span class='Operator'>= </span><span class='String'>"./__CFGNAME__/$self-&GT;{name}/$self-&GT;{name}.def"</span><span class='Delimiter'>; 
</span>    $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>implib<span class='Delimiter'>}</span>   <span class='Operator'>= </span><span class='String'>"__CFGNAME__/$self-&GT;{name}/$libname"</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN175"></a><span class='Control'>sub</span> <span class='Declare_Function'>UseDef</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$def<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span> 
    $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>def<span class='Delimiter'>} </span><span class='Operator'>= </span>$def<span class='Delimiter'>; 
} 
</span> 
<a name="LN182"></a><span class='Control'>sub</span> <span class='Declare_Function'>AddDir</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$reldir<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$mf <span class='Operator'>= </span><a href="Project.pm.html#LN407"><span class='Ref_to_Func'>read_makefile</span></a><span class='Parentheses'>(</span>$reldir<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    $mf <span class='Operator'>=~ s</span><span class='String'>{\\\r?\n}{}g; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$mf <span class='Operator'>=~ m</span><span class='String'>{^(?:SUB)?DIRS[^=]*=\s*(.*)$}</span>mg<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>foreach</span> <span class='Keyword'>my </span>$subdir <span class='Parentheses'>(</span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$1<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>next</span> 
              <span class='Control'>if</span> $subdir <span class='Operator'>eq </span><span class='String'>"\$(top_builddir)/src/timezone"</span> 
            <span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>#special case for non-standard include 
</span>            <span class='Control'>next</span> 
              <span class='Control'>if</span> $reldir <span class='Operator'>. </span><span class='String'>"/"</span> <span class='Operator'>. </span>$subdir <span class='Operator'>eq </span><span class='String'>"src/backend/port/darwin"</span><span class='Delimiter'>; 
</span> 
            $self<span class='Operator'>-&GT;</span><a href="Project.pm.html#LN182"><span class='Ref_to_Func'>AddDir</span></a><span class='Parentheses'>(</span>$reldir <span class='Operator'>. </span><span class='String'>"/"</span> <span class='Operator'>. </span>$subdir<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span>$mf <span class='Operator'>=~ m</span><span class='String'>{^(?:EXTRA_)?OBJS[^=]*=\s*(.*)$}</span><span class='Operator'>m</span><span class='String'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$s         <span class='Operator'>= </span>$1<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$filter_re <span class='Operator'>= </span>qr<span class='Delimiter'>{</span><span class='Operator'>\</span>$<span class='Operator'>\</span><span class='Parentheses'>(</span>filter <span class='Parentheses'>(</span><span class='Delimiter'>[</span><span class='Operator'>^</span><span class='Delimiter'>,]</span><span class='Operator'>+</span><span class='Parentheses'>)</span><span class='Delimiter'>,</span><span class='Operator'>\s</span><span class='String'>+\$\(([^\)]+)\)\)}; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span>$s <span class='Operator'>=~ /$filter_re/</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span> 
            <span class='Comment_Single_Line'># Process $(filter a b c, $(VAR)) expressions 
</span>            <span class='Keyword'>my </span>$list   <span class='Operator'>= </span>$1<span class='Delimiter'>; 
</span>            <span class='Keyword'>my </span>$filter <span class='Operator'>= </span>$2<span class='Delimiter'>; 
</span>            $list <span class='Operator'>=~ s</span><span class='String'>/\.o/\.c/</span>g<span class='Delimiter'>; 
</span>            <span class='Keyword'>my </span>@pieces <span class='Operator'>= </span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$list<span class='Delimiter'>; 
</span>            <span class='Keyword'>my </span>$matches <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>            <span class='Control'>foreach</span> <span class='Keyword'>my </span>$p <span class='Parentheses'>(</span>@pieces<span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>$filter <span class='Operator'>eq </span><span class='String'>"LIBOBJS"</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>grep</span><span class='Parentheses'>(</span><span class='Operator'>/$p/</span><span class='Delimiter'>, </span>@main<span class='Operator'>::</span>pgportfiles<span class='Delimiter'>, </span>@main<span class='Operator'>::</span>pgcommonfiles<span class='Parentheses'>) 
</span>                        <span class='Operator'>== </span>1<span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        $p <span class='Operator'>=~ s</span><span class='String'>/\.c/\.o/</span><span class='Delimiter'>; 
</span>                        $matches <span class='Operator'>.= </span>$p <span class='Operator'>. </span><span class='String'>" "</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    confess <span class='String'>"Unknown filter $filter\n"</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            $s <span class='Operator'>=~ s</span><span class='String'>/$filter_re/$matches/</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>foreach</span> <span class='Keyword'>my </span>$f <span class='Parentheses'>(</span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$s<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>next</span> <span class='Control'>if</span> $f <span class='Operator'>=~ /^\s*$/</span><span class='Delimiter'>; 
</span>            <span class='Control'>next</span> <span class='Control'>if</span> $f <span class='Operator'>eq </span><span class='String'>"\\"</span><span class='Delimiter'>; 
</span>            <span class='Control'>next</span> <span class='Control'>if</span> $f <span class='Operator'>=~ /\/SUBSYS.o$/</span><span class='Delimiter'>; 
</span>            $f <span class='Operator'>=~ s</span><span class='String'>/,$//</span> 
              <span class='Delimiter'>;</span>    <span class='Comment_Single_Line'># Remove trailing comma that can show up from filter stuff 
</span>            <span class='Control'>next</span> <span class='Control'>unless</span> $f <span class='Operator'>=~ /.*\.o$/</span><span class='Delimiter'>; 
</span>            $f <span class='Operator'>=~ s</span><span class='String'>/\.o$/\.c/</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>$f <span class='Operator'>=~ /^\$\(top_builddir\)\/(.*)/</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                $f <span class='Operator'>= </span>$1<span class='Delimiter'>; 
</span>                $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>}</span><span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>$f<span class='Delimiter'>} </span><span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>files<span class='Delimiter'>}</span><span class='Operator'>-&GT;</span><span class='Delimiter'>{</span><span class='String'>"$reldir/$f"</span><span class='Delimiter'>} </span><span class='Operator'>= </span>1<span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        $mf <span class='Operator'>=~ s</span><span class='String'>{OBJS[^=]*=\s*(.*)$}{}m; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Single_Line'># Match rules that pull in source files from different directories, eg 
</span>    <span class='Comment_Single_Line'># pgstrcasecmp.c rint.c snprintf.c: % : $(top_srcdir)/src/port/% 
</span>    <span class='Keyword'>my </span>$replace_re <span class='Operator'>= 
</span>      qr<span class='Delimiter'>{</span><span class='Operator'>^</span><span class='Parentheses'>(</span><span class='Delimiter'>[</span><span class='Operator'>^:\</span>n<span class='Operator'>\</span>$<span class='Delimiter'>]</span><span class='Operator'>+\.</span>c<span class='Parentheses'>)</span><span class='Operator'>\s</span><span class='String'>*:\s*(?:%\s*</span><span class='Operator'>: </span><span class='Parentheses'>)</span><span class='Operator'>?\</span>$<span class='Parentheses'>(</span><span class='Operator'>\</span><span class='Parentheses'>(</span><span class='Delimiter'>[</span><span class='Operator'>^\</span><span class='Parentheses'>)</span><span class='Delimiter'>]</span><span class='Operator'>+\</span><span class='Parentheses'>))</span><span class='Operator'>\/</span><span class='Parentheses'>(</span><span class='Operator'>.*</span><span class='Parentheses'>)</span><span class='Operator'>\/</span><span class='Delimiter'>[</span><span class='Operator'>^\/</span><span class='Delimiter'>]</span><span class='Operator'>+\</span>n<span class='Delimiter'>}</span><span class='Operator'>m</span><span class='String'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span>$mf <span class='Operator'>=~ m</span><span class='String'>{$replace_re}</span><span class='Operator'>m</span><span class='String'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$match  <span class='Operator'>= </span>$1<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$top    <span class='Operator'>= </span>$2<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$target <span class='Operator'>= </span>$3<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>@pieces <span class='Operator'>= </span><span class='Keyword'>split </span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$match<span class='Delimiter'>; 
</span>        <span class='Control'>foreach</span> <span class='Keyword'>my </span>$fn <span class='Parentheses'>(</span>@pieces<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>$top <span class='Operator'>eq </span><span class='String'>"(top_srcdir)"</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>eval </span><span class='Delimiter'>{ </span>$self<span class='Operator'>-&GT;</span><a href="Project.pm.html#LN58"><span class='Ref_to_Func'>ReplaceFile</span></a><span class='Parentheses'>(</span>$fn<span class='Delimiter'>, </span>$target<span class='Parentheses'>) </span><span class='Delimiter'>}; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>elsif</span> <span class='Parentheses'>(</span>$top <span class='Operator'>eq </span><span class='String'>"(backend_src)"</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>eval </span><span class='Delimiter'>{ </span>$self<span class='Operator'>-&GT;</span><a href="Project.pm.html#LN58"><span class='Ref_to_Func'>ReplaceFile</span></a><span class='Parentheses'>(</span>$fn<span class='Delimiter'>, </span><span class='String'>"src/backend/$target"</span><span class='Parentheses'>) </span><span class='Delimiter'>}; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                confess <span class='String'>"Bad replacement top: $top, on line $_\n"</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        $mf <span class='Operator'>=~ s</span><span class='String'>{$replace_re}{}m; 
</span>    <span class='Delimiter'>} 
</span> 
    $self<span class='Operator'>-&GT;</span><a href="Project.pm.html#LN287"><span class='Ref_to_Func'>AddDirResourceFile</span></a><span class='Parentheses'>(</span>$reldir<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Single_Line'># If the directory's Makefile bears a description string, add a resource file. 
</span><a name="LN287"></a><span class='Control'>sub</span> <span class='Declare_Function'>AddDirResourceFile</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$reldir<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$mf <span class='Operator'>= </span><a href="Project.pm.html#LN407"><span class='Ref_to_Func'>read_makefile</span></a><span class='Parentheses'>(</span>$reldir<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>$mf <span class='Operator'>=~ /^PGFILEDESC\s*=\s*\"([^\"]+)\"/m</span><span class='String'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$desc <span class='Operator'>= </span>$1<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$ico<span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>$mf <span class='Operator'>=~ /^PGAPPICON\s*=\s*(.*)$/m</span><span class='String'>) { $ico = $1; } 
</span>        $self<span class='Operator'>-&GT;</span><a href="Project.pm.html#LN301"><span class='Ref_to_Func'>AddResourceFile</span></a><span class='Parentheses'>(</span>$reldir<span class='Delimiter'>, </span>$desc<span class='Delimiter'>, </span>$ico<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<a name="LN301"></a><span class='Control'>sub</span> <span class='Declare_Function'>AddResourceFile</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$dir<span class='Delimiter'>, </span>$desc<span class='Delimiter'>, </span>$ico<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$sec<span class='Delimiter'>, </span>$min<span class='Delimiter'>, </span>$hour<span class='Delimiter'>, </span>$mday<span class='Delimiter'>, </span>$mon<span class='Delimiter'>, </span>$year<span class='Delimiter'>, </span>$wday<span class='Delimiter'>, </span>$yday<span class='Delimiter'>, </span>$isdst<span class='Parentheses'>) </span><span class='Operator'>= 
</span>      <span class='Keyword'>localtime</span><span class='Parentheses'>(</span><span class='Keyword'>time</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$d <span class='Operator'>= </span><span class='Keyword'>sprintf</span><span class='Parentheses'>(</span><span class='String'>"%02d%03d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span>$year <span class='Operator'>- </span>100<span class='Parentheses'>)</span><span class='Delimiter'>, </span>$yday<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>Solution<span class='Operator'>::</span><a href="Solution.pm.html#LN80"><span class='Ref_to_Func'>IsNewer</span></a><span class='Parentheses'>(</span><span class='String'>"$dir/win32ver.rc"</span><span class='Delimiter'>, </span><span class='String'>'src/port/win32ver.rc'</span><span class='Parentheses'>)) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>print </span><span class='String'>"Generating win32ver.rc for $dir\n"</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>open</span><span class='Parentheses'>(</span><span class='Keyword'>my </span>$i<span class='Delimiter'>, </span><span class='String'>'&LT;'</span><span class='Delimiter'>, </span><span class='String'>'src/port/win32ver.rc'</span><span class='Parentheses'>) 
</span>          <span class='Operator'>|| </span>confess <span class='String'>"Could not open win32ver.rc"</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>open</span><span class='Parentheses'>(</span><span class='Keyword'>my </span>$o<span class='Delimiter'>, </span><span class='String'>'&GT;'</span><span class='Delimiter'>, </span><span class='String'>"$dir/win32ver.rc"</span><span class='Parentheses'>) 
</span>          <span class='Operator'>|| </span>confess <span class='String'>"Could not write win32ver.rc"</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$icostr <span class='Operator'>= </span>$ico <span class='Operator'>? </span><span class='String'>"IDI_ICON ICON \"src/port/$ico.ico\""</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>&LT;</span>$i<span class='Operator'>&GT;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>s</span><span class='String'>/FILEDESC/"$desc"/</span>gm<span class='Delimiter'>; 
</span>            <span class='Operator'>s</span><span class='String'>/_ICO_/$icostr/</span>gm<span class='Delimiter'>; 
</span>            <span class='Operator'>s</span><span class='String'>/(VERSION.*),0/$1,$d/</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>type<span class='Delimiter'>} </span><span class='Operator'>eq </span><span class='String'>"dll"</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>s</span><span class='String'>/VFT_APP/VFT_DLL/</span>gm<span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Keyword'>print </span>$o $_<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Keyword'>close</span><span class='Parentheses'>(</span>$o<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>close</span><span class='Parentheses'>(</span>$i<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    $self<span class='Operator'>-&GT;</span><a href="Project.pm.html#LN40"><span class='Ref_to_Func'>AddFile</span></a><span class='Parentheses'>(</span><span class='String'>"$dir/win32ver.rc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN334"></a><span class='Control'>sub</span> <span class='Declare_Function'>DisableLinkerWarnings</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$warnings<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span> 
    $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>disablelinkerwarnings<span class='Delimiter'>} </span><span class='Operator'>.= </span><span class='String'>','</span> 
      <span class='Control'>unless</span> <span class='Parentheses'>(</span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>disablelinkerwarnings<span class='Delimiter'>} </span><span class='Operator'>eq </span><span class='String'>''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>disablelinkerwarnings<span class='Delimiter'>} </span><span class='Operator'>.= </span>$warnings<span class='Delimiter'>; 
} 
</span> 
<a name="LN343"></a><span class='Control'>sub</span> <span class='Declare_Function'>Save</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># If doing DLL and haven't specified a DEF file, do a full export of all symbols 
# in the project. 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>type<span class='Delimiter'>} </span><span class='Operator'>eq </span><span class='String'>"dll"</span> <span class='Operator'>&& !</span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>def<span class='Delimiter'>}</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $self<span class='Operator'>-&GT;</span><a href="Project.pm.html#LN166"><span class='Ref_to_Func'>FullExportDLL</span></a><span class='Parentheses'>(</span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span><a href="../../test/perl/PostgresNode.pm.html#LN216"><span class='Ref_to_Func'>name</span></a><span class='Delimiter'>} </span><span class='Operator'>. </span><span class='String'>".lib"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
<span class='Comment_Single_Line'># Warning 4197 is about double exporting, disable this per 
# http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=99193 
</span>    $self<span class='Operator'>-&GT;</span><a href="Project.pm.html#LN334"><span class='Ref_to_Func'>DisableLinkerWarnings</span></a><span class='Parentheses'>(</span><span class='String'>'4197'</span><span class='Parentheses'>) </span><span class='Control'>if</span> <span class='Parentheses'>(</span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>platform<span class='Delimiter'>} </span><span class='Operator'>eq </span><span class='String'>'x64'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># Dump the project 
</span>    <span class='Keyword'>open</span><span class='Parentheses'>(</span><span class='Keyword'>my </span>$f<span class='Delimiter'>, </span><span class='String'>'&GT;'</span><span class='Delimiter'>, </span><span class='String'>"$self-&GT;{name}$self-&GT;{filenameExtension}"</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span>croak<span class='Parentheses'>( 
</span>        <span class='String'>"Could not write to $self-&GT;{name}$self-&GT;{filenameExtension}\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $self<span class='Operator'>-&GT;</span><a href="VCBuildProject.pm.html#LN24"><span class='Ref_to_Func'>WriteHeader</span></a><span class='Parentheses'>(</span>$f<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $self<span class='Operator'>-&GT;</span><a href="VCBuildProject.pm.html#LN62"><span class='Ref_to_Func'>WriteFiles</span></a><span class='Parentheses'>(</span>$f<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $self<span class='Operator'>-&GT;</span><a href="VCBuildProject.pm.html#LN158"><span class='Ref_to_Func'>Footer</span></a><span class='Parentheses'>(</span>$f<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>close</span><span class='Parentheses'>(</span>$f<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN368"></a><span class='Control'>sub</span> <span class='Declare_Function'>GetAdditionalLinkerDependencies</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$self<span class='Delimiter'>, </span>$cfgname<span class='Delimiter'>, </span>$separator<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$libcfg <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>uc </span>$cfgname <span class='Operator'>eq </span><span class='String'>"RELEASE"</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>"MD"</span> <span class='Operator'>: </span><span class='String'>"MDd"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$libs <span class='Operator'>= </span><span class='String'>''</span><span class='Delimiter'>; 
</span>    <span class='Control'>foreach</span> <span class='Keyword'>my </span>$lib <span class='Parentheses'>(</span>@<span class='Delimiter'>{ </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>libraries<span class='Delimiter'>} }</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>my </span>$xlib <span class='Operator'>= </span>$lib<span class='Delimiter'>; 
</span>        <span class='Control'>foreach</span> <span class='Keyword'>my </span>$slib <span class='Parentheses'>(</span>@<span class='Delimiter'>{ </span>$self<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>suffixlib<span class='Delimiter'>} }</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>$slib <span class='Operator'>eq </span>$lib<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                $xlib <span class='Operator'>=~ s</span><span class='String'>/\.lib$/$libcfg.lib/</span><span class='Delimiter'>; 
</span>                <span class='Control'>last</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        $libs <span class='Operator'>.= </span>$xlib <span class='Operator'>. </span>$separator<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    $libs <span class='Operator'>=~ s</span><span class='String'>/.$//</span><span class='Delimiter'>; 
</span>    $libs <span class='Operator'>=~ s</span><span class='String'>/__CFGNAME__/$cfgname/</span>g<span class='Delimiter'>; 
</span>    <span class='Control'>return</span> $libs<span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Single_Line'># Utility function that loads a complete file 
</span><a name="LN392"></a><span class='Control'>sub</span> <span class='Declare_Function'>read_file</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$filename <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$F<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$t <span class='Operator'>= </span>$<span class='Operator'>/</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>undef </span>$<span class='Operator'>/</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>open</span><span class='Parentheses'>(</span>$F<span class='Delimiter'>, </span><span class='String'>'&LT;'</span><span class='Delimiter'>, </span>$filename<span class='Parentheses'>) </span><span class='Operator'>|| </span>croak <span class='String'>"Could not open file $filename\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$txt <span class='Operator'>= &LT;</span>$F<span class='Operator'>&GT;</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>close</span><span class='Parentheses'>(</span>$F<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $<span class='Operator'>/ = </span>$t<span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> $txt<span class='Delimiter'>; 
} 
</span> 
<a name="LN407"></a><span class='Control'>sub</span> <span class='Declare_Function'>read_makefile</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$reldir <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$F<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$t <span class='Operator'>= </span>$<span class='Operator'>/</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>undef </span>$<span class='Operator'>/</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>open</span><span class='Parentheses'>(</span>$F<span class='Delimiter'>, </span><span class='String'>'&LT;'</span><span class='Delimiter'>, </span><span class='String'>"$reldir/GNUmakefile"</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span><span class='Keyword'>open</span><span class='Parentheses'>(</span>$F<span class='Delimiter'>, </span><span class='String'>'&LT;'</span><span class='Delimiter'>, </span><span class='String'>"$reldir/Makefile"</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span>confess <span class='String'>"Could not open $reldir/Makefile\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$txt <span class='Operator'>= &LT;</span>$F<span class='Operator'>&GT;</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>close</span><span class='Parentheses'>(</span>$F<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $<span class='Operator'>/ = </span>$t<span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> $txt<span class='Delimiter'>; 
} 
</span> 
1<span class='Delimiter'>; 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>