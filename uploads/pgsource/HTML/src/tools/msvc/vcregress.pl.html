<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\tools\msvc\vcregress.pl</title>
<LINK REL=StyleSheet HREF="../../../Perl_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\tools\msvc\vcregress.pl</b></p></td>
<td align='right'>
Wed Jun 14 08:26:15 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Single_Line'># -*-perl-*- hey - emacs - this is a perl file 
</span> 
<span class='Comment_Single_Line'># src/tools/msvc/vcregress.pl 
</span> 
<span class='Control'>use</span> strict<span class='Delimiter'>; 
</span> 
<span class='Keyword'>our </span>$config<span class='Delimiter'>; 
</span> 
<span class='Control'>use</span> Cwd<span class='Delimiter'>; 
</span><span class='Control'>use</span> File<span class='Operator'>::</span>Basename<span class='Delimiter'>; 
</span><span class='Control'>use</span> File<span class='Operator'>::</span>Copy<span class='Delimiter'>; 
</span><span class='Control'>use</span> File<span class='Operator'>::</span>Find <span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
<span class='Control'>use</span> <a href="Install.pm.html#LN44"><span class='Ref_to_Func'>Install</span></a> <span class='Keyword'>qw</span><span class='String'>(Install)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>my </span>$startdir <span class='Operator'>= </span>getcwd<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>chdir </span><span class='String'>"../../.."</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>d <span class='String'>"../../../src/tools/msvc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>my </span>$topdir         <span class='Operator'>= </span>getcwd<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Keyword'>my </span>$tmp_installdir <span class='Operator'>= </span><span class='String'>"$topdir/tmp_install"</span><span class='Delimiter'>; 
</span> 
<span class='Control'>do</span> <span class='String'>'src/tools/msvc/config_default.pl'</span><span class='Delimiter'>; 
</span><span class='Control'>do</span> <span class='String'>'src/tools/msvc/config.pl'</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>f <span class='String'>'src/tools/msvc/config.pl'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'># buildenv.pl is for specifying the build environment settings 
# it should contain lines like: 
# $ENV{PATH} = "c:/path/to/bison/bin;$ENV{PATH}"; 
</span> 
<span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span>e <span class='String'>"src/tools/msvc/buildenv.pl"</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>do</span> <span class='String'>"src/tools/msvc/buildenv.pl"</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>my </span>$what <span class='Operator'>= </span><span class='Keyword'>shift </span><span class='Operator'>|| </span><span class='String'>""</span><span class='Delimiter'>; 
</span><span class='Control'>if</span> <span class='Parentheses'>(</span>$what <span class='Operator'>=~ 
/^(check|installcheck|plcheck|contribcheck|modulescheck|ecpgcheck|isolationcheck|upgradecheck|bincheck|recoverycheck|taptest)$/</span>i 
  <span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    $what <span class='Operator'>= </span><span class='Keyword'>uc </span>$what<span class='Delimiter'>; 
} 
</span><span class='Control'>else</span> 
<span class='Delimiter'>{ 
</span>    <a href="../fix-old-flex-code.pl.html#LN55"><span class='Ref_to_Func'>usage</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Single_Line'># use a capital C here because config.pl has $config 
</span><span class='Keyword'>my </span>$Config <span class='Operator'>= -</span>e <span class='String'>"release/postgres/postgres.exe"</span> <span class='Operator'>? </span><span class='String'>"Release"</span> <span class='Operator'>: </span><span class='String'>"Debug"</span><span class='Delimiter'>; 
</span> 
copy<span class='Parentheses'>(</span><span class='String'>"$Config/refint/refint.dll"</span><span class='Delimiter'>,</span>                 <span class='String'>"src/test/regress"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>copy<span class='Parentheses'>(</span><span class='String'>"$Config/autoinc/autoinc.dll"</span><span class='Delimiter'>,</span>               <span class='String'>"src/test/regress"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>copy<span class='Parentheses'>(</span><span class='String'>"$Config/regress/regress.dll"</span><span class='Delimiter'>,</span>               <span class='String'>"src/test/regress"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>copy<span class='Parentheses'>(</span><span class='String'>"$Config/dummy_seclabel/dummy_seclabel.dll"</span><span class='Delimiter'>, </span><span class='String'>"src/test/regress"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
$ENV<span class='Delimiter'>{</span>PATH<span class='Delimiter'>} </span><span class='Operator'>= </span><span class='String'>"$topdir/$Config/libpq;$ENV{PATH}"</span><span class='Delimiter'>; 
</span> 
<span class='Control'>if</span> <span class='Parentheses'>(</span>$ENV<span class='Delimiter'>{</span>PERL5LIB<span class='Delimiter'>}</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    $ENV<span class='Delimiter'>{</span>PERL5LIB<span class='Delimiter'>} </span><span class='Operator'>= </span><span class='String'>"$topdir/src/tools/msvc;$ENV{PERL5LIB}"</span><span class='Delimiter'>; 
} 
</span><span class='Control'>else</span> 
<span class='Delimiter'>{ 
</span>    $ENV<span class='Delimiter'>{</span>PERL5LIB<span class='Delimiter'>} </span><span class='Operator'>= </span><span class='String'>"$topdir/src/tools/msvc"</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>my </span>$maxconn <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>$maxconn <span class='Operator'>= </span><span class='String'>"--max_connections=$ENV{MAX_CONNECTIONS}"</span> 
  <span class='Control'>if</span> $ENV<span class='Delimiter'>{</span>MAX_CONNECTIONS<span class='Delimiter'>}; 
</span> 
<span class='Keyword'>my </span>$temp_config <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>$temp_config <span class='Operator'>= </span><span class='String'>"--temp-config=\"$ENV{TEMP_CONFIG}\""</span> 
  <span class='Control'>if</span> $ENV<span class='Delimiter'>{</span>TEMP_CONFIG<span class='Delimiter'>}; 
</span> 
<span class='Keyword'>chdir </span><span class='String'>"src/test/regress"</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>my </span>%command <span class='Operator'>= </span><span class='Parentheses'>( 
</span>    CHECK          <span class='Operator'>=&GT; \&</span><a href="vcregress.pl.html#LN114"><span class='Ref_to_Func'>check</span></a><span class='Delimiter'>, 
</span>    PLCHECK        <span class='Operator'>=&GT; \&</span><a href="vcregress.pl.html#LN237"><span class='Ref_to_Func'>plcheck</span></a><span class='Delimiter'>, 
</span>    INSTALLCHECK   <span class='Operator'>=&GT; \&</span><a href="vcregress.pl.html#LN98"><span class='Ref_to_Func'>installcheck</span></a><span class='Delimiter'>, 
</span>    ECPGCHECK      <span class='Operator'>=&GT; \&</span><a href="vcregress.pl.html#LN134"><span class='Ref_to_Func'>ecpgcheck</span></a><span class='Delimiter'>, 
</span>    CONTRIBCHECK   <span class='Operator'>=&GT; \&</span><a href="vcregress.pl.html#LN345"><span class='Ref_to_Func'>contribcheck</span></a><span class='Delimiter'>, 
</span>    MODULESCHECK   <span class='Operator'>=&GT; \&</span><a href="vcregress.pl.html#LN368"><span class='Ref_to_Func'>modulescheck</span></a><span class='Delimiter'>, 
</span>    ISOLATIONCHECK <span class='Operator'>=&GT; \&</span><a href="vcregress.pl.html#LN159"><span class='Ref_to_Func'>isolationcheck</span></a><span class='Delimiter'>, 
</span>    BINCHECK       <span class='Operator'>=&GT; \&</span><a href="vcregress.pl.html#LN206"><span class='Ref_to_Func'>bincheck</span></a><span class='Delimiter'>, 
</span>    RECOVERYCHECK  <span class='Operator'>=&GT; \&</span><a href="vcregress.pl.html#LN381"><span class='Ref_to_Func'>recoverycheck</span></a><span class='Delimiter'>, 
</span>    UPGRADECHECK   <span class='Operator'>=&GT; \&</span><a href="vcregress.pl.html#LN435"><span class='Ref_to_Func'>upgradecheck</span></a><span class='Delimiter'>, 
</span>    TAPTEST        <span class='Operator'>=&GT; \&</span><a href="vcregress.pl.html#LN226"><span class='Ref_to_Func'>taptest</span></a><span class='Delimiter'>,</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>my </span>$proc <span class='Operator'>= </span>$command<span class='Delimiter'>{</span>$what<span class='Delimiter'>}; 
</span> 
<span class='Control'>exit</span> 3 <span class='Control'>unless</span> $proc<span class='Delimiter'>; 
</span> 
<span class='Operator'>&</span>$proc<span class='Parentheses'>(</span>@ARGV<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Control'>exit</span> 0<span class='Delimiter'>; 
</span> 
<span class='Comment_Single_Line'>######################################################################## 
</span> 
<a name="LN98"></a><span class='Control'>sub</span> <span class='Declare_Function'>installcheck</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$schedule <span class='Operator'>= </span><span class='Keyword'>shift </span><span class='Operator'>|| </span><span class='String'>'serial'</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@args <span class='Operator'>= </span><span class='Parentheses'>( 
</span>        <span class='String'>"../../../$Config/pg_regress/pg_regress"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--dlpath=."</span><span class='Delimiter'>, 
</span>        <span class='String'>"--bindir=../../../$Config/psql"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--schedule=${schedule}_schedule"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--encoding=SQL_ASCII"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--no-locale"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>push</span><span class='Parentheses'>(</span>@args<span class='Delimiter'>, </span>$maxconn<span class='Parentheses'>) </span><span class='Control'>if</span> $maxconn<span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$status <span class='Operator'>= </span>$<span class='Operator'>? &GT;&GT; </span>8<span class='Delimiter'>; 
</span>    <span class='Control'>exit</span> $status <span class='Control'>if</span> $status<span class='Delimiter'>; 
} 
</span> 
<a name="LN114"></a><span class='Control'>sub</span> <span class='Declare_Function'>check</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$schedule <span class='Operator'>= </span><span class='Keyword'>shift </span><span class='Operator'>|| </span><span class='String'>'parallel'</span><span class='Delimiter'>; 
</span>    <a href="vcregress.pl.html#LN604"><span class='Ref_to_Func'>InstallTemp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>chdir </span><span class='String'>"${topdir}/src/test/regress"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@args <span class='Operator'>= </span><span class='Parentheses'>( 
</span>        <span class='String'>"../../../$Config/pg_regress/pg_regress"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--dlpath=."</span><span class='Delimiter'>, 
</span>        <span class='String'>"--bindir="</span><span class='Delimiter'>, 
</span>        <span class='String'>"--schedule=${schedule}_schedule"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--encoding=SQL_ASCII"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--no-locale"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--temp-instance=./tmp_check"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>push</span><span class='Parentheses'>(</span>@args<span class='Delimiter'>, </span>$maxconn<span class='Parentheses'>)</span>     <span class='Control'>if</span> $maxconn<span class='Delimiter'>; 
</span>    <span class='Keyword'>push</span><span class='Parentheses'>(</span>@args<span class='Delimiter'>, </span>$temp_config<span class='Parentheses'>) </span><span class='Control'>if</span> $temp_config<span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$status <span class='Operator'>= </span>$<span class='Operator'>? &GT;&GT; </span>8<span class='Delimiter'>; 
</span>    <span class='Control'>exit</span> $status <span class='Control'>if</span> $status<span class='Delimiter'>; 
} 
</span> 
<a name="LN134"></a><span class='Control'>sub</span> <span class='Declare_Function'>ecpgcheck</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$msbflags <span class='Operator'>= </span>$ENV<span class='Delimiter'>{</span>MSBFLAGS<span class='Delimiter'>} </span><span class='Operator'>|| </span><span class='String'>""</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>chdir </span>$startdir<span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span><span class='String'>"msbuild ecpg_regression.proj $msbflags /p:config=$Config"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$status <span class='Operator'>= </span>$<span class='Operator'>? &GT;&GT; </span>8<span class='Delimiter'>; 
</span>    <span class='Control'>exit</span> $status <span class='Control'>if</span> $status<span class='Delimiter'>; 
</span>    <a href="vcregress.pl.html#LN604"><span class='Ref_to_Func'>InstallTemp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>chdir </span><span class='String'>"$topdir/src/interfaces/ecpg/test"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$schedule <span class='Operator'>= </span><span class='String'>"ecpg"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@args     <span class='Operator'>= </span><span class='Parentheses'>( 
</span>        <span class='String'>"../../../../$Config/pg_regress_ecpg/pg_regress_ecpg"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--bindir="</span><span class='Delimiter'>, 
</span>        <span class='String'>"--dbname=ecpg1_regression,ecpg2_regression"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--create-role=regress_ecpg_user1,regress_ecpg_user2"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--schedule=${schedule}_schedule"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--encoding=SQL_ASCII"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--no-locale"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--temp-instance=./tmp_chk"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>push</span><span class='Parentheses'>(</span>@args<span class='Delimiter'>, </span>$maxconn<span class='Parentheses'>) </span><span class='Control'>if</span> $maxconn<span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $status <span class='Operator'>= </span>$<span class='Operator'>? &GT;&GT; </span>8<span class='Delimiter'>; 
</span>    <span class='Control'>exit</span> $status <span class='Control'>if</span> $status<span class='Delimiter'>; 
} 
</span> 
<a name="LN159"></a><span class='Control'>sub</span> <span class='Declare_Function'>isolationcheck</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>chdir </span><span class='String'>"../isolation"</span><span class='Delimiter'>; 
</span>    copy<span class='Parentheses'>(</span><span class='String'>"../../../$Config/isolationtester/isolationtester.exe"</span><span class='Delimiter'>, 
</span>        <span class='String'>"../../../$Config/pg_isolation_regress"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@args <span class='Operator'>= </span><span class='Parentheses'>( 
</span>        <span class='String'>"../../../$Config/pg_isolation_regress/pg_isolation_regress"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--bindir=../../../$Config/psql"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--inputdir=."</span><span class='Delimiter'>, 
</span>        <span class='String'>"--schedule=./isolation_schedule"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>push</span><span class='Parentheses'>(</span>@args<span class='Delimiter'>, </span>$maxconn<span class='Parentheses'>) </span><span class='Control'>if</span> $maxconn<span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$status <span class='Operator'>= </span>$<span class='Operator'>? &GT;&GT; </span>8<span class='Delimiter'>; 
</span>    <span class='Control'>exit</span> $status <span class='Control'>if</span> $status<span class='Delimiter'>; 
} 
</span> 
<a name="LN175"></a><span class='Control'>sub</span> <span class='Declare_Function'>tap_check</span> 
<span class='Delimiter'>{ 
</span>    <span class='Control'>die</span> <span class='String'>"Tap tests not enabled in configuration"</span> 
      <span class='Control'>unless</span> $config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>tap_tests<span class='Delimiter'>}; 
</span> 
    <span class='Keyword'>my </span>@flags<span class='Delimiter'>; 
</span>    <span class='Control'>foreach</span> <span class='Keyword'>my </span>$arg <span class='Parentheses'>(</span>0 <span class='Operator'>.. </span><span class='Keyword'>scalar</span><span class='Parentheses'>(</span>@_<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>next</span> <span class='Control'>unless</span> $_<span class='Delimiter'>[</span>$arg<span class='Delimiter'>] </span><span class='Operator'>=~ /^PROVE_FLAGS=(.*)/</span><span class='Delimiter'>; 
</span>        @flags <span class='Operator'>= </span><span class='Keyword'>split</span><span class='Parentheses'>(</span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>splice</span><span class='Parentheses'>(</span>@_<span class='Delimiter'>,</span>$arg<span class='Delimiter'>,</span>1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>last</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Keyword'>my </span>$dir <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>chdir </span>$dir<span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>@args <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>"prove"</span><span class='Delimiter'>, </span>@flags<span class='Delimiter'>, </span><span class='String'>"t/*.pl"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># adjust the environment for just this test 
</span>    <span class='Keyword'>local </span>%ENV <span class='Operator'>= </span>%ENV<span class='Delimiter'>; 
</span>    $ENV<span class='Delimiter'>{</span>PERL5LIB<span class='Delimiter'>}</span>   <span class='Operator'>= </span><span class='String'>"$topdir/src/test/perl;$ENV{PERL5LIB}"</span><span class='Delimiter'>; 
</span>    $ENV<span class='Delimiter'>{</span>PG_REGRESS<span class='Delimiter'>} </span><span class='Operator'>= </span><span class='String'>"$topdir/$Config/pg_regress/pg_regress"</span><span class='Delimiter'>; 
</span> 
    $ENV<span class='Delimiter'>{</span>TESTDIR<span class='Delimiter'>} </span><span class='Operator'>= </span><span class='String'>"$dir"</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$status <span class='Operator'>= </span>$<span class='Operator'>? &GT;&GT; </span>8<span class='Delimiter'>; 
</span>    <span class='Control'>return</span> $status<span class='Delimiter'>; 
} 
</span> 
<a name="LN206"></a><span class='Control'>sub</span> <span class='Declare_Function'>bincheck</span> 
<span class='Delimiter'>{ 
</span>    <a href="vcregress.pl.html#LN604"><span class='Ref_to_Func'>InstallTemp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>$mstat <span class='Operator'>= </span>0<span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># Find out all the existing TAP tests by looking for t/ directories 
</span>    <span class='Comment_Single_Line'># in the tree. 
</span>    <span class='Keyword'>my </span>@bin_dirs <span class='Operator'>= </span><span class='Keyword'>glob</span><span class='Parentheses'>(</span><span class='String'>"$topdir/src/bin/*"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># Process each test 
</span>    <span class='Control'>foreach</span> <span class='Keyword'>my </span>$dir <span class='Parentheses'>(</span>@bin_dirs<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>next</span> <span class='Control'>unless</span> <span class='Operator'>-</span>d <span class='String'>"$dir/t"</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$status <span class='Operator'>= </span><a href="vcregress.pl.html#LN175"><span class='Ref_to_Func'>tap_check</span></a><span class='Parentheses'>(</span>$dir<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        $mstat <span class='Operator'>||= </span>$status<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>exit</span> $mstat <span class='Control'>if</span> $mstat<span class='Delimiter'>; 
} 
</span> 
<a name="LN226"></a><span class='Control'>sub</span> <span class='Declare_Function'>taptest</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$dir <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>die</span> <span class='String'>"no tests found!"</span> <span class='Control'>unless</span> <span class='Operator'>-</span>d <span class='String'>"$topdir/$dir/t"</span><span class='Delimiter'>; 
</span> 
    <a href="vcregress.pl.html#LN604"><span class='Ref_to_Func'>InstallTemp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$status <span class='Operator'>= </span><a href="vcregress.pl.html#LN175"><span class='Ref_to_Func'>tap_check</span></a><span class='Parentheses'>(</span><span class='String'>"$topdir/$dir"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>exit</span> $status <span class='Control'>if</span> $status<span class='Delimiter'>; 
} 
</span> 
<a name="LN237"></a><span class='Control'>sub</span> <span class='Declare_Function'>plcheck</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>chdir </span><span class='String'>"../../pl"</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>foreach</span> <span class='Keyword'>my </span>$pl <span class='Parentheses'>(</span><span class='Keyword'>glob</span><span class='Parentheses'>(</span><span class='String'>"*"</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>next</span> <span class='Control'>unless</span> <span class='Operator'>-</span>d <span class='String'>"$pl/sql"</span> <span class='Operator'>&& -</span>d <span class='String'>"$pl/expected"</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$lang <span class='Operator'>= </span>$pl <span class='Operator'>eq </span><span class='String'>'tcl'</span> <span class='Operator'>? </span><span class='String'>'pltcl'</span> <span class='Operator'>: </span>$pl<span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>$lang <span class='Operator'>eq </span><span class='String'>'plpython'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>next</span> <span class='Control'>unless</span> <span class='Operator'>-</span>d <span class='String'>"../../$Config/plpython2"</span><span class='Delimiter'>; 
</span>            $lang <span class='Operator'>= </span><span class='String'>'plpythonu'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>next</span> <span class='Control'>unless</span> <span class='Operator'>-</span>d <span class='String'>"../../$Config/$lang"</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Keyword'>my </span>@lang_args <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>"--load-extension=$lang"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>chdir </span>$pl<span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>@tests <span class='Operator'>= </span><a href="vcregress.pl.html#LN553"><span class='Ref_to_Func'>fetchTests</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>$lang <span class='Operator'>eq </span><span class='String'>'plperl'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span> 
            <span class='Comment_Single_Line'># run both trusted and untrusted perl tests 
</span>            <span class='Keyword'>push</span><span class='Parentheses'>(</span>@lang_args<span class='Delimiter'>, </span><span class='String'>"--load-extension=plperlu"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Single_Line'># assume we're using this perl to built postgres 
</span>            <span class='Comment_Single_Line'># test if we can run two interpreters in one backend, and if so 
</span>            <span class='Comment_Single_Line'># run the trusted/untrusted interaction tests 
</span>            <span class='Control'>use</span> Config<span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>$Config<span class='Delimiter'>{</span>usemultiplicity<span class='Delimiter'>} </span><span class='Operator'>eq </span><span class='String'>'define'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>push</span><span class='Parentheses'>(</span>@tests<span class='Delimiter'>, </span><span class='String'>'plperl_plperlu'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Keyword'>print 
</span>          <span class='String'>"============================================================\n"</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>print </span><span class='String'>"Checking $lang\n"</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>@args <span class='Operator'>= </span><span class='Parentheses'>( 
</span>            <span class='String'>"../../../$Config/pg_regress/pg_regress"</span><span class='Delimiter'>, 
</span>            <span class='String'>"--bindir=../../../$Config/psql"</span><span class='Delimiter'>, 
</span>            <span class='String'>"--dbname=pl_regression"</span><span class='Delimiter'>, </span>@lang_args<span class='Delimiter'>, </span>@tests<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$status <span class='Operator'>= </span>$<span class='Operator'>? &GT;&GT; </span>8<span class='Delimiter'>; 
</span>        <span class='Control'>exit</span> $status <span class='Control'>if</span> $status<span class='Delimiter'>; 
</span>        <span class='Keyword'>chdir </span><span class='String'>".."</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Keyword'>chdir </span><span class='String'>"../../.."</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN288"></a><span class='Control'>sub</span> <span class='Declare_Function'>subdircheck</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$subdir <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$module <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>   <span class='Operator'>!-</span>d <span class='String'>"$module/sql"</span> 
        <span class='Operator'>|| !-</span>d <span class='String'>"$module/expected"</span> 
        <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>!-</span>f <span class='String'>"$module/GNUmakefile"</span> <span class='Operator'>&& !-</span>f <span class='String'>"$module/Makefile"</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Keyword'>chdir </span>$module<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@tests <span class='Operator'>= </span><a href="vcregress.pl.html#LN553"><span class='Ref_to_Func'>fetchTests</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@opts  <span class='Operator'>= </span><a href="vcregress.pl.html#LN520"><span class='Ref_to_Func'>fetchRegressOpts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># Add some options for transform modules, see their respective 
</span>    <span class='Comment_Single_Line'># Makefile for more details regarding Python-version specific 
</span>    <span class='Comment_Single_Line'># dependencies. 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>   $module <span class='Operator'>eq </span><span class='String'>"hstore_plpython"</span> 
        <span class='Operator'>|| </span>$module <span class='Operator'>eq </span><span class='String'>"ltree_plpython"</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>die</span> <span class='String'>"Python not enabled in configuration"</span> 
          <span class='Control'>if</span> <span class='Operator'>!</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>python<span class='Delimiter'>}</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Single_Line'># Attempt to get python version and location. 
</span>        <span class='Comment_Single_Line'># Assume python.exe in specified dir. 
</span>        <span class='Keyword'>my </span>$pythonprog <span class='Operator'>= </span><span class='String'>"import sys;"</span> <span class='Operator'>. </span><span class='String'>"print(str(sys.version_info[0]))"</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$prefixcmd  <span class='Operator'>= </span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>python<span class='Delimiter'>} </span><span class='Operator'>. </span><span class='String'>"\\python -c \"$pythonprog\""</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$pyver      <span class='Operator'>= `</span>$prefixcmd<span class='Operator'>`</span><span class='Delimiter'>; 
</span>        <span class='Control'>die</span> <span class='String'>"Could not query for python version!\n"</span> <span class='Control'>if</span> $<span class='Operator'>?</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>chomp</span><span class='Parentheses'>(</span>$pyver<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>$pyver <span class='Operator'>eq </span><span class='String'>"2"</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>push </span>@opts<span class='Delimiter'>, </span><span class='String'>"--load-extension=plpythonu"</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>push </span>@opts<span class='Delimiter'>, </span><span class='String'>'--load-extension='</span> <span class='Operator'>. </span>$module <span class='Operator'>. </span><span class='String'>'u'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span> 
            <span class='Comment_Single_Line'># disable tests on python3 for now. 
</span>            <span class='Keyword'>chdir </span><span class='String'>".."</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
 
    <span class='Keyword'>print </span><span class='String'>"============================================================\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"Checking $module\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@args <span class='Operator'>= </span><span class='Parentheses'>( 
</span>        <span class='String'>"$topdir/$Config/pg_regress/pg_regress"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--bindir=${topdir}/${Config}/psql"</span><span class='Delimiter'>, 
</span>        <span class='String'>"--dbname=contrib_regression"</span><span class='Delimiter'>, </span>@opts<span class='Delimiter'>, </span>@tests<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>chdir </span><span class='String'>".."</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN345"></a><span class='Control'>sub</span> <span class='Declare_Function'>contribcheck</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>chdir </span><span class='String'>"../../../contrib"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$mstat <span class='Operator'>= </span>0<span class='Delimiter'>; 
</span>    <span class='Control'>foreach</span> <span class='Keyword'>my </span>$module <span class='Parentheses'>(</span><span class='Keyword'>glob</span><span class='Parentheses'>(</span><span class='String'>"*"</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span> 
        <span class='Comment_Single_Line'># these configuration-based exclusions must match Install.pm 
</span>        <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$module <span class='Operator'>eq </span><span class='String'>"uuid-ossp"</span>     <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>uuid<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$module <span class='Operator'>eq </span><span class='String'>"sslinfo"</span>       <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>openssl<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$module <span class='Operator'>eq </span><span class='String'>"xml2"</span>          <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>xml<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$module <span class='Operator'>eq </span><span class='String'>"hstore_plperl"</span> <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>perl<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$module <span class='Operator'>eq </span><span class='String'>"hstore_plpython"</span> <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>python<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$module <span class='Operator'>eq </span><span class='String'>"ltree_plpython"</span>  <span class='Operator'>&& !</span><span class='Keyword'>defined</span><span class='Parentheses'>(</span>$config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>python<span class='Delimiter'>}</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>next</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>$module <span class='Operator'>eq </span><span class='String'>"sepgsql"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="vcregress.pl.html#LN288"><span class='Ref_to_Func'>subdircheck</span></a><span class='Parentheses'>(</span><span class='String'>"$topdir/contrib"</span><span class='Delimiter'>, </span>$module<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$status <span class='Operator'>= </span>$<span class='Operator'>? &GT;&GT; </span>8<span class='Delimiter'>; 
</span>        $mstat <span class='Operator'>||= </span>$status<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>exit</span> $mstat <span class='Control'>if</span> $mstat<span class='Delimiter'>; 
} 
</span> 
<a name="LN368"></a><span class='Control'>sub</span> <span class='Declare_Function'>modulescheck</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>chdir </span><span class='String'>"../../../src/test/modules"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$mstat <span class='Operator'>= </span>0<span class='Delimiter'>; 
</span>    <span class='Control'>foreach</span> <span class='Keyword'>my </span>$module <span class='Parentheses'>(</span><span class='Keyword'>glob</span><span class='Parentheses'>(</span><span class='String'>"*"</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="vcregress.pl.html#LN288"><span class='Ref_to_Func'>subdircheck</span></a><span class='Parentheses'>(</span><span class='String'>"$topdir/src/test/modules"</span><span class='Delimiter'>, </span>$module<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>my </span>$status <span class='Operator'>= </span>$<span class='Operator'>? &GT;&GT; </span>8<span class='Delimiter'>; 
</span>        $mstat <span class='Operator'>||= </span>$status<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>exit</span> $mstat <span class='Control'>if</span> $mstat<span class='Delimiter'>; 
} 
</span> 
<a name="LN381"></a><span class='Control'>sub</span> <span class='Declare_Function'>recoverycheck</span> 
<span class='Delimiter'>{ 
</span>    <a href="vcregress.pl.html#LN604"><span class='Ref_to_Func'>InstallTemp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>$mstat  <span class='Operator'>= </span>0<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$dir    <span class='Operator'>= </span><span class='String'>"$topdir/src/test/recovery"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$status <span class='Operator'>= </span><a href="vcregress.pl.html#LN175"><span class='Ref_to_Func'>tap_check</span></a><span class='Parentheses'>(</span>$dir<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>exit</span> $status <span class='Control'>if</span> $status<span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Single_Line'># Run "initdb", then reconfigure authentication. 
</span><a name="LN392"></a><span class='Control'>sub</span> <span class='Declare_Function'>standard_initdb</span> 
<span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span> 
        <span class='Keyword'>system</span><span class='Parentheses'>(</span><span class='String'>'initdb'</span><span class='Delimiter'>, </span><span class='String'>'-N'</span><span class='Parentheses'>) </span><span class='Operator'>== </span>0 and <span class='Keyword'>system</span><span class='Parentheses'>( 
</span>            <span class='String'>"$topdir/$Config/pg_regress/pg_regress"</span><span class='Delimiter'>, </span><span class='String'>'--config-auth'</span><span class='Delimiter'>, 
</span>            $ENV<span class='Delimiter'>{</span>PGDATA<span class='Delimiter'>}</span><span class='Parentheses'>) </span><span class='Operator'>== </span>0<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Single_Line'># This is similar to appendShellString().  Perl system(@args) bypasses 
# cmd.exe, so omit the caret escape layer. 
</span><a name="LN402"></a><span class='Control'>sub</span> <span class='Declare_Function'>quote_system_arg</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$arg <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># Change N &GT;= 0 backslashes before a double quote to 2N+1 backslashes. 
</span>    $arg <span class='Operator'>=~ s</span><span class='String'>/(\\*)"/${\($1 . $1)}\\"/</span>gs<span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># Change N &GT;= 1 backslashes at end of argument to 2N backslashes. 
</span>    $arg <span class='Operator'>=~ s</span><span class='String'>/(\\+)$/${\($1 . $1)}/</span>gs<span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># Wrap the whole thing in unescaped double quotes. 
</span>    <span class='Control'>return</span> <span class='String'>"\"$arg\""</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Single_Line'># Generate a database with a name made of a range of ASCII characters, useful 
# for testing pg_upgrade. 
</span><a name="LN418"></a><span class='Control'>sub</span> <span class='Declare_Function'>generate_db</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$prefix<span class='Delimiter'>, </span>$from_char<span class='Delimiter'>, </span>$to_char<span class='Delimiter'>, </span>$suffix<span class='Parentheses'>) </span><span class='Operator'>= </span>@_<span class='Delimiter'>; 
</span> 
    <span class='Keyword'>my </span>$dbname <span class='Operator'>= </span>$prefix<span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Keyword'>my </span>$i <span class='Parentheses'>(</span>$from_char <span class='Operator'>.. </span>$to_char<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>next</span> <span class='Control'>if</span> $i <span class='Operator'>== </span>7 <span class='Operator'>|| </span>$i <span class='Operator'>== </span>10 <span class='Operator'>|| </span>$i <span class='Operator'>== </span>13<span class='Delimiter'>;</span>    <span class='Comment_Single_Line'># skip BEL, LF, and CR 
</span>        $dbname <span class='Operator'>= </span>$dbname <span class='Operator'>. </span><span class='Keyword'>sprintf</span><span class='Parentheses'>(</span><span class='String'>'%c'</span><span class='Delimiter'>, </span>$i<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    $dbname <span class='Operator'>.= </span>$suffix<span class='Delimiter'>; 
</span> 
    <span class='Keyword'>system</span><span class='Parentheses'>(</span><span class='String'>'createdb'</span><span class='Delimiter'>, </span><a href="vcregress.pl.html#LN402"><span class='Ref_to_Func'>quote_system_arg</span></a><span class='Parentheses'>(</span>$dbname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$status <span class='Operator'>= </span>$<span class='Operator'>? &GT;&GT; </span>8<span class='Delimiter'>; 
</span>    <span class='Control'>exit</span> $status <span class='Control'>if</span> $status<span class='Delimiter'>; 
} 
</span> 
<a name="LN435"></a><span class='Control'>sub</span> <span class='Declare_Function'>upgradecheck</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$status<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$cwd <span class='Operator'>= </span>getcwd<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># Much of this comes from the pg_upgrade test.sh script, 
</span>    <span class='Comment_Single_Line'># but it only covers the --install case, and not the case 
</span>    <span class='Comment_Single_Line'># where the old and new source or bin dirs are different. 
</span>    <span class='Comment_Single_Line'># i.e. only this version to this version check. That's 
</span>    <span class='Comment_Single_Line'># what pg_upgrade's "make check" does. 
</span> 
    $ENV<span class='Delimiter'>{</span>PGHOST<span class='Delimiter'>} </span><span class='Operator'>= </span><span class='String'>'localhost'</span><span class='Delimiter'>; 
</span>    $ENV<span class='Delimiter'>{</span>PGPORT<span class='Delimiter'>} </span><span class='Operator'>||= </span>50432<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$tmp_root <span class='Operator'>= </span><span class='String'>"$topdir/src/bin/pg_upgrade/tmp_check"</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>mkdir </span>$tmp_root <span class='Operator'>|| </span><span class='Control'>die</span> $<span class='Operator'>!</span><span class='Parentheses'>) </span><span class='Control'>unless</span> <span class='Operator'>-</span>d $tmp_root<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$upg_tmp_install <span class='Operator'>= </span><span class='String'>"$tmp_root/install"</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'># unshared temp install 
</span>    <span class='Keyword'>print </span><span class='String'>"Setting up temp install\n\n"</span><span class='Delimiter'>; 
</span>    <a href="Install.pm.html#LN44"><span class='Ref_to_Func'>Install</span></a><span class='Parentheses'>(</span>$upg_tmp_install<span class='Delimiter'>, </span><span class='String'>"all"</span><span class='Delimiter'>, </span>$config<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># Install does a chdir, so change back after that 
</span>    <span class='Keyword'>chdir </span>$cwd<span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span><span class='Parentheses'>(</span>$bindir<span class='Delimiter'>, </span>$libdir<span class='Delimiter'>, </span>$oldsrc<span class='Delimiter'>, </span>$newsrc<span class='Parentheses'>) </span><span class='Operator'>= 
</span>      <span class='Parentheses'>(</span><span class='String'>"$upg_tmp_install/bin"</span><span class='Delimiter'>, </span><span class='String'>"$upg_tmp_install/lib"</span><span class='Delimiter'>, </span>$topdir<span class='Delimiter'>, </span>$topdir<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $ENV<span class='Delimiter'>{</span>PATH<span class='Delimiter'>} </span><span class='Operator'>= </span><span class='String'>"$bindir;$ENV{PATH}"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$data <span class='Operator'>= </span><span class='String'>"$tmp_root/data"</span><span class='Delimiter'>; 
</span>    $ENV<span class='Delimiter'>{</span>PGDATA<span class='Delimiter'>} </span><span class='Operator'>= </span><span class='String'>"$data.old"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$logdir <span class='Operator'>= </span><span class='String'>"$topdir/src/bin/pg_upgrade/log"</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>mkdir </span>$logdir <span class='Operator'>|| </span><span class='Control'>die</span> $<span class='Operator'>!</span><span class='Parentheses'>) </span><span class='Control'>unless</span> <span class='Operator'>-</span>d $logdir<span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nRunning initdb on old cluster\n\n"</span><span class='Delimiter'>; 
</span>    <a href="vcregress.pl.html#LN392"><span class='Ref_to_Func'>standard_initdb</span></a><span class='Parentheses'>() </span>or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nStarting old cluster\n\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@args <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>'pg_ctl'</span><span class='Delimiter'>, </span><span class='String'>'start'</span><span class='Delimiter'>, </span><span class='String'>'-l'</span><span class='Delimiter'>, </span><span class='String'>"$logdir/postmaster1.log"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>) </span><span class='Operator'>== </span>0 or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span> 
    <span class='Keyword'>print </span><span class='String'>"\nCreating databases with names covering most ASCII bytes\n\n"</span><span class='Delimiter'>; 
</span>    <a href="vcregress.pl.html#LN418"><span class='Ref_to_Func'>generate_db</span></a><span class='Parentheses'>(</span><span class='String'>"\\\"\\"</span><span class='Delimiter'>, </span>1<span class='Delimiter'>,</span>  45<span class='Delimiter'>,</span>  <span class='String'>"\\\\\"\\\\\\"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="vcregress.pl.html#LN418"><span class='Ref_to_Func'>generate_db</span></a><span class='Parentheses'>(</span><span class='String'>''</span><span class='Delimiter'>,</span>       46<span class='Delimiter'>, </span>90<span class='Delimiter'>,</span>  <span class='String'>''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="vcregress.pl.html#LN418"><span class='Ref_to_Func'>generate_db</span></a><span class='Parentheses'>(</span><span class='String'>''</span><span class='Delimiter'>,</span>       91<span class='Delimiter'>, </span>127<span class='Delimiter'>, </span><span class='String'>''</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>print </span><span class='String'>"\nSetting up data for upgrading\n\n"</span><span class='Delimiter'>; 
</span>    <a href="vcregress.pl.html#LN98"><span class='Ref_to_Func'>installcheck</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Single_Line'># now we can chdir into the source dir 
</span>    <span class='Keyword'>chdir </span><span class='String'>"$topdir/src/bin/pg_upgrade"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nDumping old cluster\n\n"</span><span class='Delimiter'>; 
</span>    @args <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>'pg_dumpall'</span><span class='Delimiter'>, </span><span class='String'>'-f'</span><span class='Delimiter'>, </span><span class='String'>"$tmp_root/dump1.sql"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>) </span><span class='Operator'>== </span>0 or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nStopping old cluster\n\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span><span class='String'>"pg_ctl stop"</span><span class='Parentheses'>) </span><span class='Operator'>== </span>0 or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span>    $ENV<span class='Delimiter'>{</span>PGDATA<span class='Delimiter'>} </span><span class='Operator'>= </span><span class='String'>"$data"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nSetting up new cluster\n\n"</span><span class='Delimiter'>; 
</span>    <a href="vcregress.pl.html#LN392"><span class='Ref_to_Func'>standard_initdb</span></a><span class='Parentheses'>() </span>or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nRunning pg_upgrade\n\n"</span><span class='Delimiter'>; 
</span>    @args <span class='Operator'>= </span><span class='Parentheses'>( 
</span>        <span class='String'>'pg_upgrade'</span><span class='Delimiter'>, </span><span class='String'>'-d'</span><span class='Delimiter'>, </span><span class='String'>"$data.old"</span><span class='Delimiter'>, </span><span class='String'>'-D'</span><span class='Delimiter'>, </span>$data<span class='Delimiter'>, </span><span class='String'>'-b'</span><span class='Delimiter'>, 
</span>        $bindir<span class='Delimiter'>,</span>      <span class='String'>'-B'</span><span class='Delimiter'>, </span>$bindir<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>) </span><span class='Operator'>== </span>0 or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nStarting new cluster\n\n"</span><span class='Delimiter'>; 
</span>    @args <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>'pg_ctl'</span><span class='Delimiter'>, </span><span class='String'>'-l'</span><span class='Delimiter'>, </span><span class='String'>"$logdir/postmaster2.log"</span><span class='Delimiter'>, </span><span class='String'>'start'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>) </span><span class='Operator'>== </span>0 or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nSetting up stats on new cluster\n\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span><span class='String'>".\\analyze_new_cluster.bat"</span><span class='Parentheses'>) </span><span class='Operator'>== </span>0 or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nDumping new cluster\n\n"</span><span class='Delimiter'>; 
</span>    @args <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>'pg_dumpall'</span><span class='Delimiter'>, </span><span class='String'>'-f'</span><span class='Delimiter'>, </span><span class='String'>"$tmp_root/dump2.sql"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>) </span><span class='Operator'>== </span>0 or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nStopping new cluster\n\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span><span class='String'>"pg_ctl stop"</span><span class='Parentheses'>) </span><span class='Operator'>== </span>0 or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nDeleting old cluster\n\n"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span><span class='String'>".\\delete_old_cluster.bat"</span><span class='Parentheses'>) </span><span class='Operator'>== </span>0 or <span class='Control'>exit</span> 1<span class='Delimiter'>; 
</span>    <span class='Keyword'>print </span><span class='String'>"\nComparing old and new cluster dumps\n\n"</span><span class='Delimiter'>; 
</span> 
    @args <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='String'>'diff'</span><span class='Delimiter'>, </span><span class='String'>'-q'</span><span class='Delimiter'>, </span><span class='String'>"$tmp_root/dump1.sql"</span><span class='Delimiter'>, </span><span class='String'>"$tmp_root/dump2.sql"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>system</span><span class='Parentheses'>(</span>@args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    $status <span class='Operator'>= </span>$<span class='Operator'>?</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>$status<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>print </span><span class='String'>"PASSED\n"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>print </span><span class='String'>"dumps not identical!\n"</span><span class='Delimiter'>; 
</span>        <span class='Control'>exit</span><span class='Parentheses'>(</span>1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<a name="LN520"></a><span class='Control'>sub</span> <span class='Declare_Function'>fetchRegressOpts</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$handle<span class='Delimiter'>; 
</span>    <span class='Keyword'>open</span><span class='Parentheses'>(</span>$handle<span class='Delimiter'>, </span><span class='String'>'&LT;'</span><span class='Delimiter'>, </span><span class='String'>"GNUmakefile"</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span><span class='Keyword'>open</span><span class='Parentheses'>(</span>$handle<span class='Delimiter'>, </span><span class='String'>'&LT;'</span><span class='Delimiter'>, </span><span class='String'>"Makefile"</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span><span class='Control'>die</span> <span class='String'>"Could not open Makefile"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>local </span><span class='Parentheses'>(</span>$<span class='Operator'>/</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='Keyword'>undef</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$m <span class='Operator'>= &LT;</span>$handle<span class='Operator'>&GT;</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>close</span><span class='Parentheses'>(</span>$handle<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>@opts<span class='Delimiter'>; 
</span> 
    $m <span class='Operator'>=~ s</span><span class='String'>{\\\r?\n}{}g; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$m <span class='Operator'>=~ /^\s*REGRESS_OPTS\s*\+?=(.*)/m</span><span class='String'>) 
</span>    <span class='Delimiter'>{ 
</span> 
        <span class='Comment_Single_Line'># Substitute known Makefile variables, then ignore options that retain 
</span>        <span class='Comment_Single_Line'># an unhandled variable reference.  Ignore anything that isn't an 
</span>        <span class='Comment_Single_Line'># option starting with "--". 
</span>        @opts <span class='Operator'>= </span><span class='Keyword'>grep </span><span class='Delimiter'>{ </span><span class='Operator'>!/\$\(/ && /^--/ </span><span class='Delimiter'>} 
</span>          <span class='Keyword'>map </span><span class='Delimiter'>{ </span><span class='Parentheses'>(</span><span class='Keyword'>my </span>$x <span class='Operator'>= </span>$_<span class='Parentheses'>)</span> <span class='Operator'>=~ s</span><span class='String'>/\Q$(top_builddir)\E/\"$topdir\"/</span><span class='Delimiter'>; </span>$x<span class='Delimiter'>; } 
</span>          <span class='Keyword'>split</span><span class='Parentheses'>(</span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$1<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$m <span class='Operator'>=~ /^\s*ENCODING\s*=\s*(\S+)/m</span><span class='String'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>push </span>@opts<span class='Delimiter'>, </span><span class='String'>"--encoding=$1"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$m <span class='Operator'>=~ /^\s*NO_LOCALE\s*=\s*\S+/m</span><span class='String'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>push </span>@opts<span class='Delimiter'>, </span><span class='String'>"--no-locale"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> @opts<span class='Delimiter'>; 
} 
</span> 
<a name="LN553"></a><span class='Control'>sub</span> <span class='Declare_Function'>fetchTests</span> 
<span class='Delimiter'>{ 
</span> 
    <span class='Keyword'>my </span>$handle<span class='Delimiter'>; 
</span>    <span class='Keyword'>open</span><span class='Parentheses'>(</span>$handle<span class='Delimiter'>, </span><span class='String'>'&LT;'</span><span class='Delimiter'>, </span><span class='String'>"GNUmakefile"</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span><span class='Keyword'>open</span><span class='Parentheses'>(</span>$handle<span class='Delimiter'>, </span><span class='String'>'&LT;'</span><span class='Delimiter'>, </span><span class='String'>"Makefile"</span><span class='Parentheses'>) 
</span>      <span class='Operator'>|| </span><span class='Control'>die</span> <span class='String'>"Could not open Makefile"</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>local </span><span class='Parentheses'>(</span>$<span class='Operator'>/</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='Keyword'>undef</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$m <span class='Operator'>= &LT;</span>$handle<span class='Operator'>&GT;</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>close</span><span class='Parentheses'>(</span>$handle<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$t <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span> 
    $m <span class='Operator'>=~ s</span><span class='String'>{\\\r?\n}{}g; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$m <span class='Operator'>=~ /^REGRESS\s*=\s*(.*)$/</span>gm<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        $t <span class='Operator'>= </span>$1<span class='Delimiter'>; 
</span>        $t <span class='Operator'>=~ s</span><span class='String'>/\s+/ /</span>g<span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>$m <span class='Operator'>=~ /contrib\/pgcrypto/</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span> 
            <span class='Comment_Single_Line'># pgcrypto is special since the tests depend on the 
</span>            <span class='Comment_Single_Line'># configuration of the build 
</span> 
            <span class='Keyword'>my </span>$cftests <span class='Operator'>= 
</span>              $config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>openssl<span class='Delimiter'>} 
</span>              <span class='Operator'>? </span><a href="vcregress.pl.html#LN593"><span class='Ref_to_Func'>GetTests</span></a><span class='Parentheses'>(</span><span class='String'>"OSSL_TESTS"</span><span class='Delimiter'>, </span>$m<span class='Parentheses'>) 
</span>              <span class='Operator'>: </span><a href="vcregress.pl.html#LN593"><span class='Ref_to_Func'>GetTests</span></a><span class='Parentheses'>(</span><span class='String'>"INT_TESTS"</span><span class='Delimiter'>,</span>  $m<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>my </span>$pgptests <span class='Operator'>= 
</span>              $config<span class='Operator'>-&GT;</span><span class='Delimiter'>{</span>zlib<span class='Delimiter'>} 
</span>              <span class='Operator'>? </span><a href="vcregress.pl.html#LN593"><span class='Ref_to_Func'>GetTests</span></a><span class='Parentheses'>(</span><span class='String'>"ZLIB_TST"</span><span class='Delimiter'>,</span>     $m<span class='Parentheses'>) 
</span>              <span class='Operator'>: </span><a href="vcregress.pl.html#LN593"><span class='Ref_to_Func'>GetTests</span></a><span class='Parentheses'>(</span><span class='String'>"ZLIB_OFF_TST"</span><span class='Delimiter'>, </span>$m<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            $t <span class='Operator'>=~ s</span><span class='String'>/\$\(CF_TESTS\)/$cftests/</span><span class='Delimiter'>; 
</span>            $t <span class='Operator'>=~ s</span><span class='String'>/\$\(CF_PGP_TESTS\)/$pgptests/</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Keyword'>split</span><span class='Parentheses'>(</span><span class='Operator'>/\s+/</span><span class='Delimiter'>, </span>$t<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN593"></a><span class='Control'>sub</span> <span class='Declare_Function'>GetTests</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>my </span>$testname <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Keyword'>my </span>$m        <span class='Operator'>= </span><span class='Keyword'>shift</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>$m <span class='Operator'>=~ /^$testname\s*=\s*(.*)$/</span>gm<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>return</span> $1<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='String'>""</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN604"></a><span class='Control'>sub</span> <span class='Declare_Function'>InstallTemp</span> 
<span class='Delimiter'>{ 
</span>    <span class='Control'>unless</span> <span class='Parentheses'>(</span>$ENV<span class='Delimiter'>{</span>NO_TEMP_INSTALL<span class='Delimiter'>}</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Keyword'>print </span><span class='String'>"Setting up temp install\n\n"</span><span class='Delimiter'>; 
</span>        <a href="Install.pm.html#LN44"><span class='Ref_to_Func'>Install</span></a><span class='Parentheses'>(</span><span class='String'>"$tmp_installdir"</span><span class='Delimiter'>, </span><span class='String'>"all"</span><span class='Delimiter'>, </span>$config<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    $ENV<span class='Delimiter'>{</span>PATH<span class='Delimiter'>} </span><span class='Operator'>= </span><span class='String'>"$tmp_installdir/bin;$ENV{PATH}"</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN614"></a><span class='Control'>sub</span> <span class='Declare_Function'>usage</span> 
<span class='Delimiter'>{ 
</span>    <span class='Keyword'>print </span>STDERR 
      <span class='String'>"Usage: vcregress.pl &LT;mode&GT; [ &LT;arg&GT;]\n\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"Options for &LT;mode&GT;:\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  bincheck       run tests of utilities in src/bin/\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  check          deploy instance and run regression tests on it\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  contribcheck   run tests of modules in contrib/\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  ecpgcheck      run regression tests of ECPG\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  installcheck   run regression tests on existing instance\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  isolationcheck run isolation tests\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  modulescheck   run tests of modules in src/test/modules/\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  plcheck        run tests of PL languages\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  recoverycheck  run recovery test suite\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  taptest        run an arbitrary TAP test set\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  upgradecheck   run tests of pg_upgrade\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"\nOptions for &LT;arg&GT;: (used by check and installcheck)\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  serial         serial mode\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  parallel       parallel mode\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"\nOption for &LT;arg&GT;: for taptest\n"</span><span class='Delimiter'>, 
</span>      <span class='String'>"  TEST_DIR       (required) directory where tests reside\n"</span><span class='Delimiter'>; 
</span>    <span class='Control'>exit</span><span class='Parentheses'>(</span>1<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>